{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/panels/WatchlistPanel.tsx"],"sourcesContent":["import { useState, useRef, useEffect, useMemo, useCallback } from 'react'\nimport FlagIcon from '../ui/FlagIcon'\nimport IconButton from '../ui/IconButton'\nimport { LuGripVertical } from 'react-icons/lu'\nimport { FiStar, FiSearch, FiSlash } from 'react-icons/fi'\nimport { useAccount } from '../../context/AccountContext'\nimport { useInstruments } from '../../context/InstrumentContext'\nimport { useWebSocket } from '../../context/WebSocketContext'\nimport { useTrading } from '../../context/TradingContext'\nimport { cn } from '../../lib/utils'\n\n// Extract Row for performance/blink logic\nconst InstrumentRow = ({ item, isVisible, toggleFavorite, lastQuote, handleDragStart, handleDragEnter, handleDragEnd, idx, onSelect, addNavbarTab }) => {\n  // Refs for tracking previous values to trigger blinks\n  const prevBidRef = useRef(item.bid);\n  const prevAskRef = useRef(item.ask);\n\n  // Live Data or Static Fallback\n  const quote = lastQuote || {};\n\n  // Format to 6 significant digits total\n  const formatPrice = (price: number | undefined | null): string => {\n    if (price === undefined || price === null) return '0.00000';\n\n    const priceNum = Number(price);\n    if (isNaN(priceNum) || priceNum === 0) return '0.00000';\n\n    // Use toPrecision(6) for exactly 6 significant digits\n    return parseFloat(priceNum.toPrecision(6)).toString();\n  };\n\n  const bid = formatPrice(quote.bid ?? item.bid);\n  const ask = formatPrice(quote.ask ?? item.ask);\n\n  // Spread calculation\n  const spread = quote.spread !== undefined ? quote.spread : (item.spread || 0);\n\n  // Weekend market closure (all non-crypto instruments)\n  const isWeekend = [0, 6].includes(new Date().getUTCDay());\n  const isCrypto = (item.category || '').toLowerCase().includes('crypto');\n  const isMarketClosed = isWeekend && !isCrypto;\n\n  // Calculate Day Change (as Range %)\n  // \"calculate how much is in +ve or -ve inpercentage based on day high/low and current\"\n  let dayChangeLabel = '0.00%';\n  let changeColor = 'gray';\n\n  if (quote.dayHigh && quote.dayLow && quote.bid) {\n    const range = quote.dayHigh - quote.dayLow;\n    if (range > 0) {\n      const pct = ((quote.bid - quote.dayLow) / range) * 100;\n      // If closer to High = Green? Closer to Low = Red?\n      // Or usually change is vs Open. Since we don't have Open, I will map Range % to a visual indicator\n      // But the column says \"1D Change\". Let's show Range % for now as requested.\n      dayChangeLabel = `${pct.toFixed(2)}%`;\n      changeColor = pct > 50 ? 'green' : 'red';\n    }\n  } else if (item.change) {\n    dayChangeLabel = item.change;\n    changeColor = parseFloat(item.change) >= 0 ? 'green' : 'red';\n  }\n\n  // Blink Logic\n  const [bidColor, setBidColor] = useState('');\n  const [askColor, setAskColor] = useState('');\n\n  useEffect(() => {\n    if (quote.bid && prevBidRef.current !== quote.bid) {\n      const color = quote.bid > prevBidRef.current ? 'text-[#2ebd85]' : 'text-[#f6465d]';\n      setBidColor(color);\n      const timer = setTimeout(() => setBidColor(''), 300); // Blink duration\n      prevBidRef.current = quote.bid;\n      return () => clearTimeout(timer);\n    }\n  }, [quote.bid]);\n\n  useEffect(() => {\n    if (quote.ask && prevAskRef.current !== quote.ask) {\n      const color = quote.ask > prevAskRef.current ? 'text-[#2ebd85]' : 'text-[#f6465d]';\n      setAskColor(color);\n      const timer = setTimeout(() => setAskColor(''), 300);\n      prevAskRef.current = quote.ask;\n      return () => clearTimeout(timer);\n    }\n  }, [quote.ask]);\n\n  // Fallback static color logic\n  const staticBidColor = changeColor === 'green' ? 'text-[#2ebd85]' : 'text-[#f6465d]';\n  const staticAskColor = changeColor === 'green' ? 'text-[#2ebd85]' : 'text-[#f6465d]';\n\n  return (\n    <div\n      draggable\n      onDragStart={(e) => handleDragStart(e, idx)}\n      onDragEnter={(e) => handleDragEnter(e, idx)}\n      onDragEnd={handleDragEnd}\n      onClick={() => {\n        onSelect(item.symbol);\n        // Also add to Navbar if not already there\n        if (addNavbarTab) {\n          addNavbarTab(item.symbol);\n        }\n      }}\n      className=\"group grid grid-cols-[30px_36px_minmax(100px,1fr)_auto_auto_auto_30px] gap-0 items-center border-b border-gray-800 hover:bg-[#1c252f] transition-colors h-[40px] cursor-pointer min-w-0\"\n    >\n      {/* Grip Handle */}\n      <div className=\"flex items-center justify-center text-[#565c66] cursor-grab active:cursor-grabbing bg-[#0b0e14] group-hover:bg-[#1c252f] h-full transition-colors border-r border-gray-800\">\n        <LuGripVertical size={14} />\n      </div>\n\n      {/* Flag */}\n      <div className=\"flex items-center justify-center bg-[#0b0e14] group-hover:bg-[#1c252f] h-full transition-colors border-r border-gray-800 p-1.5\">\n        <div className=\"w-6 h-6 rounded-full overflow-hidden\">\n          <FlagIcon symbol={item.symbol} />\n        </div>\n      </div>\n\n      {/* Symbol */}\n      <div className=\"pl-2 flex flex-col justify-center border-r border-gray-800 bg-[#0b0e14] group-hover:bg-[#1c252f] h-full transition-colors overflow-hidden min-w-[100px] flex-shrink-0\">\n        <span className=\"text-[13px] font-bold text-gray-200 truncate\">{item.symbol}</span>\n        {isVisible('description') && <span className=\"text-[10px] text-gray-500 truncate\">{item.description || item.name}</span>}\n        {isMarketClosed && (\n          <span className=\"flex items-center gap-1 text-amber-400\">\n            <FiSlash size={12} />\n          </span>\n        )}\n      </div>\n\n      {/* Bid */}\n      {isVisible('bid') && (\n        <div className=\"px-1 w-[90px] min-w-[90px] text-center flex items-center justify-center h-full flex-shrink-0\">\n          <span className={cn(\n            \"text-[12px] font-medium px-1.5 py-1 rounded-[4px] w-full block transition-colors bg-[#2ebd85]/10 truncate\",\n            bidColor || staticBidColor\n          )}>\n            {bid}\n          </span>\n        </div>\n      )}\n\n      {/* Ask */}\n      {isVisible('ask') && (\n        <div className=\"px-1 w-[90px] min-w-[90px] text-center flex items-center justify-center h-full flex-shrink-0\">\n          <span className={cn(\n            \"text-[12px] font-medium px-1.5 py-1 rounded-[4px] w-full block transition-colors bg-[#f6465d]/10 truncate\",\n            askColor || staticAskColor\n          )}>\n            {ask}\n          </span>\n        </div>\n      )}\n\n      {/* 1D Change */}\n      {isVisible('change') && (\n        <div className={cn(\n          \"px-1 w-[70px] min-w-[70px] text-center text-[11px] font-medium flex items-center justify-center h-full truncate flex-shrink-0\",\n          changeColor === 'green' ? 'text-[#2ebd85]' : 'text-[#f6465d]'\n        )}>\n          {dayChangeLabel}\n        </div>\n      )}\n\n      {/* Star / Favorite */}\n      <div className=\"flex items-center justify-center h-full\">\n        <button\n          onClick={(e) => { e.stopPropagation(); toggleFavorite(item.id); }}\n          className={`text-[14px] transition-colors ${item.favorite ? 'text-[#f59e0b]' : 'text-gray-600 hover:text-gray-400'}`}\n        >\n          {item.favorite ? <FiStar fill=\"currentColor\" /> : <FiStar />}\n        </button>\n      </div>\n\n    </div>\n  )\n}\n\nexport default function WatchlistPanel({ onClose }) {\n  const { currentAccount } = useAccount()\n  const { setSymbol, addNavbarTab } = useTrading()\n  const {\n    instruments,\n    categories: dynamicCategories,\n    isLoading,\n    toggleFavorite,\n    reorderInstruments\n  } = useInstruments()\n  const { subscribe, unsubscribe, lastQuotes, normalizeSymbol } = useWebSocket()\n\n  const [searchTerm, setSearchTerm] = useState('')\n  const [selectedCategory, setSelectedCategory] = useState('Favorites')\n  const [showCategoryDropdown, setShowCategoryDropdown] = useState(false)\n  const [showPriceHighlight, setShowPriceHighlight] = useState(false)\n\n  // Columns configuration based on \"Image 2\"\n  const [columns, setColumns] = useState([\n    { id: 'flag', label: '', visible: true, draggable: false },\n    { id: 'signal', label: 'Signal', visible: false, draggable: true },\n    { id: 'description', label: 'Description', visible: true, draggable: true },\n    { id: 'bid', label: 'Bid', visible: true, draggable: true },\n    { id: 'spread', label: 'Spread', visible: false, draggable: true },\n    { id: 'ask', label: 'Ask', visible: true, draggable: true },\n    { id: 'change', label: '1D change', visible: true, draggable: true },\n    { id: 'chart', label: 'Show chart', visible: false, draggable: false },\n    { id: 'pl', label: 'P/L', visible: false, draggable: true },\n  ])\n\n  // Drag and drop logic\n  const dragItem = useRef<number | null>(null)\n  const dragOverItem = useRef<number | null>(null)\n\n  const handleDragStart = (e: React.DragEvent, position: number) => {\n    dragItem.current = position\n    e.dataTransfer.effectAllowed = 'move'\n  }\n\n  const handleDragEnter = (e: React.DragEvent, position: number) => {\n    dragOverItem.current = position\n    e.preventDefault()\n  }\n\n  const handleDragEnd = async () => {\n    if (dragItem.current !== null && dragOverItem.current !== null && dragItem.current !== dragOverItem.current) {\n      const newList = [...instruments]\n\n      // Map filtered indices back to original indices\n      const itemToMove = filteredItems[dragItem.current]\n      const targetItem = filteredItems[dragOverItem.current]\n\n      const fromIdx = newList.findIndex(i => i.id === itemToMove.id)\n      const toIdx = newList.findIndex(i => i.id === targetItem.id)\n\n      if (fromIdx !== -1 && toIdx !== -1) {\n        newList.splice(fromIdx, 1)\n        newList.splice(toIdx, 0, itemToMove)\n        await reorderInstruments(newList)\n      }\n    }\n    dragItem.current = null\n    dragOverItem.current = null\n  }\n\n  const items = instruments\n\n  const isVisible = (id: string) => columns.find(c => c.id === id)?.visible\n\n  const toggleColumn = (id: string) => {\n    setColumns(columns.map(col =>\n      col.id === id ? { ...col, visible: !col.visible } : col\n    ))\n  }\n\n  const filteredItems = useMemo(() => {\n    let filtered = items;\n\n    // Filter by Category\n    if (selectedCategory === 'Favorites') {\n      filtered = filtered.filter(item => item.favorite);\n    } else if (selectedCategory !== 'All instruments') {\n      filtered = filtered.filter(item => item.category === selectedCategory);\n    }\n\n    // Filter by Search\n    if (searchTerm) {\n      const lowerTerm = searchTerm.toLowerCase();\n      filtered = filtered.filter(item =>\n        item.symbol.toLowerCase().includes(lowerTerm) ||\n        (item.name && item.name.toLowerCase().includes(lowerTerm)) ||\n        (item.description && item.description.toLowerCase().includes(lowerTerm))\n      );\n    }\n\n    return filtered;\n  }, [items, selectedCategory, searchTerm]);\n\n  // Automatically switch to 'All instruments' if Favorites is selected but empty\n  useEffect(() => {\n    if (selectedCategory === 'Favorites' && filteredItems.length === 0 && items.length > 0) {\n      setSelectedCategory('All instruments');\n    }\n  }, [selectedCategory, filteredItems.length, items.length]);\n\n  // Handle Subscriptions\n  useEffect(() => {\n    const symbols = filteredItems.map(i => i.symbol);\n    subscribe(symbols);\n    return () => unsubscribe(symbols); // Cleanup on unmount/change\n  }, [filteredItems, subscribe, unsubscribe]);\n\n\n  return (\n    <div className=\"flex flex-col h-full overflow-hidden bg-background text-[#b2b5be] font-sans border border-gray-800 rounded-md\">\n\n      {/* New Header Layout: Dropdown Title + Actions */}\n      <header className=\"flex items-center justify-between pl-3 pr-2 py-2 flex-shrink-0 min-h-[44px] border-b border-gray-800/50\">\n\n        {/* Dropdown Title Trigger */}\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowCategoryDropdown(!showCategoryDropdown)}\n            className=\"flex items-center gap-2 text-[14px] font-semibold text-white hover:text-gray-300 transition-colors\"\n          >\n            {selectedCategory}\n            <svg width=\"10\" height=\"6\" viewBox=\"0 0 10 6\" fill=\"none\" className={`transition-transform duration-200 ${showCategoryDropdown ? 'rotate-180' : ''}`}>\n              <path d=\"M1 1L5 5L9 1\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n            </svg>\n          </button>\n\n          {/* Dropdown Menu */}\n          {showCategoryDropdown && (\n            <>\n              <div className=\"fixed inset-0 z-40\" onClick={() => setShowCategoryDropdown(false)}></div>\n              <div className=\"absolute top-full left-0 mt-2 w-[220px] bg-[#1a1e25] border border-gray-700 rounded-lg shadow-xl z-50 py-1 max-h-[400px] overflow-y-auto\">\n                {dynamicCategories.map(cat => (\n                  <div\n                    key={cat}\n                    onClick={() => {\n                      setSelectedCategory(cat);\n                      setShowCategoryDropdown(false);\n                    }}\n                    className=\"px-4 py-2.5 text-[13px] text-gray-300 hover:bg-[#2a303c] hover:text-white cursor-pointer flex items-center justify-between group transition-colors\"\n                  >\n                    <span>{cat}</span>\n                    {selectedCategory === cat ? (\n                      <svg width=\"10\" height=\"8\" viewBox=\"0 0 10 8\" fill=\"none\" className=\"text-white\">\n                        <path d=\"M1 4L3.5 6.5L9 1\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n                      </svg>\n                    ) : (\n                      <span className=\"opacity-0 group-hover:opacity-100 text-[#f59e0b]\">\n                        <FiStar size={12} fill=\"currentColor\" />\n                      </span>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </>\n          )}\n        </div>\n\n        {/* Actions: Settings + Close */}\n        <div className=\"flex items-center gap-1\">\n\n          <button\n            onClick={onClose}\n            className=\"p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded transition-colors\"\n          >\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n              <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" />\n              <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" />\n            </svg>\n          </button>\n        </div>\n      </header>\n\n      {/* Search Bar - Below Header */}\n      <div className=\"px-3 py-2 flex-shrink-0 border-b border-gray-800/50\">\n        <div className=\"relative group bg-[#131720] rounded-md border border-gray-800 group-focus-within:border-gray-600 transition-colors\">\n          <div className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n              <circle cx=\"11\" cy=\"11\" r=\"8\" />\n              <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\" />\n            </svg>\n          </div>\n          <input\n            type=\"text\"\n            placeholder=\"Search\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"w-full pl-9 pr-3 py-1.5 bg-transparent text-[13px] text-white placeholder-gray-600 focus:outline-none\"\n          />\n        </div>\n      </div>\n\n      {/* Table Header */}\n      <div className=\"grid grid-cols-[30px_36px_minmax(100px,1fr)_auto_auto_auto_30px] gap-0 border-b border-gray-800 bg-background text-[11px] font-medium text-gray-500 uppercase min-w-0\">\n        <div className=\"py-2 text-center bg-[#0b0e14] border-r border-gray-800\"></div> {/* Grip placeholder */}\n        <div className=\"py-2 text-center bg-[#0b0e14] border-r border-gray-800\"></div> {/* Flag placeholder */}\n        <div className=\"py-2 pl-2 text-left bg-[#0b0e14] border-r border-gray-800 min-w-[100px] flex-shrink-0\">Symbol</div>\n\n        {isVisible('bid') && <div className=\"py-2 px-1 text-center w-[90px] min-w-[90px] flex-shrink-0\">Bid</div>}\n        {isVisible('ask') && <div className=\"py-2 px-1 text-center w-[90px] min-w-[90px] flex-shrink-0\">Ask</div>}\n        {isVisible('change') && <div className=\"py-2 px-1 text-center w-[70px] min-w-[70px] flex-shrink-0\">1D</div>}\n\n        <div className=\"py-2 text-center\"></div> {/* Star placeholder */}\n      </div>\n\n      {/* Table Content */}\n      <div className=\"flex-1 overflow-y-auto overflow-x-auto custom-scrollbar\">\n        {filteredItems.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-gray-600 grayscale opacity-40 py-10\">\n            <FiSearch size={48} className=\"mb-4\" />\n            <span className=\"text-[14px] font-medium\">No symbols found</span>\n            {currentAccount?.group && <span className=\"text-[11px] mt-1 opacity-60\">for {currentAccount.group}</span>}\n          </div>\n        ) : (\n          <div className=\"min-w-max\">\n            {filteredItems.map((item, idx) => (\n              <InstrumentRow\n                key={item.id}\n                item={item}\n                idx={idx}\n                isVisible={isVisible}\n                toggleFavorite={toggleFavorite}\n                lastQuote={lastQuotes[normalizeSymbol(item.symbol)]}\n                handleDragStart={handleDragStart}\n                handleDragEnter={handleDragEnter}\n                handleDragEnd={handleDragEnd}\n                onSelect={setSymbol}\n                addNavbarTab={addNavbarTab}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 795, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/ui/Tooltip.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef, useEffect } from 'react'\nimport { createPortal } from 'react-dom'\n\nexport default function Tooltip({ children, text, className = '', placement = 'bottom' }: { children: React.ReactNode, text: string, className?: string, placement?: 'bottom' | 'top' | 'right' | 'left' }) {\n  const [isVisible, setIsVisible] = useState(false)\n  const [coords, setCoords] = useState({ top: 0, left: 0 })\n  const triggerRef = useRef<HTMLDivElement>(null)\n\n  const updatePosition = () => {\n    if (triggerRef.current) {\n      const rect = triggerRef.current.getBoundingClientRect()\n      const scrollX = window.scrollX\n      const scrollY = window.scrollY\n\n      let top = 0\n      let left = 0\n\n      switch (placement) {\n        case 'bottom':\n          top = rect.bottom + scrollY + 8\n          left = rect.left + scrollX + rect.width / 2\n          break\n        case 'top':\n          top = rect.top + scrollY - 8\n          left = rect.left + scrollX + rect.width / 2\n          break\n        case 'right':\n          top = rect.top + scrollY + rect.height / 2\n          left = rect.right + scrollX + 8\n          break\n        case 'left':\n          top = rect.top + scrollY + rect.height / 2\n          left = rect.left + scrollX - 8\n          break\n        default:\n          top = rect.bottom + scrollY + 8\n          left = rect.left + scrollX + rect.width / 2\n      }\n\n      setCoords({ top, left })\n    }\n  }\n\n  const handleMouseEnter = () => {\n    updatePosition()\n    setIsVisible(true)\n  }\n\n  const handleMouseLeave = () => {\n    setIsVisible(false)\n  }\n\n  const arrowClasses = {\n    bottom: 'bottom-full left-1/2 transform -translate-x-1/2 border-b-[#2a353e]',\n    right: 'right-full top-1/2 transform -translate-y-1/2 border-r-[#2a353e]',\n    top: 'top-full left-1/2 transform -translate-x-1/2 border-t-[#2a353e]',\n    left: 'left-full top-1/2 transform -translate-y-1/2 border-l-[#2a353e]'\n  }\n\n  const tooltipContent = (\n    <div\n      className=\"absolute px-2 py-1 bg-[#2a353e] text-white text-xs rounded shadow-lg whitespace-nowrap z-[9999] border border-[#4a5568] pointer-events-none transition-opacity duration-75\"\n      style={{\n        top: coords.top,\n        left: coords.left,\n        transform: placement === 'left' || placement === 'right' ? 'translateY(-50%)' : 'translateX(-50%)',\n        opacity: isVisible ? 1 : 0\n      }}\n    >\n      {text}\n      {/* Arrow */}\n      <div className={`absolute border-4 border-transparent ${arrowClasses[placement]}`}></div>\n    </div>\n  )\n\n  return (\n    <>\n      <div\n        ref={triggerRef}\n        className={`relative flex items-center justify-center ${className}`}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n      >\n        {children}\n      </div>\n      {isVisible && createPortal(tooltipContent, document.body)}\n    </>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKe,SAAS,QAAQ,EAAE,QAAQ,EAAE,IAAI,EAAE,YAAY,EAAE,EAAE,YAAY,QAAQ,EAAoH;IACxM,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;QAAE,KAAK;QAAG,MAAM;IAAE;IACvD,MAAM,aAAa,IAAA,+MAAM,EAAiB;IAE1C,MAAM,iBAAiB;QACrB,IAAI,WAAW,OAAO,EAAE;YACtB,MAAM,OAAO,WAAW,OAAO,CAAC,qBAAqB;YACrD,MAAM,UAAU,OAAO,OAAO;YAC9B,MAAM,UAAU,OAAO,OAAO;YAE9B,IAAI,MAAM;YACV,IAAI,OAAO;YAEX,OAAQ;gBACN,KAAK;oBACH,MAAM,KAAK,MAAM,GAAG,UAAU;oBAC9B,OAAO,KAAK,IAAI,GAAG,UAAU,KAAK,KAAK,GAAG;oBAC1C;gBACF,KAAK;oBACH,MAAM,KAAK,GAAG,GAAG,UAAU;oBAC3B,OAAO,KAAK,IAAI,GAAG,UAAU,KAAK,KAAK,GAAG;oBAC1C;gBACF,KAAK;oBACH,MAAM,KAAK,GAAG,GAAG,UAAU,KAAK,MAAM,GAAG;oBACzC,OAAO,KAAK,KAAK,GAAG,UAAU;oBAC9B;gBACF,KAAK;oBACH,MAAM,KAAK,GAAG,GAAG,UAAU,KAAK,MAAM,GAAG;oBACzC,OAAO,KAAK,IAAI,GAAG,UAAU;oBAC7B;gBACF;oBACE,MAAM,KAAK,MAAM,GAAG,UAAU;oBAC9B,OAAO,KAAK,IAAI,GAAG,UAAU,KAAK,KAAK,GAAG;YAC9C;YAEA,UAAU;gBAAE;gBAAK;YAAK;QACxB;IACF;IAEA,MAAM,mBAAmB;QACvB;QACA,aAAa;IACf;IAEA,MAAM,mBAAmB;QACvB,aAAa;IACf;IAEA,MAAM,eAAe;QACnB,QAAQ;QACR,OAAO;QACP,KAAK;QACL,MAAM;IACR;IAEA,MAAM,+BACJ,8OAAC;QACC,WAAU;QACV,OAAO;YACL,KAAK,OAAO,GAAG;YACf,MAAM,OAAO,IAAI;YACjB,WAAW,cAAc,UAAU,cAAc,UAAU,qBAAqB;YAChF,SAAS,YAAY,IAAI;QAC3B;;YAEC;0BAED,8OAAC;gBAAI,WAAW,CAAC,qCAAqC,EAAE,YAAY,CAAC,UAAU,EAAE;;;;;;;;;;;;IAIrF,qBACE;;0BACE,8OAAC;gBACC,KAAK;gBACL,WAAW,CAAC,0CAA0C,EAAE,WAAW;gBACnE,cAAc;gBACd,cAAc;0BAEb;;;;;;YAEF,2BAAa,IAAA,4NAAY,EAAC,gBAAgB,SAAS,IAAI;;;AAG9D"}},
    {"offset": {"line": 904, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/ui/IconButton.tsx"],"sourcesContent":["import React from 'react'\nimport Tooltip from './Tooltip'\n\nexport default function IconButton({ children, onClick, tooltip, className = '', ...props }) {\n  const button = (\n    <button \n      className={`p-1 text-[#b2b5be] hover:text-white transition-colors cursor-pointer hover:bg-[#2a353e] hover:border hover:border-[#4a5568] rounded-sm border border-transparent ${className}`}\n      onClick={onClick}\n      {...props}\n    >\n      {children}\n    </button>\n  )\n\n  if (tooltip) {\n    return <Tooltip text={tooltip}>{button}</Tooltip>\n  }\n\n  return button\n}\n"],"names":[],"mappings":";;;;;AACA;;;AAEe,SAAS,WAAW,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,YAAY,EAAE,EAAE,GAAG,OAAO;IACzF,MAAM,uBACJ,8OAAC;QACC,WAAW,CAAC,iKAAiK,EAAE,WAAW;QAC1L,SAAS;QACR,GAAG,KAAK;kBAER;;;;;;IAIL,IAAI,SAAS;QACX,qBAAO,8OAAC,8IAAO;YAAC,MAAM;sBAAU;;;;;;IAClC;IAEA,OAAO;AACT"}},
    {"offset": {"line": 939, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/panels/EconomicCalendarPanel.tsx"],"sourcesContent":["\"use client\";\nimport { useState } from 'react'\nimport IconButton from '../ui/IconButton'\n\nexport default function EconomicCalendarPanel({ onClose }) {\n  const [selectedImpact, setSelectedImpact] = useState('All impacts')\n  const [selectedCountry, setSelectedCountry] = useState('All countries')\n\n  const economicEvents = [\n    {\n      time: '12:00',\n      ampm: 'AM',\n      event: 'ANZ Business Confidence',\n      country: 'NZ',\n      impact: 2, // Medium\n      actual: '67',\n      forecast: '58',\n      previous: '58'\n    },\n    {\n      time: '12:00',\n      ampm: 'AM',\n      event: 'Thanksgiving Day',\n      country: 'US',\n      impact: 1, // Low\n      actual: '-',\n      forecast: '-',\n      previous: '-'\n    },\n    {\n      time: '12:30',\n      ampm: 'AM',\n      event: 'Building Capital Expenditure QoQ',\n      country: 'NZ',\n      impact: 1,\n      actual: '2.1%',\n      forecast: '0.4%',\n      previous: '0.3%'\n    },\n    {\n      time: '12:30',\n      ampm: 'AM',\n      event: 'Plant Machinery Capital Expenditure QoQ',\n      country: 'NZ',\n      impact: 1,\n      actual: '12%',\n      forecast: '0.4%',\n      previous: '0.7%'\n    }\n  ]\n\n  const getCountryFlag = (country) => {\n    const flags = {\n      'NZ': 'üá≥üáø',\n      'US': 'üá∫üá∏',\n      'CN': 'üá®üá≥',\n      'JP': 'üáØüáµ',\n      'AU': 'üá¶üá∫',\n      'DE': 'üá©üá™',\n    }\n    return flags[country] || 'üè≥Ô∏è'\n  }\n\n  return (\n    <div className=\"flex flex-col h-full overflow-hidden bg-background text-[#b2b5be] border border-gray-800 rounded-md\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between pt-4 px-4 flex-shrink-0\">\n        <h2 className=\"text-[#b2b5be] text-[13px] font-medium uppercase tracking-wider\">ECONOMIC CALENDAR</h2>\n        <IconButton onClick={onClose} tooltip=\"Hide panel\">\n          <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n          </svg>\n        </IconButton>\n      </div>\n\n      {/* Filters */}\n      <div className=\"p-4 space-y-4 flex-shrink-0 border-b border-gray-800\">\n        <div className=\"relative\">\n          <select\n            value={selectedImpact}\n            onChange={(e) => setSelectedImpact(e.target.value)}\n            className=\"w-full bg-background border border-gray-800 rounded px-3 py-2.5 text-sm text-[#e1e2e5] appearance-none cursor-pointer focus:outline-none focus:border-[#4a5568]\"\n          >\n            <option>All impacts</option>\n            <option>High impact</option>\n            <option>Medium impact</option>\n            <option>Low impact</option>\n          </select>\n          <svg className=\"absolute right-3 top-3 w-4 h-4 text-[#6f7682] pointer-events-none\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fillRule=\"evenodd\" d=\"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n          </svg>\n        </div>\n\n        <div className=\"relative\">\n          <select\n            value={selectedCountry}\n            onChange={(e) => setSelectedCountry(e.target.value)}\n            className=\"w-full bg-background border border-gray-800 rounded px-3 py-2.5 text-sm text-[#e1e2e5] appearance-none cursor-pointer focus:outline-none focus:border-[#4a5568]\"\n          >\n            <option>All countries</option>\n            <option>United States</option>\n            <option>China</option>\n            <option>Japan</option>\n            <option>Australia</option>\n            <option>Germany</option>\n            <option>New Zealand</option>\n          </select>\n          <svg className=\"absolute right-3 top-3 w-4 h-4 text-[#6f7682] pointer-events-none\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fillRule=\"evenodd\" d=\"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n          </svg>\n        </div>\n      </div>\n\n      {/* Events List */}\n      <div className=\"flex-1 overflow-y-auto custom-scrollbar\">\n        <div className=\"bg-[#1e2830] px-4 py-2.5 text-[13px] font-bold text-[#e1e2e5] sticky top-0 z-10 border-b border-gray-800\">\n          November 27\n        </div>\n        <div>\n          {economicEvents.map((item, index) => (\n            <div key={index} className=\"flex border-b border-gray-800 py-3 px-4 hover:bg-[#1c252f] transition-colors cursor-pointer group\">\n              {/* Left Column: Time & Flag/Impact */}\n              <div className=\"w-[70px] flex flex-col gap-2.5 flex-shrink-0\">\n                <div className=\"flex flex-col leading-none\">\n                  <span className=\"text-[13px] text-[#b2b5be] font-medium\">{item.time}</span>\n                  <span className=\"text-[11px] text-[#6f7682] mt-0.5\">{item.ampm}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm leading-none\">{getCountryFlag(item.country)}</span>\n                  <div className=\"flex gap-[2px] items-end h-3\">\n                    {[1, 2, 3].map(bar => (\n                      <div\n                        key={bar}\n                        className={`w-[3px] rounded-[1px] ${bar <= item.impact ? 'bg-[#eab308]' : 'bg-[#2a353e]'} ${bar === 1 ? 'h-1.5' : bar === 2 ? 'h-2.5' : 'h-3.5'}`}\n                      />\n                    ))}\n                  </div>\n                </div>\n              </div>\n\n              {/* Right Column: Event & Values */}\n              <div className=\"flex-1 min-w-0 pl-1\">\n                <div className=\"flex justify-between items-start mb-2\">\n                  <span className=\"text-[#e1e2e5] text-[13px] font-normal leading-tight pr-2\">{item.event}</span>\n                  <svg className=\"w-4 h-4 text-[#6f7682] group-hover:text-[#b2b5be] transition-colors flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                  </svg>\n                </div>\n                <div className=\"flex justify-between text-[13px] pr-6\">\n                  <span className={`font-medium w-1/3 text-left ${item.actual !== '-' ? 'text-[#e1e2e5]' : 'text-[#6f7682]'}`}>{item.actual}</span>\n                  <span className=\"text-[#6f7682] w-1/3 text-center\">{item.forecast}</span>\n                  <span className=\"text-[#6f7682] w-1/3 text-right\">{item.previous}</span>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1405, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/ui/Toggle.tsx"],"sourcesContent":["export default function Toggle({ checked, onChange, label }: { checked: boolean, onChange: (e: React.ChangeEvent<HTMLInputElement>) => void, label?: string }) {\n  return (\n    <label className=\"relative inline-flex items-center cursor-pointer\">\n      <input\n        type=\"checkbox\"\n        checked={checked}\n        onChange={onChange}\n        className=\"sr-only peer\"\n      />\n      <div className=\"w-9 h-5 bg-[#545b64] rounded-full peer peer-checked:bg-[#7f8792] peer-focus:outline-none transition-colors relative\">\n        <div className={`absolute top-0.5 left-0.5 bg-white rounded-full h-4 w-4 transition-transform duration-200 ${checked ? 'translate-x-4' : 'translate-x-0'}`}></div>\n      </div>\n    </label>\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAe,SAAS,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAoG;IAC3J,qBACE,8OAAC;QAAM,WAAU;;0BACf,8OAAC;gBACC,MAAK;gBACL,SAAS;gBACT,UAAU;gBACV,WAAU;;;;;;0BAEZ,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAW,CAAC,0FAA0F,EAAE,UAAU,kBAAkB,iBAAiB;;;;;;;;;;;;;;;;;AAIlK"}},
    {"offset": {"line": 1450, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/panels/SettingsPanel.tsx"],"sourcesContent":["\"use client\";\nimport { useState } from 'react'\nimport Toggle from '../ui/Toggle'\nimport IconButton from '../ui/IconButton'\n\nexport default function SettingsPanel({ onClose }) {\n  const [settings, setSettings] = useState({\n    signals: false,\n    hmrPeriods: true,\n    priceAlerts: true,\n    openPositions: true,\n    tpsl: false,\n    economicCalendar: true,\n    highImpact: true,\n    middleImpact: false,\n    lowImpact: false,\n    lowestImpact: false,\n    soundPriceAlerts: false,\n    soundClosing: false,\n    autoTPSL: false,\n    orderMode: 'regular',\n    priceSource: 'bid',\n    theme: 'dark',\n    timezone: 'Etc/UTC'\n  })\n\n  const handleToggle = (key) => {\n    setSettings(prev => ({ ...prev, [key]: !prev[key] }))\n  }\n\n  const handleSelect = (key, value) => {\n    setSettings(prev => ({ ...prev, [key]: value }))\n  }\n\n  return (\n    <div className=\"w-full min-w-[240px] flex flex-col h-full overflow-hidden bg-background border border-gray-800 rounded-md\">\n      {/* Header */}\n      <div className=\"pt-4 px-4 flex-shrink-0\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-gray-400 font-medium uppercase text-[13px]\">Settings</h2>\n          <IconButton onClick={onClose} tooltip=\"Hide panel\">\n            <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n            </svg>\n          </IconButton>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"flex-1 overflow-y-auto min-h-0 p-3 lg:p-4 space-y-4 lg:space-y-6\">\n        {/* Show on chart */}\n        <div>\n          <h3 className=\"text-gray-300 text-xs lg:text-sm font-bold mb-3 lg:mb-4\">Show on chart</h3>\n          <div className=\"space-y-3 lg:space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-200 text-sm lg:text-base\">Signals</span>\n              <Toggle checked={settings.signals} onChange={() => handleToggle('signals')} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-200 text-sm lg:text-base\">HMR periods</span>\n              <Toggle checked={settings.hmrPeriods} onChange={() => handleToggle('hmrPeriods')} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-200 text-sm lg:text-base\">Price alerts</span>\n              <Toggle checked={settings.priceAlerts} onChange={() => handleToggle('priceAlerts')} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-200 text-sm lg:text-base\">Open positions</span>\n              <Toggle checked={settings.openPositions} onChange={() => handleToggle('openPositions')} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-200 text-sm lg:text-base\">TP / SL / Stop / Limit</span>\n              <Toggle checked={settings.tpsl} onChange={() => handleToggle('tpsl')} />\n            </div>\n\n            {/* Economic Calendar */}\n            <div>\n              <div className=\"flex items-center justify-between mb-2 lg:mb-3\">\n                <span className=\"text-gray-200 text-sm lg:text-base\">Economic calendar</span>\n                <Toggle checked={settings.economicCalendar} onChange={() => handleToggle('economicCalendar')} />\n              </div>\n              {settings.economicCalendar && (\n                <div className=\"ml-4 lg:ml-6 space-y-2 lg:space-y-3\">\n                  <div className=\"flex items-center gap-2 lg:gap-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.highImpact}\n                      onChange={() => handleToggle('highImpact')}\n                      className=\"w-4 h-4 text-gray-500 bg-gray-700 border-gray-800 rounded focus:ring-gray-500 cursor-pointer\"\n                    />\n                    <span className=\"text-gray-200 text-sm lg:text-base\">High impact</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 lg:gap-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.middleImpact}\n                      onChange={() => handleToggle('middleImpact')}\n                      className=\"w-4 h-4 text-gray-500 bg-gray-700 border-gray-800 rounded focus:ring-gray-500 cursor-pointer\"\n                    />\n                    <span className=\"text-gray-200 text-sm lg:text-base\">Middle impact</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 lg:gap-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.lowImpact}\n                      onChange={() => handleToggle('lowImpact')}\n                      className=\"w-4 h-4 text-gray-500 bg-gray-700 border-gray-800 rounded focus:ring-gray-500 cursor-pointer\"\n                    />\n                    <span className=\"text-gray-200 text-sm lg:text-base\">Low impact</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 lg:gap-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={settings.lowestImpact}\n                      onChange={() => handleToggle('lowestImpact')}\n                      className=\"w-4 h-4 text-gray-500 bg-gray-700 border-gray-800 rounded focus:ring-gray-500 cursor-pointer\"\n                    />\n                    <span className=\"text-gray-200 text-sm lg:text-base\">Lowest impact</span>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Sound effects */}\n        <div>\n          <h3 className=\"text-gray-300 text-xs lg:text-sm font-bold mb-3 lg:mb-4\">Sound effects</h3>\n          <div className=\"space-y-3 lg:space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-200 text-sm lg:text-base\">Price alerts</span>\n              <Toggle checked={settings.soundPriceAlerts} onChange={() => handleToggle('soundPriceAlerts')} />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-200 text-sm lg:text-base\">Closing by TP / SL / SO</span>\n              <Toggle checked={settings.soundClosing} onChange={() => handleToggle('soundClosing')} />\n            </div>\n          </div>\n        </div>\n\n        {/* Trading settings */}\n        <div>\n          <h3 className=\"text-gray-300 text-xs lg:text-sm font-bold mb-3 lg:mb-4\">Trading settings</h3>\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-gray-200 text-sm lg:text-base\">Set TP/SL automatically</span>\n            <Toggle checked={settings.autoTPSL} onChange={() => handleToggle('autoTPSL')} />\n          </div>\n        </div>\n\n        {/* Open order mode */}\n        <div>\n          <h3 className=\"text-gray-300 text-xs lg:text-sm font-bold mb-3 lg:mb-4\">Open order mode</h3>\n          <select\n            value={settings.orderMode}\n            onChange={(e) => handleSelect('orderMode', e.target.value)}\n            className=\"w-full bg-[#2a3441] border border-gray-800 rounded px-3 py-2 text-sm lg:text-base text-gray-200 cursor-pointer\"\n          >\n            <option value=\"regular\">Regular form</option>\n            <option value=\"quick\">Quick form</option>\n          </select>\n        </div>\n\n        {/* Price source */}\n        <div>\n          <h3 className=\"text-gray-300 text-xs lg:text-sm font-bold mb-3 lg:mb-4\">Price source</h3>\n          <select\n            value={settings.priceSource}\n            onChange={(e) => handleSelect('priceSource', e.target.value)}\n            className=\"w-full bg-[#2a3441] border border-gray-800 rounded px-3 py-2 text-sm lg:text-base text-gray-200 cursor-pointer\"\n          >\n            <option value=\"bid\">Bid</option>\n            <option value=\"ask\">Ask</option>\n            <option value=\"mid\">Mid</option>\n          </select>\n        </div>\n\n        {/* Appearance */}\n        <div>\n          <h3 className=\"text-gray-300 text-xs lg:text-sm font-bold mb-3 lg:mb-4\">Appearance</h3>\n          <select\n            value={settings.theme}\n            onChange={(e) => handleSelect('theme', e.target.value)}\n            className=\"w-full bg-[#2a3441] border border-gray-800 rounded px-3 py-2 text-sm lg:text-base text-gray-200 cursor-pointer\"\n          >\n            <option value=\"dark\">Always dark</option>\n            <option value=\"light\">Always light</option>\n            <option value=\"auto\">Auto</option>\n          </select>\n        </div>\n\n        {/* Time zone */}\n        <div>\n          <h3 className=\"text-gray-300 text-xs lg:text-sm font-bold mb-3 lg:mb-4\">Time zone</h3>\n          <select\n            value={settings.timezone}\n            onChange={(e) => handleSelect('timezone', e.target.value)}\n            className=\"w-full bg-[#2a3441] border border-gray-800 rounded px-3 py-2 text-sm lg:text-base text-gray-200 cursor-pointer\"\n          >\n            <option value=\"Etc/UTC\">UTC</option>\n            <option value=\"America/New_York\">New York</option>\n            <option value=\"Europe/London\">London</option>\n            <option value=\"Asia/Tokyo\">Tokyo</option>\n          </select>\n        </div>\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2188, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/layout/LeftSidebar.tsx"],"sourcesContent":["\"use client\";\nimport { useState, useEffect } from 'react'\nimport WatchlistPanel from '../panels/WatchlistPanel'\nimport EconomicCalendarPanel from '../panels/EconomicCalendarPanel'\nimport SettingsPanel from '../panels/SettingsPanel'\nimport ResizablePanel from '../panels/ResizablePanel'\nimport { LuList, LuCalendar, LuSettings } from 'react-icons/lu'\nimport Tooltip from '../ui/Tooltip'\n\ninterface LeftSidebarProps {\n  onPanelStateChange?: (hasActivePanel: boolean) => void;\n  isExpanded?: boolean;\n}\n\nexport default function LeftSidebar({ onPanelStateChange, isExpanded }: LeftSidebarProps) {\n  const [activePanel, setActivePanel] = useState<string | null>('instruments')\n\n  const togglePanel = (panel: string) => {\n    setActivePanel(activePanel === panel ? null : panel)\n  }\n\n  const closePanel = () => {\n    setActivePanel(null)\n  }\n\n  const hasActivePanel = activePanel !== null\n\n  // Reset active panel when sidebar is collapsed externally\n  useEffect(() => {\n    if (!isExpanded) {\n      setActivePanel(null)\n    }\n  }, [isExpanded])\n\n  // Notify parent component about panel state changes\n  useEffect(() => {\n    if (onPanelStateChange) {\n      onPanelStateChange(hasActivePanel)\n    }\n  }, [hasActivePanel, onPanelStateChange])\n\n  return (\n    <div className={`flex h-full overflow-hidden min-h-0 gap-1`}>\n      {/* ${!hasActivePanel ? 'border-r-4 border-gray-600' : ''} */}\n      <aside className={`w-[48px] flex flex-col items-center py-3 gap-4 flex-shrink-0 h-full bg-background rounded-tr-lg border border-gray-800`}>\n        {/* Instruments Button */}\n        <div>\n          <Tooltip text=\"Instruments\" placement=\"right\">\n            <button\n              className={`cursor-pointer w-8 h-8 flex items-center justify-center text-gray-400 hover:text-gray-200 rounded-sm transition-all duration-200 ${activePanel === 'instruments' ? 'bg-[#263239] border border-gray-400 text-gray-200' : 'hover:bg-[#263239] hover:border hover:border-gray-400 border-2 border-transparent'\n                }`}\n              type=\"button\"\n              data-test=\"aside-panel-watchlist-button\"\n              aria-label=\"Instruments\"\n              onClick={() => togglePanel('instruments')}\n            >\n              <LuList size={20} className={activePanel === 'instruments' ? 'text-gray-200' : 'text-gray-300'} />\n            </button>\n          </Tooltip>\n        </div>\n\n        {/* Economic Calendar Button - HIDDEN */}\n        {false && (\n          <div>\n            <Tooltip text=\"Economic calendar\" placement=\"right\">\n              <button\n                className={`cursor-pointer w-8 h-8 flex items-center justify-center text-gray-400 hover:text-gray-200 rounded-sm transition-all duration-200 ${activePanel === 'calendar' ? 'bg-[#263239] border border-gray-400 text-gray-200' : 'hover:bg-[#263239] hover:border hover:border-gray-400 border-2 border-transparent'\n                  }`}\n                type=\"button\"\n                data-test=\"aside-panel-calendar-events-button\"\n                aria-label=\"Economic calendar\"\n                onClick={() => togglePanel('calendar')}\n              >\n                <LuCalendar size={20} className={activePanel === 'calendar' ? 'text-white' : 'text-gray-300'} />\n              </button>\n            </Tooltip>\n          </div>\n        )}\n\n        {/* Settings Button */}\n        <div>\n          <Tooltip text=\"Settings\" placement=\"right\">\n            <button\n              className={`cursor-pointer w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white rounded-sm transition-all duration-200 ${activePanel === 'settings' ? 'bg-[#263239] border border-gray-400 text-gray-200' : 'hover:bg-[#263239] hover:border hover:border-gray-400 border-2 border-transparent'\n                }`}\n              type=\"button\"\n              data-test=\"aside-panel-settings-button\"\n              aria-label=\"Settings\"\n              onClick={() => togglePanel('settings')}\n            >\n              <LuSettings size={20} className={activePanel === 'settings' ? 'text-white' : 'text-gray-300'} />\n            </button>\n          </Tooltip>\n        </div>\n      </aside>\n\n      {/* Panel Content - only show when panel is active */}\n      {hasActivePanel && (\n        <>\n          {activePanel === 'instruments' && (\n            <div className=\"bg-background border-r border-gray-700 flex flex-col h-full min-h-0 overflow-hidden flex-1 rounded-t-md\">\n              <WatchlistPanel onClose={closePanel} />\n            </div>\n          )}\n          {false && activePanel === 'calendar' && (\n            <div className=\"bg-background border-r border-gray-700 flex flex-col h-full min-h-0 overflow-hidden flex-1 rounded-t-md\">\n              <EconomicCalendarPanel onClose={closePanel} />\n            </div>\n          )}\n          {activePanel === 'settings' && (\n            <div className=\"bg-background border-r border-gray-700 flex flex-col h-full min-h-0 overflow-hidden flex-1 rounded-t-md\">\n              <SettingsPanel onClose={closePanel} />\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AAEA;AACA;AAPA;;;;;;;;AAce,SAAS,YAAY,EAAE,kBAAkB,EAAE,UAAU,EAAoB;IACtF,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAgB;IAE9D,MAAM,cAAc,CAAC;QACnB,eAAe,gBAAgB,QAAQ,OAAO;IAChD;IAEA,MAAM,aAAa;QACjB,eAAe;IACjB;IAEA,MAAM,iBAAiB,gBAAgB;IAEvC,0DAA0D;IAC1D,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,YAAY;YACf,eAAe;QACjB;IACF,GAAG;QAAC;KAAW;IAEf,oDAAoD;IACpD,IAAA,kNAAS,EAAC;QACR,IAAI,oBAAoB;YACtB,mBAAmB;QACrB;IACF,GAAG;QAAC;QAAgB;KAAmB;IAEvC,qBACE,8OAAC;QAAI,WAAW,CAAC,yCAAyC,CAAC;;0BAEzD,8OAAC;gBAAM,WAAW,CAAC,sHAAsH,CAAC;;kCAExI,8OAAC;kCACC,cAAA,8OAAC,8IAAO;4BAAC,MAAK;4BAAc,WAAU;sCACpC,cAAA,8OAAC;gCACC,WAAW,CAAC,iIAAiI,EAAE,gBAAgB,gBAAgB,sDAAsD,qFACjO;gCACJ,MAAK;gCACL,aAAU;gCACV,cAAW;gCACX,SAAS,IAAM,YAAY;0CAE3B,cAAA,8OAAC,wJAAM;oCAAC,MAAM;oCAAI,WAAW,gBAAgB,gBAAgB,kBAAkB;;;;;;;;;;;;;;;;;;;;;oBAMpF,uBACC,8OAAC;kCACC,cAAA,8OAAC,8IAAO;4BAAC,MAAK;4BAAoB,WAAU;sCAC1C,cAAA,8OAAC;gCACC,WAAW,CAAC,iIAAiI,EAAE,gBAAgB,aAAa,sDAAsD,qFAC9N;gCACJ,MAAK;gCACL,aAAU;gCACV,cAAW;gCACX,SAAS,IAAM,YAAY;0CAE3B,cAAA,8OAAC,4JAAU;oCAAC,MAAM;oCAAI,WAAW,gBAAgB,aAAa,eAAe;;;;;;;;;;;;;;;;;;;;;kCAOrF,8OAAC;kCACC,cAAA,8OAAC,8IAAO;4BAAC,MAAK;4BAAW,WAAU;sCACjC,cAAA,8OAAC;gCACC,WAAW,CAAC,8HAA8H,EAAE,gBAAgB,aAAa,sDAAsD,qFAC3N;gCACJ,MAAK;gCACL,aAAU;gCACV,cAAW;gCACX,SAAS,IAAM,YAAY;0CAE3B,cAAA,8OAAC,4JAAU;oCAAC,MAAM;oCAAI,WAAW,gBAAgB,aAAa,eAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;YAOpF,gCACC;;oBACG,gBAAgB,+BACf,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,yJAAc;4BAAC,SAAS;;;;;;;;;;;oBAG5B,SAAS,gBAAgB,4BACxB,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,gKAAqB;4BAAC,SAAS;;;;;;;;;;;oBAGnC,gBAAgB,4BACf,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC,wJAAa;4BAAC,SAAS;;;;;;;;;;;;;;;;;;;AAOtC"}},
    {"offset": {"line": 2401, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/chart/RealtimeDataFeed.ts"],"sourcesContent":["\nimport {\n    LibrarySymbolInfo,\n    ResolutionString,\n    HistoryCallback,\n    SubscribeBarsCallback,\n    PeriodParams,\n    SearchSymbolsCallback\n} from '../../../public/charting_library/datafeed-api';\n\ninterface CandleUpdate {\n    type: 'candle_update';\n    symbol: string;\n    tf: string;\n    t: number; // timestamp\n    o: number;\n    h: number;\n    l: number;\n    c: number;\n    v: number;\n    isFinal: boolean;\n}\n\ninterface CandleHistoryResponse {\n    type: 'candle_snapshot';\n    symbol: string;\n    tf: string;\n    ts: number;\n    candles: {\n        t: number;\n        o: number;\n        h: number;\n        l: number;\n        c: number;\n        v: number;\n        isFinal: number;\n    }[];\n}\n\ninterface SubSymbolsRequest {\n    type: 'sub_symbols';\n    symbols: string[];\n    streams: ['candle_live'];\n}\n\ninterface CandleHistoryRequest {\n    type: 'candle_history';\n    symbol: string;\n    tf: string;\n    count: number;\n}\n\n// Helper to map resolution string to API timeframe string\n// 1m, 5m, 15m, 30m, 1h, 4h, 1D, 1W, 1M => API: M1, M5, M15, M30, H1, H4, D1, W1, Mn1\nconst resolutionToTimeframe = (resolution: string): string => {\n    if (resolution === '1') return 'M1';\n    if (resolution === '5') return 'M5';\n    if (resolution === '15') return 'M15';\n    if (resolution === '30') return 'M30';\n    if (resolution === '60') return 'H1';\n    if (resolution === '240') return 'H4';\n    if (resolution === 'D' || resolution === '1D') return 'D1';\n    if (resolution === 'W' || resolution === '1W') return 'W1';\n    if (resolution === 'M' || resolution === '1M') return 'Mn1';\n    // Fallback\n    return resolution;\n};\n\n// Normalizes symbols by stripping lowercase suffixes (e.g., BTCUSDm -> BTCUSD)\nconst normalizeSymbol = (symbol: string): string => {\n    if (!symbol) return '';\n    const s = symbol.split('.')[0].trim();\n    // Strip trailing suffixes like m, a, c, f, h, r (case-insensitive)\n    return s.replace(/[macfhrMACFHR]+$/, '').toUpperCase();\n};\n\nclass WebSocketManager {\n    private url: string;\n    private ws: WebSocket | null = null;\n    private reconnectTimeout: any = null;\n    private subscribers: Set<{ symbol: string; tf: string; callback: SubscribeBarsCallback; lastBarTime: number }> = new Set();\n    private historyCallbacks: Map<string, { onSuccess: HistoryCallback; onError: (error: string) => void }> = new Map();\n    private requestQueue: (() => void)[] = [];\n\n    constructor(url: string) {\n        this.url = url;\n        this.connect();\n    }\n\n    private connect() {\n        if (this.ws) {\n            this.ws.close();\n        }\n\n        this.ws = new WebSocket(this.url);\n\n        this.ws.onopen = () => {\n            this.resubscribe();\n            this.processQueue();\n        };\n\n        this.ws.onmessage = (event) => {\n            try {\n                const data = JSON.parse(event.data);\n                this.handleMessage(data);\n            } catch (e) {\n            }\n        };\n\n        this.ws.onclose = () => {\n            this.ws = null;\n            this.reconnectTimeout = setTimeout(() => this.connect(), 2000);\n        };\n\n        this.ws.onerror = (err) => {\n        };\n    }\n\n    private processQueue() {\n        while (this.requestQueue.length > 0) {\n            const req = this.requestQueue.shift();\n            if (req) req();\n        }\n    }\n\n    private resubscribe() {\n        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) return;\n\n        const symbolsToSubscribe = new Set<string>();\n        this.subscribers.forEach(sub => symbolsToSubscribe.add(normalizeSymbol(sub.symbol)));\n\n        if (symbolsToSubscribe.size > 0) {\n            const msg: SubSymbolsRequest = {\n                type: 'sub_symbols',\n                symbols: Array.from(symbolsToSubscribe),\n                streams: ['candle_live']\n            };\n            this.ws.send(JSON.stringify(msg));\n        }\n    }\n\n    public subscribe(symbol: string, tf: string, callback: SubscribeBarsCallback) {\n        // Use mapped timeframe for subscription tracking\n        const mappedTf = resolutionToTimeframe(tf);\n        const subscription = { symbol, tf: mappedTf, callback, lastBarTime: 0 };\n        this.subscribers.add(subscription);\n\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n            const normalizedSymbol = normalizeSymbol(symbol);\n            const msg: SubSymbolsRequest = {\n                type: 'sub_symbols',\n                symbols: [normalizedSymbol],\n                streams: ['candle_live']\n            };\n            this.ws.send(JSON.stringify(msg));\n        }\n\n        return subscription;\n    }\n\n    public unsubscribe(subscription: any) {\n        this.subscribers.delete(subscription);\n    }\n\n    public getHistory(symbol: string, tf: string, count: number, onSuccess: HistoryCallback, onError: (error: string) => void) {\n        const runRequest = () => {\n            if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n                onError(\"WebSocket not connected during execution\");\n                return;\n            }\n\n            const normalizedSymbol = normalizeSymbol(symbol);\n            const key = `${normalizedSymbol}-${tf}`;\n            this.historyCallbacks.set(key, { onSuccess, onError });\n\n            const msg: CandleHistoryRequest = {\n                type: 'candle_history',\n                symbol: normalizedSymbol,\n                tf,\n                count\n            };\n            this.ws.send(JSON.stringify(msg));\n        };\n\n        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n            this.requestQueue.push(runRequest);\n        } else {\n            runRequest();\n        }\n    }\n\n    private handleMessage(data: any) {\n        if (data.type === 'candle_snapshot') {\n            const response = data as CandleHistoryResponse;\n            const key = `${response.symbol}-${response.tf}`;\n            const callback = this.historyCallbacks.get(key);\n            if (callback) {\n                const bars = response.candles.map(c => ({\n                    time: c.t,\n                    open: c.o,\n                    high: c.h,\n                    low: c.l,\n                    close: c.c,\n                    volume: c.v\n                }));\n                // Sort just in case\n                bars.sort((a, b) => a.time - b.time);\n\n                callback.onSuccess(bars, { noData: bars.length === 0 });\n                this.historyCallbacks.delete(key);\n            }\n        } else if (data.type === 'candle_update') {\n            const update = data as CandleUpdate;\n\n            Array.from(this.subscribers).forEach(sub => {\n                // sub.tf is already mapped (e.g., 'H1'), update.tf uses mapped values too\n                const subTf = sub.tf;\n                const subNormalized = normalizeSymbol(sub.symbol);\n                const updateNormalized = normalizeSymbol(update.symbol);\n\n                if (subNormalized === updateNormalized && subTf === update.tf) {\n                    const bar = {\n                        time: update.t,\n                        open: update.o,\n                        high: update.h,\n                        low: update.l,\n                        close: update.c,\n                        volume: update.v\n                    };\n\n                    sub.callback(bar);\n                }\n            });\n        }\n    }\n}\n\nexport class RealtimeDataFeed {\n    private wsManager: WebSocketManager;\n    private configuration: any;\n\n    constructor() {\n        const wsUrl = process.env.NEXT_PUBLIC_WS_URL || 'wss://metaapi.zuperior.com/ws';\n        this.wsManager = new WebSocketManager(wsUrl);\n\n        this.configuration = {\n            supports_search: false,\n            supports_group_request: false,\n            supported_resolutions: ['1', '5', '15', '30', '60', '240', '1D', '1W', '1M'],\n            supports_marks: false,\n            supports_timescale_marks: false,\n        };\n    }\n\n    public onReady(callback: (config: any) => void) {\n        setTimeout(() => callback(this.configuration), 0);\n    }\n\n    public searchSymbols(\n        userInput: string,\n        exchange: string,\n        symbolType: string,\n        onResult: SearchSymbolsCallback\n    ) {\n        onResult([]);\n    }\n\n    public resolveSymbol(\n        symbolName: string,\n        onSymbolResolvedCallback: (symbolInfo: LibrarySymbolInfo) => void,\n        onResolveErrorCallback: (reason: string) => void\n    ) {\n        const symbolInfo: LibrarySymbolInfo = {\n            name: symbolName,\n            description: symbolName,\n            type: 'crypto', // guess\n            session: '24x7',\n            timezone: 'Etc/UTC',\n            exchange: '',\n            minmov: 1,\n            pricescale: 100, // Default\n            has_intraday: true,\n            supported_resolutions: this.configuration.supported_resolutions,\n            volume_precision: 2,\n            data_status: 'streaming',\n            format: 'price',\n            listed_exchange: '',\n            sector: '',\n            industry: ''\n        };\n\n        if (symbolName.includes('JPY') || symbolName.includes('XAU')) {\n            symbolInfo.pricescale = 1000;\n        } else if (symbolName.includes('BTC')) {\n            symbolInfo.pricescale = 100;\n        } else {\n            symbolInfo.pricescale = 100000;\n        }\n\n        setTimeout(() => onSymbolResolvedCallback(symbolInfo), 0);\n    }\n\n    public getBars(\n        symbolInfo: LibrarySymbolInfo,\n        resolution: ResolutionString,\n        periodParams: PeriodParams,\n        onHistoryCallback: HistoryCallback,\n        onErrorCallback: (reason: string) => void\n    ) {\n        const { from, to, countBack, firstDataRequest } = periodParams;\n        const tf = resolutionToTimeframe(resolution);\n        const count = 1000;\n\n        if (!firstDataRequest) {\n            onHistoryCallback([], { noData: true });\n            return;\n        }\n\n        this.wsManager.getHistory(symbolInfo.name, tf, count, onHistoryCallback, onErrorCallback);\n    }\n\n    public subscribeBars(\n        symbolInfo: LibrarySymbolInfo,\n        resolution: ResolutionString,\n        onRealtimeCallback: SubscribeBarsCallback,\n        listenerGuid: string,\n        onResetCacheNeededCallback: () => void\n    ) {\n        const subscription = this.wsManager.subscribe(symbolInfo.name, resolution, onRealtimeCallback);\n        (this as any)._subs = (this as any)._subs || {};\n        (this as any)._subs[listenerGuid] = subscription;\n    }\n\n    public unsubscribeBars(listenerGuid: string) {\n        const subs = (this as any)._subs;\n        if (subs && subs[listenerGuid]) {\n            this.wsManager.unsubscribe(subs[listenerGuid]);\n            delete subs[listenerGuid];\n        }\n    }\n\n    public getQuotes(symbols: string[], onDataCallback: (quotes: any[]) => void, onErrorCallback: (msg: string) => void): void {\n        onDataCallback([]);\n    }\n\n    public subscribeQuotes(symbols: string[], fastSymbols: string[], onRealtimeCallback: (quotes: any[]) => void, listenerGUID: string): void {\n    }\n\n    public unsubscribeQuotes(listenerGUID: string): void {\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2669, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/public/charting_library/broker-api.js"],"sourcesContent":["var i,o,t,e,n,r,a,c,u,l,d,s,f,I,E,P,S,C,p,O,T,L,R,m,D,N,y,A,F,g,k,M,_,v,h,x;!function(i){i[i.StopLoss=0]=\"StopLoss\",i[i.TrailingStop=1]=\"TrailingStop\",i[i.GuaranteedStop=2]=\"GuaranteedStop\"}(i||(i={})),function(i){i.Futures=\"futures\",i.Options=\"options\",i.Others=\"others\",i.FutureAndOptions=\"futureAndOptions\"}(o||(o={})),function(i){i.PerContract=\"contract\",i.Fixed=\"fixed\",i.Percent=\"percent\",i.Disabled=\"disabled\"}(t||(t={})),function(i){i.Stocks=\"stocks\",i.Futures=\"futures\",i.Forex=\"forex\",i.Crypto=\"crypto\",i.Others=\"others\"}(e||(e={})),function(i){i.Symbol=\"symbol\"}(n||(n={})),function(i){i[i.Critical=0]=\"Critical\",i[i.Informational=1]=\"Informational\"}(r||(r={})),function(i){i[i.PopUp=0]=\"PopUp\",i[i.Notification=1]=\"Notification\"}(a||(a={})),function(i){i.Quantity=\"qty\",i.OrderSide=\"side\",i.Price=\"price\",i.Duration=\"duration\",i.Brackets=\"brackets\",i.StopLossType=\"slType\"}(c||(c={})),function(i){i[i.CONNECTED=1]=\"CONNECTED\",i[i.CONNECTING=2]=\"CONNECTING\",i[i.DISCONNECTED=3]=\"DISCONNECTED\",i[i.ERROR=4]=\"ERROR\"}(u||(u={})),function(i){i[i.Connected=1]=\"Connected\",i[i.Connecting=2]=\"Connecting\",i[i.Disconnected=3]=\"Disconnected\",i[i.Error=4]=\"Error\"}(l||(l={})),function(i){i[i.LIMIT=1]=\"LIMIT\",i[i.MARKET=2]=\"MARKET\",i[i.STOP=3]=\"STOP\",i[i.STOPLIMIT=4]=\"STOPLIMIT\"}(d||(d={})),function(i){i[i.Limit=1]=\"Limit\",i[i.Market=2]=\"Market\",i[i.Stop=3]=\"Stop\",i[i.StopLimit=4]=\"StopLimit\"}(s||(s={})),function(i){i[i.BUY=1]=\"BUY\",i[i.SELL=-1]=\"SELL\"}(f||(f={})),function(i){i[i.Buy=1]=\"Buy\",i[i.Sell=-1]=\"Sell\"}(I||(I={})),function(i){i[i.CANCELED=1]=\"CANCELED\",i[i.FILLED=2]=\"FILLED\",i[i.INACTIVE=3]=\"INACTIVE\",i[i.PLACING=4]=\"PLACING\",i[i.REJECTED=5]=\"REJECTED\",i[i.WORKING=6]=\"WORKING\"}(E||(E={})),function(i){i[i.ALL=0]=\"ALL\",i[i.CANCELED=1]=\"CANCELED\",i[i.FILLED=2]=\"FILLED\",i[i.INACTIVE=3]=\"INACTIVE\",i[i.REJECTED=5]=\"REJECTED\",i[i.WORKING=6]=\"WORKING\"}(P||(P={})),function(i){i[i.Canceled=1]=\"Canceled\",i[i.Filled=2]=\"Filled\",i[i.Inactive=3]=\"Inactive\",i[i.Placing=4]=\"Placing\",i[i.Rejected=5]=\"Rejected\",i[i.Working=6]=\"Working\"}(S||(S={})),function(i){i[i.All=0]=\"All\",i[i.Canceled=1]=\"Canceled\",i[i.Filled=2]=\"Filled\",i[i.Inactive=3]=\"Inactive\",i[i.Rejected=5]=\"Rejected\",i[i.Working=6]=\"Working\"}(C||(C={})),function(i){i[i.Order=1]=\"Order\",i[i.Position=2]=\"Position\"}(p||(p={})),function(i){i[i.ORDER=1]=\"ORDER\",i[i.POSITION=2]=\"POSITION\"}(O||(O={})),function(i){i[i.Order=1]=\"Order\",i[i.Position=2]=\"Position\",i[i.IndividualPosition=3]=\"IndividualPosition\"}(T||(T={})),function(i){i[i.StopLoss=0]=\"StopLoss\",i[i.TakeProfit=1]=\"TakeProfit\",i[i.TrailingStop=2]=\"TrailingStop\",i[i.GuaranteedStop=3]=\"GuaranteedStop\"}(L||(L={})),function(i){i[i.LIMITPRICE=1]=\"LIMITPRICE\",i[i.STOPPRICE=2]=\"STOPPRICE\",i[i.TAKEPROFIT=3]=\"TAKEPROFIT\",i[i.STOPLOSS=4]=\"STOPLOSS\"}(R||(R={})),function(i){i[i.LimitPrice=1]=\"LimitPrice\",i[i.StopPrice=2]=\"StopPrice\",i[i.TakeProfit=3]=\"TakeProfit\",i[i.StopLoss=4]=\"StopLoss\",i[i.Quantity=5]=\"Quantity\"}(m||(m={})),function(i){i[i.ERROR=0]=\"ERROR\",i[i.SUCCESS=1]=\"SUCCESS\"}(D||(D={})),function(i){i[i.Error=0]=\"Error\",i[i.Success=1]=\"Success\"}(N||(N={})),function(i){i[i.Demo=1]=\"Demo\",i[i.Real=0]=\"Real\"}(y||(y={})),function(i){i.Information=\"information\",i.Warning=\"warning\",i.Error=\"error\"}(A||(A={})),function(i){i.Demo=\"demo\",i.Live=\"live\"}(F||(F={})),function(i){i[i.LogOut=0]=\"LogOut\",i[i.FailedRestoring=1]=\"FailedRestoring\",i[i.Offline=2]=\"Offline\",i[i.APIError=3]=\"APIError\",i[i.TwoFactorRequired=4]=\"TwoFactorRequired\",i[i.CancelAuthorization=5]=\"CancelAuthorization\",i[i.TimeOutForAuthorization=6]=\"TimeOutForAuthorization\",i[i.OauthError=7]=\"OauthError\",i[i.BrokenConnection=8]=\"BrokenConnection\",i[i.Reconnect=9]=\"Reconnect\",i[i.FailedSignIn=10]=\"FailedSignIn\"}(g||(g={})),function(i){i[i.None=0]=\"None\",i[i.Pips=1]=\"Pips\",i[i.Ticks=2]=\"Ticks\"}(k||(k={})),function(i){i.Halted=\"HALTED\",i.NotShortable=\"NOT-SHORTABLE\",i.HardToBorrow=\"HARD-TO-BORROW\"}(M||(M={})),function(i){i[i.Limit=1]=\"Limit\",i[i.Stop=2]=\"Stop\"}(_||(_={})),function(i){i.Disallowed=\"disallowed\",i.Allowed=\"allowed\",i.AllowedWithWarning=\"allowed_with_warning\"}(v||(v={})),function(i){i.PlaceOrder=\"place_order\",i.ModifyOrder=\"modify_order\",i.CancelOrder=\"cancel_order\",i.CancelMultipleOrders=\"cancel_multiple_orders\",i.ModifyPosition=\"modify_position\",i.ClosePosition=\"close_position\",i.ModifyIndividualPosition=\"modify_individual_position\",i.CloseIndividualPosition=\"close_individual_position\",i.CloseNetPosition=\"close_net_position\"}(h||(h={})),function(i){i.Date=\"date\",i.DateOrDateTime=\"dateOrDateTime\",i.Default=\"default\",i.Fixed=\"fixed\",i.FixedInCurrency=\"fixedInCurrency\",i.VariablePrecision=\"variablePrecision\",i.FormatQuantity=\"formatQuantity\",i.FormatPrice=\"formatPrice\",i.FormatPriceForexSup=\"formatPriceForexSup\",i.FormatPriceInCurrency=\"formatPriceInCurrency\",i.IntegerSeparated=\"integerSeparated\",i.LocalDate=\"localDate\",i.LocalDateOrDateTime=\"localDateOrDateTime\",i.Percentage=\"percentage\",i.Pips=\"pips\",i.Profit=\"profit\",i.ProfitInInstrumentCurrency=\"profitInInstrumentCurrency\",i.ProfitInPercent=\"profitInPercent\",i.Side=\"side\",i.PositionSide=\"positionSide\",i.Status=\"status\",i.Symbol=\"symbol\",i.Text=\"text\",i.Type=\"type\",i.MarginPercent=\"marginPercent\",i.Empty=\"empty\"}(x||(x={}));export{F as AccountType,L as BracketType,r as BrokerMaintenanceUrgency,o as CommissionAssetType,t as CommissionType,n as CommonAccountManagerColumnId,v as ConcurrentSessionsAllowance,a as ConnectWarningMessageDisplayType,l as ConnectionStatus,y as ConnectionType,g as DisconnectType,h as LatencyTrackingTransactionType,e as MarginRateAssetType,N as NotificationType,c as OrderInfoDependency,A as OrderOrPositionMessageType,S as OrderStatus,C as OrderStatusFilter,m as OrderTicketFocusControl,s as OrderType,T as ParentType,_ as PriceType,I as Side,x as StandardFormatterName,i as StopType};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2800, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/chart/abstract-broker-minimal.ts"],"sourcesContent":["import {\n    AccountId,\n    AccountManagerInfo,\n    AccountMetainfo,\n    ActionMetaInfo,\n    ConnectionStatus,\n    DefaultContextMenuActionsParams,\n    Execution,\n    IBrokerConnectionAdapterHost,\n    IBrokerTerminal,\n    InstrumentInfo,\n    IsTradableResult,\n    Order,\n    PlaceOrderResult,\n    Position,\n    PreOrder,\n    TradeContext,\n} from '../../../public/charting_library/broker-api';\n\nimport { IDatafeedQuotesApi } from '../../../public/charting_library/datafeed-api';\n\nexport abstract class AbstractBrokerMinimal implements IBrokerTerminal {\n    protected readonly _host: IBrokerConnectionAdapterHost;\n    protected readonly _quotesProvider: IDatafeedQuotesApi;\n\n    public constructor(host: IBrokerConnectionAdapterHost, quotesProvider: IDatafeedQuotesApi) {\n        this._host = host;\n        this._quotesProvider = quotesProvider;\n    }\n\n    public abstract connectionStatus(): ConnectionStatus;\n\n    public abstract currentAccount(): AccountId;\n\n    public abstract isTradable(symbol: string): Promise<boolean | IsTradableResult>;\n\n    public abstract symbolInfo(symbol: string): Promise<InstrumentInfo>;\n\n    public abstract orders(): Promise<Order[]>;\n\n    public abstract positions(): Promise<Position[]>;\n\n    public abstract executions(symbol: string): Promise<Execution[]>;\n\n    public abstract placeOrder(order: PreOrder): Promise<PlaceOrderResult>;\n\n    public abstract modifyOrder(order: Order, confirmId?: string): Promise<void>;\n\n    public abstract cancelOrder(orderId: string): Promise<void>;\n\n    public abstract accountManagerInfo(): AccountManagerInfo;\n\n    public abstract accountsMetainfo(): Promise<AccountMetainfo[]>;\n\n    public abstract chartContextMenuActions(\n        context: TradeContext,\n        options?: DefaultContextMenuActionsParams\n    ): Promise<ActionMetaInfo[]>;\n}\n"],"names":[],"mappings":";;;;AAqBO,MAAe;IACC,MAAoC;IACpC,gBAAoC;IAEvD,YAAmB,IAAkC,EAAE,cAAkC,CAAE;QACvF,IAAI,CAAC,KAAK,GAAG;QACb,IAAI,CAAC,eAAe,GAAG;IAC3B;AA8BJ"}},
    {"offset": {"line": 2816, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/lib/metaapi.ts"],"sourcesContent":["\n/**\n * MetaAPI Direct Client\n * \n * Direct API calls to MetaAPI for performance-critical operations.\n * Bypasses backend proxy to achieve sub-500ms response times.\n */\n\nconst METAAPI_BASE_URL = 'https://metaapi.zuperior.com';\n\nexport interface ClosePositionDirectParams {\n    positionId: string | number;\n    accountId: string;\n    accessToken: string;\n    volume?: number; // 0 = Full Close, partial value = Partial Close (in lots)\n    price?: number; // Min/Max Price (Slippage protection)\n    comment?: string;\n    positionVolumeMT5?: number; // Actual position volume in MT5 format (for Trading endpoint when volume is 0)\n}\n\nexport interface PlaceMarketOrderDirectParams {\n    accountId: string;\n    accessToken: string;\n    symbol: string;\n    side: 'buy' | 'sell';\n    volume: number; // lots\n    stopLoss?: number;\n    takeProfit?: number;\n    comment?: string;\n}\n\nexport interface PlacePendingOrderDirectParams {\n    accountId: string;\n    accessToken: string;\n    symbol: string;\n    side: 'buy' | 'sell';\n    volume: number; // lots\n    price: number;\n    orderType: 'limit' | 'stop';\n    stopLoss?: number;\n    takeProfit?: number;\n    comment?: string;\n}\n\nexport interface ModifyPendingOrderDirectParams {\n    orderId: string | number;\n    accountId: string;\n    accessToken: string;\n    price?: number; // New order price\n    stopLoss?: number; // New SL\n    takeProfit?: number; // New TP\n    comment?: string;\n}\n\nexport interface ModifyPositionDirectParams {\n    positionId: string | number;\n    accountId: string;\n    accessToken: string;\n    stopLoss?: number;\n    takeProfit?: number;\n    comment?: string;\n}\n\nexport interface ClosePositionResponse {\n    success: boolean;\n    message?: string;\n    data?: any;\n}\n\nexport interface LoginCredentials {\n    AccountId: number;\n    Password: string;\n    DeviceId: string;\n    DeviceType: string;\n}\n\nexport interface LoginResponse {\n    Token?: string;\n    token?: string;\n    error?: string;\n}\n\nexport async function loginDirect(credentials: LoginCredentials): Promise<LoginResponse> {\n    const url = `${METAAPI_BASE_URL}/api/client/ClientAuth/login`;\n    const response = await fetch(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(credentials),\n    });\n    if (!response.ok) {\n        throw new Error(`Login failed: ${response.status}`);\n    }\n    return await response.json();\n}\n\nexport async function getPositionsDirect(accountId: string, accessToken: string): Promise<any[]> {\n    const url = `${METAAPI_BASE_URL}/api/client/Positions`;\n    const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'AccountId': String(accountId),\n            'Content-Type': 'application/json',\n        },\n    });\n    if (!response.ok) return [];\n\n    const data = await response.json();\n    return Array.isArray(data) ? data : (data.positions || []);\n}\n\n// Combined endpoint that returns both positions and pending orders\n// This matches the working zup-updated-terminal implementation\nexport async function getPositionsAndOrdersDirect(accountId: string, accessToken: string): Promise<{ positions: any[], orders: any[] }> {\n    // Try multiple endpoints to find orders\n    const positionsUrl = `${METAAPI_BASE_URL}/api/client/Positions`;\n    const ordersUrl = `${METAAPI_BASE_URL}/api/client/Orders`;\n\n    const headers = {\n        'Authorization': `Bearer ${accessToken}`,\n        'AccountId': String(accountId),\n        'Content-Type': 'application/json',\n    };\n\n    try {\n        // Fetch positions and orders in parallel\n        const [positionsResponse, ordersResponse] = await Promise.all([\n            fetch(positionsUrl, { method: 'GET', headers }),\n            fetch(ordersUrl, { method: 'GET', headers })\n        ]);\n\n        let positions: any[] = [];\n        let orders: any[] = [];\n\n        // Parse positions\n        if (positionsResponse.ok) {\n            const posData = await positionsResponse.json();\n            console.log('[getPositionsAndOrdersDirect] Positions response:', posData);\n            positions = Array.isArray(posData) ? posData : (posData.positions || posData.Positions || []);\n        } else {\n            console.warn('[getPositionsAndOrdersDirect] Positions failed:', positionsResponse.status);\n        }\n\n        // Parse orders\n        if (ordersResponse.ok) {\n            const ordersData = await ordersResponse.json();\n            console.log('[getPositionsAndOrdersDirect] Orders response:', ordersData);\n            console.log('[getPositionsAndOrdersDirect] Orders keys:', Object.keys(ordersData));\n            orders = Array.isArray(ordersData) ? ordersData : (ordersData.orders || ordersData.Orders || ordersData.pendingOrders || ordersData.PendingOrders || []);\n        } else {\n            console.warn('[getPositionsAndOrdersDirect] Orders endpoint failed:', ordersResponse.status);\n        }\n\n        console.log('[getPositionsAndOrdersDirect] Final result:', {\n            positionsCount: positions.length,\n            ordersCount: orders.length\n        });\n\n        return { positions, orders };\n    } catch (error) {\n        console.error('[getPositionsAndOrdersDirect] Error:', error);\n        return { positions: [], orders: [] };\n    }\n}\n\n// Deprecated: Use getPositionsAndOrdersDirect instead\n// Kept for backward compatibility\nexport async function getPendingOrdersDirect(accountId: string, accessToken: string): Promise<any[]> {\n    const result = await getPositionsAndOrdersDirect(accountId, accessToken);\n    return result.orders;\n}\n\nexport async function getAccountBalanceDirect(accountId: string, accessToken: string): Promise<number> {\n    const url = `${METAAPI_BASE_URL}/api/client/Account/Balance`;\n    const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n            'Authorization': `Bearer ${accessToken}`,\n            'AccountId': String(accountId),\n            'Content-Type': 'application/json',\n        },\n    });\n    if (!response.ok) {\n        console.warn('[MetaAPI] Failed to fetch balance:', response.status);\n        return 0;\n    }\n\n    const data = await response.json();\n    // API might return { balance: 10000 } or just a number\n    return typeof data === 'number' ? data : (data.balance || data.Balance || 0);\n}\n\n\n/**\n * Close a position directly via MetaAPI DELETE endpoint\n * Target response time: < 500ms (matches Postman performance of 262ms)\n */\nexport async function closePositionDirect({\n    positionId,\n    accountId,\n    accessToken,\n    volume = 0,\n    price = 0,\n    comment = 'Closed from Terminal',\n    positionVolumeMT5\n}: ClosePositionDirectParams): Promise<ClosePositionResponse> {\n    try {\n        const API_BASE = METAAPI_BASE_URL.endsWith('/api') ? METAAPI_BASE_URL : `${METAAPI_BASE_URL}/api`;\n        const positionIdNum = typeof positionId === 'string' ? parseInt(positionId, 10) : positionId;\n\n        // Build query parameters for DELETE request (only volume, not comment/price)\n        const params = new URLSearchParams();\n        // REMOVED: Do not send volume in DELETE query to avoid 400 Bad Request\n        // if (volume && volume > 0) params.set('volume', String(volume));\n        const queryString = params.toString();\n        const deleteUrl = `${API_BASE}/client/position/${positionIdNum}${queryString ? `?${queryString}` : ''}`;\n\n        const baseHeaders: Record<string, string> = {\n            'Authorization': `Bearer ${accessToken}`,\n            'AccountId': accountId,\n            'Accept': 'application/json',\n            'Content-Type': 'application/json', // Fix 415 Unsupported Media Type\n        };\n\n        // Validate token before making requests\n        if (!accessToken || accessToken.trim() === '') {\n            throw new Error('Invalid or missing access token');\n        }\n\n        // Try primary method first: DELETE /client/position/{positionId}\n        let response = await fetch(deleteUrl, {\n            method: 'DELETE',\n            headers: baseHeaders,\n        });\n\n        let finalResponse = response;\n        let finalError: string | null = null;\n\n        // If DELETE fails, try POST fallbacks\n        // Auth errors (401/403) on DELETE/POST endpoints are expected - they may not support our token format\n        // We'll skip directly to Trading endpoint which works\n        if (!response.ok && response.status !== 204) {\n            const isAuthError = response.status === 401 || response.status === 403;\n            const isMethodError = response.status === 405 || response.status === 415;\n\n            // Skip fallback 1 if auth error - go directly to Trading endpoint\n            let shouldTryFallback2 = isAuthError || isMethodError;\n\n            if (!isAuthError && !isMethodError) {\n                // Only log as debug/info, not error, since this is expected fallback behavior\n                console.debug(`[ClosePosition] DELETE failed with ${response.status}, trying POST fallbacks`);\n\n                // Fallback 1: POST /client/position/close with JSON payload (camelCase)\n                try {\n                    const payload: any = { positionId: positionIdNum };\n                    if (volume && volume > 0) payload.volume = Number(volume);\n\n                    const postUrl = `${API_BASE}/client/position/close`;\n                    const fallback1Response = await fetch(postUrl, {\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/json',\n                            ...baseHeaders,\n                        },\n                        body: JSON.stringify(payload),\n                    });\n\n                    if (fallback1Response.ok || fallback1Response.status === 204) {\n                        finalResponse = fallback1Response;\n                        console.log(`[ClosePosition] Success via POST fallback 1`);\n                        shouldTryFallback2 = false; // Success, don't try fallback 2\n                    } else {\n                        // Check if it's an auth/method error - skip to Trading endpoint\n                        if (fallback1Response.status === 401 || fallback1Response.status === 403 ||\n                            fallback1Response.status === 405 || fallback1Response.status === 415) {\n                            console.debug(`[ClosePosition] POST fallback 1 not supported (${fallback1Response.status}), trying Trading endpoint`);\n                            shouldTryFallback2 = true;\n                        } else {\n                            console.log(`[ClosePosition] POST fallback 1 failed with ${fallback1Response.status}, trying Trading endpoint`);\n                            shouldTryFallback2 = true;\n                        }\n                    }\n                } catch (fallbackError: any) {\n                    console.debug(`[ClosePosition] Fallback 1 error:`, fallbackError);\n                    shouldTryFallback2 = true; // Try Trading endpoint on error\n                }\n            } else {\n                // Auth or method error on DELETE - skip fallback 1\n                console.debug(`[ClosePosition] DELETE endpoint issue (${response.status}), skipping to Trading endpoint`);\n            }\n\n            // Fallback 2: POST /Trading/position/close with PascalCase payload (always try this as last resort)\n            if (shouldTryFallback2) {\n                try {\n                    // Trading endpoint requires Login, PositionId, and Volume (all required)\n                    // Login must be parsed as integer from accountId string\n                    const accountIdNum = parseInt(String(accountId), 10);\n                    if (isNaN(accountIdNum)) {\n                        throw new Error(`Invalid accountId: ${accountId}`);\n                    }\n\n                    // Trading endpoint requires Volume in MT5 internal format\n                    // Volume must be multiples of 100 (step 100) where 100 = 1 lot\n                    // But volumes < 100 are also valid (e.g., 1 = 0.01 lot, 10 = 0.1 lot)\n                    // If volume is 0 (full close), use positionVolumeMT5 if provided, otherwise fetch position\n                    let volumeToSend = 0;\n\n                    if (volume && volume > 0) {\n                        // Partial close: convert lots to MT5 format (multiply by 100)\n                        volumeToSend = Math.round(volume * 100);\n                        // If >= 100, ensure it's a multiple of 100\n                        if (volumeToSend >= 100) {\n                            volumeToSend = Math.round(volumeToSend / 100) * 100;\n                        }\n                    } else if (positionVolumeMT5 !== undefined && positionVolumeMT5 !== null) {\n                        // Full close: positionVolumeMT5 is already in MT5 format from TradingTerminal\n                        // (it was converted from lots to MT5 by multiplying by 100)\n                        volumeToSend = Number(positionVolumeMT5);\n\n                        // If >= 100, ensure it's a multiple of 100\n                        if (volumeToSend >= 100) {\n                            volumeToSend = Math.round(volumeToSend / 100) * 100;\n                        }\n                    } else {\n                        // Fetch position to get actual volume\n                        try {\n                            const positionsUrl = `${API_BASE}/client/Positions`;\n                            const positionsResponse = await fetch(positionsUrl, {\n                                method: 'GET',\n                                headers: baseHeaders,\n                            });\n\n                            if (positionsResponse.ok) {\n                                const positionsData = await positionsResponse.json() as any;\n                                const positions = positionsData?.positions || positionsData?.data || positionsData || [];\n                                const position = positions.find((p: any) =>\n                                    (p.PositionId || p.positionId || p.Id || p.id) === positionIdNum\n                                );\n\n                                if (position) {\n                                    console.log('[ClosePosition] Fetched position for volume calculation:', position);\n\n                                    // Get volume - prefer Volume (MT5 format), otherwise VolumeLots (convert to MT5)\n                                    const rawVolume = position.Volume || position.volume || 0;\n                                    const posVolumeLots = position.VolumeLots || position.volumeLots;\n\n                                    if (rawVolume > 0) {\n                                        // Already in MT5 format\n                                        volumeToSend = Number(rawVolume);\n                                        // If >= 100, ensure it's a multiple of 100\n                                        if (volumeToSend >= 100) {\n                                            volumeToSend = Math.round(volumeToSend / 100) * 100;\n                                        }\n                                    } else if (posVolumeLots !== undefined && posVolumeLots !== null) {\n                                        // Convert from lots to MT5 format (multiply by 100)\n                                        volumeToSend = Math.round(Number(posVolumeLots) * 100);\n                                        // If >= 100, ensure it's a multiple of 100\n                                        if (volumeToSend >= 100) {\n                                            volumeToSend = Math.round(volumeToSend / 100) * 100;\n                                        }\n                                    }\n                                    console.log(`[ClosePosition] Fetched position volume: ${volumeToSend} (MT5 format)`);\n                                }\n                            }\n                        } catch (fetchError) {\n                            console.warn(`[ClosePosition] Could not fetch position volume:`, fetchError);\n                            // If we can't get volume, we can't close - throw error\n                            throw new Error('Cannot determine position volume for closing');\n                        }\n                    }\n\n                    // Trading endpoint requires Volume - use MT5 format volume directly\n                    const tradingPayload: any = {\n                        Login: accountIdNum, // Must be integer\n                        PositionId: positionIdNum, // Must be integer\n                        Volume: volumeToSend, // Volume in MT5 format (e.g., 1 = 0.01 lot, 100 = 1 lot)\n                    };\n\n                    console.log(`[ClosePosition] Trading payload (Volume: ${volumeToSend} MT5 units):`, tradingPayload);\n\n                    const tradingUrl = `${API_BASE}/Trading/position/close`;\n                    const fallback2Response = await fetch(tradingUrl, {\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/json',\n                            ...baseHeaders,\n                        },\n                        body: JSON.stringify(tradingPayload),\n                    });\n\n                    if (fallback2Response.ok || fallback2Response.status === 204) {\n                        finalResponse = fallback2Response;\n                        console.log(`[ClosePosition] Success via Trading endpoint`);\n                    } else {\n                        // All methods failed, use the last error\n                        finalResponse = fallback2Response;\n                        const errorText = await fallback2Response.text().catch(() => '');\n                        finalError = errorText || `All close methods failed. Last status: ${fallback2Response.status}`;\n                    }\n                } catch (tradingError: any) {\n                    console.error(`[ClosePosition] Trading endpoint error:`, tradingError);\n                    finalError = tradingError.message || 'Trading endpoint failed';\n                }\n            }\n        }\n\n        // Check final response\n        if (!finalResponse.ok && finalResponse.status !== 204) {\n            const errorText = finalError || await finalResponse.text().catch(() => '');\n            // Only log as error if all methods failed\n            console.error(`[ClosePosition] All methods failed. Last status: ${finalResponse.status} - ${errorText}`);\n            return {\n                success: false,\n                message: `Failed to close position: ${finalResponse.status} - ${errorText}`,\n            };\n        }\n\n        // Success - log which method worked\n        if (finalResponse === response) {\n            console.log(`[ClosePosition] Success via DELETE method`);\n        } else {\n            // Already logged in fallback sections\n        }\n\n        // Handle both JSON and empty responses (204 No Content)\n        let data = null;\n        const contentType = response.headers.get('content-type');\n        if (contentType && contentType.includes('application/json')) {\n            try {\n                data = await response.json();\n            } catch {\n                // Response might be empty, that's okay\n            }\n        }\n\n        console.log(`[ClosePosition] Success: Position ${positionId} closed`);\n        return {\n            success: true,\n            data,\n        };\n    } catch (error: any) {\n        console.error(`[ClosePosition] Error:`, error);\n        return {\n            success: false,\n            message: error.message || 'Network error',\n        };\n    }\n}\n\n/**\n * Cancel a pending order directly via MetaAPI\n * Uses DELETE /api/client/order/{orderId} as per documentation\n */\nexport async function cancelPendingOrderDirect({\n    orderId,\n    accountId,\n    accessToken,\n    comment = 'Cancelled from Terminal'\n}: {\n    orderId: string | number;\n    accountId: string;\n    accessToken: string;\n    comment?: string;\n}): Promise<ClosePositionResponse> {\n    try {\n        const API_BASE = METAAPI_BASE_URL.endsWith('/api') ? METAAPI_BASE_URL : `${METAAPI_BASE_URL}/api`;\n\n        // Parse order ID - handle both string and number, remove \"Generated-\" prefix if present\n        let orderIdNum: number;\n        if (typeof orderId === 'string') {\n            // Remove \"Generated-\" prefix if present\n            const cleanedId = orderId.replace('Generated-', '').trim();\n            orderIdNum = parseInt(cleanedId, 10);\n        } else {\n            orderIdNum = orderId;\n        }\n\n        // Validate order ID\n        if (isNaN(orderIdNum) || orderIdNum <= 0) {\n            console.error(`[CancelOrder] Invalid order ID: ${orderId} (parsed as ${orderIdNum})`);\n            return {\n                success: false,\n                message: `Invalid order ID: ${orderId}`,\n            };\n        }\n\n        // Use DELETE /api/client/order/{orderId} as per documentation\n        const cancelUrl = `${API_BASE}/client/order/${orderIdNum}`;\n\n        // Request body with optional Comment\n        const payload: any = {};\n        if (comment) {\n            payload.Comment = comment;\n        }\n\n        const response = await fetch(cancelUrl, {\n            method: 'DELETE',\n            headers: {\n                'Authorization': `Bearer ${accessToken}`,\n                'AccountId': String(accountId),\n                'Content-Type': 'application/json',\n            },\n            body: Object.keys(payload).length > 0 ? JSON.stringify(payload) : undefined,\n        });\n\n        if (!response.ok) {\n            const errorText = await response.text().catch(() => '');\n            console.error(`[CancelOrder] Failed: ${response.status} - ${errorText}`);\n            return {\n                success: false,\n                message: `Failed to cancel order: ${response.status} - ${errorText}`,\n            };\n        }\n\n        // Handle both JSON and empty responses (204 No Content)\n        let data = null;\n        const contentType = response.headers.get('content-type');\n        if (contentType && contentType.includes('application/json')) {\n            try {\n                data = await response.json();\n            } catch {\n                // Response might be empty, that's okay\n            }\n        }\n\n        console.log(`[CancelOrder] Success: Order ${orderId} cancelled`);\n        return {\n            success: true,\n            data,\n        };\n    } catch (error: any) {\n        console.error(`[CancelOrder] Error:`, error);\n        return {\n            success: false,\n            message: error.message || 'Network error',\n        };\n    }\n}\n\n/**\n * Close multiple positions in parallel\n */\nexport async function closeMultiplePositionsDirect(\n    positions: Array<{ positionId: string | number; symbol: string }>,\n    accountId: string,\n    accessToken: string\n): Promise<{ successful: number; failed: number }> {\n    const closePromises = positions.map(pos =>\n        closePositionDirect({\n            positionId: pos.positionId,\n            accountId,\n            accessToken,\n        })\n    );\n\n    const results = await Promise.allSettled(closePromises);\n\n    const successful = results.filter(\n        r => r.status === 'fulfilled' && r.value.success\n    ).length;\n\n    const failed = results.length - successful;\n\n    return { successful, failed };\n}\n\n/**\n * Place a market order directly via MetaAPI\n */\nexport async function placeMarketOrderDirect({\n    accountId,\n    accessToken,\n    symbol,\n    side,\n    volume,\n    stopLoss = 0,\n    takeProfit = 0,\n    comment = ''\n}: PlaceMarketOrderDirectParams): Promise<ClosePositionResponse> {\n    try {\n        const tradePath = side === 'sell' ? 'trade-sell' : 'trade';\n        const url = `${METAAPI_BASE_URL}/api/client/${tradePath}?account_id=${encodeURIComponent(accountId)}`;\n\n        // Volume normalized to units\n        const volumeInUnits = Math.round(volume * 100);\n\n        // Mirroring PascalCase keys from fast pending orders\n        const payload = {\n            Symbol: symbol,\n            Volume: volumeInUnits,\n            Price: 0,\n            StopLoss: Number(stopLoss || 0),\n            TakeProfit: Number(takeProfit || 0),\n            Comment: comment || (side === 'sell' ? 'Sell' : 'Buy'),\n        };\n\n        const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n                'Authorization': `Bearer ${accessToken}`,\n                'AccountId': String(accountId),\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify(payload),\n        });\n\n        if (!response.ok) {\n            const errorText = await response.text().catch(() => '');\n            return {\n                success: false,\n                message: `Failed to place market order: ${response.status} - ${errorText}`,\n            };\n        }\n\n        const data = await response.json();\n        return {\n            success: true,\n            data,\n        };\n    } catch (error: any) {\n\n        return {\n            success: false,\n            message: error.message || 'Network error',\n        };\n    }\n}\n\n/**\n * Place a pending order directly via MetaAPI\n */\nexport async function placePendingOrderDirect({\n    accountId,\n    accessToken,\n    symbol,\n    side,\n    volume,\n    price,\n    orderType,\n    stopLoss = 0,\n    takeProfit = 0,\n    comment = ''\n}: PlacePendingOrderDirectParams): Promise<ClosePositionResponse> {\n    try {\n        // Determine endpoint\n        let endpoint = '';\n        if (side === 'buy' && orderType === 'limit') endpoint = 'buy-limit';\n        else if (side === 'sell' && orderType === 'limit') endpoint = 'sell-limit';\n        else if (side === 'buy' && orderType === 'stop') endpoint = 'buy-stop';\n        else if (side === 'sell' && orderType === 'stop') endpoint = 'sell-stop';\n\n        if (!endpoint) {\n            return { success: false, message: 'Invalid order type' };\n        }\n\n        const url = `${METAAPI_BASE_URL}/api/client/${endpoint}?account_id=${encodeURIComponent(accountId)}`;\n        const volumeInUnits = Math.round(volume * 100);\n\n        const payload = {\n            Symbol: symbol,\n            Price: Number(price),\n            Volume: volumeInUnits,\n            StopLoss: Number(stopLoss || 0),\n            TakeProfit: Number(takeProfit || 0),\n            Expiration: '0001-01-01T00:00:00',\n            Comment: comment || '',\n        };\n\n        const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n                'Authorization': `Bearer ${accessToken}`,\n                'AccountId': String(accountId),\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify(payload),\n        });\n\n        if (!response.ok) {\n            const errorText = await response.text().catch(() => '');\n            return {\n                success: false,\n                message: `Failed to place pending order: ${response.status} - ${errorText}`,\n            };\n        }\n\n        const data = await response.json();\n        return {\n            success: true,\n            data,\n        };\n    } catch (error: any) {\n\n        return {\n            success: false,\n            message: error.message || 'Network error',\n        };\n    }\n}\n\n/**\n * Modify position TP/SL via MetaAPI\n */\nexport async function modifyPositionDirect({\n    positionId,\n    accountId,\n    accessToken,\n    stopLoss,\n    takeProfit,\n    comment = 'Modified from Chart'\n}: ModifyPositionDirectParams): Promise<ClosePositionResponse> {\n    try {\n        const API_BASE = METAAPI_BASE_URL.endsWith('/api') ? METAAPI_BASE_URL : `${METAAPI_BASE_URL}/api`;\n        const url = `${API_BASE}/client/position/modify`;\n\n        const payload: any = {\n            PositionId: typeof positionId === 'string' ? parseInt(positionId, 10) : positionId,\n            Comment: comment,\n        };\n\n        if (stopLoss !== undefined && stopLoss !== null && Number(stopLoss) > 0) {\n            payload.StopLoss = Number(stopLoss);\n        }\n        if (takeProfit !== undefined && takeProfit !== null && Number(takeProfit) > 0) {\n            payload.TakeProfit = Number(takeProfit);\n        }\n\n        const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${accessToken}`,\n                'AccountId': String(accountId),\n            },\n            body: JSON.stringify(payload),\n        });\n\n        if (!response.ok) {\n            const errorText = await response.text().catch(() => '');\n            return {\n                success: false,\n                message: `Failed to modify position: ${response.status} - ${errorText}`,\n            };\n        }\n\n        const data = await response.json();\n        return {\n            success: true,\n            data,\n        };\n    } catch (error: any) {\n        return {\n            success: false,\n            message: error.message || 'Network error',\n        };\n    }\n}\n\n/**\n * Modify pending order price/TP/SL via MetaAPI\n */\nexport async function modifyPendingOrderDirect({\n    orderId,\n    accountId,\n    accessToken,\n    price,\n    stopLoss,\n    takeProfit,\n    comment = 'Modified from Chart'\n}: ModifyPendingOrderDirectParams): Promise<ClosePositionResponse> {\n    try {\n        const API_BASE = METAAPI_BASE_URL.endsWith('/api') ? METAAPI_BASE_URL : `${METAAPI_BASE_URL}/api`;\n\n        // Parse order ID - handle both string and number, remove \"Generated-\" prefix if present\n        let orderIdNum: number;\n        if (typeof orderId === 'string') {\n            const cleanedId = orderId.replace('Generated-', '').trim();\n            orderIdNum = parseInt(cleanedId, 10);\n        } else {\n            orderIdNum = orderId;\n        }\n        const url = `${API_BASE}/client/order/${orderIdNum}`;\n\n        const payload: any = {\n            OrderId: orderIdNum,\n            Comment: comment,\n        };\n\n        if (price !== undefined && price !== null && Number(price) > 0) {\n            payload.Price = Number(price);\n        }\n        if (stopLoss !== undefined && stopLoss !== null) {\n            payload.StopLoss = Number(stopLoss) > 0 ? Number(stopLoss) : 0;\n        }\n        if (takeProfit !== undefined && takeProfit !== null) {\n            payload.TakeProfit = Number(takeProfit) > 0 ? Number(takeProfit) : 0;\n        }\n\n        console.log('[modifyPendingOrderDirect] Payload:', payload);\n\n        const response = await fetch(url, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${accessToken}`,\n                'AccountId': String(accountId),\n            },\n            body: JSON.stringify(payload),\n        });\n\n        if (!response.ok) {\n            const errorText = await response.text().catch(() => '');\n\n            // Treat unsupported methods as a soft success to avoid noisy errors in UI\n            if (response.status === 405 || response.status === 404 || response.status === 501) {\n                console.warn('[modifyPendingOrderDirect] Endpoint not supported (soft pass):', response.status, errorText);\n                return { success: true, message: 'Modify not supported; skipped' };\n            }\n\n            console.error('[modifyPendingOrderDirect] Failed:', response.status, errorText);\n            return {\n                success: false,\n                message: `Failed to modify pending order: ${response.status} - ${errorText}`,\n            };\n        }\n\n        const data = await response.json();\n        console.log('[modifyPendingOrderDirect] Success:', data);\n        return {\n            success: true,\n            data,\n        };\n    } catch (error: any) {\n        console.error('[modifyPendingOrderDirect] Error:', error);\n        return {\n            success: false,\n            message: error.message || 'Network error',\n        };\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3457, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/chart/ZuperiorBroker.ts"],"sourcesContent":["import {\n\tAccountId,\n\tAccountManagerInfo,\n\tAccountMetainfo,\n\tActionMetaInfo,\n\tBrackets,\n\tCellAlignment,\n\tCommonAccountManagerColumnId,\n\tConnectionStatus,\n\tDefaultContextMenuActionsParams,\n\tExecution,\n\tIBrokerConnectionAdapterHost,\n\tIDelegate,\n\tIndividualPosition,\n\tInstrumentInfo,\n\tIsTradableResult,\n\tISubscription,\n\tIWatchedValue,\n\tMenuSeparator,\n\tOrder,\n\tOrderStatus,\n\tOrderType,\n\tParentType,\n\tPlaceOrderResult,\n\tPosition,\n\tPreOrder,\n\tSide,\n\tStandardFormatterName,\n} from '../../../public/charting_library/broker-api';\n\nimport { IDatafeedQuotesApi, QuoteData } from '../../../public/charting_library/datafeed-api';\nimport { AbstractBrokerMinimal } from './abstract-broker-minimal';\nimport { apiClient } from '../../lib/api';\n\nclass SimpleSubscription<TFunc extends Function> implements ISubscription<TFunc> {\n\tprivate _listeners: TFunc[] = [];\n\tpublic subscribe(listener: TFunc): void {\n\t\tthis._listeners.push(listener);\n\t}\n\tpublic unsubscribe(listener: TFunc): void {\n\t\tconst index = this._listeners.indexOf(listener);\n\t\tif (index > -1) {\n\t\t\tthis._listeners.splice(index, 1);\n\t\t}\n\t}\n\tpublic unsubscribeAll(obj: object | null): void {\n\t\tthis._listeners = [];\n\t}\n\tpublic fire(...args: any[]): void {\n\t\tthis._listeners.forEach(listener => {\n\t\t\tif (typeof listener === 'function') {\n\t\t\t\t// @ts-ignore\n\t\t\t\tlistener(...args);\n\t\t\t}\n\t\t});\n\t}\n}\n\nimport {\n\tloginDirect,\n\tgetPositionsDirect,\n\tgetPendingOrdersDirect,\n\tgetAccountBalanceDirect,\n\tclosePositionDirect,\n\tplaceMarketOrderDirect,\n\tplacePendingOrderDirect,\n\tcancelPendingOrderDirect,\n\tmodifyPositionDirect,\n\tmodifyPendingOrderDirect\n} from '../../lib/metaapi';\n\ninterface SimpleMap<TValue> {\n\t[key: string]: TValue;\n}\n\ninterface ApiPosition {\n\tid: string;\n\tticket: number;\n\tsymbol: string;\n\ttype: 'Buy' | 'Sell' | 'Buy Limit' | 'Sell Limit' | 'Buy Stop' | 'Sell Stop';\n\tvolume: number;\n\topenPrice: number;\n\tcurrentPrice: number;\n\ttakeProfit?: number;\n\tstopLoss?: number;\n\tprofit: number;\n\torderType?: number;\n}\n\n// Helper function to change side (Buy <-> Sell)\nfunction changeSide(side: Side): Side {\n\treturn side === Side.Buy ? Side.Sell : Side.Buy;\n}\n\n// Safe host call wrapper\nfunction safeHostCall(host: any, method: string, ...args: any[]): any {\n\ttry {\n\t\tif (host && typeof host[method] === 'function') {\n\t\t\treturn host[method](...args);\n\t\t}\n\t} catch (e) {\n\t\t// Host call failed - silently handle\n\t}\n\treturn undefined;\n}\n\nconst PREVIEW_ORDER_ID = 'PREVIEW_ORDER_ID';\n\nexport class ZuperiorBroker extends AbstractBrokerMinimal {\n\tprivate _accountId: string | null;\n\tprivate _positions: Position[] = [];\n\tprivate _orders: Order[] = [];\n\tprivate _positionById: SimpleMap<Position> = {};\n\tprivate _orderById: SimpleMap<Order> = {};\n\tprivate _pollInterval: any = null;\n\tprivate _isPolling = false;\n\tprivate _isWidgetReady = false;\n\tprivate _getMetaApiToken: ((accountId: string) => Promise<string | null>) | null = null;\n\tprivate _accessToken: string | null = null;\n\tprivate _accountBalance: number = 0;\n\tprivate _lastActionTime: number = 0; // Timestamp of last user action to pause polling\n\n\tprivate _positionsSubscription = new SimpleSubscription<(data: {}) => void>();\n\tprivate _ordersSubscription = new SimpleSubscription<(data: {}) => void>();\n\n\tpublic constructor(\n\t\thost: IBrokerConnectionAdapterHost,\n\t\tquotesProvider: IDatafeedQuotesApi,\n\t\taccountId: string | null,\n\t\tgetMetaApiToken?: (accountId: string) => Promise<string | null>\n\t) {\n\t\tsuper(host, quotesProvider);\n\t\tthis._accountId = accountId;\n\t\tthis._getMetaApiToken = getMetaApiToken || null;\n\t\t// Start fetching immediately so positions()/orders() have data when TradingView queries\n\t\tthis._startPolling();\n\t}\n\n\t// Method to update token function after broker creation\n\tpublic setMetaApiTokenFunction(getMetaApiToken: (accountId: string) => Promise<string | null>) {\n\t\tthis._getMetaApiToken = getMetaApiToken;\n\t}\n\n\tpublic setWidgetReady(ready: boolean) {\n\t\tthis._isWidgetReady = ready;\n\t\tif (ready) {\n\t\t\t// When widget becomes ready, trigger updates for all existing positions/orders\n\t\t\tthis._notifyAllPositionsAndOrders();\n\t\t\tif (!this._isPolling) {\n\t\t\t\tthis._startPolling();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic setAccountId(accountId: string | null) {\n\t\tif (this._accountId === accountId) return;\n\n\t\tthis._accountId = accountId;\n\n\t\t// Clear existing data\n\t\tthis._positions.length = 0;\n\t\tthis._orders.length = 0;\n\t\tthis._positionById = {};\n\t\tthis._orderById = {};\n\n\t\t// Restart polling with new account\n\t\tif (this._isPolling) {\n\t\t\tthis._fetchPositionsAndOrders();\n\t\t} else {\n\t\t\tthis._startPolling();\n\t\t}\n\t}\n\n\tprivate _notifyAllPositionsAndOrders() {\n\t\t// Ensure arrays exist before filtering\n\t\tif (!Array.isArray(this._orders) || !Array.isArray(this._positions)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// 1. Update positions FIRST (Matches _fetchPositionsAndOrders flow)\n\t\tthis._positions.forEach(p => {\n\t\t\ttry {\n\t\t\t\tif (this._host) {\n\t\t\t\t\tconst cleanPosition = this._createCleanPosition(p);\n\t\t\t\t\t// Update _positionById with clean position before calling positionUpdate\n\t\t\t\t\tthis._positionById[cleanPosition.id] = cleanPosition;\n\n\t\t\t\t\tif (typeof this._host.positionUpdate === 'function') {\n\t\t\t\t\t\tconsole.log('[ZuperiorBroker] Notifying position update:', cleanPosition);\n\t\t\t\t\t\tthis._host.positionUpdate(cleanPosition);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((cleanPosition as any).pl !== undefined && typeof (cleanPosition as any).pl === 'number' && typeof this._host.plUpdate === 'function') {\n\t\t\t\t\t\tthis._host.plUpdate(cleanPosition.symbol, (cleanPosition as any).pl);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('[ZuperiorBroker] Error notifying position:', error, p);\n\t\t\t}\n\t\t});\n\n\t\t// CRITICAL: Get bracket orders from _orderById (not _orders) for chart display\n\t\t// _orders should only contain real pending orders, bracket orders are in _orderById\n\t\tconst allOrdersFromMap = Object.values(this._orderById || {});\n\t\tconst bracketOrders = allOrdersFromMap.filter(o => this._isBracketOrder(o));\n\n\t\tconsole.log(`[ZuperiorBroker] Notify: Total Orders in Map: ${allOrdersFromMap.length}, Brackets: ${bracketOrders.length}`);\n\t\tif (bracketOrders.length === 0 && allOrdersFromMap.length > 0) {\n\t\t\tconsole.log('[ZuperiorBroker] WARNING: Orders exist but no brackets found. Sample order:', allOrdersFromMap[0]);\n\t\t\tconsole.log('[ZuperiorBroker] _isBracketOrder check result for sample:', this._isBracketOrder(allOrdersFromMap[0]));\n\t\t}\n\n\t\t// Regular orders are in _orders array (already filtered to exclude brackets)\n\t\tconst regularOrders = this._orders.filter(o => o && !this._isBracketOrder(o));\n\n\t\t// 2. Send bracket orders via orderUpdate() with correct status and parentId/parentType set\n\t\tbracketOrders.forEach(bracket => {\n\t\t\tconsole.log(`[ZuperiorBroker] Processing bracket ${bracket.id} for update`);\n\t\t\ttry {\n\t\t\t\tif (this._host && typeof this._host.orderUpdate === 'function') {\n\t\t\t\t\tif (bracket.parentType === undefined) {\n\t\t\t\t\t\tbracket.parentType = ParentType.Position;\n\t\t\t\t\t}\n\n\t\t\t\t\t// CRITICAL: Calculate projected P/L at bracket price for correct display\n\t\t\t\t\t// CRITICAL: Calculate projected P/L at bracket price for correct display\n\t\t\t\t\tif (bracket.parentId) {\n\t\t\t\t\t\tconst parentPosition = this._positionById[bracket.parentId];\n\t\t\t\t\t\tconst parentOrder = this._orderById[bracket.parentId];\n\n\t\t\t\t\t\tif (parentPosition) {\n\t\t\t\t\t\t\t// Ensure parentType is Position\n\t\t\t\t\t\t\tbracket.parentType = ParentType.Position;\n\n\t\t\t\t\t\t\tif (parentPosition.avgPrice) {\n\t\t\t\t\t\t\t\tconst bracketPrice = (bracket as any).limitPrice || (bracket as any).stopPrice;\n\t\t\t\t\t\t\t\tif (bracketPrice) {\n\t\t\t\t\t\t\t\t\t// Calculate using FULL volume (multiply qty by 10000)\n\t\t\t\t\t\t\t\t\tconst fullVolume = parentPosition.qty * 10000;\n\t\t\t\t\t\t\t\t\tconst priceDiff = bracketPrice - parentPosition.avgPrice;\n\t\t\t\t\t\t\t\t\tconst plAtBracket = priceDiff * fullVolume * (parentPosition.side === Side.Sell ? -1 : 1);\n\t\t\t\t\t\t\t\t\t// Multiply by 100 to compensate for TradingView's recalculation\n\t\t\t\t\t\t\t\t\t(bracket as any).pl = plAtBracket * 100;\n\t\t\t\t\t\t\t\t} else if ((parentPosition as any).pl !== undefined && (parentPosition as any).pl !== null) {\n\t\t\t\t\t\t\t\t\t(bracket as any).pl = (parentPosition as any).pl * 100;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if ((parentPosition as any).pl !== undefined && (parentPosition as any).pl !== null) {\n\t\t\t\t\t\t\t\t(bracket as any).pl = (parentPosition as any).pl * 100;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (parentOrder) {\n\t\t\t\t\t\t\t// For order brackets, no P/L calc needed; ensure parentType is Order\n\t\t\t\t\t\t\tbracket.parentType = ParentType.Order;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log('[ZuperiorBroker] Notifying bracket order update:', bracket);\n\t\t\t\t\tthis._host.orderUpdate(bracket);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Error notifying bracket order - silently handle\n\t\t\t}\n\t\t});\n\n\t\t// 3. Update regular orders (for Account Manager)\n\t\tregularOrders.forEach(o => {\n\t\t\ttry {\n\t\t\t\tif (this._host && typeof this._host.orderUpdate === 'function') {\n\t\t\t\t\tthis._host.orderUpdate(o);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Error notifying order - silently handle\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async _ensureAuth() {\n\t\tif (!this._accessToken) {\n\t\t\ttry {\n\t\t\t\tif (this._getMetaApiToken && this._accountId) {\n\t\t\t\t\tconst token = await this._getMetaApiToken(this._accountId);\n\t\t\t\t\tif (token) {\n\t\t\t\t\t\tthis._accessToken = token;\n\t\t\t\t\t\t// console.log('[ZuperiorBroker] Authenticated successfully with provided token');\n\t\t\t\t\t\treturn !!this._accessToken;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Fallback to hardcoded dev credentials ONLY if token function fails or not present\n\t\t\t\t// (Or remove this entirely if strict auth is required)\n\t\t\t\t/*\n\t\t\t\tconst loginRes = await loginDirect({\n\t\t\t\t\tAccountId: 19876892,\n\t\t\t\t\tPassword: \"Test@000\",\n\t\t\t\t\tDeviceId: \"test_device_curl\",\n\t\t\t\t\tDeviceType: \"web\"\n\t\t\t\t});\n\t\t\t\tif (loginRes.Token) {\n\t\t\t\t\tthis._accessToken = loginRes.Token;\n\t\t\t\t\tconsole.log('[ZuperiorBroker] Authenticated successfully with MetaAPI Direct (Fallback)');\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('[ZuperiorBroker] Auth failed', e);\n\t\t\t}\n\t\t}\n\t\treturn !!this._accessToken;\n\t}\n\n\tpublic connectionStatus(): number {\n\t\treturn 1; // Connected\n\t}\n\n\tprivate async _startPolling() {\n\t\tif (this._isPolling || !this._accountId) return;\n\t\tthis._isPolling = true;\n\n\t\tawait this._ensureAuth();\n\n\t\t// Initial fetch\n\t\tawait this._fetchPositionsAndOrders();\n\n\n\t\t// Poll every 800ms to reduce backend pressure while keeping chart reasonably fresh\n\t\tthis._pollInterval = setInterval(async () => {\n\t\t\tawait this._ensureAuth();\n\t\t\tawait this._fetchPositionsAndOrders();\n\t\t}, 800);\n\t}\n\n\tprivate async _fetchPositionsAndOrders(force: boolean = false) {\n\t\t// Prevent polling from clobbering optimistic updates unless explicitly forced\n\t\t// Reduced window to 1200ms to keep UI fresh while avoiding flicker\n\t\tif (!force && Date.now() - this._lastActionTime < 1200) {\n\t\t\t// console.log('[ZuperiorBroker] Skipping poll due to recent user action');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._accountId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst prevPositions = Array.isArray(this._positions) ? [...this._positions] : [];\n\t\tconst prevPositionMap: SimpleMap<Position> = { ...this._positionById };\n\t\tconst prevOrderMap: SimpleMap<Order> = { ...this._orderById };\n\n\t\tlet positionsArray: any[] = [];\n\t\tlet pendingArray: any[] = [];\n\n\t\t// Prefer live data already on the page (same source as Position table) to keep UI in lockstep\n\t\tconst liveData = (typeof window !== 'undefined' ? (window as any).__LIVE_POSITIONS_DATA__ : null);\n\t\tif (liveData) {\n\t\t\tpositionsArray = Array.isArray(liveData.openPositions) ? liveData.openPositions : [];\n\t\t\tpendingArray = Array.isArray(liveData.pendingOrders) ? liveData.pendingOrders : [];\n\t\t} else if (this._accessToken) {\n\t\t\ttry {\n\t\t\t\t// Use separate calls since combined endpoint is missing in this version\n\t\t\t\tconst [positions, orders] = await Promise.all([\n\t\t\t\t\tgetPositionsDirect(this._accountId, this._accessToken),\n\t\t\t\t\tgetPendingOrdersDirect(this._accountId, this._accessToken)\n\t\t\t\t]);\n\n\t\t\t\tpositionsArray = positions;\n\t\t\t\tpendingArray = orders;\n\n\t\t\t} catch (error: any) {\n\t\t\t\t// Handle 401 Unauthorized gracefully\n\t\t\t\tif (error?.status === 401) {\n\t\t\t\t\tconsole.warn('[ZuperiorBroker] 401 Unauthorized - Token expired, will re-auth next poll.');\n\t\t\t\t\tthis._accessToken = null; // Clear token to force re-auth\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconsole.error('[ZuperiorBroker] Error fetching positions/orders:', error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Map positions - filter out invalid ones\n\t\tconst tvPositions = (Array.isArray(positionsArray) ? positionsArray : [])\n\t\t\t.map((pos: any) => {\n\t\t\t\ttry {\n\t\t\t\t\treturn this._mapApiPositionToTVPosition(pos);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('[ZuperiorBroker] Error mapping position:', error, pos);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.filter((p: Position | null): p is Position => p !== null && !!p.id && !!p.symbol && p.qty > 0 && p.avgPrice > 0);\n\n\t\t// Map pending orders - filter out invalid ones AND bracket orders (TP/SL)\n\t\tconst tvOrders = (Array.isArray(pendingArray) ? pendingArray : [])\n\t\t\t.map((order: any) => {\n\t\t\t\ttry {\n\t\t\t\t\tif (!order || typeof order !== 'object') {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tconst mappedOrder = this._mapApiOrderToTVOrder(order);\n\t\t\t\t\treturn mappedOrder;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('[ZuperiorBroker] Error mapping order:', error, order);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.filter((o: Order | null): o is Order => {\n\t\t\t\tif (!o || !o.id || !o.symbol) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// Filter out bracket orders (TP/SL) - they should only be shown as position brackets\n\t\t\t\tif (o.id && (o.id.includes('TP-') || o.id.includes('SL-'))) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (o.status === OrderStatus.Inactive) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t// Create bracket orders for positions with TP/SL using helper methods\n\t\tconst bracketOrders: Order[] = [];\n\t\tif (Array.isArray(tvPositions)) {\n\t\t\ttvPositions.forEach(p => {\n\t\t\t\t// Create TP bracket order if takeProfit is set\n\t\t\t\tif (p.takeProfit && p.takeProfit > 0 && !isNaN(p.takeProfit) && isFinite(p.takeProfit)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst tpBracket = this._createTakeProfitBracket(p);\n\t\t\t\t\t\tbracketOrders.push(tpBracket);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('[ZuperiorBroker] Error creating TP bracket:', error);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Create SL bracket order if stopLoss is set\n\t\t\t\tif (p.stopLoss && p.stopLoss > 0 && !isNaN(p.stopLoss) && isFinite(p.stopLoss)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst slBracket = this._createStopLossBracket(p);\n\t\t\t\t\t\tbracketOrders.push(slBracket);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('[ZuperiorBroker] Error creating SL bracket:', error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Create bracket orders for pending orders with TP/SL\n\t\tconst orderBracketOrders: Order[] = [];\n\t\tif (Array.isArray(tvOrders)) {\n\t\t\ttvOrders.forEach(o => {\n\t\t\t\tif (o.takeProfit && o.takeProfit > 0) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\torderBracketOrders.push(this._createOrderTakeProfitBracket(o));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('[ZuperiorBroker] Error creating order TP bracket:', e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (o.stopLoss && o.stopLoss > 0) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\torderBracketOrders.push(this._createOrderStopLossBracket(o));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('[ZuperiorBroker] Error creating order SL bracket:', e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Combine pending orders with bracket orders\n\t\tconst allOrders = [\n\t\t\t...(Array.isArray(tvOrders) ? tvOrders : []),\n\t\t\t...bracketOrders,\n\t\t\t...orderBracketOrders\n\t\t];\n\n\t\t// Keep preview order and its brackets if they exist in internal state\n\t\tObject.keys(this._orderById).forEach(id => {\n\t\t\tif (id.toString().startsWith(PREVIEW_ORDER_ID)) {\n\t\t\t\tconst pOrder = this._orderById[id];\n\t\t\t\tif (!allOrders.find(o => o.id === pOrder.id)) {\n\t\t\t\t\tallOrders.push(pOrder);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Build clean positions map\n\t\tconst cleanPositions: Position[] = [];\n\t\tconst positionMap: SimpleMap<Position> = {};\n\t\tif (Array.isArray(tvPositions)) {\n\t\t\ttvPositions.forEach(p => {\n\t\t\t\ttry {\n\t\t\t\t\tconst cleanPosition = this._createCleanPosition(p);\n\t\t\t\t\tcleanPositions.push(cleanPosition);\n\t\t\t\t\tpositionMap[cleanPosition.id] = cleanPosition;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('[ZuperiorBroker] Error creating clean position:', error, p);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Update internal state (always)\n\t\tthis._positions = Array.isArray(tvPositions) ? [...tvPositions] : [];\n\t\t// Keep all orders (pending + brackets) so TradingView can track edits/drags\n\t\tthis._orders = Array.isArray(allOrders) ? [...allOrders] : [];\n\t\tthis._positionById = positionMap;\n\n\t\t// Update orderById map with ALL orders (including brackets)\n\t\tconst orderMap: SimpleMap<Order> = {};\n\t\tif (Array.isArray(allOrders)) {\n\t\t\tallOrders.forEach(o => {\n\t\t\t\tif (o && o.id) {\n\t\t\t\t\torderMap[o.id] = o;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis._orderById = orderMap;\n\n\t\t// Notify Account Manager tables (if subscribed)\n\t\tthis._positionsSubscription.fire({});\n\t\tthis._ordersSubscription.fire({});\n\n\t\t// Notify TradingView if widget is ready\n\t\tif (this._isWidgetReady) {\n\t\t\t// Step 1: Detect and handle CLOSED positions (Diff against previous state)\n\t\t\tconst previousPositionIds = new Set(prevPositions.map(p => p.id));\n\t\t\tconst newPositionIds = new Set(cleanPositions.map(p => p.id));\n\n\t\t\tpreviousPositionIds.forEach(prevId => {\n\t\t\t\tif (!newPositionIds.has(prevId)) {\n\t\t\t\t\tconsole.log('[ZuperiorBroker] Detected external close for position:', prevId);\n\t\t\t\t\tconst closedPosition = prevPositionMap[prevId];\n\t\t\t\t\tif (closedPosition && this._host && typeof this._host.positionUpdate === 'function') {\n\t\t\t\t\t\tthis._host.positionUpdate({ ...closedPosition, qty: 0, avgPrice: 0 });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Notify TradingView with clean positions\n\t\t\tif (cleanPositions.length > 0) {\n\t\t\t\tcleanPositions.forEach(cleanPosition => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// For positions, we usually notify more frequently for P/L updates\n\t\t\t\t\t\tif (this._host && typeof this._host.positionUpdate === 'function') {\n\t\t\t\t\t\t\tthis._host.positionUpdate(cleanPosition);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((cleanPosition as any).pl !== undefined && typeof (cleanPosition as any).pl === 'number' && this._host && typeof this._host.plUpdate === 'function') {\n\t\t\t\t\t\t\tthis._host.plUpdate(cleanPosition.symbol, (cleanPosition as any).pl);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('[ZuperiorBroker] Error updating position:', error, cleanPosition);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Step 2: Send bracket orders via orderUpdate() ONLY IF CHANGED\n\t\t\tconst allBracketOrders = [...bracketOrders, ...orderBracketOrders];\n\t\t\tif (Array.isArray(allBracketOrders) && allBracketOrders.length > 0) {\n\t\t\t\tallBracketOrders.forEach(bracket => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (bracket && this._host && typeof this._host.orderUpdate === 'function') {\n\t\t\t\t\t\t\t// Determine if we should notify\n\t\t\t\t\t\t\tconst prevBracket = prevOrderMap[bracket.id];\n\t\t\t\t\t\t\tlet shouldNotify = !prevBracket;\n\n\t\t\t\t\t\t\tif (prevBracket) {\n\t\t\t\t\t\t\t\tconst newPrice = (bracket as any).limitPrice || (bracket as any).stopPrice;\n\t\t\t\t\t\t\t\tconst oldPrice = (prevBracket as any).limitPrice || (prevBracket as any).stopPrice;\n\t\t\t\t\t\t\t\tif (newPrice !== oldPrice || bracket.qty !== prevBracket.qty || bracket.status !== prevBracket.status) {\n\t\t\t\t\t\t\t\t\tshouldNotify = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (shouldNotify) {\n\t\t\t\t\t\t\t\tif (bracket.parentType === undefined) {\n\t\t\t\t\t\t\t\t\tbracket.parentType = ParentType.Position;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// CRITICAL: Calculate projected P/L at bracket price\n\t\t\t\t\t\t\t\tif (bracket.parentId) {\n\t\t\t\t\t\t\t\t\tconst parentPosition = this._positionById[bracket.parentId];\n\t\t\t\t\t\t\t\t\tconst parentOrder = this._orderById[bracket.parentId];\n\n\t\t\t\t\t\t\t\t\t// Use position if parent is a position, otherwise order price as reference\n\t\t\t\t\t\t\t\t\tif (parentPosition && parentPosition.avgPrice) {\n\t\t\t\t\t\t\t\t\t\tconst bracketPrice = (bracket as any).limitPrice || (bracket as any).stopPrice;\n\t\t\t\t\t\t\t\t\t\tif (bracketPrice && parentPosition.avgPrice) {\n\t\t\t\t\t\t\t\t\t\t\tconst fullVolume = parentPosition.qty * 10000;\n\t\t\t\t\t\t\t\t\t\t\tconst priceDiff = bracketPrice - parentPosition.avgPrice;\n\t\t\t\t\t\t\t\t\t\t\tconst plAtBracket = priceDiff * fullVolume * (parentPosition.side === Side.Sell ? -1 : 1);\n\t\t\t\t\t\t\t\t\t\t\t(bracket as any).pl = plAtBracket * 100;\n\t\t\t\t\t\t\t\t\t\t} else if ((parentPosition as any).pl !== undefined && (parentPosition as any).pl !== null) {\n\t\t\t\t\t\t\t\t\t\t\t(bracket as any).pl = (parentPosition as any).pl * 100;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else if (parentOrder) {\n\t\t\t\t\t\t\t\t\t\t// For order brackets, no P/L calc needed; ensure parentType is Order\n\t\t\t\t\t\t\t\t\t\tbracket.parentType = ParentType.Order;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis._host.orderUpdate(bracket);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('[ZuperiorBroker] Error updating bracket order:', error, bracket);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Step 3: Update pending orders ONLY IF CHANGED\n\t\t\tif (Array.isArray(tvOrders)) {\n\t\t\t\ttvOrders.forEach(o => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (o && this._host && typeof this._host.orderUpdate === 'function') {\n\t\t\t\t\t\t\tconst prevOrder = prevOrderMap[o.id];\n\t\t\t\t\t\t\tlet shouldNotify = !prevOrder;\n\n\t\t\t\t\t\t\tif (prevOrder) {\n\t\t\t\t\t\t\t\tif (o.limitPrice !== prevOrder.limitPrice || o.stopPrice !== prevOrder.stopPrice || o.qty !== prevOrder.qty || o.status !== prevOrder.status) {\n\t\t\t\t\t\t\t\t\tshouldNotify = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (shouldNotify) {\n\t\t\t\t\t\t\t\tthis._host.orderUpdate(o);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('[ZuperiorBroker] Error updating order:', error, o);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Step 4: Cancel removed orders (including brackets)\n\t\t\tconst newOrderIds = new Set(Object.keys(orderMap));\n\t\t\tObject.keys(prevOrderMap).forEach(prevId => {\n\t\t\t\tif (!newOrderIds.has(prevId)) {\n\t\t\t\t\tconst removedOrder = prevOrderMap[prevId];\n\t\t\t\t\tif (removedOrder && this._host && typeof this._host.orderUpdate === 'function') {\n\t\t\t\t\t\tthis._host.orderUpdate({ ...removedOrder, status: OrderStatus.Canceled });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _mapApiPositionToTVPosition(apiPos: any): Position {\n\t\tconst ticket = apiPos.ticket || apiPos.Ticket || apiPos.PositionId || apiPos.id;\n\t\tconst id = String(ticket);\n\n\t\t// API uses Action field: 0 = Buy, 1 = Sell\n\t\tconst action = apiPos.Action !== undefined ? apiPos.Action : (apiPos.action !== undefined ? apiPos.action : undefined);\n\t\tconst typeStr = (apiPos.type || apiPos.Type || '').toString();\n\n\t\tlet isBuy = false;\n\n\t\t// Priority 1: Check Action field (0 = Buy, 1 = Sell)\n\t\tif (action !== undefined) {\n\t\t\tisBuy = action === 0 || String(action) === '0';\n\t\t}\n\t\t// Priority 2: Check type string\n\t\telse if (typeStr === 'Buy') {\n\t\t\tisBuy = true;\n\t\t} else if (typeStr === 'Sell') {\n\t\t\tisBuy = false;\n\t\t} else {\n\t\t\tisBuy = typeStr.toLowerCase().includes('buy');\n\t\t}\n\n\t\tconst side = isBuy ? Side.Buy : Side.Sell;\n\n\t\tconst openPrice = Number(apiPos.openPrice || apiPos.OpenPrice || apiPos.PriceOpen || apiPos.priceOpen || apiPos.price || apiPos.Price || 0);\n\t\tconst currentPrice = Number(apiPos.currentPrice || apiPos.CurrentPrice || apiPos.PriceCurrent || apiPos.priceCurrent || apiPos.price || apiPos.Price || openPrice);\n\n\t\tconst rawVolume = apiPos.volume || apiPos.Volume || apiPos.units || 0;\n\t\tconst volumeLots = apiPos.volumeLots || apiPos.VolumeLots;\n\n\t\tlet volume: number;\n\n\t\tif (volumeLots !== undefined && volumeLots !== null) {\n\t\t\tvolume = Number(volumeLots);\n\t\t} else {\n\t\t\tconst numVolume = Math.abs(Number(rawVolume));\n\t\t\tvolume = numVolume / 10000;\n\t\t}\n\n\t\tconst profit = Number(apiPos.profit || apiPos.Profit || apiPos.pl || apiPos.PL || 0);\n\n\t\tconst symbol = apiPos.symbol || apiPos.Symbol || '';\n\n\t\treturn {\n\t\t\tid: id,\n\t\t\tsymbol: symbol,\n\t\t\tqty: volume,\n\t\t\tside: side, // Numeric enum for chart rendering (Side.Buy = 1, Side.Sell = -1)\n\t\t\tsideText: isBuy ? 'Buy' : 'Sell', // String for Account Manager display\n\t\t\tavgPrice: openPrice,\n\t\t\ttakeProfit: Number(apiPos.takeProfit || apiPos.TakeProfit || apiPos.PriceTP || apiPos.TP || apiPos.tp || 0) || undefined,\n\t\t\tstopLoss: Number(apiPos.stopLoss || apiPos.StopLoss || apiPos.PriceSL || apiPos.SL || apiPos.sl || 0) || undefined,\n\t\t\tprofit: profit, // For Account Manager display\n\t\t\tpl: profit, // For chart trade line P/L display\n\t\t\ttext: \" \",\n\t\t} as any;\n\t}\n\n\tprivate _mapApiOrderToTVOrder(apiOrder: any): Order | null {\n\t\tconst ticket = apiOrder.ticket || apiOrder.Ticket || apiOrder.orderId || apiOrder.OrderId || apiOrder.id;\n\t\tconst id = String(ticket);\n\t\tif (!id) return null;\n\n\t\tconst symbol = apiOrder.symbol || apiOrder.Symbol;\n\t\tif (!symbol) return null;\n\n\t\t// Orders API returns numeric Type field:\n\t\t// 0 = Buy, 1 = Sell, 2 = Buy Limit, 3 = Sell Limit, 4 = Buy Stop, 5 = Sell Stop\n\t\tconst orderType = apiOrder.Type ?? apiOrder.type ?? apiOrder.OrderType ?? apiOrder.orderType;\n\n\t\tlet isBuy = false;\n\t\tlet tvOrderType = OrderType.Limit;\n\t\tlet typeText = '';\n\n\t\tif (typeof orderType === 'number') {\n\t\t\tswitch (orderType) {\n\t\t\t\tcase 0: // Buy Market\n\t\t\t\t\tisBuy = true;\n\t\t\t\t\ttvOrderType = OrderType.Market;\n\t\t\t\t\ttypeText = 'Buy';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1: // Sell Market\n\t\t\t\t\tisBuy = false;\n\t\t\t\t\ttvOrderType = OrderType.Market;\n\t\t\t\t\ttypeText = 'Sell';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2: // Buy Limit\n\t\t\t\t\tisBuy = true;\n\t\t\t\t\ttvOrderType = OrderType.Limit;\n\t\t\t\t\ttypeText = 'Buy Limit';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3: // Sell Limit\n\t\t\t\t\tisBuy = false;\n\t\t\t\t\ttvOrderType = OrderType.Limit;\n\t\t\t\t\ttypeText = 'Sell Limit';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4: // Buy Stop\n\t\t\t\t\tisBuy = true;\n\t\t\t\t\ttvOrderType = OrderType.Stop;\n\t\t\t\t\ttypeText = 'Buy Stop';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5: // Sell Stop\n\t\t\t\t\tisBuy = false;\n\t\t\t\t\ttvOrderType = OrderType.Stop;\n\t\t\t\t\ttypeText = 'Sell Stop';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// Fallback\n\t\t\t\t\tisBuy = true;\n\t\t\t\t\ttvOrderType = OrderType.Limit;\n\t\t\t\t\ttypeText = 'Unknown';\n\t\t\t}\n\t\t} else {\n\t\t\t// Fallback to string parsing\n\t\t\tconst typeStr = String(orderType || '').toLowerCase();\n\t\t\tisBuy = typeStr.includes('buy');\n\t\t\tif (typeStr.includes('limit')) {\n\t\t\t\ttvOrderType = OrderType.Limit;\n\t\t\t} else if (typeStr.includes('stop')) {\n\t\t\t\ttvOrderType = OrderType.Stop;\n\t\t\t}\n\t\t\ttypeText = typeStr;\n\t\t}\n\n\t\tconst side = isBuy ? Side.Buy : Side.Sell;\n\n\t\t// Map API status to TV status - pending orders are Working\n\t\tconst status = OrderStatus.Working;\n\n\t\t// Orders API uses Volume field (in MT5 format: 1 = 0.01 lots, 100 = 1 lot)\n\t\tconst rawVolume = apiOrder.Volume || apiOrder.volume || apiOrder.units || 0;\n\t\tconst volumeLots = apiOrder.VolumeLots || apiOrder.volumeLots;\n\n\t\tlet volume: number;\n\t\tif (volumeLots !== undefined && volumeLots !== null) {\n\t\t\tvolume = Number(volumeLots);\n\t\t} else {\n\t\t\t// Convert MT5 volume to lots: divide by 100\n\t\t\tconst numVolume = Math.abs(Number(rawVolume));\n\t\t\tvolume = numVolume / 100;\n\t\t}\n\n\t\t// Orders API uses PriceOrder for the order price\n\t\tconst openPrice = Number(\n\t\t\tapiOrder.PriceOrder || apiOrder.priceOrder ||\n\t\t\tapiOrder.OpenPrice || apiOrder.openPrice ||\n\t\t\tapiOrder.Price || apiOrder.price || 0\n\t\t);\n\n\t\tconst mappedOrderType = tvOrderType;\n\t\tconst mappedSide = side;\n\n\t\treturn {\n\t\t\tid: id,\n\t\t\tsymbol: symbol,\n\t\t\tqty: volume,\n\t\t\tside: side,\n\t\t\tsideText: isBuy ? 'Buy' : 'Sell',\n\t\t\ttype: tvOrderType,\n\t\t\tstatus: status,\n\t\t\tlimitPrice: tvOrderType === OrderType.Limit ? openPrice : undefined,\n\t\t\tstopPrice: tvOrderType === OrderType.Stop ? openPrice : undefined,\n\t\t\ttakeProfit: Number(apiOrder.PriceTP || apiOrder.priceTP || apiOrder.TakeProfit || apiOrder.takeProfit || 0) || undefined,\n\t\t\tstopLoss: Number(apiOrder.PriceSL || apiOrder.priceSL || apiOrder.StopLoss || apiOrder.stopLoss || 0) || undefined,\n\t\t\ttext: \" \",\n\t\t} as unknown as Order;\n\t}\n\n\tprivate _createCleanPosition(p: Position): Position {\n\t\t// Clean position for TV display (similar to original)\n\t\treturn {\n\t\t\t...p,\n\t\t\ttakeProfit: p.takeProfit,\n\t\t\tstopLoss: p.stopLoss,\n\t\t};\n\t}\n\n\tprivate _createTakeProfitBracket(position: Position): Order {\n\t\treturn {\n\t\t\tid: `${position.id}_TP`,\n\t\t\tsymbol: position.symbol,\n\t\t\tqty: position.qty,\n\t\t\tside: changeSide(position.side),\n\t\t\ttype: OrderType.Limit,\n\t\t\tstatus: OrderStatus.Working,\n\t\t\tlimitPrice: position.takeProfit,\n\t\t\tparentId: position.id,\n\t\t\tparentType: ParentType.Position,\n\t\t\ttext: \"TP\",\n\t\t} as unknown as Order;\n\t}\n\n\tprivate _createStopLossBracket(position: Position): Order {\n\t\treturn {\n\t\t\tid: `${position.id}_SL`,\n\t\t\tsymbol: position.symbol,\n\t\t\tqty: position.qty,\n\t\t\tside: changeSide(position.side),\n\t\t\ttype: OrderType.Stop,\n\t\t\tstatus: OrderStatus.Working,\n\t\t\tstopPrice: position.stopLoss,\n\t\t\tparentId: position.id,\n\t\t\tparentType: ParentType.Position,\n\t\t\ttext: \"SL\",\n\t\t} as unknown as Order;\n\t}\n\n\tprivate _isBracketOrder(order: Order): boolean {\n\t\tif (!order) return false;\n\t\tif (order.parentId || order.parentType !== undefined) return true;\n\t\tconst id = (order.id || '').toString();\n\t\treturn id.includes('_TP') || id.includes('_SL') || id.includes('TP-') || id.includes('SL-');\n\t}\n\n\t// Brackets for pending orders (use parentType=Order)\n\tprivate _createOrderTakeProfitBracket(order: Order): Order {\n\t\tconst isPreview = order.id === PREVIEW_ORDER_ID;\n\t\treturn {\n\t\t\tid: `${order.id}_TP`,\n\t\t\tsymbol: order.symbol,\n\t\t\tqty: order.qty,\n\t\t\tside: changeSide(order.side),\n\t\t\ttype: OrderType.Limit,\n\t\t\tstatus: OrderStatus.Working,\n\t\t\tlimitPrice: order.takeProfit,\n\t\t\tparentId: order.id,\n\t\t\tparentType: ParentType.Order,\n\t\t\ttext: \"TP\",\n\t\t\tsideText: isPreview ? \" \" : undefined,\n\t\t\ttypeText: isPreview ? \" \" : undefined,\n\t\t\tqtyText: isPreview ? \" \" : undefined,\n\t\t} as unknown as Order;\n\t}\n\n\tprivate _createOrderStopLossBracket(order: Order): Order {\n\t\tconst isPreview = order.id === PREVIEW_ORDER_ID;\n\t\treturn {\n\t\t\tid: `${order.id}_SL`,\n\t\t\tsymbol: order.symbol,\n\t\t\tqty: order.qty,\n\t\t\tside: changeSide(order.side),\n\t\t\ttype: OrderType.Stop,\n\t\t\tstatus: OrderStatus.Working,\n\t\t\tstopPrice: order.stopLoss,\n\t\t\tparentId: order.id,\n\t\t\tparentType: ParentType.Order,\n\t\t\ttext: \"SL\",\n\t\t\tsideText: isPreview ? \" \" : undefined,\n\t\t\ttypeText: isPreview ? \" \" : undefined,\n\t\t\tqtyText: isPreview ? \" \" : undefined,\n\t\t} as unknown as Order;\n\t}\n\n\n\n\tpublic chartContextMenuActions(context: any, options?: DefaultContextMenuActionsParams): Promise<ActionMetaInfo[]> {\n\t\treturn Promise.resolve([]);\n\t}\n\n\tpublic isTradable(symbol: string): Promise<IsTradableResult> {\n\t\treturn Promise.resolve({ tradable: true });\n\t}\n\n\tpublic async placeOrder(preOrder: PreOrder): Promise<PlaceOrderResult> {\n\t\tconsole.log('[ZuperiorBroker] placeOrder called:', preOrder);\n\t\tif (!this._accessToken || !this._accountId) {\n\t\t\treturn Promise.reject('Not authenticated');\n\t\t}\n\n\t\t// Pause polling\n\t\tthis._lastActionTime = Date.now();\n\n\t\t// Normalize symbol: convert trailing M/R to m/r\n\t\tconst symbol = preOrder.symbol.replace(/M$/, 'm').replace(/R$/, 'r');\n\n\t\tconst side = preOrder.side === 1 ? 'buy' : 'sell';\n\t\tconst volume = preOrder.qty; // already in lots? Standard TV sends what we configured (qty)\n\n\t\ttry {\n\t\t\tif (preOrder.type === OrderType.Market) { // Market\n\t\t\t\tawait placeMarketOrderDirect({\n\t\t\t\t\taccountId: this._accountId,\n\t\t\t\t\taccessToken: this._accessToken,\n\t\t\t\t\tsymbol: symbol,\n\t\t\t\t\tside: side,\n\t\t\t\t\tvolume: volume,\n\t\t\t\t\tstopLoss: preOrder.stopLoss,\n\t\t\t\t\ttakeProfit: preOrder.takeProfit\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Pending\n\t\t\t\tconst price = (preOrder as any).limitPrice || (preOrder as any).stopPrice || 0;\n\t\t\t\tconst orderType = preOrder.type === OrderType.Limit ? 'limit' : 'stop'; // simplified\n\n\t\t\t\tawait placePendingOrderDirect({\n\t\t\t\t\taccountId: this._accountId,\n\t\t\t\t\taccessToken: this._accessToken,\n\t\t\t\t\tsymbol: symbol,\n\t\t\t\t\tside: side,\n\t\t\t\t\tvolume: volume,\n\t\t\t\t\tprice: price,\n\t\t\t\t\torderType: orderType,\n\t\t\t\t\tstopLoss: preOrder.stopLoss,\n\t\t\t\t\ttakeProfit: preOrder.takeProfit\n\t\t\t\t});\n\t\t\t}\n\t\t\t// Refresh soon (force redraw quickly once backend confirms)\n\t\t\tsetTimeout(() => this._fetchPositionsAndOrders(true), 600);\n\t\t\treturn {};\n\t\t} catch (e: any) {\n\t\t\tconsole.error('Place order failed', e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\n\t// TradingView calls this when a pending/order line is dragged\n\tpublic async modifyOrder(order: Order, confirmId?: string): Promise<void> {\n\t\tconsole.log('[ZuperiorBroker] modifyOrder called:', order.id, order);\n\n\t\tif (!this._accessToken || !this._accountId) {\n\t\t\treturn Promise.reject('Not authenticated');\n\t\t}\n\n\t\tthis._lastActionTime = Date.now();\n\n\t\tconst originalOrder = this._orderById[order.id];\n\t\tif (!originalOrder) {\n\t\t\tconsole.error('[ZuperiorBroker] modifyOrder failed: Order not found', order.id);\n\t\t\treturn Promise.reject('Order not found');\n\t\t}\n\n\t\t// Handle bracket order modification (dragging TP/SL lines)\n\t\tif (order.parentId !== undefined) {\n\t\t\tconst isTP = order.id.toString().includes('_TP');\n\t\t\tconst isSL = order.id.toString().includes('_SL');\n\n\t\t\t// TradingView can send the dragged price in different fields; normalize\n\t\t\tconst newPriceRaw = order.limitPrice ?? order.stopPrice ?? order.price;\n\t\t\tconst newPrice = typeof newPriceRaw === 'string' ? parseFloat(newPriceRaw) : newPriceRaw;\n\n\t\t\tconst mod: any = {};\n\t\t\tif (isTP && newPrice !== undefined) mod.takeProfit = newPrice;\n\t\t\tif (isSL && newPrice !== undefined) mod.stopLoss = newPrice;\n\n\t\t\tconsole.log('[ZuperiorBroker] modifyOrder: Bracket drag detected');\n\t\t\tconsole.log('[ZuperiorBroker] modifyOrder: Parent ID:', order.parentId);\n\t\t\tconsole.log('[ZuperiorBroker] modifyOrder: Parent Type:', order.parentType);\n\t\t\tconsole.log('[ZuperiorBroker] modifyOrder: Modification:', mod);\n\t\t\tconsole.log('[ZuperiorBroker] modifyOrder: Is Preview?', order.parentId === 'PREVIEW_ORDER_ID');\n\n\t\t\tif (order.parentType === ParentType.Position) {\n\t\t\t\treturn this.editPositionBrackets(order.parentId, mod);\n\t\t\t} else {\n\t\t\t\t// This will call editOrder which emits __ON_ORDER_PREVIEW_CHANGE__ for preview orders\n\t\t\t\tconsole.log('[ZuperiorBroker] modifyOrder: Calling editOrder for bracket modification');\n\t\t\t\treturn this.editOrder(order.parentId, mod);\n\t\t\t}\n\t\t}\n\n\t\t// Handle pending order modification (dragging order line)\n\t\tconst pendingPriceRaw = order.limitPrice ?? order.stopPrice ?? order.price;\n\t\tconst pendingPrice = typeof pendingPriceRaw === 'string' ? parseFloat(pendingPriceRaw) : pendingPriceRaw;\n\t\toriginalOrder.limitPrice = order.limitPrice !== undefined ? order.limitPrice : originalOrder.limitPrice;\n\t\toriginalOrder.stopPrice = order.stopPrice !== undefined ? order.stopPrice : originalOrder.stopPrice;\n\t\t// If neither limitPrice nor stopPrice is present but price is, apply it to the correct field based on order type\n\t\tif (pendingPrice !== undefined) {\n\t\t\tif (originalOrder.type === OrderType.Stop) {\n\t\t\t\toriginalOrder.stopPrice = pendingPrice;\n\t\t\t} else {\n\t\t\t\toriginalOrder.limitPrice = pendingPrice;\n\t\t\t}\n\t\t}\n\t\toriginalOrder.takeProfit = order.takeProfit !== undefined ? order.takeProfit : originalOrder.takeProfit;\n\t\toriginalOrder.stopLoss = order.stopLoss !== undefined ? order.stopLoss : originalOrder.stopLoss;\n\t\toriginalOrder.qty = order.qty !== undefined ? order.qty : originalOrder.qty;\n\n\t\tthis._orderById[order.id] = originalOrder;\n\n\t\tconst newTP = originalOrder.takeProfit;\n\t\tconst newSL = originalOrder.stopLoss;\n\n\t\t// Regenerate brackets\n\t\tdelete this._orderById[`${order.id}_TP`];\n\t\tdelete this._orderById[`${order.id}_SL`];\n\t\tthis._orders = this._orders.filter(o => !(o.id === `${order.id}_TP` || o.id === `${order.id}_SL`));\n\n\t\tif (newTP && newTP > 0) {\n\t\t\tconst tpB = this._createOrderTakeProfitBracket(originalOrder);\n\t\t\tthis._orderById[tpB.id] = tpB;\n\t\t\tthis._orders.push(tpB);\n\t\t}\n\t\tif (newSL && newSL > 0) {\n\t\t\tconst slB = this._createOrderStopLossBracket(originalOrder);\n\t\t\tthis._orderById[slB.id] = slB;\n\t\t\tthis._orders.push(slB);\n\t\t}\n\n\t\tthis._notifyAllPositionsAndOrders();\n\n\t\t// Persist to API\n\t\ttry {\n\t\t\t// SKIP API FOR PREVIEW\n\t\t\tif (order.id === PREVIEW_ORDER_ID) {\n\t\t\t\tconsole.log('[ZuperiorBroker] modifyOrder: Skipping API for preview order');\n\t\t\t\t// Emit event for OrderPanel sync\n\t\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\t\t(window as any).dispatchEvent(new CustomEvent('__ON_ORDER_PREVIEW_CHANGE__', {\n\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\tid: order.id,\n\t\t\t\t\t\t\tprice: originalOrder.type === OrderType.Limit ? originalOrder.limitPrice : originalOrder.stopPrice,\n\t\t\t\t\t\t\ttakeProfit: newTP,\n\t\t\t\t\t\t\tstopLoss: newSL,\n\t\t\t\t\t\t\tqty: originalOrder.qty\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\tawait modifyPendingOrderDirect({\n\t\t\t\taccountId: this._accountId,\n\t\t\t\taccessToken: this._accessToken,\n\t\t\t\torderId: order.id,\n\t\t\t\tprice: originalOrder.type === OrderType.Limit ? originalOrder.limitPrice : originalOrder.stopPrice,\n\t\t\t\tstopLoss: newSL,\n\t\t\t\ttakeProfit: newTP\n\t\t\t});\n\t\t\tsetTimeout(() => this._fetchPositionsAndOrders(true), 400);\n\t\t} catch (e) {\n\t\t\tconsole.error('[ZuperiorBroker] modifyOrder API call failed:', e);\n\t\t\tthis._fetchPositionsAndOrders();\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\n\tpublic async cancelOrder(orderId: string): Promise<void> {\n\t\tif (!this._accessToken || !this._accountId) return Promise.reject(\"Auth failed\");\n\n\t\tconsole.log('[ZuperiorBroker] cancelOrder called for:', orderId);\n\n\t\t// CHECK IF THIS IS A BRACKET CANCELLATION\n\t\tconst isTP = orderId.endsWith('_TP');\n\t\tconst isSL = orderId.endsWith('_SL');\n\n\t\tif (isTP || isSL) {\n\t\t\tconst parentId = orderId.replace('_TP', '').replace('_SL', '');\n\t\t\tconsole.log('[ZuperiorBroker] Bracket cancellation detected. Modifying parent:', parentId);\n\n\t\t\t// Check if parent is a position\n\t\t\tif (this._positionById[parentId]) {\n\t\t\t\tconst modification = isTP ? { takeProfit: 0 } : { stopLoss: 0 };\n\t\t\t\treturn this.editPositionBrackets(parentId, modification);\n\t\t\t}\n\n\t\t\t// Check if parent is an order\n\t\t\tif (this._orderById[parentId]) {\n\t\t\t\tconst modification = isTP ? { takeProfit: 0 } : { stopLoss: 0 };\n\t\t\t\treturn this.editOrder(parentId, modification);\n\t\t\t}\n\n\t\t\tconsole.warn('[ZuperiorBroker] Parent entity not found for bracket cancel:', parentId);\n\t\t\treturn Promise.resolve(); // Fallback\n\t\t}\n\n\t\t// Optimistic update for regular orders\n\t\tconst order = this._orderById[orderId];\n\t\tif (order) {\n\t\t\t// Remove from maps\n\t\t\tdelete this._orderById[orderId];\n\t\t\t// Remove from array\n\t\t\tthis._orders = this._orders.filter(o => o.id !== orderId);\n\t\t\t// Notify chart\n\t\t\tthis._notifyAllPositionsAndOrders();\n\t\t}\n\n\t\tif (orderId === PREVIEW_ORDER_ID) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\ttry {\n\t\t\tawait cancelPendingOrderDirect({\n\t\t\t\taccountId: this._accountId,\n\t\t\t\taccessToken: this._accessToken,\n\t\t\t\torderId: orderId\n\t\t\t});\n\t\t\tsetTimeout(() => this._fetchPositionsAndOrders(true), 400);\n\t\t} catch (e) {\n\t\t\tconsole.error('Cancel order failed', e);\n\t\t\t// Rollback if failed (fetch will restore it)\n\t\t\tthis._fetchPositionsAndOrders();\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tprivate _notifyBracketCancelled(bracketId: string, bracketObj?: Order) {\n\t\tconst bracket = bracketObj || this._orderById[bracketId];\n\t\tif (this._host && typeof this._host.orderUpdate === 'function') {\n\t\t\tthis._host.orderUpdate({ ...(bracket || { id: bracketId }), status: OrderStatus.Canceled });\n\t\t}\n\t}\n\n\tpublic async editPositionBrackets(positionId: string, modification: any): Promise<void> {\n\t\tif (!this._accessToken || !this._accountId) return Promise.reject(\"Auth failed\");\n\n\t\t// Pause polling to protect optimistic update\n\t\tthis._lastActionTime = Date.now();\n\n\t\t// 1. Capture current state for rollback\n\t\tconst originalPosition = this._positionById[positionId];\n\t\tif (!originalPosition) {\n\t\t\tconsole.error('[ZuperiorBroker] Position not found for edit:', positionId);\n\t\t\treturn;\n\t\t}\n\t\t// Clone for safety\n\t\tconst originalState = { ...originalPosition };\n\n\t\t// Normalize TP/SL values (TradingView may send null/undefined to clear)\n\t\t// Preserve existing brackets when the other one is modified.\n\t\tconst newTPRaw = modification.takeProfit ?? modification.tp;\n\t\tconst newSLRaw = modification.stopLoss ?? modification.sl;\n\n\t\tconst newTP =\n\t\t\tnewTPRaw === null\n\t\t\t\t? 0\n\t\t\t\t: newTPRaw === undefined || isNaN(Number(newTPRaw))\n\t\t\t\t\t? originalPosition.takeProfit ?? 0\n\t\t\t\t\t: Number(newTPRaw);\n\n\t\tconst newSL =\n\t\t\tnewSLRaw === null\n\t\t\t\t? 0\n\t\t\t\t: newSLRaw === undefined || isNaN(Number(newSLRaw))\n\t\t\t\t\t? originalPosition.stopLoss ?? 0\n\t\t\t\t\t: Number(newSLRaw);\n\n\t\t// 2. Optimistic Update\n\t\tconsole.log('[ZuperiorBroker] Optimistic Update for Position:', positionId, modification);\n\n\t\tif (newSL !== undefined) originalPosition.stopLoss = newSL;\n\t\tif (newTP !== undefined) originalPosition.takeProfit = newTP;\n\n\t\t// Update _positions array reference\n\t\tconst index = this._positions.findIndex(p => p.id === positionId);\n\t\tif (index !== -1) {\n\t\t\tthis._positions[index] = { ...originalPosition };\n\t\t\t// Ensure map points to new object reference\n\t\t\tthis._positionById[positionId] = this._positions[index];\n\t\t}\n\n\t\t// CRITICAL: Update existing brackets in-place if possible, or create new ones\n\t\tconst tpId = `${positionId}_TP`;\n\t\tconst slId = `${positionId}_SL`;\n\t\tconst existingTP = this._orderById[tpId];\n\t\tconst existingSL = this._orderById[slId];\n\n\t\t// Regenerate brackets with new values\n\t\tconst newPos = this._positionById[positionId];\n\n\t\t// --- Handle TP Bracket ---\n\t\tif (newPos.takeProfit && newPos.takeProfit > 0) {\n\t\t\tif (existingTP) {\n\t\t\t\t// Update existing TP bracket (Immutable update)\n\t\t\t\tconst updatedTP = {\n\t\t\t\t\t...existingTP,\n\t\t\t\t\tlimitPrice: newPos.takeProfit,\n\t\t\t\t\tqty: newPos.qty, // Update qty in case position size changed\n\t\t\t\t\tstatus: OrderStatus.Working\n\t\t\t\t};\n\t\t\t\tthis._orderById[tpId] = updatedTP;\n\t\t\t\t// Update array reference\n\t\t\t\tconst tpIndex = this._orders.findIndex(o => o.id === tpId);\n\t\t\t\tif (tpIndex !== -1) {\n\t\t\t\t\tthis._orders[tpIndex] = updatedTP;\n\t\t\t\t} else {\n\t\t\t\t\t// Should be in array if in map, but safe fallback\n\t\t\t\t\tthis._orders.push(updatedTP);\n\t\t\t\t}\n\t\t\t\tconsole.log('[ZuperiorBroker] Updated existing Position TP Bracket:', updatedTP.id, updatedTP.limitPrice);\n\t\t\t} else {\n\t\t\t\t// Create new TP bracket\n\t\t\t\ttry {\n\t\t\t\t\tconst tpBracket = this._createTakeProfitBracket(newPos);\n\t\t\t\t\tthis._orderById[tpBracket.id] = tpBracket;\n\t\t\t\t\tthis._orders.push(tpBracket);\n\t\t\t\t\tconsole.log('[ZuperiorBroker] Created new Position TP Bracket:', tpBracket);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('[ZuperiorBroker] Error creating TP bracket', e);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// TP removed\n\t\t\tif (existingTP) {\n\t\t\t\tthis._notifyBracketCancelled(tpId, existingTP);\n\t\t\t\tdelete this._orderById[tpId];\n\t\t\t\tthis._orders = this._orders.filter(o => o.id !== tpId);\n\t\t\t}\n\t\t}\n\n\t\t// --- Handle SL Bracket ---\n\t\tif (newPos.stopLoss && newPos.stopLoss > 0) {\n\t\t\tif (existingSL) {\n\t\t\t\t// Update existing SL bracket (Immutable update)\n\t\t\t\tconst updatedSL = {\n\t\t\t\t\t...existingSL,\n\t\t\t\t\tstopPrice: newPos.stopLoss,\n\t\t\t\t\tqty: newPos.qty,\n\t\t\t\t\tstatus: OrderStatus.Working\n\t\t\t\t};\n\t\t\t\tthis._orderById[slId] = updatedSL;\n\t\t\t\t// Update array reference\n\t\t\t\tconst slIndex = this._orders.findIndex(o => o.id === slId);\n\t\t\t\tif (slIndex !== -1) {\n\t\t\t\t\tthis._orders[slIndex] = updatedSL;\n\t\t\t\t} else {\n\t\t\t\t\tthis._orders.push(updatedSL);\n\t\t\t\t}\n\t\t\t\tconsole.log('[ZuperiorBroker] Updated existing Position SL Bracket:', updatedSL.id, updatedSL.stopPrice);\n\t\t\t} else {\n\t\t\t\t// Create new SL bracket\n\t\t\t\ttry {\n\t\t\t\t\tconst slBracket = this._createStopLossBracket(newPos);\n\t\t\t\t\tthis._orderById[slBracket.id] = slBracket;\n\t\t\t\t\tthis._orders.push(slBracket);\n\t\t\t\t\tconsole.log('[ZuperiorBroker] Created new Position SL Bracket:', slBracket);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('[ZuperiorBroker] Error creating SL bracket', e);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// SL removed\n\t\t\tif (existingSL) {\n\t\t\t\tthis._notifyBracketCancelled(slId, existingSL);\n\t\t\t\tdelete this._orderById[slId];\n\t\t\t\tthis._orders = this._orders.filter(o => o.id !== slId);\n\t\t\t}\n\t\t}\n\n\t\t// 3. Notify Chart IMMEDIATELY\n\t\tthis._notifyAllPositionsAndOrders();\n\n\t\ttry {\n\t\t\t// 4. API Call in Background\n\t\t\tawait modifyPositionDirect({\n\t\t\t\taccountId: this._accountId,\n\t\t\t\taccessToken: this._accessToken,\n\t\t\t\tpositionId: positionId,\n\t\t\t\tstopLoss: newSL,\n\t\t\t\ttakeProfit: newTP\n\t\t\t});\n\n\t\t\t// Fetch validation after a short delay to confirm backend state\n\t\t\tsetTimeout(() => this._fetchPositionsAndOrders(true), 400);\n\n\t\t} catch (e) {\n\t\t\tconsole.error('Modify position failed', e);\n\n\t\t\t// 5. Rollback on Failure\n\t\t\tconsole.log('[ZuperiorBroker] Rolling back optimistic update');\n\t\t\tconst posToRevert = this._positionById[positionId];\n\t\t\tif (posToRevert) {\n\t\t\t\tposToRevert.takeProfit = originalState.takeProfit;\n\t\t\t\tposToRevert.stopLoss = originalState.stopLoss;\n\n\t\t\t\t// Regenerate old brackets? Or just let fetch fix it?\n\t\t\t\t// Re-notifying will at least correct the position lines\n\t\t\t\tthis._notifyAllPositionsAndOrders();\n\t\t\t}\n\t\t\t// Force re-fetch to ensure sync\n\t\t\tthis._fetchPositionsAndOrders(true);\n\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tpublic async closePosition(positionId: string): Promise<void> {\n\t\tif (!this._accessToken || !this._accountId) return Promise.reject(\"Auth failed\");\n\n\t\tconsole.log('[ZuperiorBroker] closePosition called for:', positionId);\n\n\t\t// Optimistic update: Remove from local state immediately\n\t\tconst position = this._positionById[positionId];\n\t\tif (position) {\n\t\t\t// Notify chart/AM of closure BEFORE removing from state\n\t\t\tif (this._host && typeof this._host.positionUpdate === 'function') {\n\t\t\t\tconst closedPosition = { ...position, qty: 0, avgPrice: 0 };\n\t\t\t\tconsole.log('[ZuperiorBroker] Optimistic Close - Notifying host:', closedPosition);\n\t\t\t\tthis._host.positionUpdate(closedPosition);\n\n\t\t\t\tif ((position as any).pl !== undefined && typeof this._host.plUpdate === 'function') {\n\t\t\t\t\t// Update P/L to 0 or remove it? Usually just updating position is enough.\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove from maps\n\t\t\tdelete this._positionById[positionId];\n\t\t\tdelete this._orderById[`${positionId}_TP`];\n\t\t\tdelete this._orderById[`${positionId}_SL`];\n\n\t\t\t// Remove from array\n\t\t\tthis._positions = this._positions.filter(p => p.id !== positionId);\n\n\t\t\t// Notify chart (updates the rest)\n\t\t\tthis._notifyAllPositionsAndOrders();\n\t\t}\n\n\t\ttry {\n\t\t\tawait closePositionDirect({\n\t\t\t\taccountId: this._accountId,\n\t\t\t\taccessToken: this._accessToken,\n\t\t\t\tpositionId: positionId,\n\t\t\t\tvolume: position ? position.qty : 0 // Pass known volume (lots) to help API\n\t\t\t});\n\t\t\t// Fetch validation after delay\n\t\t\tsetTimeout(() => this._fetchPositionsAndOrders(true), 500);\n\t\t} catch (e) {\n\t\t\tconsole.error('Close position failed', e);\n\t\t\t// Re-fetch to restore if failed\n\t\t\tthis._fetchPositionsAndOrders(true);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tpublic accountManagerInfo(): AccountManagerInfo {\n\t\tconst orderColumns: any[] = [\n\t\t\t{\n\t\t\t\tid: 'symbol',\n\t\t\t\tlabel: 'Symbol',\n\t\t\t\tdataFields: ['symbol'],\n\t\t\t\tformatter: StandardFormatterName.Text,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'side',\n\t\t\t\tlabel: 'Side',\n\t\t\t\tdataFields: ['sideText'],\n\t\t\t\tformatter: StandardFormatterName.Text,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'qty',\n\t\t\t\tlabel: 'Qty',\n\t\t\t\tdataFields: ['qty'],\n\t\t\t\tformatter: StandardFormatterName.Fixed,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'status',\n\t\t\t\tlabel: 'Status',\n\t\t\t\tdataFields: ['status'],\n\t\t\t\tformatter: StandardFormatterName.Text,\n\t\t\t}\n\t\t];\n\n\t\tconst positionColumns: any[] = [\n\t\t\t{\n\t\t\t\tid: 'symbol',\n\t\t\t\tlabel: 'Symbol',\n\t\t\t\tdataFields: ['symbol'],\n\t\t\t\tformatter: StandardFormatterName.Text,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'side',\n\t\t\t\tlabel: 'Side',\n\t\t\t\tdataFields: ['sideText'],\n\t\t\t\tformatter: StandardFormatterName.Text,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'qty',\n\t\t\t\tlabel: 'Qty',\n\t\t\t\tdataFields: ['qty'],\n\t\t\t\tformatter: StandardFormatterName.Fixed,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'avgPrice',\n\t\t\t\tlabel: 'Price',\n\t\t\t\tdataFields: ['avgPrice'],\n\t\t\t\tformatter: StandardFormatterName.FormatPrice,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'profit',\n\t\t\t\tlabel: 'Profit',\n\t\t\t\tdataFields: ['profit'],\n\t\t\t\tformatter: StandardFormatterName.Fixed,\n\t\t\t}\n\t\t];\n\n\t\treturn {\n\t\t\taccountTitle: 'Zuperior Financial',\n\t\t\tsummary: [\n\t\t\t\t{\n\t\t\t\t\ttext: 'Balance',\n\t\t\t\t\twValue: {\n\t\t\t\t\t\tsubscribe: (onChange: any) => { },\n\t\t\t\t\t\tunsubscribe: (onChange: any) => { },\n\t\t\t\t\t\tvalue: () => this._accountBalance,\n\t\t\t\t\t\twhen: (callback: any) => { } // Dummy implementation to satisfy interface\n\t\t\t\t\t},\n\t\t\t\t\tformatter: StandardFormatterName.Fixed // Using fixed format\n\t\t\t\t}\n\t\t\t],\n\t\t\torderColumns: orderColumns,\n\t\t\tpositionColumns: positionColumns,\n\t\t\tpages: [\n\t\t\t\t{\n\t\t\t\t\tid: 'positions',\n\t\t\t\t\ttitle: 'Positions',\n\t\t\t\t\ttables: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'positions',\n\t\t\t\t\t\t\tcolumns: positionColumns,\n\t\t\t\t\t\t\tgetData: () => Promise.resolve(this._positions),\n\t\t\t\t\t\t\tchangeDelegate: this._positionsSubscription\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'orders',\n\t\t\t\t\ttitle: 'Orders',\n\t\t\t\t\ttables: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'orders',\n\t\t\t\t\t\t\tcolumns: orderColumns,\n\t\t\t\t\t\t\tgetData: () => Promise.resolve(this._orders),\n\t\t\t\t\t\t\tchangeDelegate: this._ordersSubscription\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n\n\tpublic accountsMetainfo(): Promise<AccountMetainfo[]> {\n\t\treturn Promise.resolve([\n\t\t\t{\n\t\t\t\tid: (this._accountId || '1') as AccountId,\n\t\t\t\tname: 'Zuperior Main',\n\t\t\t\tcurrency: 'USD'\n\t\t\t}\n\t\t]);\n\t}\n\tpublic async orders(): Promise<Order[]> {\n\t\treturn Promise.resolve(this._orders);\n\t}\n\n\tpublic async positions(): Promise<Position[]> {\n\t\treturn Promise.resolve(this._positions);\n\t}\n\n\tpublic async executions(symbol: string): Promise<Execution[]> {\n\t\treturn [];\n\t}\n\n\tpublic currentAccount(): AccountId {\n\t\treturn (this._accountId || '') as AccountId;\n\t}\n\n\tpublic async symbolInfo(symbol: string): Promise<InstrumentInfo> {\n\t\tconst symbolUpper = symbol.toUpperCase();\n\t\tlet pricescale = 100000; // Default Forex\n\t\tlet minTick = 0.00001;\n\n\t\tif (symbolUpper.includes('JPY') || symbolUpper.includes('XAU')) {\n\t\t\tpricescale = 100;\n\t\t\tminTick = 0.01;\n\t\t} else if (symbolUpper.includes('BTC') || symbolUpper.includes('ETH') || symbolUpper.includes('SOL')) {\n\t\t\tpricescale = 100;\n\t\t\tminTick = 0.01;\n\t\t}\n\n\t\treturn {\n\t\t\tqty: { min: 0.01, max: 100, step: 0.01 },\n\t\t\tpipSize: minTick,\n\t\t\tpipValue: 1,\n\t\t\tminTick: minTick,\n\t\t\tdescription: symbol,\n\t\t\ttype: 'crypto',\n\t\t\tdomVolumePrecision: 2,\n\t\t\tid: symbol,\n\t\t\tname: symbol,\n\t\t\tminMove2: 0,\n\t\t\tpricescale: pricescale,\n\t\t\tminmov: 1,\n\t\t\tfractional: false,\n\t\t\tsession: '24x7',\n\t\t\ttimezone: 'Etc/UTC',\n\t\t\thas_intraday: true,\n\t\t\thas_no_volume: false,\n\t\t\tdata_status: 'streaming'\n\t\t} as unknown as InstrumentInfo;\n\t}\n\n\tpublic formatter(symbol: string, alignToMinMove?: boolean): Promise<any> {\n\t\treturn Promise.resolve({\n\t\t\tformat: (value: number) => {\n\t\t\t\tif (value === undefined || value === null) return '';\n\t\t\t\treturn value.toFixed(2);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic spreadFormatter(symbol: string): Promise<any> {\n\t\treturn Promise.resolve({\n\t\t\tformat: (value: number) => {\n\t\t\t\tif (value === undefined || value === null) return '';\n\t\t\t\treturn value.toFixed(1) + ' pips';\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic quantityFormatter(symbol: string): Promise<any> {\n\t\treturn Promise.resolve({\n\t\t\tformat: (value: number) => {\n\t\t\t\tif (value === undefined || value === null) return '';\n\t\t\t\treturn value.toString();\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic pipValueFormatter(symbol: string): Promise<any> {\n\t\treturn Promise.resolve({\n\t\t\tformat: (value: number) => {\n\t\t\t\tif (value === undefined || value === null) return '';\n\t\t\t\treturn value.toFixed(2);\n\t\t\t}\n\t\t});\n\t}\n\tpublic async editOrder(orderId: string, modification: any): Promise<void> {\n\t\tconst originalOrder = this._orderById[orderId];\n\t\tif (!originalOrder) {\n\t\t\tconsole.error(`[ZuperiorBroker] Order not found: ${orderId}`);\n\t\t\treturn Promise.reject('Order not found');\n\t\t}\n\n\t\tconsole.log('[ZuperiorBroker] editOrder called:', orderId, modification);\n\n\t\t// SKIP API FOR PREVIEW\n\t\tconsole.log(\"[ZuperiorBroker] editOrder: Checking if preview order:\", orderId, \"===\", PREVIEW_ORDER_ID, \"?\", orderId === PREVIEW_ORDER_ID);\n\t\tif (orderId === PREVIEW_ORDER_ID) {\n\t\t\tconsole.log('[ZuperiorBroker] editOrder: Skipping API for preview order');\n\n\t\t\t// Update local state\n\t\t\tconst entryPrice = (originalOrder.type === OrderType.Limit ? originalOrder.limitPrice : originalOrder.stopPrice) || 0;\n\t\t\tconst side = originalOrder.side; // Buy=1, Sell=-1\n\n\t\t\tif (modification.limitPrice !== undefined) originalOrder.limitPrice = modification.limitPrice;\n\t\t\tif (modification.stopPrice !== undefined) originalOrder.stopPrice = modification.stopPrice;\n\t\t\tif (modification.qty !== undefined) originalOrder.qty = modification.qty;\n\n\t\t\t// Direct update for preview order brackets (Allow dragging anywhere for feedback)\n\t\t\tif (modification.takeProfit !== undefined) {\n\t\t\t\toriginalOrder.takeProfit = modification.takeProfit;\n\t\t\t}\n\t\t\tif (modification.stopLoss !== undefined) {\n\t\t\t\toriginalOrder.stopLoss = modification.stopLoss;\n\t\t\t}\n\n\t\t\tthis._orderById[orderId] = originalOrder;\n\n\t\t\t// Regents brackets (Preserve objects to allow continuous dragging)\n\t\t\tconst tpId = `${orderId}_TP`;\n\t\t\tconst slId = `${orderId}_SL`;\n\n\t\t\tif (originalOrder.takeProfit && originalOrder.takeProfit > 0) {\n\t\t\t\tconst existingTP = this._orderById[tpId];\n\t\t\t\tif (existingTP) {\n\t\t\t\t\t(existingTP as any).limitPrice = originalOrder.takeProfit;\n\t\t\t\t\tthis._host.orderUpdate(existingTP);\n\t\t\t\t} else {\n\t\t\t\t\tconst tpB = this._createOrderTakeProfitBracket(originalOrder);\n\t\t\t\t\tthis._orderById[tpB.id] = tpB;\n\t\t\t\t\tthis._orders.push(tpB);\n\t\t\t\t\tthis._host.orderUpdate(tpB);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._orderById[tpId]) {\n\t\t\t\t\tconst cancelledTP = { ...this._orderById[tpId], status: OrderStatus.Canceled };\n\t\t\t\t\tthis._host.orderUpdate(cancelledTP);\n\t\t\t\t\tdelete this._orderById[tpId];\n\t\t\t\t\tthis._orders = this._orders.filter(o => o.id !== tpId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (originalOrder.stopLoss && originalOrder.stopLoss > 0) {\n\t\t\t\tconst existingSL = this._orderById[slId];\n\t\t\t\tif (existingSL) {\n\t\t\t\t\t(existingSL as any).stopPrice = originalOrder.stopLoss;\n\t\t\t\t\tthis._host.orderUpdate(existingSL);\n\t\t\t\t} else {\n\t\t\t\t\tconst slB = this._createOrderStopLossBracket(originalOrder);\n\t\t\t\t\tthis._orderById[slB.id] = slB;\n\t\t\t\t\tthis._orders.push(slB);\n\t\t\t\t\tthis._host.orderUpdate(slB);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._orderById[slId]) {\n\t\t\t\t\tconst cancelledSL = { ...this._orderById[slId], status: OrderStatus.Canceled };\n\t\t\t\t\tthis._host.orderUpdate(cancelledSL);\n\t\t\t\t\tdelete this._orderById[slId];\n\t\t\t\t\tthis._orders = this._orders.filter(o => o.id !== slId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._notifyAllPositionsAndOrders();\n\n\t\t\t// Emit event for OrderPanel sync\n\t\t\tconsole.log(\"[ZuperiorBroker] editOrder: About to emit __ON_ORDER_PREVIEW_CHANGE__ event\", { tp: originalOrder.takeProfit, sl: originalOrder.stopLoss });\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\t(window as any).dispatchEvent(new CustomEvent('__ON_ORDER_PREVIEW_CHANGE__', {\n\t\t\t\t\tdetail: {\n\t\t\t\t\t\tid: orderId,\n\t\t\t\t\t\tprice: originalOrder.type === OrderType.Limit ? originalOrder.limitPrice : originalOrder.stopPrice,\n\t\t\t\t\t\ttakeProfit: originalOrder.takeProfit,\n\t\t\t\t\t\tstopLoss: originalOrder.stopLoss,\n\t\t\t\t\t\tqty: originalOrder.qty,\n\t\t\t\t\t\tsource: 'chart'\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis._lastActionTime = Date.now();\n\n\t\tconst originalState = { ...originalOrder };\n\t\tconst tpId = `${orderId}_TP`;\n\t\tconst slId = `${orderId}_SL`;\n\n\t\t// capture prior bracket state\n\t\tconst existingTP = this._orderById[tpId];\n\t\tconst existingSL = this._orderById[slId];\n\n\t\t// Update local order object with new values\n\t\tif (modification.limitPrice !== undefined) originalOrder.limitPrice = modification.limitPrice;\n\t\tif (modification.stopPrice !== undefined) originalOrder.stopPrice = modification.stopPrice;\n\t\tif (modification.takeProfit !== undefined) originalOrder.takeProfit = modification.takeProfit;\n\t\tif (modification.stopLoss !== undefined) originalOrder.stopLoss = modification.stopLoss;\n\n\t\t// --- Handle TP Bracket ---\n\t\tif (originalOrder.takeProfit && originalOrder.takeProfit > 0) {\n\t\t\tif (existingTP) {\n\t\t\t\t// Update existing (Immutable update for React/TV change detection)\n\t\t\t\tconst updatedTP = {\n\t\t\t\t\t...existingTP,\n\t\t\t\t\tlimitPrice: originalOrder.takeProfit,\n\t\t\t\t\tqty: originalOrder.qty,\n\t\t\t\t\tstatus: OrderStatus.Working // Force status\n\t\t\t\t};\n\t\t\t\tthis._orderById[tpId] = updatedTP;\n\t\t\t\t// Update array reference\n\t\t\t\tconst tpIndex = this._orders.findIndex(o => o.id === tpId);\n\t\t\t\tif (tpIndex !== -1) {\n\t\t\t\t\tthis._orders[tpIndex] = updatedTP;\n\t\t\t\t}\n\t\t\t\tconsole.log('[ZuperiorBroker] Updated existing TP bracket (immutable):', updatedTP.id, updatedTP.limitPrice);\n\t\t\t} else {\n\t\t\t\t// Create new\n\t\t\t\tconst tpBracket = this._createOrderTakeProfitBracket(originalOrder);\n\t\t\t\tthis._orderById[tpBracket.id] = tpBracket;\n\t\t\t\tthis._orders.push(tpBracket);\n\t\t\t}\n\t\t} else {\n\t\t\t// TP removed or was never there\n\t\t\tif (existingTP) {\n\t\t\t\t// Notify cancellation BEFORE deleting\n\t\t\t\tthis._notifyBracketCancelled(tpId, existingTP);\n\t\t\t\t// Remove from maps and array\n\t\t\t\tdelete this._orderById[tpId];\n\t\t\t\tthis._orders = this._orders.filter(o => o.id !== tpId);\n\t\t\t}\n\t\t}\n\n\t\t// --- Handle SL Bracket ---\n\t\tif (originalOrder.stopLoss && originalOrder.stopLoss > 0) {\n\t\t\tif (existingSL) {\n\t\t\t\t// Update existing (Immutable update)\n\t\t\t\tconst updatedSL = {\n\t\t\t\t\t...existingSL,\n\t\t\t\t\tstopPrice: originalOrder.stopLoss,\n\t\t\t\t\tqty: originalOrder.qty,\n\t\t\t\t\tstatus: OrderStatus.Working // Force status\n\t\t\t\t};\n\t\t\t\tthis._orderById[slId] = updatedSL;\n\t\t\t\t// Update array reference\n\t\t\t\tconst slIndex = this._orders.findIndex(o => o.id === slId);\n\t\t\t\tif (slIndex !== -1) {\n\t\t\t\t\tthis._orders[slIndex] = updatedSL;\n\t\t\t\t}\n\t\t\t\tconsole.log('[ZuperiorBroker] Updated existing SL bracket (immutable):', updatedSL.id, updatedSL.stopPrice);\n\t\t\t} else {\n\t\t\t\t// Create new\n\t\t\t\tconst slBracket = this._createOrderStopLossBracket(originalOrder);\n\t\t\t\tthis._orderById[slBracket.id] = slBracket;\n\t\t\t\tthis._orders.push(slBracket);\n\t\t\t}\n\t\t} else {\n\t\t\t// SL removed\n\t\t\tif (existingSL) {\n\t\t\t\t// Notify cancellation BEFORE deleting\n\t\t\t\tthis._notifyBracketCancelled(slId, existingSL);\n\t\t\t\t// Remove from maps and array\n\t\t\t\tdelete this._orderById[slId];\n\t\t\t\tthis._orders = this._orders.filter(o => o.id !== slId);\n\t\t\t}\n\t\t}\n\n\t\t// Update array reference for the parent order (trigger React/TV updates)\n\t\tconst index = this._orders.findIndex(o => o.id === orderId);\n\t\tif (index !== -1) {\n\t\t\t// We mutated originalOrder in place, which is inside _orders[index] if it was by reference.\n\t\t\t// But to be safe and trigger change detection, we shallow copy it back.\n\t\t\tthis._orders[index] = { ...originalOrder };\n\t\t\tthis._orderById[orderId] = this._orders[index];\n\t\t}\n\n\t\t// Notify all updates\n\t\tthis._notifyAllPositionsAndOrders();\n\n\t\ttry {\n\t\t\t// Use values from originalOrder which now contains the merged state\n\t\t\tawait modifyPendingOrderDirect({\n\t\t\t\taccountId: this._accountId!,\n\t\t\t\taccessToken: this._accessToken!,\n\t\t\t\torderId: orderId,\n\t\t\t\tprice: originalOrder.limitPrice || originalOrder.stopPrice,\n\t\t\t\tstopLoss: originalOrder.stopLoss,\n\t\t\t\ttakeProfit: originalOrder.takeProfit\n\t\t\t});\n\t\t\t// Re-fetch to validate\n\t\t\tsetTimeout(() => this._fetchPositionsAndOrders(true), 400);\n\t\t} catch (e) {\n\t\t\tconsole.error('[ZuperiorBroker] Modify order failed', e);\n\t\t\t// Rollback (Simplified: just re-fetch to restore state)\n\t\t\tthis._fetchPositionsAndOrders(true);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tpublic async modifyEntity(id: string, modification: any): Promise<void> {\n\t\t// Check if it's a position\n\t\tif (this._positionById[id]) {\n\t\t\treturn this.editPositionBrackets(id, modification);\n\t\t}\n\t\t// Check if it's an order\n\t\tif (this._orderById[id]) {\n\t\t\t// Adapter for order modification fields\n\t\t\tconst orderMod: any = {};\n\t\t\tif (modification.tp !== undefined) orderMod.takeProfit = modification.tp;\n\t\t\tif (modification.sl !== undefined) orderMod.stopLoss = modification.sl;\n\n\t\t\t// Map price if provided (from \"Price\" field in modal for Pending Orders)\n\t\t\tif (modification.price !== undefined) {\n\t\t\t\tconst order = this._orderById[id];\n\t\t\t\tif (order.type === OrderType.Limit) {\n\t\t\t\t\torderMod.limitPrice = modification.price;\n\t\t\t\t} else if (order.type === OrderType.Stop) {\n\t\t\t\t\torderMod.stopPrice = modification.price;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Pass other fields if present custom ones\n\t\t\tif (modification.limitPrice) orderMod.limitPrice = modification.limitPrice;\n\t\t\tif (modification.stopPrice) orderMod.stopPrice = modification.stopPrice;\n\t\t\tif (modification.takeProfit) orderMod.takeProfit = modification.takeProfit;\n\t\t\tif (modification.stopLoss) orderMod.stopLoss = modification.stopLoss;\n\n\t\t\t// Update parent order properties to match bracket changes\n\t\t\t// Update parent order properties to match bracket changes\n\t\t\tconst entity = this._orderById[id];\n\t\t\t// If this entity is a bracket (has parentId), update the parent.\n\t\t\t// If it's the main order, it's already being updated via editOrder logic, but detailed props need syncing.\n\t\t\tif (entity && entity.parentId) {\n\t\t\t\tconst actualParent = this._orderById[entity.parentId];\n\t\t\t\tif (actualParent) {\n\t\t\t\t\tif (modification.limitPrice !== undefined) actualParent.takeProfit = modification.limitPrice;\n\t\t\t\t\tif (modification.stopPrice !== undefined) actualParent.stopLoss = modification.stopPrice;\n\t\t\t\t\tif (modification.takeProfit !== undefined) actualParent.takeProfit = modification.takeProfit;\n\t\t\t\t\tif (modification.stopLoss !== undefined) actualParent.stopLoss = modification.stopLoss;\n\n\t\t\t\t\t// Notify parent update immediately\n\t\t\t\t\tif (this._host && typeof this._host.orderUpdate === 'function') {\n\n\t\t\t\t\t\tthis._host.orderUpdate(actualParent);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (entity) {\n\t\t\t\t// It is the parent order itself.\n\t\t\t\t// We still want to ensure prop consistency if we are setting new params\n\t\t\t\tif (modification.limitPrice !== undefined) entity.takeProfit = modification.limitPrice;\n\t\t\t\tif (modification.stopPrice !== undefined) entity.stopLoss = modification.stopPrice;\n\t\t\t\tif (modification.takeProfit !== undefined) entity.takeProfit = modification.takeProfit;\n\t\t\t\tif (modification.stopLoss !== undefined) entity.stopLoss = modification.stopLoss;\n\t\t\t\t// Notification happens in editOrder flow usually, but safe to do here if needed. \n\t\t\t\t// editOrder will usually handle the main notification.\n\t\t\t}\n\n\t\t\treturn this.editOrder(id, orderMod);\n\t\t}\n\n\t\tconsole.error('[ZuperiorBroker] Entity not found for modification:', id);\n\t\treturn Promise.reject('Entity not found');\n\t}\n\n\t// TradingView calls this when a pending/order line is dragged\n\tpublic async moveOrder(orderId: string, price: number): Promise<void> {\n\t\tconsole.log('[ZuperiorBroker] moveOrder invoked:', orderId, price);\n\t\tconst order = this._orderById[orderId];\n\t\tif (!order) {\n\t\t\tconsole.error('[ZuperiorBroker] moveOrder failed: Order not found', orderId);\n\t\t\treturn Promise.reject('Order not found');\n\t\t}\n\n\t\t// TradingView sometimes sends undefined/strings for preview bracket drags, normalize it here\n\t\tconst effectivePrice = (price !== undefined && !Number.isNaN(price))\n\t\t\t? Number(price)\n\t\t\t: (order.limitPrice ?? order.stopPrice);\n\t\tif (effectivePrice === undefined || Number.isNaN(effectivePrice)) {\n\t\t\tconsole.warn('[ZuperiorBroker] moveOrder aborted: invalid price payload', { orderId, price, order });\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst isTP = orderId.includes('_TP') || orderId.includes('TP-');\n\t\tconst isSL = orderId.includes('_SL') || orderId.includes('SL-');\n\n\t\tconsole.log('[ZuperiorBroker] Moving order details:', { isTP, isSL, parentId: order.parentId, parentType: order.parentType });\n\n\t\t// If this is a bracket of a pending order\n\t\tif (order.parentId && order.parentType === ParentType.Order && (isTP || isSL)) {\n\t\t\tconst mod: any = {};\n\t\t\tif (isTP) mod.takeProfit = effectivePrice;\n\t\t\tif (isSL) mod.stopLoss = effectivePrice;\n\t\t\tconsole.log('[ZuperiorBroker] Moving pending order bracket -> editOrder', order.parentId, mod);\n\n\t\t\t// For preview orders, emit sync event immediately for real-time update\n\t\t\tif (order.parentId === PREVIEW_ORDER_ID) {\n\t\t\t\tconst parentOrder = this._orderById[order.parentId];\n\t\t\t\tif (parentOrder) {\n\t\t\t\t\t// Create the event payload manually to ensure it uses the dragged price\n\t\t\t\t\tconst payload = {\n\t\t\t\t\t\tid: order.parentId,\n\t\t\t\t\t\tprice: parentOrder.type === OrderType.Limit ? parentOrder.limitPrice : parentOrder.stopPrice,\n\t\t\t\t\t\ttakeProfit: isTP ? effectivePrice : parentOrder.takeProfit,\n\t\t\t\t\t\tstopLoss: isSL ? effectivePrice : parentOrder.stopLoss,\n\t\t\t\t\t\tqty: parentOrder.qty,\n\t\t\t\t\t\tsource: 'chart'\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log(\"[ZuperiorBroker] moveOrder: Emitting real-time sync event for preview bracket drag\", payload);\n\t\t\t\t\tif (typeof window !== \"undefined\") {\n\t\t\t\t\t\t(window as any).dispatchEvent(new CustomEvent(\"__ON_ORDER_PREVIEW_CHANGE__\", {\n\t\t\t\t\t\t\tdetail: payload\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update local state directly to prevent snap-back during drag\n\t\t\t\t\tif (isTP) parentOrder.takeProfit = price;\n\t\t\t\t\tif (isSL) parentOrder.stopLoss = price;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.editOrder(order.parentId, mod);\n\t\t}\n\n\t\t// If this is a bracket of a position\n\t\tif (order.parentId && order.parentType === ParentType.Position && (isTP || isSL)) {\n\t\t\tconst mod: any = {};\n\t\t\tif (isTP) mod.takeProfit = price;\n\t\t\tif (isSL) mod.stopLoss = price;\n\t\t\tconsole.log('[ZuperiorBroker] Moving position bracket -> editPositionBrackets', order.parentId, mod);\n\t\t\treturn this.editPositionBrackets(order.parentId, mod);\n\t\t}\n\n\t\t// Base pending order line drag\n\t\tconst mod: any = {};\n\t\tif (order.type === OrderType.Stop) {\n\t\t\tmod.stopPrice = effectivePrice;\n\t\t} else {\n\t\t\tmod.limitPrice = effectivePrice;\n\t\t}\n\t\tconsole.log('[ZuperiorBroker] Moving pending order main line -> editOrder', orderId, mod);\n\t\treturn this.editOrder(orderId, mod);\n\t}\n\n\t// TradingView calls this when TP/SL of a position is dragged\n\tpublic async movePositionBrackets(positionId: string, brackets: any): Promise<void> {\n\t\tconsole.log('[ZuperiorBroker] movePositionBrackets invoked:', positionId, brackets);\n\t\treturn this.editPositionBrackets(positionId, brackets);\n\t}\n\n\t// Fallback alias used by some builds\n\tpublic async movePosition(positionId: string, brackets: any): Promise<void> {\n\t\tconsole.log('[ZuperiorBroker] movePosition invoked:', positionId, brackets); // Often same as movePositionBrackets regarding arg signature? No, movePosition might imply modifying execution price which isn't possible, but TV uses it for brackets sometimes.\n\t\t// Actually movePosition signature in API is (id, price) usually?\n\t\t// But here we mapped it to brackets in previous logic. Let's check signature.\n\t\t// If brackets is a price number, it would die.\n\t\t// Usually movePosition is for moving the *entry* price (not possible for market positions)\n\t\t// But in this library version, it might map to brackets.\n\t\treturn this.editPositionBrackets(positionId, brackets);\n\t}\n\n\tpublic setOrderPreview(previewData: {\n\t\tsymbol?: string,\n\t\tside?: 'buy' | 'sell' | null,\n\t\tqty?: number,\n\t\tprice?: number,\n\t\ttype?: 'market' | 'limit' | 'stop',\n\t\ttakeProfit?: number,\n\t\tstopLoss?: number\n\t}): void {\n\t\tif (!this._host || typeof this._host.orderUpdate !== 'function') return;\n\n\t\tif (!previewData.side) {\n\t\t\t// Cancel preview\n\t\t\tconst existing = this._orderById[PREVIEW_ORDER_ID];\n\t\t\tif (existing) {\n\t\t\t\tconst canceledPreview = {\n\t\t\t\t\t...existing,\n\t\t\t\t\tstatus: OrderStatus.Canceled,\n\t\t\t\t};\n\t\t\t\tconsole.log('[ZuperiorBroker] Canceling order preview');\n\t\t\t\tthis._host.orderUpdate(canceledPreview);\n\t\t\t\tdelete this._orderById[PREVIEW_ORDER_ID];\n\n\t\t\t\t// Also remove brackets\n\t\t\t\tdelete this._orderById[`${PREVIEW_ORDER_ID}_TP`];\n\t\t\t\tdelete this._orderById[`${PREVIEW_ORDER_ID}_SL`];\n\n\t\t\t\t// Also remove from _orders array to keep internal state consistent\n\t\t\t\tthis._orders = this._orders.filter(o => !o.id.toString().startsWith(PREVIEW_ORDER_ID));\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Create or update preview order\n\t\tconst side = previewData.side === 'buy' ? Side.Buy : Side.Sell;\n\t\tconst qty = previewData.qty || 1;\n\t\tconst price = previewData.price || 0;\n\t\tconst symbol = previewData.symbol || 'XAUUSD';\n\n\t\tconst previewOrder: Order = {\n\t\t\tid: PREVIEW_ORDER_ID,\n\t\t\tsymbol: symbol,\n\t\t\tside: side,\n\t\t\tqty: qty,\n\t\t\tstatus: OrderStatus.Working,\n\t\t\ttype: previewData.type === 'stop' ? OrderType.Stop : (previewData.type === 'limit' ? OrderType.Limit : OrderType.Limit),\n\t\t\tlimitPrice: price,\n\t\t\tstopPrice: previewData.type === 'stop' ? price : undefined,\n\t\t\ttakeProfit: previewData.takeProfit,\n\t\t\tstopLoss: previewData.stopLoss,\n\t\t\ttext: \" \",\n\t\t\tsideText: \" \", // Hide side text\n\t\t\ttypeText: \" \", // Hide type text\n\t\t\tqtyText: \" \",  // Hide qty text\n\t\t};\n\n\t\tconsole.log('[ZuperiorBroker] Setting order preview:', previewOrder);\n\t\tthis._orderById[PREVIEW_ORDER_ID] = previewOrder;\n\n\t\t// Update _orders array as well so orders() returns it\n\t\tconst existingIndex = this._orders.findIndex(o => o.id === PREVIEW_ORDER_ID);\n\t\tif (existingIndex >= 0) {\n\t\t\tthis._orders[existingIndex] = previewOrder;\n\t\t} else {\n\t\t\tthis._orders.push(previewOrder);\n\t\t}\n\n\t\t// Handle preview brackets (Preserve objects to allow iteration)\n\t\tconst tpId = `${PREVIEW_ORDER_ID}_TP`;\n\t\tconst slId = `${PREVIEW_ORDER_ID}_SL`;\n\n\t\tif (previewOrder.takeProfit && previewOrder.takeProfit > 0) {\n\t\t\tconst existingTP = this._orderById[tpId];\n\t\t\tif (existingTP) {\n\t\t\t\t(existingTP as any).limitPrice = previewOrder.takeProfit;\n\t\t\t\tthis._host.orderUpdate(existingTP);\n\t\t\t} else {\n\t\t\t\tconst tpB = this._createOrderTakeProfitBracket(previewOrder);\n\t\t\t\tthis._orderById[tpB.id] = tpB;\n\t\t\t\tthis._orders.push(tpB);\n\t\t\t\tthis._host.orderUpdate(tpB);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._orderById[tpId]) {\n\t\t\t\tconst cancelledTP = { ...this._orderById[tpId], status: OrderStatus.Canceled };\n\t\t\t\tthis._host.orderUpdate(cancelledTP);\n\t\t\t\tdelete this._orderById[tpId];\n\t\t\t\tthis._orders = this._orders.filter(o => o.id !== tpId);\n\t\t\t}\n\t\t}\n\n\t\tif (previewOrder.stopLoss && previewOrder.stopLoss > 0) {\n\t\t\tconst existingSL = this._orderById[slId];\n\t\t\tif (existingSL) {\n\t\t\t\t(existingSL as any).stopPrice = previewOrder.stopLoss;\n\t\t\t\tthis._host.orderUpdate(existingSL);\n\t\t\t} else {\n\t\t\t\tconst slB = this._createOrderStopLossBracket(previewOrder);\n\t\t\t\tthis._orderById[slB.id] = slB;\n\t\t\t\tthis._orders.push(slB);\n\t\t\t\tthis._host.orderUpdate(slB);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._orderById[slId]) {\n\t\t\t\tconst cancelledSL = { ...this._orderById[slId], status: OrderStatus.Canceled };\n\t\t\t\tthis._host.orderUpdate(cancelledSL);\n\t\t\t\tdelete this._orderById[slId];\n\t\t\t\tthis._orders = this._orders.filter(o => o.id !== slId);\n\t\t\t}\n\t\t}\n\n\t\tthis._host.orderUpdate(previewOrder);\n\t\tthis._notifyAllPositionsAndOrders();\n\n\t\t// NOTE: Do NOT emit __ON_ORDER_PREVIEW_CHANGE__ here!\n\t\t// This method is called when OrderPanel updates the preview via __SET_ORDER_PREVIEW__\n\t\t// Emitting here would overwrite chart drag events with source: 'panel'\n\t\t// The chart emits its own event with source: 'chart' from editOrder when brackets are dragged\n\t}\n}\n"],"names":[],"mappings":";;;;AAAA;AA+BA;AA2BA;;;AAxBA,MAAM;IACG,aAAsB,EAAE,CAAC;IAC1B,UAAU,QAAe,EAAQ;QACvC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;IACtB;IACO,YAAY,QAAe,EAAQ;QACzC,MAAM,QAAQ,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;QACtC,IAAI,QAAQ,CAAC,GAAG;YACf,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,OAAO;QAC/B;IACD;IACO,eAAe,GAAkB,EAAQ;QAC/C,IAAI,CAAC,UAAU,GAAG,EAAE;IACrB;IACO,KAAK,GAAG,IAAW,EAAQ;QACjC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAA;YACvB,IAAI,OAAO,aAAa,YAAY;gBACnC,aAAa;gBACb,YAAY;YACb;QACD;IACD;AACD;;AAiCA,gDAAgD;AAChD,SAAS,WAAW,IAAU;IAC7B,OAAO,SAAS,mJAAI,CAAC,GAAG,GAAG,mJAAI,CAAC,IAAI,GAAG,mJAAI,CAAC,GAAG;AAChD;AAEA,yBAAyB;AACzB,SAAS,aAAa,IAAS,EAAE,MAAc,EAAE,GAAG,IAAW;IAC9D,IAAI;QACH,IAAI,QAAQ,OAAO,IAAI,CAAC,OAAO,KAAK,YAAY;YAC/C,OAAO,IAAI,CAAC,OAAO,IAAI;QACxB;IACD,EAAE,OAAO,GAAG;IACX,qCAAqC;IACtC;IACA,OAAO;AACR;AAEA,MAAM,mBAAmB;AAElB,MAAM,uBAAuB,oLAAqB;IAChD,WAA0B;IAC1B,aAAyB,EAAE,CAAC;IAC5B,UAAmB,EAAE,CAAC;IACtB,gBAAqC,CAAC,EAAE;IACxC,aAA+B,CAAC,EAAE;IAClC,gBAAqB,KAAK;IAC1B,aAAa,MAAM;IACnB,iBAAiB,MAAM;IACvB,mBAA2E,KAAK;IAChF,eAA8B,KAAK;IACnC,kBAA0B,EAAE;IAC5B,kBAA0B,EAAE;IAE5B,yBAAyB,IAAI,qBAAyC;IACtE,sBAAsB,IAAI,qBAAyC;IAE3E,YACC,IAAkC,EAClC,cAAkC,EAClC,SAAwB,EACxB,eAA+D,CAC9D;QACD,KAAK,CAAC,MAAM;QACZ,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,gBAAgB,GAAG,mBAAmB;QAC3C,wFAAwF;QACxF,IAAI,CAAC,aAAa;IACnB;IAEA,wDAAwD;IACjD,wBAAwB,eAA8D,EAAE;QAC9F,IAAI,CAAC,gBAAgB,GAAG;IACzB;IAEO,eAAe,KAAc,EAAE;QACrC,IAAI,CAAC,cAAc,GAAG;QACtB,IAAI,OAAO;YACV,+EAA+E;YAC/E,IAAI,CAAC,4BAA4B;YACjC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;gBACrB,IAAI,CAAC,aAAa;YACnB;QACD;IACD;IAEO,aAAa,SAAwB,EAAE;QAC7C,IAAI,IAAI,CAAC,UAAU,KAAK,WAAW;QAEnC,IAAI,CAAC,UAAU,GAAG;QAElB,sBAAsB;QACtB,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG;QACzB,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG;QACtB,IAAI,CAAC,aAAa,GAAG,CAAC;QACtB,IAAI,CAAC,UAAU,GAAG,CAAC;QAEnB,mCAAmC;QACnC,IAAI,IAAI,CAAC,UAAU,EAAE;YACpB,IAAI,CAAC,wBAAwB;QAC9B,OAAO;YACN,IAAI,CAAC,aAAa;QACnB;IACD;IAEQ,+BAA+B;QACtC,uCAAuC;QACvC,IAAI,CAAC,MAAM,OAAO,CAAC,IAAI,CAAC,OAAO,KAAK,CAAC,MAAM,OAAO,CAAC,IAAI,CAAC,UAAU,GAAG;YACpE;QACD;QAEA,oEAAoE;QACpE,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAA;YACvB,IAAI;gBACH,IAAI,IAAI,CAAC,KAAK,EAAE;oBACf,MAAM,gBAAgB,IAAI,CAAC,oBAAoB,CAAC;oBAChD,yEAAyE;oBACzE,IAAI,CAAC,aAAa,CAAC,cAAc,EAAE,CAAC,GAAG;oBAEvC,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,cAAc,KAAK,YAAY;wBACpD,QAAQ,GAAG,CAAC,+CAA+C;wBAC3D,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC;oBAC3B;oBAEA,IAAI,AAAC,cAAsB,EAAE,KAAK,aAAa,OAAO,AAAC,cAAsB,EAAE,KAAK,YAAY,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,KAAK,YAAY;wBAC1I,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,cAAc,MAAM,EAAE,AAAC,cAAsB,EAAE;oBACpE;gBACD;YACD,EAAE,OAAO,OAAO;gBACf,QAAQ,KAAK,CAAC,8CAA8C,OAAO;YACpE;QACD;QAEA,+EAA+E;QAC/E,oFAAoF;QACpF,MAAM,mBAAmB,OAAO,MAAM,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC;QAC3D,MAAM,gBAAgB,iBAAiB,MAAM,CAAC,CAAA,IAAK,IAAI,CAAC,eAAe,CAAC;QAExE,QAAQ,GAAG,CAAC,CAAC,8CAA8C,EAAE,iBAAiB,MAAM,CAAC,YAAY,EAAE,cAAc,MAAM,EAAE;QACzH,IAAI,cAAc,MAAM,KAAK,KAAK,iBAAiB,MAAM,GAAG,GAAG;YAC9D,QAAQ,GAAG,CAAC,+EAA+E,gBAAgB,CAAC,EAAE;YAC9G,QAAQ,GAAG,CAAC,6DAA6D,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,EAAE;QAClH;QAEA,6EAA6E;QAC7E,MAAM,gBAAgB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,KAAK,CAAC,IAAI,CAAC,eAAe,CAAC;QAE1E,2FAA2F;QAC3F,cAAc,OAAO,CAAC,CAAA;YACrB,QAAQ,GAAG,CAAC,CAAC,oCAAoC,EAAE,QAAQ,EAAE,CAAC,WAAW,CAAC;YAC1E,IAAI;gBACH,IAAI,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,KAAK,YAAY;oBAC/D,IAAI,QAAQ,UAAU,KAAK,WAAW;wBACrC,QAAQ,UAAU,GAAG,yJAAU,CAAC,QAAQ;oBACzC;oBAEA,yEAAyE;oBACzE,yEAAyE;oBACzE,IAAI,QAAQ,QAAQ,EAAE;wBACrB,MAAM,iBAAiB,IAAI,CAAC,aAAa,CAAC,QAAQ,QAAQ,CAAC;wBAC3D,MAAM,cAAc,IAAI,CAAC,UAAU,CAAC,QAAQ,QAAQ,CAAC;wBAErD,IAAI,gBAAgB;4BACnB,gCAAgC;4BAChC,QAAQ,UAAU,GAAG,yJAAU,CAAC,QAAQ;4BAExC,IAAI,eAAe,QAAQ,EAAE;gCAC5B,MAAM,eAAe,AAAC,QAAgB,UAAU,IAAI,AAAC,QAAgB,SAAS;gCAC9E,IAAI,cAAc;oCACjB,sDAAsD;oCACtD,MAAM,aAAa,eAAe,GAAG,GAAG;oCACxC,MAAM,YAAY,eAAe,eAAe,QAAQ;oCACxD,MAAM,cAAc,YAAY,aAAa,CAAC,eAAe,IAAI,KAAK,mJAAI,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC;oCACxF,gEAAgE;oCAC/D,QAAgB,EAAE,GAAG,cAAc;gCACrC,OAAO,IAAI,AAAC,eAAuB,EAAE,KAAK,aAAa,AAAC,eAAuB,EAAE,KAAK,MAAM;oCAC1F,QAAgB,EAAE,GAAG,AAAC,eAAuB,EAAE,GAAG;gCACpD;4BACD,OAAO,IAAI,AAAC,eAAuB,EAAE,KAAK,aAAa,AAAC,eAAuB,EAAE,KAAK,MAAM;gCAC1F,QAAgB,EAAE,GAAG,AAAC,eAAuB,EAAE,GAAG;4BACpD;wBACD,OAAO,IAAI,aAAa;4BACvB,qEAAqE;4BACrE,QAAQ,UAAU,GAAG,yJAAU,CAAC,KAAK;wBACtC;oBACD;oBAEA,QAAQ,GAAG,CAAC,oDAAoD;oBAChE,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACxB;YACD,EAAE,OAAO,OAAO;YACf,kDAAkD;YACnD;QACD;QAEA,iDAAiD;QACjD,cAAc,OAAO,CAAC,CAAA;YACrB,IAAI;gBACH,IAAI,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,KAAK,YAAY;oBAC/D,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACxB;YACD,EAAE,OAAO,OAAO;YACf,0CAA0C;YAC3C;QACD;IACD;IAEA,MAAc,cAAc;QAC3B,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACvB,IAAI;gBACH,IAAI,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,UAAU,EAAE;oBAC7C,MAAM,QAAQ,MAAM,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU;oBACzD,IAAI,OAAO;wBACV,IAAI,CAAC,YAAY,GAAG;wBACpB,kFAAkF;wBAClF,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY;oBAC3B;gBACD;YAEA,oFAAoF;YACpF,uDAAuD;YACvD;;;;;;;;;;;IAWA,GACD,EAAE,OAAO,GAAG;gBACX,QAAQ,KAAK,CAAC,gCAAgC;YAC/C;QACD;QACA,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY;IAC3B;IAEO,mBAA2B;QACjC,OAAO,GAAG,YAAY;IACvB;IAEA,MAAc,gBAAgB;QAC7B,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;QACzC,IAAI,CAAC,UAAU,GAAG;QAElB,MAAM,IAAI,CAAC,WAAW;QAEtB,gBAAgB;QAChB,MAAM,IAAI,CAAC,wBAAwB;QAGnC,mFAAmF;QACnF,IAAI,CAAC,aAAa,GAAG,YAAY;YAChC,MAAM,IAAI,CAAC,WAAW;YACtB,MAAM,IAAI,CAAC,wBAAwB;QACpC,GAAG;IACJ;IAEA,MAAc,yBAAyB,QAAiB,KAAK,EAAE;QAC9D,8EAA8E;QAC9E,mEAAmE;QACnE,IAAI,CAAC,SAAS,KAAK,GAAG,KAAK,IAAI,CAAC,eAAe,GAAG,MAAM;YACvD,2EAA2E;YAC3E;QACD;QAEA,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YACrB;QACD;QAEA,MAAM,gBAAgB,MAAM,OAAO,CAAC,IAAI,CAAC,UAAU,IAAI;eAAI,IAAI,CAAC,UAAU;SAAC,GAAG,EAAE;QAChF,MAAM,kBAAuC;YAAE,GAAG,IAAI,CAAC,aAAa;QAAC;QACrE,MAAM,eAAiC;YAAE,GAAG,IAAI,CAAC,UAAU;QAAC;QAE5D,IAAI,iBAAwB,EAAE;QAC9B,IAAI,eAAsB,EAAE;QAE5B,8FAA8F;QAC9F,MAAM,WAAY,sCAAgC,0BAA0C;QAC5F;;aAGO,IAAI,IAAI,CAAC,YAAY,EAAE;YAC7B,IAAI;gBACH,wEAAwE;gBACxE,MAAM,CAAC,WAAW,OAAO,GAAG,MAAM,QAAQ,GAAG,CAAC;oBAC7C,IAAA,2IAAkB,EAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,YAAY;oBACrD,IAAA,+IAAsB,EAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,YAAY;iBACzD;gBAED,iBAAiB;gBACjB,eAAe;YAEhB,EAAE,OAAO,OAAY;gBACpB,qCAAqC;gBACrC,IAAI,OAAO,WAAW,KAAK;oBAC1B,QAAQ,IAAI,CAAC;oBACb,IAAI,CAAC,YAAY,GAAG,MAAM,+BAA+B;oBACzD;gBACD;gBACA,QAAQ,KAAK,CAAC,qDAAqD;gBACnE;YACD;QACD;QAEA,0CAA0C;QAC1C,MAAM,cAAc,CAAC,MAAM,OAAO,CAAC,kBAAkB,iBAAiB,EAAE,EACtE,GAAG,CAAC,CAAC;YACL,IAAI;gBACH,OAAO,IAAI,CAAC,2BAA2B,CAAC;YACzC,EAAE,OAAO,OAAO;gBACf,QAAQ,KAAK,CAAC,4CAA4C,OAAO;gBACjE,OAAO;YACR;QACD,GACC,MAAM,CAAC,CAAC,IAAsC,MAAM,QAAQ,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,EAAE,MAAM,IAAI,EAAE,GAAG,GAAG,KAAK,EAAE,QAAQ,GAAG;QAEhH,0EAA0E;QAC1E,MAAM,WAAW,CAAC,MAAM,OAAO,CAAC,gBAAgB,eAAe,EAAE,EAC/D,GAAG,CAAC,CAAC;YACL,IAAI;gBACH,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;oBACxC,OAAO;gBACR;gBACA,MAAM,cAAc,IAAI,CAAC,qBAAqB,CAAC;gBAC/C,OAAO;YACR,EAAE,OAAO,OAAO;gBACf,QAAQ,KAAK,CAAC,yCAAyC,OAAO;gBAC9D,OAAO;YACR;QACD,GACC,MAAM,CAAC,CAAC;YACR,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,MAAM,EAAE;gBAC7B,OAAO;YACR;YACA,qFAAqF;YACrF,IAAI,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,QAAQ,CAAC,UAAU,EAAE,EAAE,CAAC,QAAQ,CAAC,MAAM,GAAG;gBAC3D,OAAO;YACR;YACA,IAAI,EAAE,MAAM,KAAK,0JAAW,CAAC,QAAQ,EAAE;gBACtC,OAAO;YACR;YACA,OAAO;QACR;QAED,sEAAsE;QACtE,MAAM,gBAAyB,EAAE;QACjC,IAAI,MAAM,OAAO,CAAC,cAAc;YAC/B,YAAY,OAAO,CAAC,CAAA;gBACnB,+CAA+C;gBAC/C,IAAI,EAAE,UAAU,IAAI,EAAE,UAAU,GAAG,KAAK,CAAC,MAAM,EAAE,UAAU,KAAK,SAAS,EAAE,UAAU,GAAG;oBACvF,IAAI;wBACH,MAAM,YAAY,IAAI,CAAC,wBAAwB,CAAC;wBAChD,cAAc,IAAI,CAAC;oBACpB,EAAE,OAAO,OAAO;wBACf,QAAQ,KAAK,CAAC,+CAA+C;oBAC9D;gBACD;gBAEA,6CAA6C;gBAC7C,IAAI,EAAE,QAAQ,IAAI,EAAE,QAAQ,GAAG,KAAK,CAAC,MAAM,EAAE,QAAQ,KAAK,SAAS,EAAE,QAAQ,GAAG;oBAC/E,IAAI;wBACH,MAAM,YAAY,IAAI,CAAC,sBAAsB,CAAC;wBAC9C,cAAc,IAAI,CAAC;oBACpB,EAAE,OAAO,OAAO;wBACf,QAAQ,KAAK,CAAC,+CAA+C;oBAC9D;gBACD;YACD;QACD;QAEA,sDAAsD;QACtD,MAAM,qBAA8B,EAAE;QACtC,IAAI,MAAM,OAAO,CAAC,WAAW;YAC5B,SAAS,OAAO,CAAC,CAAA;gBAChB,IAAI,EAAE,UAAU,IAAI,EAAE,UAAU,GAAG,GAAG;oBACrC,IAAI;wBACH,mBAAmB,IAAI,CAAC,IAAI,CAAC,6BAA6B,CAAC;oBAC5D,EAAE,OAAO,GAAG;wBACX,QAAQ,KAAK,CAAC,qDAAqD;oBACpE;gBACD;gBACA,IAAI,EAAE,QAAQ,IAAI,EAAE,QAAQ,GAAG,GAAG;oBACjC,IAAI;wBACH,mBAAmB,IAAI,CAAC,IAAI,CAAC,2BAA2B,CAAC;oBAC1D,EAAE,OAAO,GAAG;wBACX,QAAQ,KAAK,CAAC,qDAAqD;oBACpE;gBACD;YACD;QACD;QAEA,6CAA6C;QAC7C,MAAM,YAAY;eACb,MAAM,OAAO,CAAC,YAAY,WAAW,EAAE;eACxC;eACA;SACH;QAED,sEAAsE;QACtE,OAAO,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,OAAO,CAAC,CAAA;YACpC,IAAI,GAAG,QAAQ,GAAG,UAAU,CAAC,mBAAmB;gBAC/C,MAAM,SAAS,IAAI,CAAC,UAAU,CAAC,GAAG;gBAClC,IAAI,CAAC,UAAU,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,OAAO,EAAE,GAAG;oBAC7C,UAAU,IAAI,CAAC;gBAChB;YACD;QACD;QAEA,4BAA4B;QAC5B,MAAM,iBAA6B,EAAE;QACrC,MAAM,cAAmC,CAAC;QAC1C,IAAI,MAAM,OAAO,CAAC,cAAc;YAC/B,YAAY,OAAO,CAAC,CAAA;gBACnB,IAAI;oBACH,MAAM,gBAAgB,IAAI,CAAC,oBAAoB,CAAC;oBAChD,eAAe,IAAI,CAAC;oBACpB,WAAW,CAAC,cAAc,EAAE,CAAC,GAAG;gBACjC,EAAE,OAAO,OAAO;oBACf,QAAQ,KAAK,CAAC,mDAAmD,OAAO;gBACzE;YACD;QACD;QAEA,iCAAiC;QACjC,IAAI,CAAC,UAAU,GAAG,MAAM,OAAO,CAAC,eAAe;eAAI;SAAY,GAAG,EAAE;QACpE,4EAA4E;QAC5E,IAAI,CAAC,OAAO,GAAG,MAAM,OAAO,CAAC,aAAa;eAAI;SAAU,GAAG,EAAE;QAC7D,IAAI,CAAC,aAAa,GAAG;QAErB,4DAA4D;QAC5D,MAAM,WAA6B,CAAC;QACpC,IAAI,MAAM,OAAO,CAAC,YAAY;YAC7B,UAAU,OAAO,CAAC,CAAA;gBACjB,IAAI,KAAK,EAAE,EAAE,EAAE;oBACd,QAAQ,CAAC,EAAE,EAAE,CAAC,GAAG;gBAClB;YACD;QACD;QACA,IAAI,CAAC,UAAU,GAAG;QAElB,gDAAgD;QAChD,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC;QAClC,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;QAE/B,wCAAwC;QACxC,IAAI,IAAI,CAAC,cAAc,EAAE;YACxB,2EAA2E;YAC3E,MAAM,sBAAsB,IAAI,IAAI,cAAc,GAAG,CAAC,CAAA,IAAK,EAAE,EAAE;YAC/D,MAAM,iBAAiB,IAAI,IAAI,eAAe,GAAG,CAAC,CAAA,IAAK,EAAE,EAAE;YAE3D,oBAAoB,OAAO,CAAC,CAAA;gBAC3B,IAAI,CAAC,eAAe,GAAG,CAAC,SAAS;oBAChC,QAAQ,GAAG,CAAC,0DAA0D;oBACtE,MAAM,iBAAiB,eAAe,CAAC,OAAO;oBAC9C,IAAI,kBAAkB,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,cAAc,KAAK,YAAY;wBACpF,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC;4BAAE,GAAG,cAAc;4BAAE,KAAK;4BAAG,UAAU;wBAAE;oBACpE;gBACD;YACD;YAEA,0CAA0C;YAC1C,IAAI,eAAe,MAAM,GAAG,GAAG;gBAC9B,eAAe,OAAO,CAAC,CAAA;oBACtB,IAAI;wBACH,mEAAmE;wBACnE,IAAI,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,cAAc,KAAK,YAAY;4BAClE,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC;wBAC3B;wBACA,IAAI,AAAC,cAAsB,EAAE,KAAK,aAAa,OAAO,AAAC,cAAsB,EAAE,KAAK,YAAY,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,KAAK,YAAY;4BACxJ,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,cAAc,MAAM,EAAE,AAAC,cAAsB,EAAE;wBACpE;oBACD,EAAE,OAAO,OAAO;wBACf,QAAQ,KAAK,CAAC,6CAA6C,OAAO;oBACnE;gBACD;YACD;YAEA,gEAAgE;YAChE,MAAM,mBAAmB;mBAAI;mBAAkB;aAAmB;YAClE,IAAI,MAAM,OAAO,CAAC,qBAAqB,iBAAiB,MAAM,GAAG,GAAG;gBACnE,iBAAiB,OAAO,CAAC,CAAA;oBACxB,IAAI;wBACH,IAAI,WAAW,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,KAAK,YAAY;4BAC1E,gCAAgC;4BAChC,MAAM,cAAc,YAAY,CAAC,QAAQ,EAAE,CAAC;4BAC5C,IAAI,eAAe,CAAC;4BAEpB,IAAI,aAAa;gCAChB,MAAM,WAAW,AAAC,QAAgB,UAAU,IAAI,AAAC,QAAgB,SAAS;gCAC1E,MAAM,WAAW,AAAC,YAAoB,UAAU,IAAI,AAAC,YAAoB,SAAS;gCAClF,IAAI,aAAa,YAAY,QAAQ,GAAG,KAAK,YAAY,GAAG,IAAI,QAAQ,MAAM,KAAK,YAAY,MAAM,EAAE;oCACtG,eAAe;gCAChB;4BACD;4BAEA,IAAI,cAAc;gCACjB,IAAI,QAAQ,UAAU,KAAK,WAAW;oCACrC,QAAQ,UAAU,GAAG,yJAAU,CAAC,QAAQ;gCACzC;gCAEA,qDAAqD;gCACrD,IAAI,QAAQ,QAAQ,EAAE;oCACrB,MAAM,iBAAiB,IAAI,CAAC,aAAa,CAAC,QAAQ,QAAQ,CAAC;oCAC3D,MAAM,cAAc,IAAI,CAAC,UAAU,CAAC,QAAQ,QAAQ,CAAC;oCAErD,2EAA2E;oCAC3E,IAAI,kBAAkB,eAAe,QAAQ,EAAE;wCAC9C,MAAM,eAAe,AAAC,QAAgB,UAAU,IAAI,AAAC,QAAgB,SAAS;wCAC9E,IAAI,gBAAgB,eAAe,QAAQ,EAAE;4CAC5C,MAAM,aAAa,eAAe,GAAG,GAAG;4CACxC,MAAM,YAAY,eAAe,eAAe,QAAQ;4CACxD,MAAM,cAAc,YAAY,aAAa,CAAC,eAAe,IAAI,KAAK,mJAAI,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC;4CACvF,QAAgB,EAAE,GAAG,cAAc;wCACrC,OAAO,IAAI,AAAC,eAAuB,EAAE,KAAK,aAAa,AAAC,eAAuB,EAAE,KAAK,MAAM;4CAC1F,QAAgB,EAAE,GAAG,AAAC,eAAuB,EAAE,GAAG;wCACpD;oCACD,OAAO,IAAI,aAAa;wCACvB,qEAAqE;wCACrE,QAAQ,UAAU,GAAG,yJAAU,CAAC,KAAK;oCACtC;gCACD;gCAEA,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;4BACxB;wBACD;oBACD,EAAE,OAAO,OAAO;wBACf,QAAQ,KAAK,CAAC,kDAAkD,OAAO;oBACxE;gBACD;YACD;YAEA,gDAAgD;YAChD,IAAI,MAAM,OAAO,CAAC,WAAW;gBAC5B,SAAS,OAAO,CAAC,CAAA;oBAChB,IAAI;wBACH,IAAI,KAAK,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,KAAK,YAAY;4BACpE,MAAM,YAAY,YAAY,CAAC,EAAE,EAAE,CAAC;4BACpC,IAAI,eAAe,CAAC;4BAEpB,IAAI,WAAW;gCACd,IAAI,EAAE,UAAU,KAAK,UAAU,UAAU,IAAI,EAAE,SAAS,KAAK,UAAU,SAAS,IAAI,EAAE,GAAG,KAAK,UAAU,GAAG,IAAI,EAAE,MAAM,KAAK,UAAU,MAAM,EAAE;oCAC7I,eAAe;gCAChB;4BACD;4BAEA,IAAI,cAAc;gCACjB,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;4BACxB;wBACD;oBACD,EAAE,OAAO,OAAO;wBACf,QAAQ,KAAK,CAAC,0CAA0C,OAAO;oBAChE;gBACD;YACD;YAEA,qDAAqD;YACrD,MAAM,cAAc,IAAI,IAAI,OAAO,IAAI,CAAC;YACxC,OAAO,IAAI,CAAC,cAAc,OAAO,CAAC,CAAA;gBACjC,IAAI,CAAC,YAAY,GAAG,CAAC,SAAS;oBAC7B,MAAM,eAAe,YAAY,CAAC,OAAO;oBACzC,IAAI,gBAAgB,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,KAAK,YAAY;wBAC/E,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;4BAAE,GAAG,YAAY;4BAAE,QAAQ,0JAAW,CAAC,QAAQ;wBAAC;oBACxE;gBACD;YACD;QACD;IACD;IAEQ,4BAA4B,MAAW,EAAY;QAC1D,MAAM,SAAS,OAAO,MAAM,IAAI,OAAO,MAAM,IAAI,OAAO,UAAU,IAAI,OAAO,EAAE;QAC/E,MAAM,KAAK,OAAO;QAElB,2CAA2C;QAC3C,MAAM,SAAS,OAAO,MAAM,KAAK,YAAY,OAAO,MAAM,GAAI,OAAO,MAAM,KAAK,YAAY,OAAO,MAAM,GAAG;QAC5G,MAAM,UAAU,CAAC,OAAO,IAAI,IAAI,OAAO,IAAI,IAAI,EAAE,EAAE,QAAQ;QAE3D,IAAI,QAAQ;QAEZ,qDAAqD;QACrD,IAAI,WAAW,WAAW;YACzB,QAAQ,WAAW,KAAK,OAAO,YAAY;QAC5C,OAEK,IAAI,YAAY,OAAO;YAC3B,QAAQ;QACT,OAAO,IAAI,YAAY,QAAQ;YAC9B,QAAQ;QACT,OAAO;YACN,QAAQ,QAAQ,WAAW,GAAG,QAAQ,CAAC;QACxC;QAEA,MAAM,OAAO,QAAQ,mJAAI,CAAC,GAAG,GAAG,mJAAI,CAAC,IAAI;QAEzC,MAAM,YAAY,OAAO,OAAO,SAAS,IAAI,OAAO,SAAS,IAAI,OAAO,SAAS,IAAI,OAAO,SAAS,IAAI,OAAO,KAAK,IAAI,OAAO,KAAK,IAAI;QACzI,MAAM,eAAe,OAAO,OAAO,YAAY,IAAI,OAAO,YAAY,IAAI,OAAO,YAAY,IAAI,OAAO,YAAY,IAAI,OAAO,KAAK,IAAI,OAAO,KAAK,IAAI;QAExJ,MAAM,YAAY,OAAO,MAAM,IAAI,OAAO,MAAM,IAAI,OAAO,KAAK,IAAI;QACpE,MAAM,aAAa,OAAO,UAAU,IAAI,OAAO,UAAU;QAEzD,IAAI;QAEJ,IAAI,eAAe,aAAa,eAAe,MAAM;YACpD,SAAS,OAAO;QACjB,OAAO;YACN,MAAM,YAAY,KAAK,GAAG,CAAC,OAAO;YAClC,SAAS,YAAY;QACtB;QAEA,MAAM,SAAS,OAAO,OAAO,MAAM,IAAI,OAAO,MAAM,IAAI,OAAO,EAAE,IAAI,OAAO,EAAE,IAAI;QAElF,MAAM,SAAS,OAAO,MAAM,IAAI,OAAO,MAAM,IAAI;QAEjD,OAAO;YACN,IAAI;YACJ,QAAQ;YACR,KAAK;YACL,MAAM;YACN,UAAU,QAAQ,QAAQ;YAC1B,UAAU;YACV,YAAY,OAAO,OAAO,UAAU,IAAI,OAAO,UAAU,IAAI,OAAO,OAAO,IAAI,OAAO,EAAE,IAAI,OAAO,EAAE,IAAI,MAAM;YAC/G,UAAU,OAAO,OAAO,QAAQ,IAAI,OAAO,QAAQ,IAAI,OAAO,OAAO,IAAI,OAAO,EAAE,IAAI,OAAO,EAAE,IAAI,MAAM;YACzG,QAAQ;YACR,IAAI;YACJ,MAAM;QACP;IACD;IAEQ,sBAAsB,QAAa,EAAgB;QAC1D,MAAM,SAAS,SAAS,MAAM,IAAI,SAAS,MAAM,IAAI,SAAS,OAAO,IAAI,SAAS,OAAO,IAAI,SAAS,EAAE;QACxG,MAAM,KAAK,OAAO;QAClB,IAAI,CAAC,IAAI,OAAO;QAEhB,MAAM,SAAS,SAAS,MAAM,IAAI,SAAS,MAAM;QACjD,IAAI,CAAC,QAAQ,OAAO;QAEpB,yCAAyC;QACzC,gFAAgF;QAChF,MAAM,YAAY,SAAS,IAAI,IAAI,SAAS,IAAI,IAAI,SAAS,SAAS,IAAI,SAAS,SAAS;QAE5F,IAAI,QAAQ;QACZ,IAAI,cAAc,wJAAS,CAAC,KAAK;QACjC,IAAI,WAAW;QAEf,IAAI,OAAO,cAAc,UAAU;YAClC,OAAQ;gBACP,KAAK;oBACJ,QAAQ;oBACR,cAAc,wJAAS,CAAC,MAAM;oBAC9B,WAAW;oBACX;gBACD,KAAK;oBACJ,QAAQ;oBACR,cAAc,wJAAS,CAAC,MAAM;oBAC9B,WAAW;oBACX;gBACD,KAAK;oBACJ,QAAQ;oBACR,cAAc,wJAAS,CAAC,KAAK;oBAC7B,WAAW;oBACX;gBACD,KAAK;oBACJ,QAAQ;oBACR,cAAc,wJAAS,CAAC,KAAK;oBAC7B,WAAW;oBACX;gBACD,KAAK;oBACJ,QAAQ;oBACR,cAAc,wJAAS,CAAC,IAAI;oBAC5B,WAAW;oBACX;gBACD,KAAK;oBACJ,QAAQ;oBACR,cAAc,wJAAS,CAAC,IAAI;oBAC5B,WAAW;oBACX;gBACD;oBACC,WAAW;oBACX,QAAQ;oBACR,cAAc,wJAAS,CAAC,KAAK;oBAC7B,WAAW;YACb;QACD,OAAO;YACN,6BAA6B;YAC7B,MAAM,UAAU,OAAO,aAAa,IAAI,WAAW;YACnD,QAAQ,QAAQ,QAAQ,CAAC;YACzB,IAAI,QAAQ,QAAQ,CAAC,UAAU;gBAC9B,cAAc,wJAAS,CAAC,KAAK;YAC9B,OAAO,IAAI,QAAQ,QAAQ,CAAC,SAAS;gBACpC,cAAc,wJAAS,CAAC,IAAI;YAC7B;YACA,WAAW;QACZ;QAEA,MAAM,OAAO,QAAQ,mJAAI,CAAC,GAAG,GAAG,mJAAI,CAAC,IAAI;QAEzC,2DAA2D;QAC3D,MAAM,SAAS,0JAAW,CAAC,OAAO;QAElC,2EAA2E;QAC3E,MAAM,YAAY,SAAS,MAAM,IAAI,SAAS,MAAM,IAAI,SAAS,KAAK,IAAI;QAC1E,MAAM,aAAa,SAAS,UAAU,IAAI,SAAS,UAAU;QAE7D,IAAI;QACJ,IAAI,eAAe,aAAa,eAAe,MAAM;YACpD,SAAS,OAAO;QACjB,OAAO;YACN,4CAA4C;YAC5C,MAAM,YAAY,KAAK,GAAG,CAAC,OAAO;YAClC,SAAS,YAAY;QACtB;QAEA,iDAAiD;QACjD,MAAM,YAAY,OACjB,SAAS,UAAU,IAAI,SAAS,UAAU,IAC1C,SAAS,SAAS,IAAI,SAAS,SAAS,IACxC,SAAS,KAAK,IAAI,SAAS,KAAK,IAAI;QAGrC,MAAM,kBAAkB;QACxB,MAAM,aAAa;QAEnB,OAAO;YACN,IAAI;YACJ,QAAQ;YACR,KAAK;YACL,MAAM;YACN,UAAU,QAAQ,QAAQ;YAC1B,MAAM;YACN,QAAQ;YACR,YAAY,gBAAgB,wJAAS,CAAC,KAAK,GAAG,YAAY;YAC1D,WAAW,gBAAgB,wJAAS,CAAC,IAAI,GAAG,YAAY;YACxD,YAAY,OAAO,SAAS,OAAO,IAAI,SAAS,OAAO,IAAI,SAAS,UAAU,IAAI,SAAS,UAAU,IAAI,MAAM;YAC/G,UAAU,OAAO,SAAS,OAAO,IAAI,SAAS,OAAO,IAAI,SAAS,QAAQ,IAAI,SAAS,QAAQ,IAAI,MAAM;YACzG,MAAM;QACP;IACD;IAEQ,qBAAqB,CAAW,EAAY;QACnD,sDAAsD;QACtD,OAAO;YACN,GAAG,CAAC;YACJ,YAAY,EAAE,UAAU;YACxB,UAAU,EAAE,QAAQ;QACrB;IACD;IAEQ,yBAAyB,QAAkB,EAAS;QAC3D,OAAO;YACN,IAAI,GAAG,SAAS,EAAE,CAAC,GAAG,CAAC;YACvB,QAAQ,SAAS,MAAM;YACvB,KAAK,SAAS,GAAG;YACjB,MAAM,WAAW,SAAS,IAAI;YAC9B,MAAM,wJAAS,CAAC,KAAK;YACrB,QAAQ,0JAAW,CAAC,OAAO;YAC3B,YAAY,SAAS,UAAU;YAC/B,UAAU,SAAS,EAAE;YACrB,YAAY,yJAAU,CAAC,QAAQ;YAC/B,MAAM;QACP;IACD;IAEQ,uBAAuB,QAAkB,EAAS;QACzD,OAAO;YACN,IAAI,GAAG,SAAS,EAAE,CAAC,GAAG,CAAC;YACvB,QAAQ,SAAS,MAAM;YACvB,KAAK,SAAS,GAAG;YACjB,MAAM,WAAW,SAAS,IAAI;YAC9B,MAAM,wJAAS,CAAC,IAAI;YACpB,QAAQ,0JAAW,CAAC,OAAO;YAC3B,WAAW,SAAS,QAAQ;YAC5B,UAAU,SAAS,EAAE;YACrB,YAAY,yJAAU,CAAC,QAAQ;YAC/B,MAAM;QACP;IACD;IAEQ,gBAAgB,KAAY,EAAW;QAC9C,IAAI,CAAC,OAAO,OAAO;QACnB,IAAI,MAAM,QAAQ,IAAI,MAAM,UAAU,KAAK,WAAW,OAAO;QAC7D,MAAM,KAAK,CAAC,MAAM,EAAE,IAAI,EAAE,EAAE,QAAQ;QACpC,OAAO,GAAG,QAAQ,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,GAAG,QAAQ,CAAC;IACtF;IAEA,qDAAqD;IAC7C,8BAA8B,KAAY,EAAS;QAC1D,MAAM,YAAY,MAAM,EAAE,KAAK;QAC/B,OAAO;YACN,IAAI,GAAG,MAAM,EAAE,CAAC,GAAG,CAAC;YACpB,QAAQ,MAAM,MAAM;YACpB,KAAK,MAAM,GAAG;YACd,MAAM,WAAW,MAAM,IAAI;YAC3B,MAAM,wJAAS,CAAC,KAAK;YACrB,QAAQ,0JAAW,CAAC,OAAO;YAC3B,YAAY,MAAM,UAAU;YAC5B,UAAU,MAAM,EAAE;YAClB,YAAY,yJAAU,CAAC,KAAK;YAC5B,MAAM;YACN,UAAU,YAAY,MAAM;YAC5B,UAAU,YAAY,MAAM;YAC5B,SAAS,YAAY,MAAM;QAC5B;IACD;IAEQ,4BAA4B,KAAY,EAAS;QACxD,MAAM,YAAY,MAAM,EAAE,KAAK;QAC/B,OAAO;YACN,IAAI,GAAG,MAAM,EAAE,CAAC,GAAG,CAAC;YACpB,QAAQ,MAAM,MAAM;YACpB,KAAK,MAAM,GAAG;YACd,MAAM,WAAW,MAAM,IAAI;YAC3B,MAAM,wJAAS,CAAC,IAAI;YACpB,QAAQ,0JAAW,CAAC,OAAO;YAC3B,WAAW,MAAM,QAAQ;YACzB,UAAU,MAAM,EAAE;YAClB,YAAY,yJAAU,CAAC,KAAK;YAC5B,MAAM;YACN,UAAU,YAAY,MAAM;YAC5B,UAAU,YAAY,MAAM;YAC5B,SAAS,YAAY,MAAM;QAC5B;IACD;IAIO,wBAAwB,OAAY,EAAE,OAAyC,EAA6B;QAClH,OAAO,QAAQ,OAAO,CAAC,EAAE;IAC1B;IAEO,WAAW,MAAc,EAA6B;QAC5D,OAAO,QAAQ,OAAO,CAAC;YAAE,UAAU;QAAK;IACzC;IAEA,MAAa,WAAW,QAAkB,EAA6B;QACtE,QAAQ,GAAG,CAAC,uCAAuC;QACnD,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YAC3C,OAAO,QAAQ,MAAM,CAAC;QACvB;QAEA,gBAAgB;QAChB,IAAI,CAAC,eAAe,GAAG,KAAK,GAAG;QAE/B,gDAAgD;QAChD,MAAM,SAAS,SAAS,MAAM,CAAC,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM;QAEhE,MAAM,OAAO,SAAS,IAAI,KAAK,IAAI,QAAQ;QAC3C,MAAM,SAAS,SAAS,GAAG,EAAE,8DAA8D;QAE3F,IAAI;YACH,IAAI,SAAS,IAAI,KAAK,wJAAS,CAAC,MAAM,EAAE;gBACvC,MAAM,IAAA,+IAAsB,EAAC;oBAC5B,WAAW,IAAI,CAAC,UAAU;oBAC1B,aAAa,IAAI,CAAC,YAAY;oBAC9B,QAAQ;oBACR,MAAM;oBACN,QAAQ;oBACR,UAAU,SAAS,QAAQ;oBAC3B,YAAY,SAAS,UAAU;gBAChC;YACD,OAAO;gBACN,UAAU;gBACV,MAAM,QAAQ,AAAC,SAAiB,UAAU,IAAI,AAAC,SAAiB,SAAS,IAAI;gBAC7E,MAAM,YAAY,SAAS,IAAI,KAAK,wJAAS,CAAC,KAAK,GAAG,UAAU,QAAQ,aAAa;gBAErF,MAAM,IAAA,gJAAuB,EAAC;oBAC7B,WAAW,IAAI,CAAC,UAAU;oBAC1B,aAAa,IAAI,CAAC,YAAY;oBAC9B,QAAQ;oBACR,MAAM;oBACN,QAAQ;oBACR,OAAO;oBACP,WAAW;oBACX,UAAU,SAAS,QAAQ;oBAC3B,YAAY,SAAS,UAAU;gBAChC;YACD;YACA,4DAA4D;YAC5D,WAAW,IAAM,IAAI,CAAC,wBAAwB,CAAC,OAAO;YACtD,OAAO,CAAC;QACT,EAAE,OAAO,GAAQ;YAChB,QAAQ,KAAK,CAAC,sBAAsB;YACpC,MAAM;QACP;IACD;IAGA,8DAA8D;IAC9D,MAAa,YAAY,KAAY,EAAE,SAAkB,EAAiB;QACzE,QAAQ,GAAG,CAAC,wCAAwC,MAAM,EAAE,EAAE;QAE9D,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YAC3C,OAAO,QAAQ,MAAM,CAAC;QACvB;QAEA,IAAI,CAAC,eAAe,GAAG,KAAK,GAAG;QAE/B,MAAM,gBAAgB,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;QAC/C,IAAI,CAAC,eAAe;YACnB,QAAQ,KAAK,CAAC,wDAAwD,MAAM,EAAE;YAC9E,OAAO,QAAQ,MAAM,CAAC;QACvB;QAEA,2DAA2D;QAC3D,IAAI,MAAM,QAAQ,KAAK,WAAW;YACjC,MAAM,OAAO,MAAM,EAAE,CAAC,QAAQ,GAAG,QAAQ,CAAC;YAC1C,MAAM,OAAO,MAAM,EAAE,CAAC,QAAQ,GAAG,QAAQ,CAAC;YAE1C,wEAAwE;YACxE,MAAM,cAAc,MAAM,UAAU,IAAI,MAAM,SAAS,IAAI,MAAM,KAAK;YACtE,MAAM,WAAW,OAAO,gBAAgB,WAAW,WAAW,eAAe;YAE7E,MAAM,MAAW,CAAC;YAClB,IAAI,QAAQ,aAAa,WAAW,IAAI,UAAU,GAAG;YACrD,IAAI,QAAQ,aAAa,WAAW,IAAI,QAAQ,GAAG;YAEnD,QAAQ,GAAG,CAAC;YACZ,QAAQ,GAAG,CAAC,4CAA4C,MAAM,QAAQ;YACtE,QAAQ,GAAG,CAAC,8CAA8C,MAAM,UAAU;YAC1E,QAAQ,GAAG,CAAC,+CAA+C;YAC3D,QAAQ,GAAG,CAAC,6CAA6C,MAAM,QAAQ,KAAK;YAE5E,IAAI,MAAM,UAAU,KAAK,yJAAU,CAAC,QAAQ,EAAE;gBAC7C,OAAO,IAAI,CAAC,oBAAoB,CAAC,MAAM,QAAQ,EAAE;YAClD,OAAO;gBACN,sFAAsF;gBACtF,QAAQ,GAAG,CAAC;gBACZ,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,QAAQ,EAAE;YACvC;QACD;QAEA,0DAA0D;QAC1D,MAAM,kBAAkB,MAAM,UAAU,IAAI,MAAM,SAAS,IAAI,MAAM,KAAK;QAC1E,MAAM,eAAe,OAAO,oBAAoB,WAAW,WAAW,mBAAmB;QACzF,cAAc,UAAU,GAAG,MAAM,UAAU,KAAK,YAAY,MAAM,UAAU,GAAG,cAAc,UAAU;QACvG,cAAc,SAAS,GAAG,MAAM,SAAS,KAAK,YAAY,MAAM,SAAS,GAAG,cAAc,SAAS;QACnG,iHAAiH;QACjH,IAAI,iBAAiB,WAAW;YAC/B,IAAI,cAAc,IAAI,KAAK,wJAAS,CAAC,IAAI,EAAE;gBAC1C,cAAc,SAAS,GAAG;YAC3B,OAAO;gBACN,cAAc,UAAU,GAAG;YAC5B;QACD;QACA,cAAc,UAAU,GAAG,MAAM,UAAU,KAAK,YAAY,MAAM,UAAU,GAAG,cAAc,UAAU;QACvG,cAAc,QAAQ,GAAG,MAAM,QAAQ,KAAK,YAAY,MAAM,QAAQ,GAAG,cAAc,QAAQ;QAC/F,cAAc,GAAG,GAAG,MAAM,GAAG,KAAK,YAAY,MAAM,GAAG,GAAG,cAAc,GAAG;QAE3E,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,GAAG;QAE5B,MAAM,QAAQ,cAAc,UAAU;QACtC,MAAM,QAAQ,cAAc,QAAQ;QAEpC,sBAAsB;QACtB,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC;QACxC,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC;QACxC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,CAAC,CAAC,EAAE,EAAE,KAAK,GAAG,MAAM,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,KAAK,GAAG,MAAM,EAAE,CAAC,GAAG,CAAC;QAEhG,IAAI,SAAS,QAAQ,GAAG;YACvB,MAAM,MAAM,IAAI,CAAC,6BAA6B,CAAC;YAC/C,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,GAAG;YAC1B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;QACnB;QACA,IAAI,SAAS,QAAQ,GAAG;YACvB,MAAM,MAAM,IAAI,CAAC,2BAA2B,CAAC;YAC7C,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,GAAG;YAC1B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;QACnB;QAEA,IAAI,CAAC,4BAA4B;QAEjC,iBAAiB;QACjB,IAAI;YACH,uBAAuB;YACvB,IAAI,MAAM,EAAE,KAAK,kBAAkB;gBAClC,QAAQ,GAAG,CAAC;gBACZ,iCAAiC;gBACjC;;gBAWA,OAAO,QAAQ,OAAO;YACvB;YAEA,MAAM,IAAA,iJAAwB,EAAC;gBAC9B,WAAW,IAAI,CAAC,UAAU;gBAC1B,aAAa,IAAI,CAAC,YAAY;gBAC9B,SAAS,MAAM,EAAE;gBACjB,OAAO,cAAc,IAAI,KAAK,wJAAS,CAAC,KAAK,GAAG,cAAc,UAAU,GAAG,cAAc,SAAS;gBAClG,UAAU;gBACV,YAAY;YACb;YACA,WAAW,IAAM,IAAI,CAAC,wBAAwB,CAAC,OAAO;QACvD,EAAE,OAAO,GAAG;YACX,QAAQ,KAAK,CAAC,iDAAiD;YAC/D,IAAI,CAAC,wBAAwB;YAC7B,MAAM;QACP;IACD;IAGA,MAAa,YAAY,OAAe,EAAiB;QACxD,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,CAAC;QAElE,QAAQ,GAAG,CAAC,4CAA4C;QAExD,0CAA0C;QAC1C,MAAM,OAAO,QAAQ,QAAQ,CAAC;QAC9B,MAAM,OAAO,QAAQ,QAAQ,CAAC;QAE9B,IAAI,QAAQ,MAAM;YACjB,MAAM,WAAW,QAAQ,OAAO,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO;YAC3D,QAAQ,GAAG,CAAC,qEAAqE;YAEjF,gCAAgC;YAChC,IAAI,IAAI,CAAC,aAAa,CAAC,SAAS,EAAE;gBACjC,MAAM,eAAe,OAAO;oBAAE,YAAY;gBAAE,IAAI;oBAAE,UAAU;gBAAE;gBAC9D,OAAO,IAAI,CAAC,oBAAoB,CAAC,UAAU;YAC5C;YAEA,8BAA8B;YAC9B,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE;gBAC9B,MAAM,eAAe,OAAO;oBAAE,YAAY;gBAAE,IAAI;oBAAE,UAAU;gBAAE;gBAC9D,OAAO,IAAI,CAAC,SAAS,CAAC,UAAU;YACjC;YAEA,QAAQ,IAAI,CAAC,gEAAgE;YAC7E,OAAO,QAAQ,OAAO,IAAI,WAAW;QACtC;QAEA,uCAAuC;QACvC,MAAM,QAAQ,IAAI,CAAC,UAAU,CAAC,QAAQ;QACtC,IAAI,OAAO;YACV,mBAAmB;YACnB,OAAO,IAAI,CAAC,UAAU,CAAC,QAAQ;YAC/B,oBAAoB;YACpB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YACjD,eAAe;YACf,IAAI,CAAC,4BAA4B;QAClC;QAEA,IAAI,YAAY,kBAAkB;YACjC,OAAO,QAAQ,OAAO;QACvB;QAEA,IAAI;YACH,MAAM,IAAA,iJAAwB,EAAC;gBAC9B,WAAW,IAAI,CAAC,UAAU;gBAC1B,aAAa,IAAI,CAAC,YAAY;gBAC9B,SAAS;YACV;YACA,WAAW,IAAM,IAAI,CAAC,wBAAwB,CAAC,OAAO;QACvD,EAAE,OAAO,GAAG;YACX,QAAQ,KAAK,CAAC,uBAAuB;YACrC,6CAA6C;YAC7C,IAAI,CAAC,wBAAwB;YAC7B,MAAM;QACP;IACD;IAEQ,wBAAwB,SAAiB,EAAE,UAAkB,EAAE;QACtE,MAAM,UAAU,cAAc,IAAI,CAAC,UAAU,CAAC,UAAU;QACxD,IAAI,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,KAAK,YAAY;YAC/D,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBAAE,GAAI,WAAW;oBAAE,IAAI;gBAAU,CAAC;gBAAG,QAAQ,0JAAW,CAAC,QAAQ;YAAC;QAC1F;IACD;IAEA,MAAa,qBAAqB,UAAkB,EAAE,YAAiB,EAAiB;QACvF,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,CAAC;QAElE,6CAA6C;QAC7C,IAAI,CAAC,eAAe,GAAG,KAAK,GAAG;QAE/B,wCAAwC;QACxC,MAAM,mBAAmB,IAAI,CAAC,aAAa,CAAC,WAAW;QACvD,IAAI,CAAC,kBAAkB;YACtB,QAAQ,KAAK,CAAC,iDAAiD;YAC/D;QACD;QACA,mBAAmB;QACnB,MAAM,gBAAgB;YAAE,GAAG,gBAAgB;QAAC;QAE5C,wEAAwE;QACxE,6DAA6D;QAC7D,MAAM,WAAW,aAAa,UAAU,IAAI,aAAa,EAAE;QAC3D,MAAM,WAAW,aAAa,QAAQ,IAAI,aAAa,EAAE;QAEzD,MAAM,QACL,aAAa,OACV,IACA,aAAa,aAAa,MAAM,OAAO,aACtC,iBAAiB,UAAU,IAAI,IAC/B,OAAO;QAEZ,MAAM,QACL,aAAa,OACV,IACA,aAAa,aAAa,MAAM,OAAO,aACtC,iBAAiB,QAAQ,IAAI,IAC7B,OAAO;QAEZ,uBAAuB;QACvB,QAAQ,GAAG,CAAC,oDAAoD,YAAY;QAE5E,IAAI,UAAU,WAAW,iBAAiB,QAAQ,GAAG;QACrD,IAAI,UAAU,WAAW,iBAAiB,UAAU,GAAG;QAEvD,oCAAoC;QACpC,MAAM,QAAQ,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QACtD,IAAI,UAAU,CAAC,GAAG;YACjB,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG;gBAAE,GAAG,gBAAgB;YAAC;YAC/C,4CAA4C;YAC5C,IAAI,CAAC,aAAa,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM;QACxD;QAEA,8EAA8E;QAC9E,MAAM,OAAO,GAAG,WAAW,GAAG,CAAC;QAC/B,MAAM,OAAO,GAAG,WAAW,GAAG,CAAC;QAC/B,MAAM,aAAa,IAAI,CAAC,UAAU,CAAC,KAAK;QACxC,MAAM,aAAa,IAAI,CAAC,UAAU,CAAC,KAAK;QAExC,sCAAsC;QACtC,MAAM,SAAS,IAAI,CAAC,aAAa,CAAC,WAAW;QAE7C,4BAA4B;QAC5B,IAAI,OAAO,UAAU,IAAI,OAAO,UAAU,GAAG,GAAG;YAC/C,IAAI,YAAY;gBACf,gDAAgD;gBAChD,MAAM,YAAY;oBACjB,GAAG,UAAU;oBACb,YAAY,OAAO,UAAU;oBAC7B,KAAK,OAAO,GAAG;oBACf,QAAQ,0JAAW,CAAC,OAAO;gBAC5B;gBACA,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG;gBACxB,yBAAyB;gBACzB,MAAM,UAAU,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;gBACrD,IAAI,YAAY,CAAC,GAAG;oBACnB,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG;gBACzB,OAAO;oBACN,kDAAkD;oBAClD,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;gBACnB;gBACA,QAAQ,GAAG,CAAC,0DAA0D,UAAU,EAAE,EAAE,UAAU,UAAU;YACzG,OAAO;gBACN,wBAAwB;gBACxB,IAAI;oBACH,MAAM,YAAY,IAAI,CAAC,wBAAwB,CAAC;oBAChD,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,GAAG;oBAChC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;oBAClB,QAAQ,GAAG,CAAC,qDAAqD;gBAClE,EAAE,OAAO,GAAG;oBACX,QAAQ,KAAK,CAAC,8CAA8C;gBAC7D;YACD;QACD,OAAO;YACN,aAAa;YACb,IAAI,YAAY;gBACf,IAAI,CAAC,uBAAuB,CAAC,MAAM;gBACnC,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK;gBAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YAClD;QACD;QAEA,4BAA4B;QAC5B,IAAI,OAAO,QAAQ,IAAI,OAAO,QAAQ,GAAG,GAAG;YAC3C,IAAI,YAAY;gBACf,gDAAgD;gBAChD,MAAM,YAAY;oBACjB,GAAG,UAAU;oBACb,WAAW,OAAO,QAAQ;oBAC1B,KAAK,OAAO,GAAG;oBACf,QAAQ,0JAAW,CAAC,OAAO;gBAC5B;gBACA,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG;gBACxB,yBAAyB;gBACzB,MAAM,UAAU,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;gBACrD,IAAI,YAAY,CAAC,GAAG;oBACnB,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG;gBACzB,OAAO;oBACN,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;gBACnB;gBACA,QAAQ,GAAG,CAAC,0DAA0D,UAAU,EAAE,EAAE,UAAU,SAAS;YACxG,OAAO;gBACN,wBAAwB;gBACxB,IAAI;oBACH,MAAM,YAAY,IAAI,CAAC,sBAAsB,CAAC;oBAC9C,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,GAAG;oBAChC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;oBAClB,QAAQ,GAAG,CAAC,qDAAqD;gBAClE,EAAE,OAAO,GAAG;oBACX,QAAQ,KAAK,CAAC,8CAA8C;gBAC7D;YACD;QACD,OAAO;YACN,aAAa;YACb,IAAI,YAAY;gBACf,IAAI,CAAC,uBAAuB,CAAC,MAAM;gBACnC,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK;gBAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YAClD;QACD;QAEA,8BAA8B;QAC9B,IAAI,CAAC,4BAA4B;QAEjC,IAAI;YACH,4BAA4B;YAC5B,MAAM,IAAA,6IAAoB,EAAC;gBAC1B,WAAW,IAAI,CAAC,UAAU;gBAC1B,aAAa,IAAI,CAAC,YAAY;gBAC9B,YAAY;gBACZ,UAAU;gBACV,YAAY;YACb;YAEA,gEAAgE;YAChE,WAAW,IAAM,IAAI,CAAC,wBAAwB,CAAC,OAAO;QAEvD,EAAE,OAAO,GAAG;YACX,QAAQ,KAAK,CAAC,0BAA0B;YAExC,yBAAyB;YACzB,QAAQ,GAAG,CAAC;YACZ,MAAM,cAAc,IAAI,CAAC,aAAa,CAAC,WAAW;YAClD,IAAI,aAAa;gBAChB,YAAY,UAAU,GAAG,cAAc,UAAU;gBACjD,YAAY,QAAQ,GAAG,cAAc,QAAQ;gBAE7C,qDAAqD;gBACrD,wDAAwD;gBACxD,IAAI,CAAC,4BAA4B;YAClC;YACA,gCAAgC;YAChC,IAAI,CAAC,wBAAwB,CAAC;YAE9B,MAAM;QACP;IACD;IAEA,MAAa,cAAc,UAAkB,EAAiB;QAC7D,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,CAAC;QAElE,QAAQ,GAAG,CAAC,8CAA8C;QAE1D,yDAAyD;QACzD,MAAM,WAAW,IAAI,CAAC,aAAa,CAAC,WAAW;QAC/C,IAAI,UAAU;YACb,wDAAwD;YACxD,IAAI,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,cAAc,KAAK,YAAY;gBAClE,MAAM,iBAAiB;oBAAE,GAAG,QAAQ;oBAAE,KAAK;oBAAG,UAAU;gBAAE;gBAC1D,QAAQ,GAAG,CAAC,uDAAuD;gBACnE,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC;gBAE1B,IAAI,AAAC,SAAiB,EAAE,KAAK,aAAa,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,KAAK,YAAY;gBACpF,0EAA0E;gBAC3E;YACD;YAEA,mBAAmB;YACnB,OAAO,IAAI,CAAC,aAAa,CAAC,WAAW;YACrC,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,WAAW,GAAG,CAAC,CAAC;YAC1C,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,WAAW,GAAG,CAAC,CAAC;YAE1C,oBAAoB;YACpB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YAEvD,kCAAkC;YAClC,IAAI,CAAC,4BAA4B;QAClC;QAEA,IAAI;YACH,MAAM,IAAA,4IAAmB,EAAC;gBACzB,WAAW,IAAI,CAAC,UAAU;gBAC1B,aAAa,IAAI,CAAC,YAAY;gBAC9B,YAAY;gBACZ,QAAQ,WAAW,SAAS,GAAG,GAAG,EAAE,uCAAuC;YAC5E;YACA,+BAA+B;YAC/B,WAAW,IAAM,IAAI,CAAC,wBAAwB,CAAC,OAAO;QACvD,EAAE,OAAO,GAAG;YACX,QAAQ,KAAK,CAAC,yBAAyB;YACvC,gCAAgC;YAChC,IAAI,CAAC,wBAAwB,CAAC;YAC9B,MAAM;QACP;IACD;IAEO,qBAAyC;QAC/C,MAAM,eAAsB;YAC3B;gBACC,IAAI;gBACJ,OAAO;gBACP,YAAY;oBAAC;iBAAS;gBACtB,WAAW,oKAAqB,CAAC,IAAI;YACtC;YACA;gBACC,IAAI;gBACJ,OAAO;gBACP,YAAY;oBAAC;iBAAW;gBACxB,WAAW,oKAAqB,CAAC,IAAI;YACtC;YACA;gBACC,IAAI;gBACJ,OAAO;gBACP,YAAY;oBAAC;iBAAM;gBACnB,WAAW,oKAAqB,CAAC,KAAK;YACvC;YACA;gBACC,IAAI;gBACJ,OAAO;gBACP,YAAY;oBAAC;iBAAS;gBACtB,WAAW,oKAAqB,CAAC,IAAI;YACtC;SACA;QAED,MAAM,kBAAyB;YAC9B;gBACC,IAAI;gBACJ,OAAO;gBACP,YAAY;oBAAC;iBAAS;gBACtB,WAAW,oKAAqB,CAAC,IAAI;YACtC;YACA;gBACC,IAAI;gBACJ,OAAO;gBACP,YAAY;oBAAC;iBAAW;gBACxB,WAAW,oKAAqB,CAAC,IAAI;YACtC;YACA;gBACC,IAAI;gBACJ,OAAO;gBACP,YAAY;oBAAC;iBAAM;gBACnB,WAAW,oKAAqB,CAAC,KAAK;YACvC;YACA;gBACC,IAAI;gBACJ,OAAO;gBACP,YAAY;oBAAC;iBAAW;gBACxB,WAAW,oKAAqB,CAAC,WAAW;YAC7C;YACA;gBACC,IAAI;gBACJ,OAAO;gBACP,YAAY;oBAAC;iBAAS;gBACtB,WAAW,oKAAqB,CAAC,KAAK;YACvC;SACA;QAED,OAAO;YACN,cAAc;YACd,SAAS;gBACR;oBACC,MAAM;oBACN,QAAQ;wBACP,WAAW,CAAC,YAAoB;wBAChC,aAAa,CAAC,YAAoB;wBAClC,OAAO,IAAM,IAAI,CAAC,eAAe;wBACjC,MAAM,CAAC,YAAoB,EAAE,4CAA4C;oBAC1E;oBACA,WAAW,oKAAqB,CAAC,KAAK,CAAC,qBAAqB;gBAC7D;aACA;YACD,cAAc;YACd,iBAAiB;YACjB,OAAO;gBACN;oBACC,IAAI;oBACJ,OAAO;oBACP,QAAQ;wBACP;4BACC,IAAI;4BACJ,SAAS;4BACT,SAAS,IAAM,QAAQ,OAAO,CAAC,IAAI,CAAC,UAAU;4BAC9C,gBAAgB,IAAI,CAAC,sBAAsB;wBAC5C;qBACA;gBACF;gBACA;oBACC,IAAI;oBACJ,OAAO;oBACP,QAAQ;wBACP;4BACC,IAAI;4BACJ,SAAS;4BACT,SAAS,IAAM,QAAQ,OAAO,CAAC,IAAI,CAAC,OAAO;4BAC3C,gBAAgB,IAAI,CAAC,mBAAmB;wBACzC;qBACA;gBACF;aACA;QACF;IACD;IAEO,mBAA+C;QACrD,OAAO,QAAQ,OAAO,CAAC;YACtB;gBACC,IAAK,IAAI,CAAC,UAAU,IAAI;gBACxB,MAAM;gBACN,UAAU;YACX;SACA;IACF;IACA,MAAa,SAA2B;QACvC,OAAO,QAAQ,OAAO,CAAC,IAAI,CAAC,OAAO;IACpC;IAEA,MAAa,YAAiC;QAC7C,OAAO,QAAQ,OAAO,CAAC,IAAI,CAAC,UAAU;IACvC;IAEA,MAAa,WAAW,MAAc,EAAwB;QAC7D,OAAO,EAAE;IACV;IAEO,iBAA4B;QAClC,OAAQ,IAAI,CAAC,UAAU,IAAI;IAC5B;IAEA,MAAa,WAAW,MAAc,EAA2B;QAChE,MAAM,cAAc,OAAO,WAAW;QACtC,IAAI,aAAa,QAAQ,gBAAgB;QACzC,IAAI,UAAU;QAEd,IAAI,YAAY,QAAQ,CAAC,UAAU,YAAY,QAAQ,CAAC,QAAQ;YAC/D,aAAa;YACb,UAAU;QACX,OAAO,IAAI,YAAY,QAAQ,CAAC,UAAU,YAAY,QAAQ,CAAC,UAAU,YAAY,QAAQ,CAAC,QAAQ;YACrG,aAAa;YACb,UAAU;QACX;QAEA,OAAO;YACN,KAAK;gBAAE,KAAK;gBAAM,KAAK;gBAAK,MAAM;YAAK;YACvC,SAAS;YACT,UAAU;YACV,SAAS;YACT,aAAa;YACb,MAAM;YACN,oBAAoB;YACpB,IAAI;YACJ,MAAM;YACN,UAAU;YACV,YAAY;YACZ,QAAQ;YACR,YAAY;YACZ,SAAS;YACT,UAAU;YACV,cAAc;YACd,eAAe;YACf,aAAa;QACd;IACD;IAEO,UAAU,MAAc,EAAE,cAAwB,EAAgB;QACxE,OAAO,QAAQ,OAAO,CAAC;YACtB,QAAQ,CAAC;gBACR,IAAI,UAAU,aAAa,UAAU,MAAM,OAAO;gBAClD,OAAO,MAAM,OAAO,CAAC;YACtB;QACD;IACD;IAEO,gBAAgB,MAAc,EAAgB;QACpD,OAAO,QAAQ,OAAO,CAAC;YACtB,QAAQ,CAAC;gBACR,IAAI,UAAU,aAAa,UAAU,MAAM,OAAO;gBAClD,OAAO,MAAM,OAAO,CAAC,KAAK;YAC3B;QACD;IACD;IAEO,kBAAkB,MAAc,EAAgB;QACtD,OAAO,QAAQ,OAAO,CAAC;YACtB,QAAQ,CAAC;gBACR,IAAI,UAAU,aAAa,UAAU,MAAM,OAAO;gBAClD,OAAO,MAAM,QAAQ;YACtB;QACD;IACD;IAEO,kBAAkB,MAAc,EAAgB;QACtD,OAAO,QAAQ,OAAO,CAAC;YACtB,QAAQ,CAAC;gBACR,IAAI,UAAU,aAAa,UAAU,MAAM,OAAO;gBAClD,OAAO,MAAM,OAAO,CAAC;YACtB;QACD;IACD;IACA,MAAa,UAAU,OAAe,EAAE,YAAiB,EAAiB;QACzE,MAAM,gBAAgB,IAAI,CAAC,UAAU,CAAC,QAAQ;QAC9C,IAAI,CAAC,eAAe;YACnB,QAAQ,KAAK,CAAC,CAAC,kCAAkC,EAAE,SAAS;YAC5D,OAAO,QAAQ,MAAM,CAAC;QACvB;QAEA,QAAQ,GAAG,CAAC,sCAAsC,SAAS;QAE3D,uBAAuB;QACvB,QAAQ,GAAG,CAAC,0DAA0D,SAAS,OAAO,kBAAkB,KAAK,YAAY;QACzH,IAAI,YAAY,kBAAkB;YACjC,QAAQ,GAAG,CAAC;YAEZ,qBAAqB;YACrB,MAAM,aAAa,CAAC,cAAc,IAAI,KAAK,wJAAS,CAAC,KAAK,GAAG,cAAc,UAAU,GAAG,cAAc,SAAS,KAAK;YACpH,MAAM,OAAO,cAAc,IAAI,EAAE,iBAAiB;YAElD,IAAI,aAAa,UAAU,KAAK,WAAW,cAAc,UAAU,GAAG,aAAa,UAAU;YAC7F,IAAI,aAAa,SAAS,KAAK,WAAW,cAAc,SAAS,GAAG,aAAa,SAAS;YAC1F,IAAI,aAAa,GAAG,KAAK,WAAW,cAAc,GAAG,GAAG,aAAa,GAAG;YAExE,kFAAkF;YAClF,IAAI,aAAa,UAAU,KAAK,WAAW;gBAC1C,cAAc,UAAU,GAAG,aAAa,UAAU;YACnD;YACA,IAAI,aAAa,QAAQ,KAAK,WAAW;gBACxC,cAAc,QAAQ,GAAG,aAAa,QAAQ;YAC/C;YAEA,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG;YAE3B,mEAAmE;YACnE,MAAM,OAAO,GAAG,QAAQ,GAAG,CAAC;YAC5B,MAAM,OAAO,GAAG,QAAQ,GAAG,CAAC;YAE5B,IAAI,cAAc,UAAU,IAAI,cAAc,UAAU,GAAG,GAAG;gBAC7D,MAAM,aAAa,IAAI,CAAC,UAAU,CAAC,KAAK;gBACxC,IAAI,YAAY;oBACd,WAAmB,UAAU,GAAG,cAAc,UAAU;oBACzD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACxB,OAAO;oBACN,MAAM,MAAM,IAAI,CAAC,6BAA6B,CAAC;oBAC/C,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,GAAG;oBAC1B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;oBAClB,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACxB;YACD,OAAO;gBACN,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE;oBAC1B,MAAM,cAAc;wBAAE,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK;wBAAE,QAAQ,0JAAW,CAAC,QAAQ;oBAAC;oBAC7E,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;oBACvB,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK;oBAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;gBAClD;YACD;YAEA,IAAI,cAAc,QAAQ,IAAI,cAAc,QAAQ,GAAG,GAAG;gBACzD,MAAM,aAAa,IAAI,CAAC,UAAU,CAAC,KAAK;gBACxC,IAAI,YAAY;oBACd,WAAmB,SAAS,GAAG,cAAc,QAAQ;oBACtD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACxB,OAAO;oBACN,MAAM,MAAM,IAAI,CAAC,2BAA2B,CAAC;oBAC7C,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,GAAG;oBAC1B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;oBAClB,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACxB;YACD,OAAO;gBACN,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE;oBAC1B,MAAM,cAAc;wBAAE,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK;wBAAE,QAAQ,0JAAW,CAAC,QAAQ;oBAAC;oBAC7E,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;oBACvB,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK;oBAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;gBAClD;YACD;YAEA,IAAI,CAAC,4BAA4B;YAEjC,iCAAiC;YACjC,QAAQ,GAAG,CAAC,+EAA+E;gBAAE,IAAI,cAAc,UAAU;gBAAE,IAAI,cAAc,QAAQ;YAAC;YACtJ;;YAYA,OAAO,QAAQ,OAAO;QACvB;QAEA,IAAI,CAAC,eAAe,GAAG,KAAK,GAAG;QAE/B,MAAM,gBAAgB;YAAE,GAAG,aAAa;QAAC;QACzC,MAAM,OAAO,GAAG,QAAQ,GAAG,CAAC;QAC5B,MAAM,OAAO,GAAG,QAAQ,GAAG,CAAC;QAE5B,8BAA8B;QAC9B,MAAM,aAAa,IAAI,CAAC,UAAU,CAAC,KAAK;QACxC,MAAM,aAAa,IAAI,CAAC,UAAU,CAAC,KAAK;QAExC,4CAA4C;QAC5C,IAAI,aAAa,UAAU,KAAK,WAAW,cAAc,UAAU,GAAG,aAAa,UAAU;QAC7F,IAAI,aAAa,SAAS,KAAK,WAAW,cAAc,SAAS,GAAG,aAAa,SAAS;QAC1F,IAAI,aAAa,UAAU,KAAK,WAAW,cAAc,UAAU,GAAG,aAAa,UAAU;QAC7F,IAAI,aAAa,QAAQ,KAAK,WAAW,cAAc,QAAQ,GAAG,aAAa,QAAQ;QAEvF,4BAA4B;QAC5B,IAAI,cAAc,UAAU,IAAI,cAAc,UAAU,GAAG,GAAG;YAC7D,IAAI,YAAY;gBACf,mEAAmE;gBACnE,MAAM,YAAY;oBACjB,GAAG,UAAU;oBACb,YAAY,cAAc,UAAU;oBACpC,KAAK,cAAc,GAAG;oBACtB,QAAQ,0JAAW,CAAC,OAAO,CAAC,eAAe;gBAC5C;gBACA,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG;gBACxB,yBAAyB;gBACzB,MAAM,UAAU,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;gBACrD,IAAI,YAAY,CAAC,GAAG;oBACnB,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG;gBACzB;gBACA,QAAQ,GAAG,CAAC,6DAA6D,UAAU,EAAE,EAAE,UAAU,UAAU;YAC5G,OAAO;gBACN,aAAa;gBACb,MAAM,YAAY,IAAI,CAAC,6BAA6B,CAAC;gBACrD,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,GAAG;gBAChC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;YACnB;QACD,OAAO;YACN,gCAAgC;YAChC,IAAI,YAAY;gBACf,sCAAsC;gBACtC,IAAI,CAAC,uBAAuB,CAAC,MAAM;gBACnC,6BAA6B;gBAC7B,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK;gBAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YAClD;QACD;QAEA,4BAA4B;QAC5B,IAAI,cAAc,QAAQ,IAAI,cAAc,QAAQ,GAAG,GAAG;YACzD,IAAI,YAAY;gBACf,qCAAqC;gBACrC,MAAM,YAAY;oBACjB,GAAG,UAAU;oBACb,WAAW,cAAc,QAAQ;oBACjC,KAAK,cAAc,GAAG;oBACtB,QAAQ,0JAAW,CAAC,OAAO,CAAC,eAAe;gBAC5C;gBACA,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG;gBACxB,yBAAyB;gBACzB,MAAM,UAAU,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;gBACrD,IAAI,YAAY,CAAC,GAAG;oBACnB,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG;gBACzB;gBACA,QAAQ,GAAG,CAAC,6DAA6D,UAAU,EAAE,EAAE,UAAU,SAAS;YAC3G,OAAO;gBACN,aAAa;gBACb,MAAM,YAAY,IAAI,CAAC,2BAA2B,CAAC;gBACnD,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,GAAG;gBAChC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;YACnB;QACD,OAAO;YACN,aAAa;YACb,IAAI,YAAY;gBACf,sCAAsC;gBACtC,IAAI,CAAC,uBAAuB,CAAC,MAAM;gBACnC,6BAA6B;gBAC7B,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK;gBAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YAClD;QACD;QAEA,yEAAyE;QACzE,MAAM,QAAQ,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QACnD,IAAI,UAAU,CAAC,GAAG;YACjB,4FAA4F;YAC5F,wEAAwE;YACxE,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG;gBAAE,GAAG,aAAa;YAAC;YACzC,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM;QAC/C;QAEA,qBAAqB;QACrB,IAAI,CAAC,4BAA4B;QAEjC,IAAI;YACH,oEAAoE;YACpE,MAAM,IAAA,iJAAwB,EAAC;gBAC9B,WAAW,IAAI,CAAC,UAAU;gBAC1B,aAAa,IAAI,CAAC,YAAY;gBAC9B,SAAS;gBACT,OAAO,cAAc,UAAU,IAAI,cAAc,SAAS;gBAC1D,UAAU,cAAc,QAAQ;gBAChC,YAAY,cAAc,UAAU;YACrC;YACA,uBAAuB;YACvB,WAAW,IAAM,IAAI,CAAC,wBAAwB,CAAC,OAAO;QACvD,EAAE,OAAO,GAAG;YACX,QAAQ,KAAK,CAAC,wCAAwC;YACtD,wDAAwD;YACxD,IAAI,CAAC,wBAAwB,CAAC;YAC9B,MAAM;QACP;IACD;IAEA,MAAa,aAAa,EAAU,EAAE,YAAiB,EAAiB;QACvE,2BAA2B;QAC3B,IAAI,IAAI,CAAC,aAAa,CAAC,GAAG,EAAE;YAC3B,OAAO,IAAI,CAAC,oBAAoB,CAAC,IAAI;QACtC;QACA,yBAAyB;QACzB,IAAI,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE;YACxB,wCAAwC;YACxC,MAAM,WAAgB,CAAC;YACvB,IAAI,aAAa,EAAE,KAAK,WAAW,SAAS,UAAU,GAAG,aAAa,EAAE;YACxE,IAAI,aAAa,EAAE,KAAK,WAAW,SAAS,QAAQ,GAAG,aAAa,EAAE;YAEtE,yEAAyE;YACzE,IAAI,aAAa,KAAK,KAAK,WAAW;gBACrC,MAAM,QAAQ,IAAI,CAAC,UAAU,CAAC,GAAG;gBACjC,IAAI,MAAM,IAAI,KAAK,wJAAS,CAAC,KAAK,EAAE;oBACnC,SAAS,UAAU,GAAG,aAAa,KAAK;gBACzC,OAAO,IAAI,MAAM,IAAI,KAAK,wJAAS,CAAC,IAAI,EAAE;oBACzC,SAAS,SAAS,GAAG,aAAa,KAAK;gBACxC;YACD;YAEA,2CAA2C;YAC3C,IAAI,aAAa,UAAU,EAAE,SAAS,UAAU,GAAG,aAAa,UAAU;YAC1E,IAAI,aAAa,SAAS,EAAE,SAAS,SAAS,GAAG,aAAa,SAAS;YACvE,IAAI,aAAa,UAAU,EAAE,SAAS,UAAU,GAAG,aAAa,UAAU;YAC1E,IAAI,aAAa,QAAQ,EAAE,SAAS,QAAQ,GAAG,aAAa,QAAQ;YAEpE,0DAA0D;YAC1D,0DAA0D;YAC1D,MAAM,SAAS,IAAI,CAAC,UAAU,CAAC,GAAG;YAClC,iEAAiE;YACjE,2GAA2G;YAC3G,IAAI,UAAU,OAAO,QAAQ,EAAE;gBAC9B,MAAM,eAAe,IAAI,CAAC,UAAU,CAAC,OAAO,QAAQ,CAAC;gBACrD,IAAI,cAAc;oBACjB,IAAI,aAAa,UAAU,KAAK,WAAW,aAAa,UAAU,GAAG,aAAa,UAAU;oBAC5F,IAAI,aAAa,SAAS,KAAK,WAAW,aAAa,QAAQ,GAAG,aAAa,SAAS;oBACxF,IAAI,aAAa,UAAU,KAAK,WAAW,aAAa,UAAU,GAAG,aAAa,UAAU;oBAC5F,IAAI,aAAa,QAAQ,KAAK,WAAW,aAAa,QAAQ,GAAG,aAAa,QAAQ;oBAEtF,mCAAmC;oBACnC,IAAI,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,KAAK,YAAY;wBAE/D,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;oBACxB;gBACD;YACD,OAAO,IAAI,QAAQ;gBAClB,iCAAiC;gBACjC,wEAAwE;gBACxE,IAAI,aAAa,UAAU,KAAK,WAAW,OAAO,UAAU,GAAG,aAAa,UAAU;gBACtF,IAAI,aAAa,SAAS,KAAK,WAAW,OAAO,QAAQ,GAAG,aAAa,SAAS;gBAClF,IAAI,aAAa,UAAU,KAAK,WAAW,OAAO,UAAU,GAAG,aAAa,UAAU;gBACtF,IAAI,aAAa,QAAQ,KAAK,WAAW,OAAO,QAAQ,GAAG,aAAa,QAAQ;YAChF,kFAAkF;YAClF,uDAAuD;YACxD;YAEA,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI;QAC3B;QAEA,QAAQ,KAAK,CAAC,uDAAuD;QACrE,OAAO,QAAQ,MAAM,CAAC;IACvB;IAEA,8DAA8D;IAC9D,MAAa,UAAU,OAAe,EAAE,KAAa,EAAiB;QACrE,QAAQ,GAAG,CAAC,uCAAuC,SAAS;QAC5D,MAAM,QAAQ,IAAI,CAAC,UAAU,CAAC,QAAQ;QACtC,IAAI,CAAC,OAAO;YACX,QAAQ,KAAK,CAAC,sDAAsD;YACpE,OAAO,QAAQ,MAAM,CAAC;QACvB;QAEA,6FAA6F;QAC7F,MAAM,iBAAiB,AAAC,UAAU,aAAa,CAAC,OAAO,KAAK,CAAC,SAC1D,OAAO,SACN,MAAM,UAAU,IAAI,MAAM,SAAS;QACvC,IAAI,mBAAmB,aAAa,OAAO,KAAK,CAAC,iBAAiB;YACjE,QAAQ,IAAI,CAAC,6DAA6D;gBAAE;gBAAS;gBAAO;YAAM;YAClG,OAAO,QAAQ,OAAO;QACvB;QAEA,MAAM,OAAO,QAAQ,QAAQ,CAAC,UAAU,QAAQ,QAAQ,CAAC;QACzD,MAAM,OAAO,QAAQ,QAAQ,CAAC,UAAU,QAAQ,QAAQ,CAAC;QAEzD,QAAQ,GAAG,CAAC,0CAA0C;YAAE;YAAM;YAAM,UAAU,MAAM,QAAQ;YAAE,YAAY,MAAM,UAAU;QAAC;QAE3H,0CAA0C;QAC1C,IAAI,MAAM,QAAQ,IAAI,MAAM,UAAU,KAAK,yJAAU,CAAC,KAAK,IAAI,CAAC,QAAQ,IAAI,GAAG;YAC9E,MAAM,MAAW,CAAC;YAClB,IAAI,MAAM,IAAI,UAAU,GAAG;YAC3B,IAAI,MAAM,IAAI,QAAQ,GAAG;YACzB,QAAQ,GAAG,CAAC,8DAA8D,MAAM,QAAQ,EAAE;YAE1F,uEAAuE;YACvE,IAAI,MAAM,QAAQ,KAAK,kBAAkB;gBACxC,MAAM,cAAc,IAAI,CAAC,UAAU,CAAC,MAAM,QAAQ,CAAC;gBACnD,IAAI,aAAa;oBAChB,wEAAwE;oBACxE,MAAM,UAAU;wBACf,IAAI,MAAM,QAAQ;wBAClB,OAAO,YAAY,IAAI,KAAK,wJAAS,CAAC,KAAK,GAAG,YAAY,UAAU,GAAG,YAAY,SAAS;wBAC5F,YAAY,OAAO,iBAAiB,YAAY,UAAU;wBAC1D,UAAU,OAAO,iBAAiB,YAAY,QAAQ;wBACtD,KAAK,YAAY,GAAG;wBACpB,QAAQ;oBACT;oBACA,QAAQ,GAAG,CAAC,sFAAsF;oBAClG;;oBAMA,+DAA+D;oBAC/D,IAAI,MAAM,YAAY,UAAU,GAAG;oBACnC,IAAI,MAAM,YAAY,QAAQ,GAAG;gBAClC;YACD;YACA,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,QAAQ,EAAE;QACvC;QAEA,qCAAqC;QACrC,IAAI,MAAM,QAAQ,IAAI,MAAM,UAAU,KAAK,yJAAU,CAAC,QAAQ,IAAI,CAAC,QAAQ,IAAI,GAAG;YACjF,MAAM,MAAW,CAAC;YAClB,IAAI,MAAM,IAAI,UAAU,GAAG;YAC3B,IAAI,MAAM,IAAI,QAAQ,GAAG;YACzB,QAAQ,GAAG,CAAC,oEAAoE,MAAM,QAAQ,EAAE;YAChG,OAAO,IAAI,CAAC,oBAAoB,CAAC,MAAM,QAAQ,EAAE;QAClD;QAEA,+BAA+B;QAC/B,MAAM,MAAW,CAAC;QAClB,IAAI,MAAM,IAAI,KAAK,wJAAS,CAAC,IAAI,EAAE;YAClC,IAAI,SAAS,GAAG;QACjB,OAAO;YACN,IAAI,UAAU,GAAG;QAClB;QACA,QAAQ,GAAG,CAAC,gEAAgE,SAAS;QACrF,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS;IAChC;IAEA,6DAA6D;IAC7D,MAAa,qBAAqB,UAAkB,EAAE,QAAa,EAAiB;QACnF,QAAQ,GAAG,CAAC,kDAAkD,YAAY;QAC1E,OAAO,IAAI,CAAC,oBAAoB,CAAC,YAAY;IAC9C;IAEA,qCAAqC;IACrC,MAAa,aAAa,UAAkB,EAAE,QAAa,EAAiB;QAC3E,QAAQ,GAAG,CAAC,0CAA0C,YAAY,WAAW,kLAAkL;QAC/P,iEAAiE;QACjE,8EAA8E;QAC9E,+CAA+C;QAC/C,2FAA2F;QAC3F,yDAAyD;QACzD,OAAO,IAAI,CAAC,oBAAoB,CAAC,YAAY;IAC9C;IAEO,gBAAgB,WAQtB,EAAQ;QACR,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,WAAW,KAAK,YAAY;QAEjE,IAAI,CAAC,YAAY,IAAI,EAAE;YACtB,iBAAiB;YACjB,MAAM,WAAW,IAAI,CAAC,UAAU,CAAC,iBAAiB;YAClD,IAAI,UAAU;gBACb,MAAM,kBAAkB;oBACvB,GAAG,QAAQ;oBACX,QAAQ,0JAAW,CAAC,QAAQ;gBAC7B;gBACA,QAAQ,GAAG,CAAC;gBACZ,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACvB,OAAO,IAAI,CAAC,UAAU,CAAC,iBAAiB;gBAExC,uBAAuB;gBACvB,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,iBAAiB,GAAG,CAAC,CAAC;gBAChD,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,iBAAiB,GAAG,CAAC,CAAC;gBAEhD,mEAAmE;gBACnE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,EAAE,CAAC,QAAQ,GAAG,UAAU,CAAC;YACrE;YACA;QACD;QAEA,iCAAiC;QACjC,MAAM,OAAO,YAAY,IAAI,KAAK,QAAQ,mJAAI,CAAC,GAAG,GAAG,mJAAI,CAAC,IAAI;QAC9D,MAAM,MAAM,YAAY,GAAG,IAAI;QAC/B,MAAM,QAAQ,YAAY,KAAK,IAAI;QACnC,MAAM,SAAS,YAAY,MAAM,IAAI;QAErC,MAAM,eAAsB;YAC3B,IAAI;YACJ,QAAQ;YACR,MAAM;YACN,KAAK;YACL,QAAQ,0JAAW,CAAC,OAAO;YAC3B,MAAM,YAAY,IAAI,KAAK,SAAS,wJAAS,CAAC,IAAI,GAAI,YAAY,IAAI,KAAK,UAAU,wJAAS,CAAC,KAAK,GAAG,wJAAS,CAAC,KAAK;YACtH,YAAY;YACZ,WAAW,YAAY,IAAI,KAAK,SAAS,QAAQ;YACjD,YAAY,YAAY,UAAU;YAClC,UAAU,YAAY,QAAQ;YAC9B,MAAM;YACN,UAAU;YACV,UAAU;YACV,SAAS;QACV;QAEA,QAAQ,GAAG,CAAC,2CAA2C;QACvD,IAAI,CAAC,UAAU,CAAC,iBAAiB,GAAG;QAEpC,sDAAsD;QACtD,MAAM,gBAAgB,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAC3D,IAAI,iBAAiB,GAAG;YACvB,IAAI,CAAC,OAAO,CAAC,cAAc,GAAG;QAC/B,OAAO;YACN,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;QACnB;QAEA,gEAAgE;QAChE,MAAM,OAAO,GAAG,iBAAiB,GAAG,CAAC;QACrC,MAAM,OAAO,GAAG,iBAAiB,GAAG,CAAC;QAErC,IAAI,aAAa,UAAU,IAAI,aAAa,UAAU,GAAG,GAAG;YAC3D,MAAM,aAAa,IAAI,CAAC,UAAU,CAAC,KAAK;YACxC,IAAI,YAAY;gBACd,WAAmB,UAAU,GAAG,aAAa,UAAU;gBACxD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;YACxB,OAAO;gBACN,MAAM,MAAM,IAAI,CAAC,6BAA6B,CAAC;gBAC/C,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,GAAG;gBAC1B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;gBAClB,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;YACxB;QACD,OAAO;YACN,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE;gBAC1B,MAAM,cAAc;oBAAE,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK;oBAAE,QAAQ,0JAAW,CAAC,QAAQ;gBAAC;gBAC7E,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACvB,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK;gBAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YAClD;QACD;QAEA,IAAI,aAAa,QAAQ,IAAI,aAAa,QAAQ,GAAG,GAAG;YACvD,MAAM,aAAa,IAAI,CAAC,UAAU,CAAC,KAAK;YACxC,IAAI,YAAY;gBACd,WAAmB,SAAS,GAAG,aAAa,QAAQ;gBACrD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;YACxB,OAAO;gBACN,MAAM,MAAM,IAAI,CAAC,2BAA2B,CAAC;gBAC7C,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,GAAG;gBAC1B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;gBAClB,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;YACxB;QACD,OAAO;YACN,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE;gBAC1B,MAAM,cAAc;oBAAE,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK;oBAAE,QAAQ,0JAAW,CAAC,QAAQ;gBAAC;gBAC7E,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;gBACvB,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK;gBAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YAClD;QACD;QAEA,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;QACvB,IAAI,CAAC,4BAA4B;IAEjC,sDAAsD;IACtD,sFAAsF;IACtF,uEAAuE;IACvE,8FAA8F;IAC/F;AACD"}},
    {"offset": {"line": 5269, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/chart/TVChartContainer.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { RealtimeDataFeed } from './RealtimeDataFeed';\nimport { ZuperiorBroker } from './ZuperiorBroker';\nimport { formatSymbolDisplay } from '@/lib/utils';\n\n\ndeclare global {\n    interface Window {\n        TradingView: any;\n        Datafeeds: any;\n        Brokers: any;\n        CustomDialogs: any;\n        tvWidget: any;\n        __GET_METAAPI_TOKEN__: any;\n        __OPEN_MODIFY_POSITION_MODAL__: any;\n    }\n}\n\nimport { useTrading } from '../../context/TradingContext';\nimport { useAccount } from '../../context/AccountContext';\n\nexport const TVChartContainer = () => {\n    const containerRef = useRef<HTMLDivElement>(null);\n    const brokerRef = useRef<any>(null);\n    const widgetRef = useRef<any>(null);\n    const { setModifyModalState, lastModification } = useTrading();\n    const { currentAccountId, getMetaApiToken } = useAccount();\n    const modifyModalPromiseResolve = useRef<((value: boolean) => void) | null>(null);\n\n    // Standalone state (Keeping symbol state from standalone for now, or should we use TradingContext symbol?)\n    // Let's use TradingContext symbol if available, otherwise fallback\n    const { symbol: ctxSymbol, setSymbol: ctxSetSymbol } = useTrading();\n    const [localSymbol, setLocalSymbol] = useState('XAUUSD'); // Default fallback\n\n    const activeSymbol = formatSymbolDisplay(ctxSymbol || localSymbol);\n    const setSymbol = ctxSetSymbol || setLocalSymbol;\n\n    // Expose openModifyPositionModal to window for Broker to use\n    const openModifyPositionModal = (position: any, brackets?: any) => {\n        const mappedPosition = {\n            ...position,\n            openPrice: position.avg_price || position.avgPrice || position.price || position.limitPrice || position.stopPrice,\n            currentPrice: position.currentPrice || position.price,\n            tp: brackets?.takeProfit || position.takeProfit || position.tp,\n            sl: brackets?.stopLoss || position.stopLoss || position.sl,\n            pl: position.profit || position.pl || '0.00',\n            volume: position.qty || position.volume,\n            flag: (position.symbol || '').toLowerCase().replace(/[^a-z0-9]/g, ''),\n            ticket: position.id, // Ensure ticket is set for orders\n        };\n        setModifyModalState({ isOpen: true, position: mappedPosition });\n        return new Promise<boolean>((resolve) => {\n            modifyModalPromiseResolve.current = resolve;\n        });\n    };\n\n    useEffect(() => {\n        if (typeof window !== 'undefined') {\n            (window as any).__OPEN_MODIFY_POSITION_MODAL__ = openModifyPositionModal;\n            (window as any).__SET_ORDER_PREVIEW__ = (previewData: any) => {\n                if (brokerRef.current && typeof brokerRef.current.setOrderPreview === 'function') {\n                    brokerRef.current.setOrderPreview(previewData);\n                }\n            };\n        }\n    }, [setModifyModalState]);\n\n    // Resolve the promise when the modal closes\n    const { modifyModalState } = useTrading();\n    useEffect(() => {\n        if (!modifyModalState.isOpen && modifyModalPromiseResolve.current) {\n            // If we have a pending promise and the modal closes\n            // Check if a modification was made (lastModification set) to determine success\n            // But usually just resolving 'false' or 'true' makes the chart proceed.\n            // If we resolve 'false', it cancels drag. If 'true', it generally accepts.\n            // If the user Saved, 'lastModification' is set, so we can assume success?\n            // Actually, if update is handled via broker.modifyEntity, the chart gets the update event.\n            // So for the *dialog result*, we can just say 'false' (cancel internal handling) or 'true'.\n            // If we return 'true', the chart might try to apply changes itself if we returned an object.\n            // But we return boolean.\n            // Let's resolve 'false' to ensure the chart doesn't do anything weird, \n            // relying on our explicit 'modifyEntity' call to update the order.\n            // Or if we return 'true', it might imply \"user confirmed\".\n\n            // NOTE: If we dragged, and then closed modal without saving, we want it to snap back.\n            // If we saved, our 'modifyEntity' will update the order, and chart will see the update.\n            // So resolving 'false' might be safer to prevent double-modification or stuck state?\n            // Let's try resolving true if lastModification is present, false otherwise.\n            const wasSaved = !!lastModification;\n            console.log('[TVChartContainer] Modal closed. Resolving hook promise:', wasSaved);\n            modifyModalPromiseResolve.current(wasSaved);\n            modifyModalPromiseResolve.current = null;\n        }\n    }, [modifyModalState.isOpen, lastModification]);\n\n    useEffect(() => {\n        if (lastModification && brokerRef.current) {\n            console.log('[TVChartContainer] lastModification received:', lastModification);\n\n            if (brokerRef.current.modifyEntity) {\n                brokerRef.current.modifyEntity(lastModification.id, lastModification)\n                    .catch((err: any) => console.error(err));\n            } else if (brokerRef.current.editPositionBrackets) {\n                // Fallback (legacy)\n                const sl = lastModification.sl ? parseFloat(lastModification.sl) : undefined;\n                const tp = lastModification.tp ? parseFloat(lastModification.tp) : undefined;\n                const modifiedBrackets = {\n                    ...(sl !== undefined && !isNaN(sl) ? { stopLoss: sl } : {}),\n                    ...(tp !== undefined && !isNaN(tp) ? { takeProfit: tp } : {}),\n                    _skipModal: true,\n                };\n                brokerRef.current.editPositionBrackets(lastModification.id, modifiedBrackets)\n                    .catch((err: any) => console.error(err));\n            }\n        }\n    }, [lastModification]);\n\n\n    useEffect(() => {\n        // Add version query parameter to force browser to reload standalone.js\n        // This ensures the browser uses the correct version that matches the bundles\n        const scripts = [\n            '/charting_library/charting_library.standalone.js?v=30.3.0',\n            '/datafeeds/udf/dist/bundle.js',\n            '/broker-sample/dist/bundle.js',\n            '/custom-dialogs/dist/bundle.js'\n        ];\n\n        const styles = [\n            '/custom-dialogs/dist/bundle.css'\n        ];\n\n\n\n        const initWidget = () => {\n            if (!window.TradingView || !window.Brokers || !window.CustomDialogs) {\n                return;\n            }\n\n\n\n            // Use our custom RealtimeDataFeed\n            const datafeed = new RealtimeDataFeed();\n\n            // Stub callbacks for CustomDialogs or Broker Sample\n            // The logic here is simplified to allow the chart to render\n            const onCancelOrderResultCallback = () => { };\n            const onCloseOrderResultCallback = () => { };\n            const onReversePositionResultCallback = () => { };\n            const onOrderResultCallback = () => { };\n            const onPositionResultCallback = () => { };\n\n            // We need to initialize these if we want usage of CustomDialogs from inside the bundle\n            // Ideally we should minimize reliance on CustomDialogs if we don't have the whole setup\n            // But if broker-sample bundle expects them, we initialize them.\n            // If they are missing from public/, this will fail.\n            // We copied `custom-dialogs` to public, so it should load.\n\n            let customOrderDialog: any = null;\n            let customPositionDialog: any = null;\n            let customCancelOrderDialog: any = null;\n            let customClosePositionDialog: any = null;\n            let customReversePositionDialog: any = null;\n\n            if (window.CustomDialogs) {\n                customCancelOrderDialog = window.CustomDialogs.createCancelOrderDialog(onCancelOrderResultCallback);\n                customClosePositionDialog = window.CustomDialogs.createClosePositionDialog(onCloseOrderResultCallback);\n                customReversePositionDialog = window.CustomDialogs.createReversePositionDialog(onReversePositionResultCallback);\n            }\n\n            const sendOrderRequest = (order: any) => { };\n            const sendModifyOrder = (order: any) => { };\n            const redrawChart = () => { };\n\n            let createCancelOrderButtonListener: any = null;\n            let createClosePositionButtonListener: any = null;\n            let createReversePositionButtonListener: any = null;\n\n            const widgetOptions = {\n                symbol: activeSymbol,\n                interval: '5',\n                container: containerRef.current!,\n                datafeed: datafeed,\n                library_path: '/charting_library/',\n                locale: 'en',\n                fullscreen: false,\n                autosize: true,\n                theme: 'Dark',\n                custom_css_url: '/charting_library/custom.css',\n                disabled_features: [\n                    'use_localstorage_for_settings',\n                    'widgetbar',\n                    'right_toolbar',\n                    'legend_show_volume',\n                    'header_symbol_search',\n                    'symbol_search_hot_key',\n                    'header_compare',\n                    'buy_sell_buttons',\n                    'objects_tree_widget',\n                    'trading_notifications',\n                    'trading_account_manager',\n                ],\n                enabled_features: [\n                    'study_templates',\n                    'order_panel',\n                    'trading_bracket_orders',\n                ],\n                charts_storage_url: 'https://saveload.tradingview.com',\n                charts_storage_api_version: '1.1',\n                client_id: 'trading_platform_demo',\n                user_id: 'public_user',\n                loading_screen: {\n                    backgroundColor: \"#02040d\",\n                },\n                overrides: {\n                    \"paneProperties.background\": \"#02040d\",\n                    \"paneProperties.backgroundType\": \"solid\",\n                    \"paneProperties.vertGridProperties.color\": \"#02040d\",\n                    \"paneProperties.horzGridProperties.color\": \"#02040d\",\n                    \"mainSeriesProperties.candleStyle.upColor\": \"#16A34A\",\n                    \"mainSeriesProperties.candleStyle.downColor\": \"#EF4444\",\n                    \"mainSeriesProperties.candleStyle.borderUpColor\": \"#16A34A\",\n                    \"mainSeriesProperties.candleStyle.borderDownColor\": \"#EF4444\",\n                    \"mainSeriesProperties.candleStyle.wickUpColor\": \"#16A34A\",\n                    \"mainSeriesProperties.candleStyle.wickDownColor\": \"#EF4444\",\n                },\n                toolbar_bg: '#02040d',\n\n                broker_factory: (host: any) => {\n                    // Pass getMetaApiToken to broker constructor to enable dynamic auth\n                    const broker = new ZuperiorBroker(host, datafeed, currentAccountId, getMetaApiToken);\n                    brokerRef.current = broker;\n\n                    // Setup dialogs if available\n                    if (window.CustomDialogs) {\n                        customOrderDialog = window.CustomDialogs.createOrderDialog(broker, onOrderResultCallback);\n                        customPositionDialog = window.CustomDialogs.createPositionDialog(broker, onPositionResultCallback);\n                        // createCancelOrderButtonListener = window.CustomDialogs.createCancelOrderButtonListenerFactory(broker);\n\n                        // Custom Close Position Listener: Bypass modal, call broker directly\n                        createClosePositionButtonListener = () => (positionId: string) => {\n                            console.log('[TVChartContainer] Custom close listener triggered for:', positionId);\n                            broker.closePosition(positionId)\n                                .then(() => console.log('Position closed successfully'))\n                                .catch((e: any) => console.error('Failed to close position', e));\n                        };\n\n                        // createReversePositionButtonListener = window.CustomDialogs.createReversePositionButtonListenerFactory(broker);\n                    }\n\n                    return broker;\n                },\n                broker_config: {\n                    configFlags: {\n                        // Position management flags\n                        supportPositions: true,\n                        supportPositionBrackets: true,\n                        supportIndividualPositionBrackets: true,\n                        supportModifyPosition: true,\n                        supportPLUpdate: true,\n                        supportClosePosition: true,\n                        supportReversePosition: false,\n                        supportNativeReversePosition: false,\n                        supportPositionNetting: false,\n                        supportPreviewClosePosition: false,\n\n                        // Order management flags\n                        supportOrders: true,\n                        supportOrderBrackets: true,\n                        supportModifyOrder: true,\n                        supportCancelOrder: true,\n                        supportCloseOrder: true,\n                        supportMarketBrackets: true,\n                        supportModifyOrderPrice: true,\n                        supportModifyOrderBrackets: true,\n                        supportIndividualOrderBrackets: true,\n                        supportAddBracketsToExistingOrder: true,\n                        supportAddBracketsToExistingPosition: true,\n                        supportCancelBrackets: true,\n                        supportMoveOrder: true,\n                        supportMoveOrderBrackets: true,\n                        supportMovePosition: true,\n                        supportMovePositionBrackets: true,\n                        supportEditAmount: true,\n                        supportDragToModify: true,\n\n                        // Order type flags\n                        supportStopLoss: true,\n                        supportStopOrders: true,\n                        supportStopLimitOrders: false,\n                        supportTrailingStop: true,\n                        supportMultiposition: true,\n\n                        // UI and other flags\n                        showQuantityInsteadOfAmount: true,\n                        supportDOM: false,\n                        supportSymbolSearch: false,\n                        supportStrictCheckingLimitOrderPrice: false,\n                        supportLevel2Data: false,\n                        supportReducePosition: false,\n                        supportWorkOrder: true,\n                        supportModifyPositionBrackets: true,\n                        supportModifyBrackets: true,\n                        supportGuaranteedStop: false,\n                        supportOrdersHistory: false,\n                        supportPlaceOrderPreview: true,\n                    },\n                    durations: [{ name: 'DAY', value: 'DAY' }, { name: 'GTT', value: 'GTT' }],\n                    customUI: {\n                        showOrderDialog: (order: any) => {\n                            console.log('[TVChartContainer] showOrderDialog called:', order);\n                            // Bypass modal for preview order\n                            if (order.id === 'PREVIEW_ORDER_ID') {\n                                return Promise.resolve(true);\n                            }\n                            // If order has an ID, it is an existing order being modified -> Use our modal\n                            if (order.id) {\n                                return openModifyPositionModal(order);\n                            }\n                            if (window.CustomDialogs) return window.CustomDialogs.showOrderDialog(customOrderDialog, order);\n                            return Promise.resolve(true);\n                        },\n                        showPositionDialog: (position: any, brackets: any) => {\n                            return openModifyPositionModal(position, brackets);\n                        },\n                        showPositionBracketsDialog: (position: any, brackets: any) => {\n                            return openModifyPositionModal(position, brackets);\n                        },\n                        showIndividualPositionBracketsDialog: (position: any, brackets: any) => {\n                            return openModifyPositionModal(position, brackets);\n                        },\n                        showCancelOrderDialog: (order: any) => {\n                            // SKIP MODAL: Call broker directly for instant cancel\n                            console.log('[TVChartContainer] Direct cancel triggered for order:', order.id);\n                            if (brokerRef.current) {\n                                brokerRef.current.cancelOrder(order.id)\n                                    .catch((e: any) => console.error('Direct cancel failed', e));\n                            }\n                            return Promise.resolve(true);\n                        },\n                        showClosePositionDialog: (position: any) => {\n                            // SKIP MODAL: Call broker directly for instant close\n                            console.log('[TVChartContainer] Direct close triggered for:', position.id);\n                            if (brokerRef.current) {\n                                brokerRef.current.closePosition(position.id)\n                                    .catch((e: any) => console.error('Direct close failed', e));\n                            }\n                            return Promise.resolve(true);\n                        },\n                        // Disable reverse dialog entirely\n                        showReversePositionDialog: () => Promise.resolve(false),\n                    }\n                }\n            };\n\n            const tvWidget = new window.TradingView.widget(widgetOptions);\n            widgetRef.current = tvWidget;\n            window.tvWidget = tvWidget;\n\n\n\n            tvWidget.onChartReady(() => {\n                tvWidget.activeChart().onSymbolChanged().subscribe(null, () => {\n                    const newSymbol = tvWidget.activeChart().symbol();\n                    if (setSymbol) setSymbol(newSymbol);\n                });\n\n                if (brokerRef.current && typeof brokerRef.current.setWidgetReady === 'function') {\n                    brokerRef.current.setWidgetReady(true);\n                }\n\n                // Subscribe to real-time dragging for preview sync\n                const chart = tvWidget.activeChart();\n\n                // onOrderMove fires when the user release or modifies the line\n                // We use a try-catch for robustness across different library builds\n                try {\n                    if (typeof (chart as any).onOrderMove === 'function') {\n                        (chart as any).onOrderMove().subscribe(null, (order: any) => {\n                            if (!order) return;\n                            if (brokerRef.current && order.id.toString().includes('PREVIEW_ORDER_ID')) {\n                                // TradingView can put the dragged price on different fields depending on line type\n                                const movedPriceRaw = order.price ?? order.limitPrice ?? order.stopPrice;\n                                const movedPrice = typeof movedPriceRaw === 'string' ? parseFloat(movedPriceRaw) : movedPriceRaw;\n                                if (movedPrice === undefined || Number.isNaN(movedPrice)) return;\n                                brokerRef.current.moveOrder(order.id, movedPrice);\n                            }\n                        });\n                    }\n\n                    if (typeof (chart as any).onPositionDrag === 'function') {\n                        (chart as any).onPositionDrag().subscribe(null, (pos: any) => {\n                            // Logic for position drag if needed\n                        });\n                    }\n                } catch (e) {\n                    console.error('[TVChartContainer] Error subscribing to chart events:', e);\n                }\n            });\n        };\n\n        const loadScript = (src: string) => {\n            return new Promise((resolve, reject) => {\n                const script = document.createElement('script');\n                script.src = src;\n                script.onload = resolve;\n                script.onerror = () => {\n                    reject(new Error(`Failed to load script: ${src}`));\n                };\n                document.head.appendChild(script);\n            });\n        };\n\n        const loadStyle = (href: string) => {\n            const link = document.createElement('link');\n            link.rel = 'stylesheet';\n            link.type = 'text/css';\n            link.href = href;\n            document.head.appendChild(link);\n        };\n\n        styles.forEach(loadStyle);\n\n        Promise.all(scripts.map(loadScript))\n            .then(() => {\n                initWidget();\n            })\n            .catch(err => {\n                console.error(\"Failed to load TradingView scripts\", err);\n            });\n\n        return () => {\n            if (brokerRef.current && typeof (brokerRef.current as any).__cleanup__ === 'function') {\n                (brokerRef.current as any).__cleanup__();\n            }\n            if (window.tvWidget) {\n                try {\n                    window.tvWidget.remove();\n                } catch (e) { }\n                window.tvWidget = null;\n            }\n        };\n    }, []);\n\n    // Effect to update broker account when it changes in context\n    useEffect(() => {\n        if (brokerRef.current && currentAccountId) {\n            if (typeof brokerRef.current.setAccountId === 'function') {\n                brokerRef.current.setAccountId(currentAccountId);\n            }\n            // Update token function if it changed\n            if (brokerRef.current.setMetaApiTokenFunction && getMetaApiToken) {\n                brokerRef.current.setMetaApiTokenFunction(getMetaApiToken);\n            }\n        }\n    }, [currentAccountId, getMetaApiToken]);\n\n    // Effect to update chart symbol when it changes in context (e.g. clicked in watchlist)\n    useEffect(() => {\n        if (activeSymbol && window.tvWidget) {\n            try {\n                const chart = window.tvWidget.activeChart();\n                if (chart) {\n                    const current = chart.symbol();\n                    // Determine if we need to update (ignore casing differences if broker handles them, but usually strict)\n                    if (current !== activeSymbol) {\n                        console.log('[TVChartContainer] Context symbol changed to', activeSymbol, 'updating chart...');\n                        chart.setSymbol(activeSymbol);\n                    }\n                }\n            } catch (e) {\n                console.warn('[TVChartContainer] Failed to set symbol', e);\n            }\n        }\n    }, [activeSymbol]);\n\n    return (\n        <div\n            ref={containerRef}\n            className=\"tv-chart-container\"\n            style={{ height: '100%', width: '100%' }}\n        />\n    );\n};\n\nexport default TVChartContainer;\n"],"names":[],"mappings":";;;;;;;AAEA;AAEA;AACA;AACA;AAeA;AACA;AAtBA;;;;;;;;AAwBO,MAAM,mBAAmB;IAC5B,MAAM,eAAe,IAAA,+MAAM,EAAiB;IAC5C,MAAM,YAAY,IAAA,+MAAM,EAAM;IAC9B,MAAM,YAAY,IAAA,+MAAM,EAAM;IAC9B,MAAM,EAAE,mBAAmB,EAAE,gBAAgB,EAAE,GAAG,IAAA,+IAAU;IAC5D,MAAM,EAAE,gBAAgB,EAAE,eAAe,EAAE,GAAG,IAAA,+IAAU;IACxD,MAAM,4BAA4B,IAAA,+MAAM,EAAoC;IAE5E,2GAA2G;IAC3G,mEAAmE;IACnE,MAAM,EAAE,QAAQ,SAAS,EAAE,WAAW,YAAY,EAAE,GAAG,IAAA,+IAAU;IACjE,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC,WAAW,mBAAmB;IAE7E,MAAM,eAAe,IAAA,0IAAmB,EAAC,aAAa;IACtD,MAAM,YAAY,gBAAgB;IAElC,6DAA6D;IAC7D,MAAM,0BAA0B,CAAC,UAAe;QAC5C,MAAM,iBAAiB;YACnB,GAAG,QAAQ;YACX,WAAW,SAAS,SAAS,IAAI,SAAS,QAAQ,IAAI,SAAS,KAAK,IAAI,SAAS,UAAU,IAAI,SAAS,SAAS;YACjH,cAAc,SAAS,YAAY,IAAI,SAAS,KAAK;YACrD,IAAI,UAAU,cAAc,SAAS,UAAU,IAAI,SAAS,EAAE;YAC9D,IAAI,UAAU,YAAY,SAAS,QAAQ,IAAI,SAAS,EAAE;YAC1D,IAAI,SAAS,MAAM,IAAI,SAAS,EAAE,IAAI;YACtC,QAAQ,SAAS,GAAG,IAAI,SAAS,MAAM;YACvC,MAAM,CAAC,SAAS,MAAM,IAAI,EAAE,EAAE,WAAW,GAAG,OAAO,CAAC,cAAc;YAClE,QAAQ,SAAS,EAAE;QACvB;QACA,oBAAoB;YAAE,QAAQ;YAAM,UAAU;QAAe;QAC7D,OAAO,IAAI,QAAiB,CAAC;YACzB,0BAA0B,OAAO,GAAG;QACxC;IACJ;IAEA,IAAA,kNAAS,EAAC;QACN;;IAQJ,GAAG;QAAC;KAAoB;IAExB,4CAA4C;IAC5C,MAAM,EAAE,gBAAgB,EAAE,GAAG,IAAA,+IAAU;IACvC,IAAA,kNAAS,EAAC;QACN,IAAI,CAAC,iBAAiB,MAAM,IAAI,0BAA0B,OAAO,EAAE;YAC/D,oDAAoD;YACpD,+EAA+E;YAC/E,wEAAwE;YACxE,2EAA2E;YAC3E,0EAA0E;YAC1E,2FAA2F;YAC3F,4FAA4F;YAC5F,6FAA6F;YAC7F,yBAAyB;YACzB,wEAAwE;YACxE,mEAAmE;YACnE,2DAA2D;YAE3D,sFAAsF;YACtF,wFAAwF;YACxF,qFAAqF;YACrF,4EAA4E;YAC5E,MAAM,WAAW,CAAC,CAAC;YACnB,QAAQ,GAAG,CAAC,4DAA4D;YACxE,0BAA0B,OAAO,CAAC;YAClC,0BAA0B,OAAO,GAAG;QACxC;IACJ,GAAG;QAAC,iBAAiB,MAAM;QAAE;KAAiB;IAE9C,IAAA,kNAAS,EAAC;QACN,IAAI,oBAAoB,UAAU,OAAO,EAAE;YACvC,QAAQ,GAAG,CAAC,iDAAiD;YAE7D,IAAI,UAAU,OAAO,CAAC,YAAY,EAAE;gBAChC,UAAU,OAAO,CAAC,YAAY,CAAC,iBAAiB,EAAE,EAAE,kBAC/C,KAAK,CAAC,CAAC,MAAa,QAAQ,KAAK,CAAC;YAC3C,OAAO,IAAI,UAAU,OAAO,CAAC,oBAAoB,EAAE;gBAC/C,oBAAoB;gBACpB,MAAM,KAAK,iBAAiB,EAAE,GAAG,WAAW,iBAAiB,EAAE,IAAI;gBACnE,MAAM,KAAK,iBAAiB,EAAE,GAAG,WAAW,iBAAiB,EAAE,IAAI;gBACnE,MAAM,mBAAmB;oBACrB,GAAI,OAAO,aAAa,CAAC,MAAM,MAAM;wBAAE,UAAU;oBAAG,IAAI,CAAC,CAAC;oBAC1D,GAAI,OAAO,aAAa,CAAC,MAAM,MAAM;wBAAE,YAAY;oBAAG,IAAI,CAAC,CAAC;oBAC5D,YAAY;gBAChB;gBACA,UAAU,OAAO,CAAC,oBAAoB,CAAC,iBAAiB,EAAE,EAAE,kBACvD,KAAK,CAAC,CAAC,MAAa,QAAQ,KAAK,CAAC;YAC3C;QACJ;IACJ,GAAG;QAAC;KAAiB;IAGrB,IAAA,kNAAS,EAAC;QACN,uEAAuE;QACvE,6EAA6E;QAC7E,MAAM,UAAU;YACZ;YACA;YACA;YACA;SACH;QAED,MAAM,SAAS;YACX;SACH;QAID,MAAM,aAAa;YACf,IAAI,CAAC,OAAO,WAAW,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO,aAAa,EAAE;gBACjE;YACJ;YAIA,kCAAkC;YAClC,MAAM,WAAW,IAAI,kKAAgB;YAErC,oDAAoD;YACpD,4DAA4D;YAC5D,MAAM,8BAA8B,KAAQ;YAC5C,MAAM,6BAA6B,KAAQ;YAC3C,MAAM,kCAAkC,KAAQ;YAChD,MAAM,wBAAwB,KAAQ;YACtC,MAAM,2BAA2B,KAAQ;YAEzC,uFAAuF;YACvF,wFAAwF;YACxF,gEAAgE;YAChE,oDAAoD;YACpD,2DAA2D;YAE3D,IAAI,oBAAyB;YAC7B,IAAI,uBAA4B;YAChC,IAAI,0BAA+B;YACnC,IAAI,4BAAiC;YACrC,IAAI,8BAAmC;YAEvC,IAAI,OAAO,aAAa,EAAE;gBACtB,0BAA0B,OAAO,aAAa,CAAC,uBAAuB,CAAC;gBACvE,4BAA4B,OAAO,aAAa,CAAC,yBAAyB,CAAC;gBAC3E,8BAA8B,OAAO,aAAa,CAAC,2BAA2B,CAAC;YACnF;YAEA,MAAM,mBAAmB,CAAC,SAAiB;YAC3C,MAAM,kBAAkB,CAAC,SAAiB;YAC1C,MAAM,cAAc,KAAQ;YAE5B,IAAI,kCAAuC;YAC3C,IAAI,oCAAyC;YAC7C,IAAI,sCAA2C;YAE/C,MAAM,gBAAgB;gBAClB,QAAQ;gBACR,UAAU;gBACV,WAAW,aAAa,OAAO;gBAC/B,UAAU;gBACV,cAAc;gBACd,QAAQ;gBACR,YAAY;gBACZ,UAAU;gBACV,OAAO;gBACP,gBAAgB;gBAChB,mBAAmB;oBACf;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;iBACH;gBACD,kBAAkB;oBACd;oBACA;oBACA;iBACH;gBACD,oBAAoB;gBACpB,4BAA4B;gBAC5B,WAAW;gBACX,SAAS;gBACT,gBAAgB;oBACZ,iBAAiB;gBACrB;gBACA,WAAW;oBACP,6BAA6B;oBAC7B,iCAAiC;oBACjC,2CAA2C;oBAC3C,2CAA2C;oBAC3C,4CAA4C;oBAC5C,8CAA8C;oBAC9C,kDAAkD;oBAClD,oDAAoD;oBACpD,gDAAgD;oBAChD,kDAAkD;gBACtD;gBACA,YAAY;gBAEZ,gBAAgB,CAAC;oBACb,oEAAoE;oBACpE,MAAM,SAAS,IAAI,8JAAc,CAAC,MAAM,UAAU,kBAAkB;oBACpE,UAAU,OAAO,GAAG;oBAEpB,6BAA6B;oBAC7B,IAAI,OAAO,aAAa,EAAE;wBACtB,oBAAoB,OAAO,aAAa,CAAC,iBAAiB,CAAC,QAAQ;wBACnE,uBAAuB,OAAO,aAAa,CAAC,oBAAoB,CAAC,QAAQ;wBACzE,yGAAyG;wBAEzG,qEAAqE;wBACrE,oCAAoC,IAAM,CAAC;gCACvC,QAAQ,GAAG,CAAC,2DAA2D;gCACvE,OAAO,aAAa,CAAC,YAChB,IAAI,CAAC,IAAM,QAAQ,GAAG,CAAC,iCACvB,KAAK,CAAC,CAAC,IAAW,QAAQ,KAAK,CAAC,4BAA4B;4BACrE;oBAEA,iHAAiH;oBACrH;oBAEA,OAAO;gBACX;gBACA,eAAe;oBACX,aAAa;wBACT,4BAA4B;wBAC5B,kBAAkB;wBAClB,yBAAyB;wBACzB,mCAAmC;wBACnC,uBAAuB;wBACvB,iBAAiB;wBACjB,sBAAsB;wBACtB,wBAAwB;wBACxB,8BAA8B;wBAC9B,wBAAwB;wBACxB,6BAA6B;wBAE7B,yBAAyB;wBACzB,eAAe;wBACf,sBAAsB;wBACtB,oBAAoB;wBACpB,oBAAoB;wBACpB,mBAAmB;wBACnB,uBAAuB;wBACvB,yBAAyB;wBACzB,4BAA4B;wBAC5B,gCAAgC;wBAChC,mCAAmC;wBACnC,sCAAsC;wBACtC,uBAAuB;wBACvB,kBAAkB;wBAClB,0BAA0B;wBAC1B,qBAAqB;wBACrB,6BAA6B;wBAC7B,mBAAmB;wBACnB,qBAAqB;wBAErB,mBAAmB;wBACnB,iBAAiB;wBACjB,mBAAmB;wBACnB,wBAAwB;wBACxB,qBAAqB;wBACrB,sBAAsB;wBAEtB,qBAAqB;wBACrB,6BAA6B;wBAC7B,YAAY;wBACZ,qBAAqB;wBACrB,sCAAsC;wBACtC,mBAAmB;wBACnB,uBAAuB;wBACvB,kBAAkB;wBAClB,+BAA+B;wBAC/B,uBAAuB;wBACvB,uBAAuB;wBACvB,sBAAsB;wBACtB,0BAA0B;oBAC9B;oBACA,WAAW;wBAAC;4BAAE,MAAM;4BAAO,OAAO;wBAAM;wBAAG;4BAAE,MAAM;4BAAO,OAAO;wBAAM;qBAAE;oBACzE,UAAU;wBACN,iBAAiB,CAAC;4BACd,QAAQ,GAAG,CAAC,8CAA8C;4BAC1D,iCAAiC;4BACjC,IAAI,MAAM,EAAE,KAAK,oBAAoB;gCACjC,OAAO,QAAQ,OAAO,CAAC;4BAC3B;4BACA,8EAA8E;4BAC9E,IAAI,MAAM,EAAE,EAAE;gCACV,OAAO,wBAAwB;4BACnC;4BACA,IAAI,OAAO,aAAa,EAAE,OAAO,OAAO,aAAa,CAAC,eAAe,CAAC,mBAAmB;4BACzF,OAAO,QAAQ,OAAO,CAAC;wBAC3B;wBACA,oBAAoB,CAAC,UAAe;4BAChC,OAAO,wBAAwB,UAAU;wBAC7C;wBACA,4BAA4B,CAAC,UAAe;4BACxC,OAAO,wBAAwB,UAAU;wBAC7C;wBACA,sCAAsC,CAAC,UAAe;4BAClD,OAAO,wBAAwB,UAAU;wBAC7C;wBACA,uBAAuB,CAAC;4BACpB,sDAAsD;4BACtD,QAAQ,GAAG,CAAC,yDAAyD,MAAM,EAAE;4BAC7E,IAAI,UAAU,OAAO,EAAE;gCACnB,UAAU,OAAO,CAAC,WAAW,CAAC,MAAM,EAAE,EACjC,KAAK,CAAC,CAAC,IAAW,QAAQ,KAAK,CAAC,wBAAwB;4BACjE;4BACA,OAAO,QAAQ,OAAO,CAAC;wBAC3B;wBACA,yBAAyB,CAAC;4BACtB,qDAAqD;4BACrD,QAAQ,GAAG,CAAC,kDAAkD,SAAS,EAAE;4BACzE,IAAI,UAAU,OAAO,EAAE;gCACnB,UAAU,OAAO,CAAC,aAAa,CAAC,SAAS,EAAE,EACtC,KAAK,CAAC,CAAC,IAAW,QAAQ,KAAK,CAAC,uBAAuB;4BAChE;4BACA,OAAO,QAAQ,OAAO,CAAC;wBAC3B;wBACA,kCAAkC;wBAClC,2BAA2B,IAAM,QAAQ,OAAO,CAAC;oBACrD;gBACJ;YACJ;YAEA,MAAM,WAAW,IAAI,OAAO,WAAW,CAAC,MAAM,CAAC;YAC/C,UAAU,OAAO,GAAG;YACpB,OAAO,QAAQ,GAAG;YAIlB,SAAS,YAAY,CAAC;gBAClB,SAAS,WAAW,GAAG,eAAe,GAAG,SAAS,CAAC,MAAM;oBACrD,MAAM,YAAY,SAAS,WAAW,GAAG,MAAM;oBAC/C,IAAI,WAAW,UAAU;gBAC7B;gBAEA,IAAI,UAAU,OAAO,IAAI,OAAO,UAAU,OAAO,CAAC,cAAc,KAAK,YAAY;oBAC7E,UAAU,OAAO,CAAC,cAAc,CAAC;gBACrC;gBAEA,mDAAmD;gBACnD,MAAM,QAAQ,SAAS,WAAW;gBAElC,+DAA+D;gBAC/D,oEAAoE;gBACpE,IAAI;oBACA,IAAI,OAAO,AAAC,MAAc,WAAW,KAAK,YAAY;wBACjD,MAAc,WAAW,GAAG,SAAS,CAAC,MAAM,CAAC;4BAC1C,IAAI,CAAC,OAAO;4BACZ,IAAI,UAAU,OAAO,IAAI,MAAM,EAAE,CAAC,QAAQ,GAAG,QAAQ,CAAC,qBAAqB;gCACvE,mFAAmF;gCACnF,MAAM,gBAAgB,MAAM,KAAK,IAAI,MAAM,UAAU,IAAI,MAAM,SAAS;gCACxE,MAAM,aAAa,OAAO,kBAAkB,WAAW,WAAW,iBAAiB;gCACnF,IAAI,eAAe,aAAa,OAAO,KAAK,CAAC,aAAa;gCAC1D,UAAU,OAAO,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE;4BAC1C;wBACJ;oBACJ;oBAEA,IAAI,OAAO,AAAC,MAAc,cAAc,KAAK,YAAY;wBACpD,MAAc,cAAc,GAAG,SAAS,CAAC,MAAM,CAAC;wBAC7C,oCAAoC;wBACxC;oBACJ;gBACJ,EAAE,OAAO,GAAG;oBACR,QAAQ,KAAK,CAAC,yDAAyD;gBAC3E;YACJ;QACJ;QAEA,MAAM,aAAa,CAAC;YAChB,OAAO,IAAI,QAAQ,CAAC,SAAS;gBACzB,MAAM,SAAS,SAAS,aAAa,CAAC;gBACtC,OAAO,GAAG,GAAG;gBACb,OAAO,MAAM,GAAG;gBAChB,OAAO,OAAO,GAAG;oBACb,OAAO,IAAI,MAAM,CAAC,uBAAuB,EAAE,KAAK;gBACpD;gBACA,SAAS,IAAI,CAAC,WAAW,CAAC;YAC9B;QACJ;QAEA,MAAM,YAAY,CAAC;YACf,MAAM,OAAO,SAAS,aAAa,CAAC;YACpC,KAAK,GAAG,GAAG;YACX,KAAK,IAAI,GAAG;YACZ,KAAK,IAAI,GAAG;YACZ,SAAS,IAAI,CAAC,WAAW,CAAC;QAC9B;QAEA,OAAO,OAAO,CAAC;QAEf,QAAQ,GAAG,CAAC,QAAQ,GAAG,CAAC,aACnB,IAAI,CAAC;YACF;QACJ,GACC,KAAK,CAAC,CAAA;YACH,QAAQ,KAAK,CAAC,sCAAsC;QACxD;QAEJ,OAAO;YACH,IAAI,UAAU,OAAO,IAAI,OAAO,AAAC,UAAU,OAAO,CAAS,WAAW,KAAK,YAAY;gBAClF,UAAU,OAAO,CAAS,WAAW;YAC1C;YACA,IAAI,OAAO,QAAQ,EAAE;gBACjB,IAAI;oBACA,OAAO,QAAQ,CAAC,MAAM;gBAC1B,EAAE,OAAO,GAAG,CAAE;gBACd,OAAO,QAAQ,GAAG;YACtB;QACJ;IACJ,GAAG,EAAE;IAEL,6DAA6D;IAC7D,IAAA,kNAAS,EAAC;QACN,IAAI,UAAU,OAAO,IAAI,kBAAkB;YACvC,IAAI,OAAO,UAAU,OAAO,CAAC,YAAY,KAAK,YAAY;gBACtD,UAAU,OAAO,CAAC,YAAY,CAAC;YACnC;YACA,sCAAsC;YACtC,IAAI,UAAU,OAAO,CAAC,uBAAuB,IAAI,iBAAiB;gBAC9D,UAAU,OAAO,CAAC,uBAAuB,CAAC;YAC9C;QACJ;IACJ,GAAG;QAAC;QAAkB;KAAgB;IAEtC,uFAAuF;IACvF,IAAA,kNAAS,EAAC;QACN,IAAI,gBAAgB,OAAO,QAAQ,EAAE;YACjC,IAAI;gBACA,MAAM,QAAQ,OAAO,QAAQ,CAAC,WAAW;gBACzC,IAAI,OAAO;oBACP,MAAM,UAAU,MAAM,MAAM;oBAC5B,wGAAwG;oBACxG,IAAI,YAAY,cAAc;wBAC1B,QAAQ,GAAG,CAAC,gDAAgD,cAAc;wBAC1E,MAAM,SAAS,CAAC;oBACpB;gBACJ;YACJ,EAAE,OAAO,GAAG;gBACR,QAAQ,IAAI,CAAC,2CAA2C;YAC5D;QACJ;IACJ,GAAG;QAAC;KAAa;IAEjB,qBACI,8OAAC;QACG,KAAK;QACL,WAAU;QACV,OAAO;YAAE,QAAQ;YAAQ,OAAO;QAAO;;;;;;AAGnD;uCAEe"}},
    {"offset": {"line": 5729, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/layout/ChartSection.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport TVChartContainer from '../chart/TVChartContainer';\n\nconst ChartSection = () => {\n    return (\n        <div className=\"flex-1 h-full overflow-hidden bg-[#0F0F0F]\">\n            <TVChartContainer />\n        </div>\n    );\n};\n\nexport default ChartSection;\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAKA,MAAM,eAAe;IACjB,qBACI,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC,0JAAgB;;;;;;;;;;AAG7B;uCAEe"}},
    {"offset": {"line": 5757, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/ui/input.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nfunction Input({ className, type, ...props }: React.ComponentProps<\"input\">) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        \"flex h-10 w-full min-w-0 rounded-md border border-white/8 bg-white/3 px-4 py-2 text-sm text-white\",\n        \"backdrop-blur-sm transition-all duration-200\",\n        \"placeholder:text-white/40\",\n        \"focus:outline-none focus:border-white/12 focus:bg-white/5\",\n        \"disabled:cursor-not-allowed disabled:opacity-50\",\n        \"file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-white\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAKA,SAAS,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC;IACzE,qBACE,8OAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,IAAA,yHAAE,EACX,qGACA,gDACA,6BACA,6DACA,mDACA,mFACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 5783, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/ui/tabs.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Tabs({\n  className,\n  ...props\n}: React.ComponentProps<typeof TabsPrimitive.Root>) {\n  return (\n    <TabsPrimitive.Root\n      data-slot=\"tabs\"\n      className={cn(\"flex flex-col gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction TabsList({\n  className,\n  ...props\n}: React.ComponentProps<typeof TabsPrimitive.List>) {\n  return (\n    <TabsPrimitive.List\n      data-slot=\"tabs-list\"\n      className={cn(\n        \"bg-white/5 text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction TabsTrigger({\n  className,\n  ...props\n}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {\n  return (\n    <TabsPrimitive.Trigger\n      data-slot=\"tabs-trigger\"\n      className={cn(\n        \"inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50\",\n        \"text-white/60 data-[state=active]:text-white data-[state=active]:bg-white/10\",\n        \"hover:text-white/80\",\n        \"[&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction TabsContent({\n  className,\n  ...props\n}: React.ComponentProps<typeof TabsPrimitive.Content>) {\n  return (\n    <TabsPrimitive.Content\n      data-slot=\"tabs-content\"\n      className={cn(\"flex-1 outline-none\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n"],"names":[],"mappings":";;;;;;;;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,KAAK,EACZ,SAAS,EACT,GAAG,OAC6C;IAChD,qBACE,8OAAC,wKAAkB;QACjB,aAAU;QACV,WAAW,IAAA,yHAAE,EAAC,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,SAAS,EAChB,SAAS,EACT,GAAG,OAC6C;IAChD,qBACE,8OAAC,wKAAkB;QACjB,aAAU;QACV,WAAW,IAAA,yHAAE,EACX,yGACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,8OAAC,2KAAqB;QACpB,aAAU;QACV,WAAW,IAAA,yHAAE,EACX,6PACA,gFACA,uBACA,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,8OAAC,2KAAqB;QACpB,aAAU;QACV,WAAW,IAAA,yHAAE,EAAC,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 5849, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/modals/OrderModeModal.tsx"],"sourcesContent":["\"use client\";\nimport { X } from 'lucide-react'\nimport { useState } from 'react'\n\nexport default function OrderModeModal({ isOpen, onClose, onConfirm, mode }) {\n  const [dontShowAgain, setDontShowAgain] = useState(false)\n\n  if (!isOpen) return null\n\n  const isRiskCalculator = mode === 'Risk calculator form'\n\n  return (\n    <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm\">\n      <div className=\"bg-background w-[500px] rounded-lg shadow-2xl border border-[#2a2f36] flex flex-col max-h-[90vh]\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between px-6 py-4 border-b border-[#2a2f36]\">\n          <h2 className=\"text-xl font-bold text-white\">\n            {isRiskCalculator ? 'Risk Calculator mode' : 'One-click trading mode'}\n          </h2>\n          <button onClick={onClose} className=\"text-gray-400 hover:text-white transition-colors\">\n            <X size={20} />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 overflow-y-auto text-[#c0c0c0] text-[14px] leading-relaxed space-y-4 custom-scrollbar\">\n          {isRiskCalculator ? (\n            <>\n              <p>\n                Selecting this option activates the Risk Calculator mode for order placement.\n              </p>\n              <p>\n                In this mode, position size is calculated automatically based on the specified Risk and Stop Loss level.\n              </p>\n              <p>\n                By enabling this mode, you understand that your market or pending orders will be submitted by clicking the Confirm button, using volume, calculated based on entered parameters.\n              </p>\n              <p>\n                You agree to accept all risks associated with the use of the order submission mode you have chosen, including, without limitation, the risk of errors, commissions or mistakes made in submitting any order.\n              </p>\n              <p>To place an order:</p>\n              <ul className=\"list-disc pl-5 space-y-1\">\n                <li>Specify preferred Risk value, this is the maximum amount of loss you are willing to tolerate should the order close by Stop Loss</li>\n                <li>Enter Stop Loss level at which you are willing to risk the specified amount</li>\n                <li>Optionally, specify Take Profit</li>\n                <li>Click on Confirm to place the order with specified Stop Loss and Take Profit, and calculated volume</li>\n              </ul>\n            </>\n          ) : (\n            <>\n              <p>\n                Selecting this option activates One-click Trading mode for order placement.\n              </p>\n              <p>\n                By enabling this mode, you understand that your market or limit orders will be submitted by clicking the bid or ask rate button, without any further order confirmation. You agree to accept all risks associated with the use of the order submission mode you have chosen, including, without limitation, the risk of errors, commissions or mistakes made in submitting any order.\n              </p>\n            </>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"px-6 py-4 border-t border-[#2a2f36] flex flex-col gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"checkbox\"\n              id=\"dont-show\"\n              checked={dontShowAgain}\n              onChange={(e) => setDontShowAgain(e.target.checked)}\n              className=\"w-4 h-4 rounded border-gray-600 bg-[#2a2f36] text-[#8b5cf6] focus:ring-0 focus:ring-offset-0 cursor-pointer\"\n            />\n            <label htmlFor=\"dont-show\" className=\"text-[14px] text-gray-400 cursor-pointer select-none\">\n              Don't show again\n            </label>\n          </div>\n\n          <div className=\"flex items-center justify-end gap-3\">\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 bg-[#2a2f36] hover:bg-[#363c45] text-white text-[14px] font-medium rounded transition-colors\"\n            >\n              Cancel\n            </button>\n            <button\n              onClick={() => onConfirm(dontShowAgain)}\n              className=\"px-4 py-2 bg-[#8b5cf6] hover:bg-[#7c3aed] text-white text-[14px] font-bold rounded transition-colors\"\n            >\n              Yes, proceed\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AAFA;;;;AAIe,SAAS,eAAe,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,IAAI,EAAE;IACzE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAC;IAEnD,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,mBAAmB,SAAS;IAElC,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BAEb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCACX,mBAAmB,yBAAyB;;;;;;sCAE/C,8OAAC;4BAAO,SAAS;4BAAS,WAAU;sCAClC,cAAA,8OAAC,iMAAC;gCAAC,MAAM;;;;;;;;;;;;;;;;;8BAKb,8OAAC;oBAAI,WAAU;8BACZ,iCACC;;0CACE,8OAAC;0CAAE;;;;;;0CAGH,8OAAC;0CAAE;;;;;;0CAGH,8OAAC;0CAAE;;;;;;0CAGH,8OAAC;0CAAE;;;;;;0CAGH,8OAAC;0CAAE;;;;;;0CACH,8OAAC;gCAAG,WAAU;;kDACZ,8OAAC;kDAAG;;;;;;kDACJ,8OAAC;kDAAG;;;;;;kDACJ,8OAAC;kDAAG;;;;;;kDACJ,8OAAC;kDAAG;;;;;;;;;;;;;qDAIR;;0CACE,8OAAC;0CAAE;;;;;;0CAGH,8OAAC;0CAAE;;;;;;;;;;;;;8BAQT,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCACC,MAAK;oCACL,IAAG;oCACH,SAAS;oCACT,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,OAAO;oCAClD,WAAU;;;;;;8CAEZ,8OAAC;oCAAM,SAAQ;oCAAY,WAAU;8CAAuD;;;;;;;;;;;;sCAK9F,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;8CAGD,8OAAC;oCACC,SAAS,IAAM,UAAU;oCACzB,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQb"}},
    {"offset": {"line": 6082, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/trading/OrderPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\"\nimport { X, Plus, Minus, HelpCircle } from \"lucide-react\"\nimport { cn, formatSymbolDisplay } from \"@/lib/utils\"\nimport { Input } from \"@/components/ui/input\"\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport Tooltip from \"@/components/ui/Tooltip\"\nimport FlagIcon from \"@/components/ui/FlagIcon\"\nimport { useTrading } from '../../context/TradingContext'\nimport { useWebSocket } from '../../context/WebSocketContext'\nimport { useAccount } from '../../context/AccountContext'\nimport { useInstruments } from '../../context/InstrumentContext'\nimport OrderModeModal from '../modals/OrderModeModal'\nimport ReactDOM from 'react-dom'\n\nexport interface OrderPanelProps extends React.HTMLAttributes<HTMLDivElement> {\n  onClose?: () => void\n  onBuy?: (data: OrderData) => void\n  onSell?: (data: OrderData) => void\n}\n\nexport interface OrderData {\n  orderType: \"market\" | \"pending\" | \"limit\"\n  pendingOrderType?: \"limit\" | \"stop\" // For pending orders: \"limit\" = Buy/Sell Limit, \"stop\" = Buy/Sell Stop\n  volume: number\n  openPrice?: number\n  stopLoss?: number\n  takeProfit?: number\n  risk?: number\n}\n\ntype FormType = \"one-click\" | \"regular\" | \"risk-calculator\"\n\nconst OrderPanel: React.FC<OrderPanelProps> = ({\n  onClose,\n  onBuy,\n  onSell,\n  className,\n  ...props\n}) => {\n  // Demo Mode: Disable all interactions\n  const disabledOverlay = \"pointer-events-none opacity-80 select-none\";\n  const { symbol } = useTrading()\n  const { subscribe, unsubscribe, lastQuotes, normalizeSymbol, isConnected } = useWebSocket()\n  const { currentBalance } = useAccount()\n  const { instruments } = useInstruments()\n  const [marketClosedToast, setMarketClosedToast] = React.useState<string | null>(null)\n\n  // Get real-time prices from WebSocket\n  const hubSymbol = React.useMemo(() => {\n    const s = (symbol || 'BTCUSD').replace('/', '');\n    // Convert trailing uppercase M or R to lowercase to match instrument feed\n    return s.replace(/M$/, 'm').replace(/R$/, 'r');\n  }, [symbol])\n\n  React.useEffect(() => {\n    if (hubSymbol) {\n      subscribe([hubSymbol])\n      return () => unsubscribe([hubSymbol])\n    }\n  }, [hubSymbol, subscribe, unsubscribe])\n\n  const quote = lastQuotes[normalizeSymbol(hubSymbol)] || lastQuotes[hubSymbol] || {}\n  const instrument = React.useMemo(() => {\n    const norm = normalizeSymbol(hubSymbol)\n    return instruments.find(i => normalizeSymbol(i.symbol) === norm || i.symbol === hubSymbol || i.symbol === symbol)\n  }, [hubSymbol, instruments, normalizeSymbol, symbol])\n\n  const isCrypto = React.useMemo(() => {\n    const cat = (instrument?.category || '').toLowerCase()\n    return cat.includes('crypto')\n  }, [instrument])\n  const isMarketClosed = React.useMemo(() => {\n    if (isCrypto) return false\n    const now = new Date()\n    const day = now.getUTCDay()\n    const minutes = now.getUTCHours() * 60 + now.getUTCMinutes()\n    const isWeekendClosed =\n      (day === 5 && minutes >= 21 * 60) ||\n      day === 6 ||\n      (day === 0 && minutes < 21 * 60 + 5)\n    return isWeekendClosed\n  }, [isCrypto])\n  const marketClosedMessage = \"Market closed for this instrument. Trading resumes Sunday 21:05 UTC.\"\n\n  // Use live prices if available, otherwise fall back to defaults\n  const currentSellPrice = quote.bid ?? 0\n  const currentBuyPrice = quote.ask ?? 0\n  const spreadVal = (quote.spread || 0) * 100\n  const currentSpread = `${spreadVal.toFixed(2)} pips`\n\n  const [formType, setFormType] = React.useState<FormType>(\"regular\")\n  const [orderType, setOrderType] = React.useState<\"market\" | \"limit\" | \"pending\">(\"market\")\n  const [pendingOrderType, setPendingOrderType] = React.useState<\"limit\" | \"stop\">(\"limit\") // For pending orders: limit or stop\n  const [volume, setVolume] = React.useState(\"0.01\")\n  const [risk, setRisk] = React.useState(\"\")\n  const [riskMode, setRiskMode] = React.useState<\"usd\" | \"percent\">(\"usd\")\n  const [takeProfit, setTakeProfit] = React.useState(\"\")\n  const [takeProfitMode, setTakeProfitMode] = React.useState<\"pips\" | \"price\">(\"price\")\n  const [stopLoss, setStopLoss] = React.useState(\"\")\n  const [stopLossMode, setStopLossMode] = React.useState<\"pips\" | \"price\">(\"price\")\n  const [openPrice, setOpenPrice] = React.useState(\"\")\n  const [showMoreDetails, setShowMoreDetails] = React.useState(false)\n  const [showOneClickModal, setShowOneClickModal] = React.useState(false)\n  const [showRiskCalculatorModal, setShowRiskCalculatorModal] = React.useState(false)\n  const [pendingFormType, setPendingFormType] = React.useState<FormType | null>(null)\n  const [pendingOrderSide, setPendingOrderSide] = React.useState<'buy' | 'sell' | null>(null)\n  const [isLoading, setIsLoading] = React.useState(false)\n  const isSyncingFromChart = React.useRef(false)\n  const lastPreviewData = React.useRef<string | null>(null)\n\n  // Check if user has dismissed the one-click modal\n  const shouldShowOneClickModal = React.useCallback(() => {\n    if (typeof window === 'undefined') return false\n    const dismissed = localStorage.getItem('zup_oneclick_modal_dismissed')\n    return dismissed !== 'true'\n  }, [])\n\n  // Check if user has dismissed the risk calculator modal\n  const shouldShowRiskCalculatorModal = React.useCallback(() => {\n    if (typeof window === 'undefined') return false\n    const dismissed = localStorage.getItem('zup_riskcalculator_modal_dismissed')\n    return dismissed !== 'true'\n  }, [])\n\n  // Handle form type change - show modal for one-click or risk calculator if needed\n  const handleFormTypeChange = React.useCallback((newFormType: FormType) => {\n    if (newFormType === \"one-click\" && shouldShowOneClickModal()) {\n      setPendingFormType(newFormType)\n      setShowOneClickModal(true)\n    } else if (newFormType === \"risk-calculator\" && shouldShowRiskCalculatorModal()) {\n      setPendingFormType(newFormType)\n      setShowRiskCalculatorModal(true)\n    } else {\n      setFormType(newFormType)\n    }\n  }, [shouldShowOneClickModal, shouldShowRiskCalculatorModal])\n\n  // Handle one-click modal confirmation\n  const handleOneClickModalConfirm = React.useCallback((dontShowAgain: boolean) => {\n    if (dontShowAgain && typeof window !== 'undefined') {\n      localStorage.setItem('zup_oneclick_modal_dismissed', 'true')\n    }\n    if (pendingFormType) {\n      setFormType(pendingFormType)\n      setPendingFormType(null)\n    }\n    setShowOneClickModal(false)\n  }, [pendingFormType])\n\n  // Ref for orderType to avoid stale usage in event listener\n  const orderTypeRef = React.useRef(orderType)\n  React.useEffect(() => {\n    orderTypeRef.current = orderType\n  }, [orderType])\n\n  // Ref to track the debounce timeout for clearing the sync flag\n  const syncTimeoutRef = React.useRef<NodeJS.Timeout | null>(null)\n\n  // Sync TP/SL from chart preview\n  React.useEffect(() => {\n    const handlePreviewChange = (e: any) => {\n      const { takeProfit: tp, stopLoss: sl, price, source } = e.detail || {}\n\n      // Prevent loops\n      if (source === 'panel') return;\n\n      // Start syncing: Cancel any pending clear\n      if (syncTimeoutRef.current) {\n        clearTimeout(syncTimeoutRef.current)\n        syncTimeoutRef.current = null\n      }\n      isSyncingFromChart.current = true\n\n      console.log('[OrderPanel] Syncing from chart:', e.detail);\n\n      try {\n        if (tp !== undefined) {\n          // If 0 or null, set empty\n          const val = (tp && tp > 0) ? tp.toFixed(5).replace(/\\.?0+$/, \"\") : \"\"\n          setTakeProfit(val)\n          if (val) setTakeProfitMode(\"price\")\n        }\n\n        if (sl !== undefined) {\n          const val = (sl && sl > 0) ? sl.toFixed(5).replace(/\\.?0+$/, \"\") : \"\"\n          setStopLoss(val)\n          if (val) setStopLossMode(\"price\")\n        }\n\n        if (price !== undefined) {\n          setOpenPrice(price.toFixed(5).replace(/\\.?0+$/, \"\"))\n          // Use ref to check current order type\n          if (orderTypeRef.current === 'market') {\n            setOrderType('pending');\n            setPendingOrderType('limit');\n          }\n        }\n      } finally {\n        // Debounce the clearing of the flag\n        syncTimeoutRef.current = setTimeout(() => {\n          isSyncingFromChart.current = false\n          syncTimeoutRef.current = null\n        }, 300)\n      }\n    }\n\n    if (typeof window !== 'undefined') {\n      (window as any).addEventListener('__ON_ORDER_PREVIEW_CHANGE__', handlePreviewChange)\n      return () => {\n        (window as any).removeEventListener('__ON_ORDER_PREVIEW_CHANGE__', handlePreviewChange)\n      }\n    }\n  }, [])\n\n  // TEST FUNCTION - Remove after debugging\n  React.useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      (window as any).testOrderPanelSync = () => {\n        console.log(\"[TEST] Manually triggering __ON_ORDER_PREVIEW_CHANGE__ event\");\n        window.dispatchEvent(new CustomEvent(\"__ON_ORDER_PREVIEW_CHANGE__\", {\n          detail: {\n            id: \"PREVIEW_ORDER_ID\",\n            price: 1.10000,\n            takeProfit: 1.10500,\n            stopLoss: 1.09500,\n            qty: 0.01,\n            source: \"chart\"\n          }\n        }));\n      };\n      console.log(\"[OrderPanel] Test function available: window.testOrderPanelSync()\");\n    }\n  }, []);\n\n\n  // Handle one-click modal cancel\n  const handleOneClickModalCancel = React.useCallback(() => {\n    setShowOneClickModal(false)\n    setPendingFormType(null)\n  }, [])\n\n  // Handle risk calculator modal confirmation\n  const handleRiskCalculatorModalConfirm = React.useCallback((dontShowAgain: boolean) => {\n    if (dontShowAgain && typeof window !== 'undefined') {\n      localStorage.setItem('zup_riskcalculator_modal_dismissed', 'true')\n    }\n    if (pendingFormType) {\n      setFormType(pendingFormType)\n      setPendingFormType(null)\n    }\n    setShowRiskCalculatorModal(false)\n  }, [pendingFormType])\n\n  // Handle risk calculator modal cancel\n  const handleRiskCalculatorModalCancel = React.useCallback(() => {\n    setShowRiskCalculatorModal(false)\n    setPendingFormType(null)\n  }, [])\n\n  // Update dropdown modes when form type changes\n  React.useEffect(() => {\n    if (formType === \"regular\") {\n      setTakeProfitMode(\"price\")\n      setStopLossMode(\"price\")\n    } else if (formType === \"risk-calculator\") {\n      setTakeProfitMode(\"pips\")\n      setStopLossMode(\"pips\")\n      setRiskMode(\"usd\")\n    }\n    // Reset pending order side when form type changes\n    setPendingOrderSide(null)\n  }, [formType])\n\n  // Trigger order preview on chart\n  React.useEffect(() => {\n    if (typeof window === 'undefined' || !(window as any).__SET_ORDER_PREVIEW__) return\n\n    // If we just got an update FROM the chart, don't send it back to the chart\n    if (isSyncingFromChart.current) return;\n\n    if (!pendingOrderSide) {\n      if (lastPreviewData.current !== 'null') {\n        (window as any).__SET_ORDER_PREVIEW__({ side: null })\n        lastPreviewData.current = 'null'\n      }\n      return\n    }\n\n    const previewPrice = orderType === 'market'\n      ? (pendingOrderSide === 'buy' ? currentBuyPrice : currentSellPrice)\n      : parseFloat(openPrice)\n\n    if (isNaN(previewPrice) || previewPrice <= 0) {\n      // If pending but no price, maybe show nothing or keep previous? \n      // Better to clear if invalid price\n      if (orderType !== 'market') {\n        (window as any).__SET_ORDER_PREVIEW__({ side: null })\n        return\n      }\n    }\n\n    const tpVal = parseFloat(takeProfit)\n    const slVal = parseFloat(stopLoss)\n    let tpPrice: number | undefined\n    let slPrice: number | undefined\n\n    if (!isNaN(tpVal) && tpVal > 0) {\n      if (takeProfitMode === 'price') {\n        tpPrice = tpVal\n      } else {\n        // Pips mode (pipSize * value)\n        const pipSize = getPipSize\n        const offset = tpVal * pipSize\n        tpPrice = pendingOrderSide === 'buy' ? previewPrice + offset : previewPrice - offset\n      }\n    }\n\n    if (!isNaN(slVal) && slVal > 0) {\n      if (stopLossMode === 'price') {\n        slPrice = slVal\n      } else {\n        const pipSize = getPipSize\n        const offset = slVal * pipSize\n        slPrice = pendingOrderSide === 'buy' ? previewPrice - offset : previewPrice + offset\n      }\n    }\n\n    // Directional validation (User request: TP must be below for Sell, above for Buy)\n    if (tpPrice !== undefined) {\n      const isValid = pendingOrderSide === 'buy' ? tpPrice > previewPrice : tpPrice < previewPrice\n      if (!isValid) tpPrice = undefined\n    }\n    if (slPrice !== undefined) {\n      const isValid = pendingOrderSide === 'buy' ? slPrice < previewPrice : slPrice > previewPrice\n      if (!isValid) slPrice = undefined\n    }\n\n    const previewPayload = {\n      symbol: symbol,\n      side: pendingOrderSide,\n      qty: parseFloat(volume) || 0.01,\n      price: previewPrice,\n      type: orderType === 'market' ? 'limit' : pendingOrderType,\n      takeProfit: tpPrice || 0,\n      stopLoss: slPrice || 0,\n      text: \" \"\n    }\n\n    // Dirty check: Only update if anything meaningful changed to avoid chart flicker\n    const payloadStr = JSON.stringify(previewPayload)\n    if (lastPreviewData.current === payloadStr) return\n    lastPreviewData.current = payloadStr;\n\n    (window as any).__SET_ORDER_PREVIEW__(previewPayload)\n  }, [pendingOrderSide, orderType, openPrice, volume, currentBuyPrice, currentSellPrice, symbol, pendingOrderType, takeProfit, stopLoss, takeProfitMode, stopLossMode])\n\n  // Get pip size based on symbol type\n  const getPipSize = React.useMemo(() => {\n    const symbolUpper = (symbol || '').toUpperCase()\n    const cat = (instrument?.category || '').toLowerCase()\n\n    if (symbolUpper.includes('JPY')) {\n      return 0.01\n    } else if (cat.includes('crypto') || symbolUpper.includes('BTC') || symbolUpper.includes('ETH')) {\n      return 1.00 // 1 point = 1 dollar\n    } else if (cat.includes('index') || cat.includes('indice') || symbolUpper.includes('US30') || symbolUpper.includes('SPX') || symbolUpper.includes('NAS')) {\n      return 1.00 // 1 point = 1 unit (4500 -> 4520 is 20 points)\n    } else if (cat.includes('metal') || symbolUpper.includes('XAU') || symbolUpper.includes('XAG')) {\n      return 1.00 // 1 point = 1 dollar (2500 -> 2520 is 20 points)\n    } else {\n      return 0.0001 // Forex default (0.0001 = 1 pip)\n    }\n  }, [symbol, instrument])\n\n  // Get default TP/SL offsets in \"points/pips\" (20 for all instruments as requested)\n  const getDefaultOffsets = React.useMemo(() => {\n    return { tp: 20, sl: 20 }\n  }, [])\n\n  // Get pip value per lot based on symbol type\n  const getPipValuePerLot = React.useMemo(() => {\n    const symbolUpper = (symbol || '').toUpperCase()\n    if (symbolUpper.includes('JPY')) {\n      return 10\n    } else if (symbolUpper.includes('XAU') || symbolUpper.includes('GOLD')) {\n      return 10\n    } else if (symbolUpper.includes('XAG') || symbolUpper.includes('SILVER')) {\n      return 10\n    } else if (symbolUpper.includes('BTC') || symbolUpper.includes('BTCUSD')) {\n      return getPipSize\n    } else if (symbolUpper.includes('ETH') || symbolUpper.includes('ETHUSD')) {\n      return getPipSize\n    } else {\n      return 10\n    }\n  }, [symbol, getPipSize])\n\n  // Calculate SL and TP prices from pips (for risk calculator)\n  const calculatePriceFromPips = React.useCallback((pips: number, isBuy: boolean, isStopLoss: boolean = false) => {\n    if (pips === null || pips === undefined || isNaN(pips)) return null\n    const pipSize = getPipSize\n    const priceChange = pips * pipSize\n    if (isBuy) {\n      return currentBuyPrice + priceChange\n    } else {\n      return currentSellPrice - priceChange\n    }\n  }, [getPipSize, currentBuyPrice, currentSellPrice])\n\n  // Auto-set TP/SL upon preview start OR symbol change\n  const lastProcessedSymbol = React.useRef(symbol)\n\n  React.useEffect(() => {\n    // If pendingOrderSide is active, we should show lines\n    if (pendingOrderSide) {\n      const offsets = getDefaultOffsets\n      const pipSize = getPipSize\n\n      // Calculate distances: \n      // For Forex (pipSize 0.0001), 20 * 0.0001 = 0.0020\n      // For Crypto (pipSize 1.00), 1000 * 1.00 = 1000\n      // For Metals/Indices (pipSize 1.00 or 0.01), 20 units\n      const tpDist = offsets.tp * pipSize\n      const slDist = offsets.sl * pipSize\n\n      let basePrice = 0\n      if (orderType === 'market') {\n        basePrice = pendingOrderSide === 'buy' ? currentBuyPrice : currentSellPrice\n      } else {\n        basePrice = parseFloat(openPrice) || 0\n      }\n\n      const isSymbolChanged = lastProcessedSymbol.current !== symbol\n      if (isSymbolChanged) {\n        lastProcessedSymbol.current = symbol\n      }\n\n      if (basePrice > 0) {\n        // Set TP/SL if missing OR if symbol just changed\n        if (!takeProfit || isSymbolChanged) {\n          const tp = pendingOrderSide === 'buy' ? basePrice + tpDist : basePrice - tpDist\n          setTakeProfit(tp.toFixed(instrument?.digits || 2).replace(/\\.?0+$/, \"\"))\n          setTakeProfitMode(\"price\")\n        }\n        if (!stopLoss || isSymbolChanged) {\n          const sl = pendingOrderSide === 'buy' ? basePrice - slDist : basePrice + slDist\n          setStopLoss(sl.toFixed(instrument?.digits || 2).replace(/\\.?0+$/, \"\"))\n          setStopLossMode(\"price\")\n        }\n      }\n    } else {\n      // If side is cleared (e.g. symbol changed but side not set), we can still prep values if we want\n      // but usually wait for side selection ('buy'/'sell')\n    }\n  }, [pendingOrderSide, symbol, currentBuyPrice, currentSellPrice, orderType, openPrice, getDefaultOffsets, getPipSize, instrument])\n\n  // Calculate volume for risk calculator based on Risk and Stop Loss\n  const calculateRiskBasedVolume = React.useMemo(() => {\n    if (formType !== \"risk-calculator\" || !risk || !stopLoss) {\n      return null\n    }\n\n    let riskAmount = parseFloat(risk)\n    // Handle risk in percentage\n    if (riskMode === \"percent\") {\n      const equity = currentBalance?.equity || 0\n      if (equity <= 0) return null\n      riskAmount = (riskAmount / 100) * equity\n    }\n\n    let stopLossPips = 0\n\n    if (stopLossMode === \"pips\") {\n      stopLossPips = Math.abs(parseFloat(stopLoss))\n    } else {\n      // stopLossMode === \"price\"\n      const slPrice = parseFloat(stopLoss)\n      if (isNaN(slPrice) || slPrice <= 0) return null\n\n      let entryPrice = 0\n      if (orderType === \"pending\" || orderType === \"limit\") {\n        entryPrice = openPrice ? parseFloat(openPrice) : 0\n      } else {\n        // For market orders, use mid price as estimation\n        entryPrice = (currentBuyPrice + currentSellPrice) / 2\n      }\n\n      if (entryPrice <= 0) return null\n\n      // Use pipSize from hook\n      const pipSize = getPipSize\n      stopLossPips = Math.abs(entryPrice - slPrice) / pipSize\n    }\n\n    if (!riskAmount || !stopLossPips || stopLossPips <= 0 || riskAmount <= 0) {\n      return null\n    }\n\n    const pipValuePerLot = getPipValuePerLot\n    const calculatedVolume = riskAmount / (stopLossPips * pipValuePerLot)\n    const clampedVolume = Math.max(0.01, Math.min(50.00, calculatedVolume))\n\n    return clampedVolume\n  }, [formType, risk, stopLoss, stopLossMode, riskMode, getPipValuePerLot, currentBalance, orderType, openPrice, currentBuyPrice, currentSellPrice, getPipSize])\n\n  // Calculate SL and TP prices from pips\n  const calculatedStopLossPrice = React.useMemo(() => {\n    if (formType !== \"risk-calculator\" || !stopLoss || stopLossMode !== \"pips\") return null\n    const pips = parseFloat(stopLoss)\n    if (isNaN(pips)) return null\n    return calculatePriceFromPips(pips, true, true)\n  }, [formType, stopLoss, stopLossMode, calculatePriceFromPips])\n\n  const calculatedTakeProfitPrice = React.useMemo(() => {\n    if (formType !== \"risk-calculator\" || !takeProfit || takeProfitMode !== \"pips\") return null\n    const pips = parseFloat(takeProfit)\n    if (isNaN(pips) || pips <= 0) return null\n    return calculatePriceFromPips(pips, true, false)\n  }, [formType, takeProfit, takeProfitMode, calculatePriceFromPips])\n\n  // Update volume when risk calculator values change\n  React.useEffect(() => {\n    if (formType === \"risk-calculator\" && calculateRiskBasedVolume !== null) {\n      setVolume(calculateRiskBasedVolume.toFixed(2))\n    }\n  }, [formType, calculateRiskBasedVolume])\n\n  const handleVolumeChange = (value: string) => {\n    if (value === '') {\n      setVolume('')\n      return\n    }\n\n    const trimmedValue = value.trim()\n\n    if (!/^[\\d.]*$/.test(trimmedValue) || (trimmedValue.match(/\\./g) || []).length > 1) {\n      return\n    }\n\n    const decimalIndex = trimmedValue.indexOf('.')\n    if (decimalIndex !== -1) {\n      const decimalPart = trimmedValue.substring(decimalIndex + 1)\n      if (decimalPart.length > 2) {\n        const truncated = trimmedValue.substring(0, decimalIndex + 3)\n        setVolume(truncated)\n        return\n      }\n    }\n\n    setVolume(trimmedValue)\n  }\n\n  const incrementVolume = () => {\n    const currentValue = parseFloat(volume) || 0.01\n    const roundedCurrent = Math.round(currentValue * 100) / 100\n    const newValue = Math.min(50.00, roundedCurrent + 0.01)\n    setVolume(newValue.toFixed(2))\n  }\n\n  const decrementVolume = () => {\n    const currentValue = parseFloat(volume) || 0.01\n    const roundedCurrent = Math.round(currentValue * 100) / 100\n    const newValue = Math.max(0.01, roundedCurrent - 0.01)\n    setVolume(newValue.toFixed(2))\n  }\n\n  const incrementField = (value: string, setter: (v: string) => void) => {\n    const basePrice = value && !isNaN(parseFloat(value)) ? parseFloat(value) : currentBuyPrice\n    setter((basePrice + 0.001).toFixed(3))\n  }\n\n  const decrementField = (value: string, setter: (v: string) => void) => {\n    const basePrice = value && !isNaN(parseFloat(value)) ? parseFloat(value) : currentBuyPrice\n    setter(Math.max(0, basePrice - 0.001).toFixed(3))\n  }\n\n  // Render buy/sell price buttons with spread overlay - solid backgrounds for one-click\n  const renderPriceButtonsSolid = () => (\n    <div className=\"relative grid grid-cols-2 gap-3\">\n      <button\n        onClick={async () => {\n          if (isMarketClosed) {\n            setMarketClosedToast(marketClosedMessage)\n            return\n          }\n          if (isLoading) return;\n          setPendingOrderSide('sell');\n          setIsLoading(true);\n          try {\n            onSell?.({\n              orderType,\n              pendingOrderType: orderType === \"pending\" ? pendingOrderType : undefined,\n              volume: parseFloat(volume),\n              openPrice: openPrice ? parseFloat(openPrice) : currentSellPrice,\n              stopLoss: undefined,\n              takeProfit: undefined,\n            });\n            setTimeout(() => {\n              setIsLoading(false);\n              setPendingOrderSide(null);\n            }, 1000);\n          } catch (err) {\n            setIsLoading(false);\n            setPendingOrderSide(null);\n          }\n        }}\n        disabled={isLoading}\n        className={cn(\n          \"rounded-md p-3 bg-[#FF5555] hover:bg-[#FF5555]/90 cursor-pointer text-left relative overflow-hidden transition-all text-white\",\n          isLoading && \"opacity-80\"\n        )}\n      >\n        {isLoading && pendingOrderSide === 'sell' && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-[1px] z-10\">\n            <div className=\"flex gap-1\">\n              {[0, 1, 2].map((i) => (\n                <div\n                  key={i}\n                  className=\"w-1.5 h-1.5 bg-white rounded-full opacity-80\"\n                />\n              ))}\n            </div>\n          </div>\n        )}\n        <div className=\"text-xs text-white/80 mb-1\">Sell</div>\n        <div className=\"price-font text-white font-bold text-sm leading-tight\">\n          {Math.floor(currentSellPrice).toLocaleString()}\n          <span className=\"text-lg\">.{String(Math.floor((currentSellPrice % 1) * 100)).padStart(2, '0')}</span>\n          <sup className=\"text-sm\">{String(Math.floor((currentSellPrice % 1) * 1000) % 10)}</sup>\n        </div>\n      </button>\n\n      <button\n        onClick={async () => {\n          if (isMarketClosed) {\n            setMarketClosedToast(marketClosedMessage)\n            return\n          }\n          if (isLoading) return;\n          setPendingOrderSide('buy');\n          setIsLoading(true);\n          try {\n            onBuy?.({\n              orderType,\n              pendingOrderType: orderType === \"pending\" ? pendingOrderType : undefined,\n              volume: parseFloat(volume),\n              openPrice: openPrice ? parseFloat(openPrice) : currentBuyPrice,\n              stopLoss: undefined,\n              takeProfit: undefined,\n            });\n            setTimeout(() => {\n              setIsLoading(false);\n              setPendingOrderSide(null);\n            }, 1000);\n          } catch (err) {\n            setIsLoading(false);\n            setPendingOrderSide(null);\n          }\n        }}\n        disabled={isLoading}\n        className={cn(\n          \"rounded-md p-3 bg-[#4A9EFF] hover:bg-[#4A9EFF]/90 cursor-pointer text-right relative overflow-hidden transition-all text-white\",\n          isLoading && \"opacity-80\"\n        )}\n      >\n        {isLoading && pendingOrderSide === 'buy' && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-[1px] z-10\">\n            <div className=\"flex gap-1\">\n              {[0, 1, 2].map((i) => (\n                <div\n                  key={i}\n                  className=\"w-1.5 h-1.5 bg-white rounded-full opacity-80\"\n                />\n              ))}\n            </div>\n          </div>\n        )}\n        <div className=\"text-xs text-white/80 mb-1\">Buy</div>\n        <div className=\"price-font text-white font-bold text-sm leading-tight\">\n          {Math.floor(currentBuyPrice).toLocaleString()}\n          <span className=\"text-lg\">.{String(Math.floor((currentBuyPrice % 1) * 100)).padStart(2, '0')}</span>\n          <sup className=\"text-sm\">{String(Math.floor((currentBuyPrice % 1) * 1000) % 10)}</sup>\n        </div>\n      </button>\n\n      <div className=\"absolute left-1/2 bottom-0 -translate-x-1/2 px-2 py-0.5 rounded backdrop-blur-xl bg-white/[0.03] border border-white/10 text-[10px] text-white/80 font-medium whitespace-nowrap z-10\">\n        {currentSpread} {isConnected && <span className=\"text-green-500 ml-1\">‚óè</span>}\n      </div>\n    </div>\n  )\n\n  // Render buy/sell price buttons with spread overlay - bordered for regular/risk calculator\n  // In regular form, clicking these buttons sets pendingOrderSide to show confirmation\n  const renderPriceButtonsBordered = (readOnly: boolean = false, showConfirmation: boolean = false) => {\n    const finalVolume = formType === \"risk-calculator\" && calculateRiskBasedVolume !== null\n      ? calculateRiskBasedVolume\n      : (parseFloat(volume) || 0.01)\n\n    let finalStopLoss: number | undefined = undefined\n    let finalTakeProfit: number | undefined = undefined\n\n    if (formType === \"risk-calculator\") {\n      if (stopLossMode === \"price\") {\n        finalStopLoss = stopLoss ? parseFloat(stopLoss) : undefined\n      } else {\n        finalStopLoss = calculatedStopLossPrice ?? undefined\n      }\n\n      if (takeProfitMode === \"price\") {\n        finalTakeProfit = takeProfit ? parseFloat(takeProfit) : undefined\n      } else {\n        finalTakeProfit = calculatedTakeProfitPrice ?? undefined\n      }\n    } else {\n      // Regular form: convert pips to price if needed\n      if (stopLoss) {\n        if (stopLossMode === \"price\") {\n          finalStopLoss = parseFloat(stopLoss)\n        } else if (stopLossMode === \"pips\") {\n          // Convert pips to price - for buy orders, negative pips means price goes down (SL below entry)\n          // For sell orders, positive pips means price goes up (SL above entry)\n          const pips = parseFloat(stopLoss)\n          if (!isNaN(pips)) {\n            const pipSize = getPipSize\n            const priceChange = pips * pipSize\n            // Use buy price as base for calculation (will be adjusted based on order side in API)\n            finalStopLoss = currentBuyPrice + priceChange\n          }\n        }\n      }\n\n      if (takeProfit) {\n        if (takeProfitMode === \"price\") {\n          finalTakeProfit = parseFloat(takeProfit)\n        } else if (takeProfitMode === \"pips\") {\n          // Convert pips to price - for buy orders, positive pips means price goes up (TP above entry)\n          // For sell orders, negative pips means price goes down (TP below entry)\n          const pips = parseFloat(takeProfit)\n          if (!isNaN(pips) && pips > 0) {\n            const pipSize = getPipSize\n            const priceChange = pips * pipSize\n            // Use buy price as base for calculation\n            finalTakeProfit = currentBuyPrice + priceChange\n          }\n        }\n      }\n    }\n\n    const finalOpenPrice = orderType !== \"market\" && openPrice\n      ? parseFloat(openPrice)\n      : undefined\n\n    // Use violet for risk calculator form buttons, keep red/blue for regular form\n    const isRiskCalculator = formType === \"risk-calculator\"\n    const sellButtonBorder = isRiskCalculator ? 'border-[#8b5cf6]' : 'border-[#FF5555]'\n    const sellButtonHover = isRiskCalculator ? 'hover:bg-[#8b5cf6]/10' : 'hover:bg-[#FF5555]/10'\n    const buyButtonBorder = isRiskCalculator ? 'border-[#8b5cf6]' : 'border-[#4A9EFF]'\n    const buyButtonHover = isRiskCalculator ? 'hover:bg-[#8b5cf6]/10' : 'hover:bg-[#4A9EFF]/10'\n    const sellButtonTextColor = isRiskCalculator ? 'text-[#8b5cf6]' : 'text-[#FF5555]'\n    const buyButtonTextColor = isRiskCalculator ? 'text-[#8b5cf6]' : 'text-[#4A9EFF]'\n\n    return (\n      <div className=\"relative grid grid-cols-2 gap-3\">\n        <button\n          type=\"button\"\n          className={`rounded-md p-3 border-2 ${sellButtonBorder} bg-transparent ${readOnly ? '' : sellButtonHover} text-left cursor-pointer`}\n          onClick={readOnly ? undefined : () => {\n            if (isMarketClosed) {\n              setMarketClosedToast(marketClosedMessage)\n              return\n            }\n            if (showConfirmation) {\n              // In regular form, set pending order side to show confirmation\n              setPendingOrderSide('sell')\n            } else {\n              // In risk calculator or pending orders, place order directly\n              if (!onSell) return\n              if (!finalVolume || finalVolume <= 0) {\n                return\n              }\n              // For pending orders, validate that openPrice is provided\n              if (orderType === 'pending' && !finalOpenPrice) {\n                alert('Please enter an open price for pending orders')\n                return\n              }\n\n              // Calculate Sell-specific SL/TP if in Pips mode\n              let sellStopLoss = finalStopLoss\n              let sellTakeProfit = finalTakeProfit\n\n              if (formType === \"risk-calculator\" && stopLossMode === \"pips\" && stopLoss) {\n                const pips = parseFloat(stopLoss)\n                if (!isNaN(pips)) {\n                  const pipSize = getPipSize\n                  // For Sell: SL is ABOVE entry (Entry + Pips)\n                  const entry = orderType === 'market' ? currentSellPrice : (finalOpenPrice || 0)\n                  sellStopLoss = entry + (pips * pipSize)\n                }\n              }\n\n              if (formType === \"risk-calculator\" && takeProfitMode === \"pips\" && takeProfit) {\n                const pips = parseFloat(takeProfit)\n                if (!isNaN(pips) && pips > 0) {\n                  const pipSize = getPipSize\n                  // For Sell: TP is BELOW entry (Entry - Pips)\n                  const entry = orderType === 'market' ? currentSellPrice : (finalOpenPrice || 0)\n                  sellTakeProfit = entry - (pips * pipSize)\n                }\n              }\n\n              const orderData: OrderData = {\n                orderType,\n                pendingOrderType: orderType === \"pending\" ? pendingOrderType : undefined,\n                volume: finalVolume,\n                openPrice: orderType === 'market' ? currentSellPrice : finalOpenPrice,\n                stopLoss: sellStopLoss,\n                takeProfit: sellTakeProfit,\n              }\n              onSell(orderData)\n            }\n          }}\n          disabled={readOnly}\n        >\n          <div className=\"text-xs text-white/60 mb-1\">Sell</div>\n          <div className={`price-font ${sellButtonTextColor} font-bold text-sm leading-tight`}>\n            {Math.floor(currentSellPrice).toLocaleString()}\n            <span className=\"text-lg\">.{String(Math.floor((currentSellPrice % 1) * 100)).padStart(2, '0')}</span>\n            <sup className=\"text-sm\">{String(Math.floor((currentSellPrice % 1) * 1000) % 10)}</sup>\n          </div>\n        </button>\n\n        <button\n          type=\"button\"\n          className={`rounded-md p-3 border-2 ${buyButtonBorder} bg-transparent ${readOnly ? '' : buyButtonHover} text-right cursor-pointer`}\n          onClick={readOnly ? undefined : () => {\n            if (isMarketClosed) {\n              setMarketClosedToast(marketClosedMessage)\n              return\n            }\n            if (showConfirmation) {\n              // In regular form, set pending order side to show confirmation\n              setPendingOrderSide('buy')\n            } else {\n              // In risk calculator or pending orders, place order directly\n              if (!onBuy) return\n              if (!finalVolume || finalVolume <= 0) {\n                return\n              }\n              // For pending orders, validate that openPrice is provided\n              if (orderType === 'pending' && !finalOpenPrice) {\n                alert('Please enter an open price for pending orders')\n                return\n              }\n\n              // Calculate Buy-specific SL/TP if in Pips mode\n              let buyStopLoss = finalStopLoss\n              let buyTakeProfit = finalTakeProfit\n\n              if (formType === \"risk-calculator\" && stopLossMode === \"pips\" && stopLoss) {\n                const pips = parseFloat(stopLoss)\n                if (!isNaN(pips)) {\n                  const pipSize = getPipSize\n                  // For Buy: SL is BELOW entry (Entry - Pips)\n                  const entry = orderType === 'market' ? currentBuyPrice : (finalOpenPrice || 0)\n                  buyStopLoss = entry - (pips * pipSize)\n                }\n              }\n\n              if (formType === \"risk-calculator\" && takeProfitMode === \"pips\" && takeProfit) {\n                const pips = parseFloat(takeProfit)\n                if (!isNaN(pips) && pips > 0) {\n                  const pipSize = getPipSize\n                  // For Buy: TP is ABOVE entry (Entry + Pips)\n                  const entry = orderType === 'market' ? currentBuyPrice : (finalOpenPrice || 0)\n                  buyTakeProfit = entry + (pips * pipSize)\n                }\n              }\n\n              const orderData: OrderData = {\n                orderType,\n                pendingOrderType: orderType === \"pending\" ? pendingOrderType : undefined,\n                volume: finalVolume,\n                openPrice: orderType === 'market' ? currentBuyPrice : finalOpenPrice,\n                stopLoss: buyStopLoss,\n                takeProfit: buyTakeProfit,\n              }\n              onBuy(orderData)\n            }\n          }}\n          disabled={readOnly}\n        >\n          <div className=\"text-xs text-white/60 mb-1\">Buy</div>\n          <div className={`price-font ${buyButtonTextColor} font-bold text-sm leading-tight`}>\n            {Math.floor(currentBuyPrice).toLocaleString()}\n            <span className=\"text-lg\">.{String(Math.floor((currentBuyPrice % 1) * 100)).padStart(2, '0')}</span>\n            <sup className=\"text-sm\">{String(Math.floor((currentBuyPrice % 1) * 1000) % 10)}</sup>\n          </div>\n        </button>\n\n        <div className=\"absolute left-1/2 bottom-0 -translate-x-1/2 px-2 py-0.5 rounded backdrop-blur-xl bg-white/[0.03] border border-white/10 text-[10px] text-white/80 font-medium whitespace-nowrap z-10\">\n          {currentSpread} {isConnected && <span className=\"text-green-500 ml-1\">‚óè</span>}\n        </div>\n      </div>\n    )\n  }\n\n  // Simple toast for market closed\n  const renderMarketClosedToast = () => {\n    if (!marketClosedToast) return null\n    return ReactDOM.createPortal(\n      <div className=\"fixed bottom-4 left-4 z-[99999] bg-[#0b0e14] text-[#d1d5db] rounded-md shadow-lg border border-amber-500/60 w-[320px] overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-300\">\n        <div className=\"p-4 relative\">\n          <button\n            onClick={() => setMarketClosedToast(null)}\n            className=\"absolute top-2 right-2 text-[#9ca3af] hover:text-white transition-colors\"\n          >\n            √ó\n          </button>\n          <div className=\"flex items-start gap-3\">\n            <div className=\"mt-0.5 text-amber-400\">‚ö†</div>\n            <div className=\"flex-1\">\n              <h3 className=\"text-white font-medium text-[14px] leading-tight mb-1\">Market closed</h3>\n              <p className=\"text-[13px] text-[#d1d5db]\">{marketClosedMessage}</p>\n            </div>\n          </div>\n        </div>\n      </div>,\n      document.body\n    )\n  }\n\n  // Calculate financial metrics in real-time\n  const calculateFinancialMetrics = React.useMemo(() => {\n    const vol = parseFloat(volume) || 0\n    const price = orderType === \"limit\" && openPrice ? parseFloat(openPrice) : currentBuyPrice\n    const symbolUpper = (symbol || '').toUpperCase()\n\n    let contractSize = 100000\n    let pipValue = 0.0001\n\n    if (symbolUpper.includes('XAU') || symbolUpper.includes('XAG')) {\n      contractSize = 100\n      pipValue = 0.01\n    } else if (symbolUpper.includes('BTC') || symbolUpper.includes('ETH')) {\n      contractSize = 1\n      pipValue = 0.01\n    } else {\n      contractSize = 100000\n      pipValue = symbolUpper.includes('JPY') ? 0.01 : 0.0001\n    }\n\n    const leverageStr = String(currentBalance?.leverage || \"1:2000\")\n    // Correctly parse leverage from strings like \"1:2000\" or \"2000\"\n    const leverageMatch = leverageStr.match(/(\\d+)$/)\n    const leverage = leverageMatch ? parseInt(leverageMatch[1], 10) : 2000\n\n    const margin = (vol * contractSize * price) / leverage\n    const tradeValue = vol * contractSize * price\n    const spread = (quote.spread || 0) * 100\n    const fees = vol * spread * 10\n    const calculatedPipValue = contractSize * pipValue * vol\n    const swapLong = -(tradeValue * 0.0001)\n    const swapShort = 0\n    const volumeInUnits = vol * contractSize\n    const volumeInUSD = tradeValue\n    const credit = currentBalance?.credit || 0\n\n    return {\n      fees,\n      leverage: `1:${leverage}`,\n      margin,\n      swapLong,\n      swapShort,\n      pipValue: calculatedPipValue,\n      volumeInUnits,\n      volumeInUSD,\n      credit\n    }\n  }, [volume, currentBuyPrice, openPrice, orderType, symbol, currentBalance, quote.spread])\n\n  // Render financial details section\n  const renderFinancialDetails = () => (\n    <div className=\"space-y-2 pt-2 border-t border-white/10\">\n      <div className=\"flex items-center justify-between text-xs\">\n        <span className=\"text-white/60\">Fees:</span>\n        <div className=\"flex items-center gap-1\">\n          <span className=\"text-white price-font\">‚âà {calculateFinancialMetrics.fees.toFixed(2)} USD</span>\n          <Tooltip text=\"Estimated commission and spread costs\">\n            <HelpCircle className=\"h-3 w-3 text-white/40\" />\n          </Tooltip>\n        </div>\n      </div>\n\n      <div className=\"flex items-center justify-between text-xs\">\n        <span className=\"text-white/60\">Leverage:</span>\n        <div className=\"flex items-center gap-1\">\n          <span className=\"text-white price-font\">{calculateFinancialMetrics.leverage.startsWith('1:') ? calculateFinancialMetrics.leverage : `1:${calculateFinancialMetrics.leverage}`}</span>\n          <Tooltip text=\"Account leverage ratio\">\n            <HelpCircle className=\"h-3 w-3 text-white/40\" />\n          </Tooltip>\n        </div>\n      </div>\n\n      <div className=\"flex items-center justify-between text-xs\">\n        <span className=\"text-white/60\">Margin:</span>\n        <span className=\"text-white price-font\">{calculateFinancialMetrics.margin.toFixed(2)} USD</span>\n      </div>\n\n      {showMoreDetails && (\n        <>\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-white/60\">Swap Long:</span>\n            <div className=\"flex items-center gap-1\">\n              <span className=\"text-white price-font\">{calculateFinancialMetrics.swapLong.toFixed(2)} USD</span>\n              <Tooltip text=\"Overnight swap for long positions\">\n                <HelpCircle className=\"h-3 w-3 text-white/40\" />\n              </Tooltip>\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-white/60\">Swap Short:</span>\n            <div className=\"flex items-center gap-1\">\n              <span className=\"text-white price-font\">{calculateFinancialMetrics.swapShort.toFixed(2)} USD</span>\n              <Tooltip text=\"Overnight swap for short positions\">\n                <HelpCircle className=\"h-3 w-3 text-white/40\" />\n              </Tooltip>\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-white/60\">Pip Value:</span>\n            <span className=\"text-white price-font\">{calculateFinancialMetrics.pipValue.toFixed(2)} USD</span>\n          </div>\n\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-white/60\">Volume in units:</span>\n            <span className=\"text-white price-font\">{calculateFinancialMetrics.volumeInUnits.toFixed(2)} {symbol?.toUpperCase().includes('BTC') ? 'BTC' : symbol?.toUpperCase().includes('ETH') ? 'ETH' : symbol?.toUpperCase().includes('XAU') ? 'oz' : ''}</span>\n          </div>\n\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-white/60\">Volume in USD:</span>\n            <span className=\"text-white price-font\">{calculateFinancialMetrics.volumeInUSD.toFixed(2)} USD</span>\n          </div>\n\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-white/60\">Credit:</span>\n            <span className=\"text-white price-font\">{calculateFinancialMetrics.credit.toFixed(2)} USD</span>\n          </div>\n        </>\n      )}\n\n      <button\n        onClick={() => setShowMoreDetails(!showMoreDetails)}\n        className=\"w-full flex items-center justify-center gap-1 text-xs text-white/60 hover:text-white/80 pt-1\"\n      >\n        {showMoreDetails ? (\n          <>\n            <span>Less</span>\n            <svg className=\"h-3 w-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\n            </svg>\n          </>\n        ) : (\n          <>\n            <span>More</span>\n            <svg className=\"h-3 w-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n            </svg>\n          </>\n        )}\n      </button>\n    </div>\n  )\n\n  // Render input field with dropdown and +/- buttons\n  const renderInputField = (\n    label: string,\n    value: string,\n    onChange: (v: string) => void,\n    mode: string,\n    onModeChange: (v: string) => void,\n    modeOptions: { value: string; label: string }[],\n    showTooltip?: boolean\n  ) => (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"text-xs font-medium text-white/80\">{label}</div>\n        {showTooltip && (\n          <Tooltip text={`Set ${label.toLowerCase()}`}>\n            <HelpCircle className=\"h-3.5 w-3.5 text-white/40\" />\n          </Tooltip>\n        )}\n      </div>\n      <div className=\"flex items-stretch border border-white/10 rounded-md overflow-hidden bg-white/[0.02] focus-within:border-[#8B5CF6]\">\n        <Input\n          type=\"number\"\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder=\"Not set\"\n          className=\"flex-1 border-0 bg-transparent text-center price-font text-sm h-9 focus-visible:ring-0 focus-visible:ring-offset-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder:text-white/40\"\n        />\n        <select value={mode} onChange={(e) => onModeChange(e.target.value)} className=\"w-[70px] border-0 h-9 bg-transparent text-xs text-white focus:outline-none focus:ring-0\">\n          {modeOptions.map(opt => (\n            <option key={opt.value} value={opt.value} className=\"bg-[#1a1f28]\">{opt.label}</option>\n          ))}\n        </select>\n        <button\n          onClick={() => decrementField(value, onChange)}\n          className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n        >\n          <Minus className=\"h-3.5 w-3.5 text-white/60\" />\n        </button>\n        <button\n          onClick={() => incrementField(value, onChange)}\n          className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n        >\n          <Plus className=\"h-3.5 w-3.5 text-white/60\" />\n        </button>\n      </div>\n    </div>\n  )\n\n  // Get country code from symbol (simplified - can be enhanced)\n  const getCountryCode = () => {\n    const symbolUpper = (symbol || '').toUpperCase()\n    if (symbolUpper.includes('USD')) return 'US'\n    if (symbolUpper.includes('EUR')) return 'EU'\n    if (symbolUpper.includes('GBP')) return 'GB'\n    if (symbolUpper.includes('JPY')) return 'JP'\n    return 'US'\n  }\n\n  return (\n    <div\n      className={cn(\n        \"flex flex-col h-full bg-[#181926] border-l border-[#262932] overflow-hidden\",\n        className,\n        disabledOverlay\n      )}\n      {...props}\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-white/10 bg-white/[0.02]\">\n        <div className=\"flex items-center gap-2.5\">\n          <div className=\"w-5 h-5\">\n            <FlagIcon symbol={symbol || 'BTCUSD'} />\n          </div>\n          <span className=\"text-sm font-semibold text-white\">{formatSymbolDisplay(symbol) || 'Select Symbol'}</span>\n        </div>\n        {onClose && (\n          <button\n            onClick={onClose}\n            className=\"h-7 w-7 flex items-center justify-center rounded-md hover:bg-white/10 hover:border border-transparent hover:border-white/20 cursor-pointer group\"\n            title=\"Close Order Panel\"\n          >\n            <X className=\"h-4 w-4 text-white/60 group-hover:text-white\" />\n          </button>\n        )}\n      </div>\n\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin\">\n        {/* Form Type Selector */}\n        <select value={formType} onChange={(e) => handleFormTypeChange(e.target.value as FormType)} className=\"w-full bg-white/[0.02] border border-white/10 rounded-md h-9 px-3 text-sm text-white focus:outline-none focus:ring-0 focus:border-[#8B5CF6]\">\n          <option value=\"regular\" className=\"bg-[#1a1f28]\">Regular form</option>\n          <option value=\"one-click\" className=\"bg-[#1a1f28]\">One-click form</option>\n          <option value=\"risk-calculator\" className=\"bg-[#1a1f28]\">Risk calculator form</option>\n        </select>\n\n        {/* ONE-CLICK FORM */}\n        {formType === \"one-click\" && (\n          <>\n            <Tabs value={orderType === \"pending\" ? \"limit\" : orderType} onValueChange={(value: string) => {\n              setOrderType(value === \"limit\" ? \"pending\" : (value as \"market\" | \"pending\"))\n            }}>\n              <TabsList className=\"grid w-full grid-cols-2\">\n                <TabsTrigger value=\"market\">Market</TabsTrigger>\n                <TabsTrigger value=\"limit\">Limit</TabsTrigger>\n              </TabsList>\n            </Tabs>\n\n            {orderType === \"pending\" && (\n              <>\n                {/* Pending Order Type Selector: Limit vs Stop */}\n                <Tabs value={pendingOrderType} onValueChange={(value: string) => setPendingOrderType(value as \"limit\" | \"stop\")}>\n                  <TabsList className=\"grid w-full grid-cols-2\">\n                    <TabsTrigger value=\"limit\">Limit</TabsTrigger>\n                    <TabsTrigger value=\"stop\">Stop</TabsTrigger>\n                  </TabsList>\n                </Tabs>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"text-xs font-medium text-white/80\">Open price</div>\n                    <Tooltip text={`Set open price for ${pendingOrderType === \"limit\" ? \"limit\" : \"stop\"} order`}>\n                      <HelpCircle className=\"h-3.5 w-3.5 text-white/40\" />\n                    </Tooltip>\n                  </div>\n                  <div className=\"flex items-stretch border border-white/10 rounded-md overflow-hidden bg-white/[0.02] focus-within:border-[#8B5CF6]\">\n                    <Input\n                      type=\"number\"\n                      value={openPrice}\n                      onChange={(e) => setOpenPrice(e.target.value)}\n                      placeholder={currentBuyPrice.toFixed(3)}\n                      className=\"flex-1 border-0 bg-transparent text-center price-font text-sm h-9 focus-visible:ring-0 focus-visible:ring-offset-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder:text-white/40\"\n                    />\n                    <div className=\"flex items-center justify-center px-3 text-xs text-white/60 min-w-[50px]\">\n                      {pendingOrderType === \"limit\" ? \"Limit\" : \"Stop\"}\n                    </div>\n                    <button\n                      onClick={() => decrementField(openPrice, setOpenPrice)}\n                      className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                    >\n                      <Minus className=\"h-3.5 w-3.5 text-white/60\" />\n                    </button>\n                    <button\n                      onClick={() => incrementField(openPrice, setOpenPrice)}\n                      className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                    >\n                      <Plus className=\"h-3.5 w-3.5 text-white/60\" />\n                    </button>\n                  </div>\n                  {openPrice && (\n                    <div className=\"text-xs text-white/60\">\n                      {((parseFloat(openPrice) - currentBuyPrice) * 10000).toFixed(1)} pips\n                    </div>\n                  )}\n                </div>\n              </>\n            )}\n\n            <div className=\"space-y-2\">\n              <div className=\"text-xs font-medium text-white/80\">Volume</div>\n              <div className=\"flex items-stretch border border-white/10 rounded-md overflow-hidden bg-white/[0.02] focus-within:border-[#8B5CF6]\">\n                <Input\n                  type=\"text\"\n                  inputMode=\"decimal\"\n                  value={volume}\n                  onChange={(e) => handleVolumeChange(e.target.value)}\n                  onBlur={(e) => {\n                    const numValue = parseFloat(e.target.value) || 0.01\n                    const roundedValue = Math.round(numValue * 100) / 100\n                    const clampedValue = Math.max(0.01, Math.min(50.00, roundedValue))\n                    setVolume(clampedValue.toFixed(2))\n                  }}\n                  className=\"flex-1 border-0 bg-transparent text-center price-font text-sm h-9 focus-visible:ring-0 focus-visible:ring-offset-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                />\n                <div className=\"flex items-center justify-center px-3 text-xs text-white/60 min-w-[50px]\">\n                  Lots\n                </div>\n                <button\n                  onClick={decrementVolume}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Minus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n                <button\n                  onClick={incrementVolume}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Plus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n              </div>\n            </div>\n\n            {renderPriceButtonsSolid()}\n            {renderFinancialDetails()}\n          </>\n        )}\n\n        {/* REGULAR FORM */}\n        {formType === \"regular\" && (\n          <>\n            {renderPriceButtonsBordered(false, true)}\n\n            <Tabs value={orderType} onValueChange={(value: string) => setOrderType(value as \"market\" | \"limit\" | \"pending\")}>\n              <TabsList className=\"grid w-full grid-cols-2\">\n                <TabsTrigger value=\"market\">Market</TabsTrigger>\n                <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n              </TabsList>\n            </Tabs>\n\n            {orderType === \"pending\" && (\n              <>\n                {/* Pending Order Type Selector: Limit vs Stop */}\n                <Tabs value={pendingOrderType} onValueChange={(value: string) => setPendingOrderType(value as \"limit\" | \"stop\")}>\n                  <TabsList className=\"grid w-full grid-cols-2\">\n                    <TabsTrigger value=\"limit\">Limit</TabsTrigger>\n                    <TabsTrigger value=\"stop\">Stop</TabsTrigger>\n                  </TabsList>\n                </Tabs>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"text-xs font-medium text-white/80\">Open price</div>\n                    <Tooltip text={`Set open price for ${pendingOrderType === \"limit\" ? \"limit\" : \"stop\"} order`}>\n                      <HelpCircle className=\"h-3.5 w-3.5 text-white/40\" />\n                    </Tooltip>\n                  </div>\n                  <div className=\"flex items-stretch border border-white/10 rounded-md overflow-hidden bg-white/[0.02] focus-within:border-[#8B5CF6]\">\n                    <Input\n                      type=\"number\"\n                      value={openPrice}\n                      onChange={(e) => setOpenPrice(e.target.value)}\n                      placeholder={currentBuyPrice.toFixed(3)}\n                      className=\"flex-1 border-0 bg-transparent text-center price-font text-sm h-9 focus-visible:ring-0 focus-visible:ring-offset-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder:text-white/40\"\n                    />\n                    <div className=\"flex items-center justify-center px-3 text-xs text-white/60 min-w-[50px]\">\n                      {pendingOrderType === \"limit\" ? \"Limit\" : \"Stop\"}\n                    </div>\n                    <button\n                      onClick={() => decrementField(openPrice, setOpenPrice)}\n                      className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                    >\n                      <Minus className=\"h-3.5 w-3.5 text-white/60\" />\n                    </button>\n                    <button\n                      onClick={() => incrementField(openPrice, setOpenPrice)}\n                      className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                    >\n                      <Plus className=\"h-3.5 w-3.5 text-white/60\" />\n                    </button>\n                  </div>\n                  {openPrice && (\n                    <div className=\"text-xs text-white/60\">\n                      {((parseFloat(openPrice) - currentBuyPrice) * 10000).toFixed(1)} pips\n                      {pendingOrderType === \"limit\" && (\n                        <span className=\"ml-2 text-white/40\">\n                          (Buy Limit: below current, Sell Limit: above current)\n                        </span>\n                      )}\n                      {pendingOrderType === \"stop\" && (\n                        <span className=\"ml-2 text-white/40\">\n                          (Buy Stop: above current, Sell Stop: below current)\n                        </span>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </>\n            )}\n\n            <div className=\"space-y-2\">\n              <div className=\"text-xs font-medium text-white/80\">Volume</div>\n              <div className=\"flex items-stretch border border-white/10 rounded-md overflow-hidden bg-white/[0.02] focus-within:border-[#8B5CF6]\">\n                <Input\n                  type=\"text\"\n                  inputMode=\"decimal\"\n                  value={volume}\n                  onChange={(e) => handleVolumeChange(e.target.value)}\n                  onBlur={(e) => {\n                    const numValue = parseFloat(e.target.value) || 0.01\n                    const roundedValue = Math.round(numValue * 100) / 100\n                    const clampedValue = Math.max(0.01, Math.min(50.00, roundedValue))\n                    setVolume(clampedValue.toFixed(2))\n                  }}\n                  className=\"flex-1 border-0 bg-transparent text-center price-font text-sm h-9 focus-visible:ring-0 focus-visible:ring-offset-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                />\n                <div className=\"flex items-center justify-center px-3 text-xs text-white/60 min-w-[50px]\">\n                  Lots\n                </div>\n                <button\n                  onClick={decrementVolume}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Minus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n                <button\n                  onClick={incrementVolume}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Plus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n              </div>\n            </div>\n\n            {renderInputField(\n              \"Take Profit\",\n              takeProfit,\n              setTakeProfit,\n              takeProfitMode,\n              (value: string) => setTakeProfitMode(value as \"pips\" | \"price\"),\n              [\n                { value: \"price\", label: \"Price\" },\n                { value: \"pips\", label: \"Pips\" }\n              ],\n              true\n            )}\n\n            {renderInputField(\n              \"Stop Loss\",\n              stopLoss,\n              setStopLoss,\n              stopLossMode,\n              (value: string) => setStopLossMode(value as \"pips\" | \"price\"),\n              [\n                { value: \"price\", label: \"Price\" },\n                { value: \"pips\", label: \"Pips\" }\n              ],\n              true\n            )}\n\n            {/* Confirmation Buttons - Only show when a side is selected */}\n            {pendingOrderSide && (\n              <>\n                {/* Stop Loss Metrics - Show above confirmation button */}\n                {stopLoss && (\n                  <div className=\"flex items-center justify-center gap-4 pt-2 pb-1 text-xs text-white/60\">\n                    {stopLossMode === \"pips\" ? (\n                      <>\n                        <span>{stopLoss.startsWith('-') ? stopLoss : `-${stopLoss}`} pips</span>\n                        <span className=\"text-white/40\">|</span>\n                        <span>\n                          {(() => {\n                            const pips = Math.abs(parseFloat(stopLoss) || 0)\n                            const isBuy = pendingOrderSide === 'buy'\n                            const calculatedPrice = calculatePriceFromPips(pips, isBuy, true)\n                            if (calculatedPrice !== null) {\n                              const priceDiff = isBuy\n                                ? currentBuyPrice - calculatedPrice\n                                : calculatedPrice - currentSellPrice\n                              const pipValue = pips * getPipValuePerLot * (parseFloat(volume) || 0.01)\n                              return `-${Math.abs(pipValue).toFixed(2)} USD`\n                            }\n                            return '-0.00 USD'\n                          })()}\n                        </span>\n                        <span className=\"text-white/40\">|</span>\n                        <span>\n                          {(() => {\n                            const pips = Math.abs(parseFloat(stopLoss) || 0)\n                            const pipValue = pips * getPipValuePerLot * (parseFloat(volume) || 0.01)\n                            const balance = currentBalance?.equity || 1\n                            const percent = (Math.abs(pipValue) / balance) * 100\n                            return `-${percent.toFixed(2)} %`\n                          })()}\n                        </span>\n                      </>\n                    ) : (\n                      <>\n                        <span>\n                          {(() => {\n                            const slPrice = parseFloat(stopLoss) || 0\n                            const isBuy = pendingOrderSide === 'buy'\n                            const entryPrice = isBuy ? currentBuyPrice : currentSellPrice\n                            const priceDiff = isBuy ? entryPrice - slPrice : slPrice - entryPrice\n                            const pipSize = getPipSize\n                            const pips = priceDiff / pipSize\n                            return `${pips.toFixed(1)} pips`\n                          })()}\n                        </span>\n                        <span className=\"text-white/40\">|</span>\n                        <span>\n                          {(() => {\n                            const slPrice = parseFloat(stopLoss) || 0\n                            const isBuy = pendingOrderSide === 'buy'\n                            const entryPrice = isBuy ? currentBuyPrice : currentSellPrice\n                            const priceDiff = Math.abs(entryPrice - slPrice)\n                            const pipSize = getPipSize\n                            const pips = priceDiff / pipSize\n                            const pipValue = pips * getPipValuePerLot * (parseFloat(volume) || 0.01)\n                            return `-${pipValue.toFixed(2)} USD`\n                          })()}\n                        </span>\n                        <span className=\"text-white/40\">|</span>\n                        <span>\n                          {(() => {\n                            const slPrice = parseFloat(stopLoss) || 0\n                            const isBuy = pendingOrderSide === 'buy'\n                            const entryPrice = isBuy ? currentBuyPrice : currentSellPrice\n                            const priceDiff = Math.abs(entryPrice - slPrice)\n                            const pipSize = getPipSize\n                            const pips = priceDiff / pipSize\n                            const pipValue = pips * getPipValuePerLot * (parseFloat(volume) || 0.01)\n                            const balance = currentBalance?.equity || 1\n                            const percent = (pipValue / balance) * 100\n                            return `-${percent.toFixed(2)} %`\n                          })()}\n                        </span>\n                      </>\n                    )}\n                  </div>\n                )}\n\n                <div className=\"flex flex-col gap-2 pt-2\">\n                  <button\n                    disabled={isLoading}\n                    onClick={async () => {\n                      if (isMarketClosed) {\n                        setMarketClosedToast(marketClosedMessage)\n                        return\n                      }\n                      if (isLoading) return;\n                      const handler = pendingOrderSide === 'buy' ? onBuy : onSell\n                      if (!handler) return\n                      const finalVolume = parseFloat(volume) || 0.01\n                      if (finalVolume <= 0) {\n                        return\n                      }\n                      let finalStopLoss: number | undefined = undefined\n                      let finalTakeProfit: number | undefined = undefined\n\n                      const isBuy = pendingOrderSide === 'buy'\n\n                      if (stopLossMode === \"price\") {\n                        finalStopLoss = stopLoss ? parseFloat(stopLoss) : undefined\n                      } else if (stopLossMode === \"pips\" && stopLoss) {\n                        const pips = parseFloat(stopLoss)\n                        if (!isNaN(pips)) {\n                          const calculatedPrice = calculatePriceFromPips(pips, isBuy, true)\n                          if (calculatedPrice !== null) {\n                            finalStopLoss = calculatedPrice\n                          }\n                        }\n                      }\n\n                      if (takeProfitMode === \"price\") {\n                        finalTakeProfit = takeProfit ? parseFloat(takeProfit) : undefined\n                      } else if (takeProfitMode === \"pips\" && takeProfit) {\n                        const pips = parseFloat(takeProfit)\n                        if (!isNaN(pips) && pips > 0) {\n                          const calculatedPrice = calculatePriceFromPips(pips, isBuy, false)\n                          if (calculatedPrice !== null) {\n                            finalTakeProfit = calculatedPrice\n                          }\n                        }\n                      }\n\n                      // For pending orders, validate that openPrice is provided\n                      if (orderType === 'pending' && !openPrice) {\n                        alert('Please enter an open price for pending orders')\n                        return\n                      }\n\n                      const orderData: OrderData = {\n                        orderType,\n                        pendingOrderType: orderType === \"pending\" ? pendingOrderType : undefined,\n                        volume: finalVolume,\n                        openPrice: orderType === 'market'\n                          ? (pendingOrderSide === 'buy' ? currentBuyPrice : currentSellPrice)\n                          : (openPrice ? parseFloat(openPrice) : undefined),\n                        stopLoss: finalStopLoss,\n                        takeProfit: finalTakeProfit,\n                      }\n\n                      setIsLoading(true);\n                      try {\n                        handler(orderData);\n                        setTimeout(() => {\n                          setIsLoading(false);\n                          setPendingOrderSide(null);\n                        }, 1000);\n                      } catch (err) {\n                        setIsLoading(false);\n                        setPendingOrderSide(null);\n                      }\n                    }}\n                    className={cn(\n                      \"w-full font-semibold py-3 px-4 rounded-md transition-all flex flex-col items-center justify-center relative overflow-hidden text-white\",\n                      pendingOrderSide === 'buy' ? 'bg-[#4A9EFF] hover:bg-[#4A9EFF]/90' : 'bg-[#FF5555] hover:bg-[#FF5555]/90',\n                      isLoading && \"opacity-80\"\n                    )}\n                  >\n                    {isLoading && (\n                      <div className=\"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-[1px] z-10 focus:outline-none\">\n                        <div className=\"flex gap-1\">\n                          {[0, 1, 2].map((i) => (\n                            <div\n                              key={i}\n                              className=\"w-1.5 h-1.5 bg-white rounded-full opacity-80\"\n                            />\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                    <span className=\"text-sm\">Confirm {pendingOrderSide === 'buy' ? 'Buy' : 'Sell'}</span>\n                    <span className=\"text-xs opacity-90\">{volume} lots</span>\n                  </button>\n                  <button\n                    onClick={() => setPendingOrderSide(null)}\n                    disabled={isLoading}\n                    className=\"w-full bg-[#2a2f36] hover:bg-[#363c45] text-white font-medium py-2.5 px-4 rounded-md text-sm transition-colors disabled:opacity-50\"\n                  >\n                    Cancel\n                  </button>\n                </div>\n\n                {/* Financial Details - Show below confirmation buttons */}\n                {renderFinancialDetails()}\n              </>\n            )}\n          </>\n        )}\n\n        {/* RISK CALCULATOR FORM */}\n        {formType === \"risk-calculator\" && (\n          <>\n            {renderPriceButtonsBordered(false)}\n\n            <Tabs value={orderType} onValueChange={(value: string) => setOrderType(value as \"market\" | \"limit\" | \"pending\")}>\n              <TabsList className=\"grid w-full grid-cols-2\">\n                <TabsTrigger value=\"market\">Market</TabsTrigger>\n                <TabsTrigger value=\"pending\">Pending</TabsTrigger>\n              </TabsList>\n            </Tabs>\n\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"text-xs font-medium text-white/80\">Risk</div>\n                <Tooltip text=\"Maximum amount you're willing to risk on this trade\">\n                  <HelpCircle className=\"h-3.5 w-3.5 text-white/40\" />\n                </Tooltip>\n              </div>\n              <div className=\"flex items-stretch border border-white/10 rounded-md overflow-hidden bg-white/[0.02] focus-within:border-[#8B5CF6]\">\n                <Input\n                  type=\"number\"\n                  value={risk}\n                  onChange={(e) => setRisk(e.target.value)}\n                  placeholder=\"Not set\"\n                  className=\"flex-1 border-0 bg-transparent text-center price-font text-sm h-9 focus-visible:ring-0 focus-visible:ring-offset-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder:text-white/40\"\n                />\n                <select value={riskMode} onChange={(e) => setRiskMode(e.target.value as \"usd\" | \"percent\")} className=\"w-[70px] border-0 h-9 bg-transparent text-xs text-white focus:outline-none focus:ring-0\">\n                  <option value=\"usd\" className=\"bg-[#1a1f28]\">USD</option>\n                  <option value=\"percent\" className=\"bg-[#1a1f28]\">%</option>\n                </select>\n                <button\n                  onClick={() => {\n                    const currentValue = parseFloat(risk) || 0\n                    setRisk(Math.max(0, currentValue - 1).toString())\n                  }}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Minus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n                <button\n                  onClick={() => {\n                    const currentValue = parseFloat(risk) || 0\n                    setRisk((currentValue + 1).toString())\n                  }}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Plus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n              </div>\n              {riskMode === \"percent\" && risk && (\n                <div className=\"text-xs text-white/60 text-center\">\n                  {((parseFloat(risk) || 0) * (currentBalance?.equity || 0) / 100).toFixed(2)} USD\n                </div>\n              )}\n              {riskMode === \"usd\" && calculateRiskBasedVolume !== null && (\n                <div className=\"text-xs text-white/80 text-center font-medium\">\n                  {calculateRiskBasedVolume.toFixed(2)} lots\n                </div>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"text-xs font-medium text-white/80\">Stop Loss</div>\n                <Tooltip text=\"Stop loss distance in pips (negative for Buy, positive for Sell)\">\n                  <HelpCircle className=\"h-3.5 w-3.5 text-white/40\" />\n                </Tooltip>\n              </div>\n              <div className=\"flex items-stretch border border-white/10 rounded-md overflow-hidden bg-white/[0.02] focus-within:border-[#8B5CF6]\">\n                <Input\n                  type=\"number\"\n                  value={stopLoss}\n                  onChange={(e) => setStopLoss(e.target.value)}\n                  placeholder=\"Not set\"\n                  className=\"flex-1 border-0 bg-transparent text-center price-font text-sm h-9 focus-visible:ring-0 focus-visible:ring-offset-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder:text-white/40\"\n                />\n                <select\n                  value={stopLossMode}\n                  onChange={(e) => setStopLossMode(e.target.value as \"pips\" | \"price\")}\n                  className=\"w-[70px] border-0 h-9 bg-transparent text-xs text-white focus:outline-none focus:ring-0 text-center\"\n                >\n                  <option value=\"pips\" className=\"bg-[#1a1f28]\">Pips</option>\n                  <option value=\"price\" className=\"bg-[#1a1f28]\">Price</option>\n                </select>\n                <button\n                  onClick={() => {\n                    const currentValue = parseFloat(stopLoss) || 0\n                    setStopLoss((currentValue - 1).toString())\n                  }}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Minus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n                <button\n                  onClick={() => {\n                    const currentValue = parseFloat(stopLoss) || 0\n                    setStopLoss((currentValue + 1).toString())\n                  }}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Plus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n              </div>\n              {(calculatedStopLossPrice !== null || (stopLossMode === \"price\" && stopLoss)) && calculateRiskBasedVolume !== null && (\n                <div className=\"space-y-0.5\">\n                  {stopLossMode === \"pips\" && stopLoss && !isNaN(parseFloat(stopLoss)) && (\n                    <div className=\"text-xs text-white/60 text-center flex justify-center gap-3\">\n                      <span>B: {(currentBuyPrice - parseFloat(stopLoss) * getPipSize).toFixed(2)}</span>\n                      <span>S: {(currentSellPrice + parseFloat(stopLoss) * getPipSize).toFixed(2)}</span>\n                    </div>\n                  )}\n                  <div className=\"text-xs text-red-400/80 text-center font-medium\">\n                    {(() => {\n                      let riskVal = parseFloat(risk) || 0;\n                      if (riskMode === \"percent\") {\n                        const equity = currentBalance?.equity || 0;\n                        riskVal = (riskVal / 100) * equity;\n                      }\n                      return riskVal.toFixed(2) + \" USD loss\";\n                    })()}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"text-xs font-medium text-white/80\">Take Profit</div>\n                <Tooltip text=\"Take profit distance in pips\">\n                  <HelpCircle className=\"h-3.5 w-3.5 text-white/40\" />\n                </Tooltip>\n              </div>\n              <div className=\"flex items-stretch border border-white/10 rounded-md overflow-hidden bg-white/[0.02] focus-within:border-[#8B5CF6]\">\n                <Input\n                  type=\"number\"\n                  value={takeProfit}\n                  onChange={(e) => setTakeProfit(e.target.value)}\n                  placeholder=\"Not set\"\n                  className=\"flex-1 border-0 bg-transparent text-center price-font text-sm h-9 focus-visible:ring-0 focus-visible:ring-offset-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none placeholder:text-white/40\"\n                />\n                <select\n                  value={takeProfitMode}\n                  onChange={(e) => setTakeProfitMode(e.target.value as \"pips\" | \"price\")}\n                  className=\"w-[70px] border-0 h-9 bg-transparent text-xs text-white focus:outline-none focus:ring-0 text-center\"\n                >\n                  <option value=\"pips\" className=\"bg-[#1a1f28]\">Pips</option>\n                  <option value=\"price\" className=\"bg-[#1a1f28]\">Price</option>\n                </select>\n                <button\n                  onClick={() => {\n                    const currentValue = parseFloat(takeProfit) || 0\n                    setTakeProfit(Math.max(0, currentValue - 1).toString())\n                  }}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Minus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n                <button\n                  onClick={() => {\n                    const currentValue = parseFloat(takeProfit) || 0\n                    setTakeProfit((currentValue + 1).toString())\n                  }}\n                  className=\"h-9 w-9 flex items-center justify-center hover:bg-white/5 cursor-pointer\"\n                >\n                  <Plus className=\"h-3.5 w-3.5 text-white/60\" />\n                </button>\n              </div>\n              {(calculatedTakeProfitPrice !== null || (takeProfitMode === \"price\" && takeProfit)) && calculateRiskBasedVolume !== null && (\n                <div className=\"space-y-0.5\">\n                  {takeProfitMode === \"pips\" && calculatedTakeProfitPrice !== null && (\n                    <div className=\"text-xs text-white/60 text-center\">\n                      {calculatedTakeProfitPrice.toFixed(2)}\n                    </div>\n                  )}\n                  <div className=\"text-xs text-green-400/80 text-center font-medium\">\n                    {(() => {\n                      let pips = 0;\n                      if (takeProfitMode === \"pips\") {\n                        pips = parseFloat(takeProfit);\n                      } else {\n                        // Price mode\n                        const tpPrice = parseFloat(takeProfit);\n                        if (!isNaN(tpPrice)) {\n                          let entryPrice = 0;\n                          if (orderType === \"pending\" || orderType === \"limit\") {\n                            entryPrice = openPrice ? parseFloat(openPrice) : 0;\n                          } else {\n                            entryPrice = (currentBuyPrice + currentSellPrice) / 2;\n                          }\n                          if (entryPrice > 0) {\n                            const pipSize = getPipSize;\n                            pips = Math.abs(tpPrice - entryPrice) / pipSize;\n                          }\n                        }\n                      }\n                      const profit = pips * getPipValuePerLot * calculateRiskBasedVolume;\n                      return profit.toFixed(2) + \" USD profit\";\n                    })()}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {renderFinancialDetails()}\n          </>\n        )}\n\n      </div>\n\n      {/* One-click Trading Modal */}\n      <OrderModeModal\n        isOpen={showOneClickModal}\n        onClose={handleOneClickModalCancel}\n        onConfirm={handleOneClickModalConfirm}\n        mode=\"One-click form\"\n      />\n\n      {/* Risk Calculator Modal */}\n      <OrderModeModal\n        isOpen={showRiskCalculatorModal}\n        onClose={handleRiskCalculatorModalCancel}\n        onConfirm={handleRiskCalculatorModalConfirm}\n        mode=\"Risk calculator form\"\n      />\n\n      {marketClosedToast && ReactDOM.createPortal(\n        <div className=\"fixed bottom-4 left-4 z-[99999] bg-[#0b0e14] text-[#d1d5db] rounded-md shadow-lg border border-amber-500/60 w-[320px] overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-300\">\n          <div className=\"p-4 relative\">\n            <button\n              onClick={() => setMarketClosedToast(null)}\n              className=\"absolute top-2 right-2 text-[#9ca3af] hover:text-white transition-colors\"\n            >\n              √ó\n            </button>\n            <div className=\"flex items-start gap-3\">\n              <div className=\"mt-0.5 text-amber-400\">‚ö†</div>\n              <div className=\"flex-1\">\n                <h3 className=\"text-white font-medium text-[14px] leading-tight mb-1\">Market closed</h3>\n                <p className=\"text-[13px] text-[#d1d5db]\">{marketClosedMessage}</p>\n              </div>\n            </div>\n          </div>\n        </div>,\n        document.body\n      )}\n    </div>\n  )\n}\n\nexport default OrderPanel\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9369, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/ui/resizable.tsx"],"sourcesContent":["import { ComponentProps } from \"react\"\nimport { PiDotsThreeOutlineVerticalFill } from \"react-icons/pi\"\nimport { Panel, PanelGroup, PanelResizeHandle } from \"react-resizable-panels\"\n\nfunction ResizablePanelGroup({ className, ...props }: ComponentProps<typeof PanelGroup>) {\n  return (\n    <PanelGroup\n      className={`flex h-full w-full data-[panel-group-direction=vertical]:flex-col ${className || ''}`}\n      {...props}\n    />\n  )\n}\n\nfunction ResizablePanel({ className, ...props }: ComponentProps<typeof Panel>) {\n  return <Panel className={className} {...props} />\n}\n\nfunction ResizableHandle({ withHandle, className, ...props }) {\n  return (\n    <PanelResizeHandle\n      className={`relative flex w-1 items-center justify-center bg-transparent after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-400 focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-1 data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90 hover:bg-gray-700/50 transition-colors ${className || ''}`}\n      {...props}\n    >\n      {withHandle && (\n        <div className=\"z-10 flex h-4 w-0 items-center justify-center rounded-sm border border-gray-600 bg-gray-700\">\n          <PiDotsThreeOutlineVerticalFill className=\"text-gray-400\" />\n        </div>\n      )}\n    </PanelResizeHandle>\n  )\n}\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n"],"names":[],"mappings":";;;;;;;;;AACA;AACA;;;;AAEA,SAAS,oBAAoB,EAAE,SAAS,EAAE,GAAG,OAA0C;IACrF,qBACE,8OAAC,kOAAU;QACT,WAAW,CAAC,kEAAkE,EAAE,aAAa,IAAI;QAChG,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,eAAe,EAAE,SAAS,EAAE,GAAG,OAAqC;IAC3E,qBAAO,8OAAC,6NAAK;QAAC,WAAW;QAAY,GAAG,KAAK;;;;;;AAC/C;AAEA,SAAS,gBAAgB,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,OAAO;IAC1D,qBACE,8OAAC,yOAAiB;QAChB,WAAW,CAAC,srBAAsrB,EAAE,aAAa,IAAI;QACptB,GAAG,KAAK;kBAER,4BACC,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC,gLAA8B;gBAAC,WAAU;;;;;;;;;;;;;;;;AAKpD"}},
    {"offset": {"line": 9432, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/modals/CloseAllPositionsDropdown.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useRef, useState } from 'react'\n\nexport default function CloseAllPositionsDropdown({ isOpen, onClose, onConfirm, positions, anchorRef }: any) {\n  const dropdownRef = useRef<HTMLDivElement>(null)\n  const [selectedOption, setSelectedOption] = useState('all')\n\n  // Calculate stats\n  const stats = positions.reduce((acc: any, pos: any) => {\n    const pl = parseFloat(pos.pl.replace('+', ''))\n\n    // All\n    acc.all.count++\n    acc.all.pl += pl\n\n    // Profitable\n    if (pl > 0) {\n      acc.profitable.count++\n      acc.profitable.pl += pl\n    }\n\n    // Losing\n    if (pl < 0) {\n      acc.losing.count++\n      acc.losing.pl += pl\n    }\n\n    // Buy\n    if (pos.type === 'Buy') {\n      acc.buy.count++\n      acc.buy.pl += pl\n    }\n\n    // Sell\n    if (pos.type === 'Sell') {\n      acc.sell.count++\n      acc.sell.pl += pl\n    }\n\n    return acc\n  }, {\n    all: { count: 0, pl: 0 },\n    profitable: { count: 0, pl: 0 },\n    losing: { count: 0, pl: 0 },\n    buy: { count: 0, pl: 0 },\n    sell: { count: 0, pl: 0 }\n  })\n\n  const formatPL = (val: number) => {\n    if (val === 0) return '--'\n    const sign = val > 0 ? '+' : ''\n    return `${sign}${val.toFixed(2)}`\n  }\n\n  const getColor = (val: number) => {\n    if (val === 0) return 'text-[#8b9096]'\n    return val > 0 ? 'text-[#2ebd85]' : 'text-[#f6465d]'\n  }\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      const target = event.target as Node;\n      if (dropdownRef.current && !dropdownRef.current.contains(target) &&\n        anchorRef.current && !anchorRef.current.contains(target)) {\n        onClose()\n      }\n    }\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside)\n    }\n\n    return () => document.removeEventListener('mousedown', handleClickOutside)\n  }, [isOpen, onClose, anchorRef])\n\n  if (!isOpen) return null\n\n  // Calculate position\n  const style: React.CSSProperties = {}\n  if (anchorRef?.current) {\n    const rect = anchorRef.current.getBoundingClientRect()\n    style.bottom = `${window.innerHeight - rect.top + 8}px`\n    style.right = `${window.innerWidth - rect.right}px`\n  }\n\n  const options = [\n    { id: 'all', label: 'Close all' },\n    { id: 'profitable', label: 'Close all profitable' },\n    { id: 'losing', label: 'Close all losing' },\n    { id: 'buy', label: 'Close all Buy' },\n    { id: 'sell', label: 'Close all Sell' }\n  ]\n\n  return (\n    <div\n      ref={dropdownRef}\n      style={style}\n      className=\"fixed z-[100] bg-[#02040d] rounded-lg shadow-2xl w-[320px] border border-[#363c47] overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-200\"\n    >\n      <div className=\"p-4\">\n        <h3 className=\"text-white font-medium text-[14px] mb-3\">\n          Close all positions at the market prices?\n        </h3>\n\n        <div className=\"space-y-2\">\n          {options.map(opt => {\n            const stat = stats[opt.id]\n            const isDisabled = stat.count === 0\n\n            return (\n              <label\n                key={opt.id}\n                className={`flex items-center justify-between cursor-pointer group p-2 rounded hover:bg-[#363c47] transition-colors ${isDisabled ? 'opacity-50 pointer-events-none' : ''}`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"relative flex items-center justify-center w-4 h-4\">\n                    <input\n                      type=\"radio\"\n                      name=\"closeOption\"\n                      value={opt.id}\n                      checked={selectedOption === opt.id}\n                      onChange={(e) => setSelectedOption(e.target.value)}\n                      disabled={isDisabled}\n                      className=\"peer appearance-none w-4 h-4 border border-[#565c66] rounded-full checked:border-[#8b5cf6] checked:bg-[#8b5cf6] transition-colors\"\n                    />\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-[#e1e3e6] text-[13px]\">{opt.label}</span>\n                    {stat.count > 0 && (\n                      <span className=\"bg-[#141d22] text-[#b2b5be] text-[10px] px-1.5 py-0.5 rounded\">\n                        {stat.count}\n                      </span>\n                    )}\n                  </div>\n                </div>\n                <span className={`text-[13px] font-mono ${getColor(stat.pl)}`}>\n                  {formatPL(stat.pl)}\n                </span>\n              </label>\n            )\n          })}\n        </div>\n\n        <div className=\"flex gap-2 mt-4\">\n          <button\n            onClick={onClose}\n            className=\"flex-1 py-2 text-[13px] font-medium text-[#e1e3e6] bg-[#363c47] hover:bg-[#404652] transition-colors rounded\"\n          >\n            Cancel\n          </button>\n          <button\n            onClick={() => {\n              onConfirm(selectedOption)\n              onClose()\n            }}\n            className=\"flex-1 py-2 text-[13px] font-medium text-[#141d22] bg-[#8b5cf6] hover:bg-[#ffe54f] transition-colors rounded\"\n          >\n            Confirm\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9691, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/layout/StatusBar.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useRef, useCallback, useMemo } from 'react'\nimport { GiNetworkBars } from \"react-icons/gi\";\nimport CloseAllPositionsDropdown from \"../modals/CloseAllPositionsDropdown\";\nimport { usePrivacy } from '../../context/PrivacyContext';\nimport { formatCurrency } from '../../lib/utils';\nimport { apiClient } from '../../lib/api';\nimport { useWebSocket } from '../../context/WebSocketContext';\n\nexport default function StatusBar({ openPositions = [], onCloseAll }: any) {\n  const { hideBalance } = usePrivacy();\n  const { ping } = useWebSocket();\n  const [data, setData] = useState<any>(null);\n  const [showDropdown, setShowDropdown] = useState(false)\n  const buttonRef = useRef(null)\n\n  const fetchBalance = useCallback(async () => {\n    try {\n      // Get account ID directly from localStorage to be independent\n      let accountId = localStorage.getItem('defaultMt5Account') || localStorage.getItem('accountId');\n      const token = localStorage.getItem('token');\n\n      // Force demo mock if we are in demo mode (which we are)\n      // or if the accountId looks like a demo ID\n      // Error handling: If accountId is missing, use a default demo ID\n      if (!accountId) accountId = 'demo-10001';\n\n      // Always mock for this demo terminal to avoid connection errors\n      // The user wants a purely frontend demo\n      setData({\n        Balance: 10000.00,\n        Equity: 10000.00,\n        Margin: 0,\n        MarginLevel: 0,\n        success: true\n      });\n      return;\n\n      /* \n      // Original Logic - Commented out for Demo Terminal\n      if (!accountId) return;\n\n      const baseURL = apiClient.getBaseURL();\n      const response = await fetch(`${baseURL}/api/accounts/${accountId}/profile`, {\n        cache: 'no-store',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      const result = await response.json();\n\n      if (result.success && result.data) {\n        setData(result.data);\n      }\n      */\n    } catch (err) {\n      // Silently fail - balance fetch errors are not critical\n      // console.error('[StatusBar] Direct Fetch Error:', err);\n      // Fallback to demo data on error\n      setData({\n        Balance: 10000.00,\n        Equity: 10000.00,\n        Margin: 0,\n        MarginLevel: 0,\n        success: true\n      });\n    }\n  }, []);\n\n  // Standalone polling loop\n  useEffect(() => {\n    fetchBalance(); // Initial fetch\n    // Poll less aggressively to prevent connection exhaustion\n    const interval = setInterval(fetchBalance, 5000);\n    return () => clearInterval(interval);\n  }, [fetchBalance]);\n\n  // Map values\n  const equity = data?.Equity ?? data?.equity ?? 0;\n  const balance = data?.Balance ?? data?.balance ?? 0;\n  const margin = data?.Margin ?? data?.margin ?? data?.MarginUsed ?? data?.marginUsed ?? 0;\n\n  // Calculate Free Margin: Always calculate as Equity - Margin (standard MT5 formula)\n  const freeMargin = useMemo(() => {\n    const eq = Number(equity) || 0;\n    const mg = Number(margin) || 0;\n    return parseFloat((eq - mg).toFixed(2));\n  }, [equity, margin]);\n\n  const marginLevel = data?.MarginLevel ?? data?.marginLevel ?? 0;\n\n  // Calculate P/L from open positions (same as CloseAllPositionsDropdown)\n  // Sum up all position P/L values\n  const totalPL = openPositions.reduce((sum, pos) => {\n    const pl = parseFloat(String(pos.pl || '0').replace('+', ''));\n    return sum + (isNaN(pl) ? 0 : pl);\n  }, 0);\n\n  const renderValue = (value: number, suffix: string = 'USD') => {\n    if (hideBalance) return '****';\n    return `${formatCurrency(value, 2)} ${suffix}`;\n  };\n\n  return (\n    <div className=\"bg-background flex items-center justify-between px-4 py-2 text-xs text-gray-400 font-medium rounded-tl-md relative border-t border-gray-800\">\n      {/* Left section - Account info */}\n      <div className=\"flex items-center gap-6\">\n        <span>Equity: <span className=\"text-gray-200 font-mono\">{renderValue(equity)}</span></span>\n        <span>Free Margin: <span className=\"text-gray-200 font-mono\">{renderValue(freeMargin)}</span></span>\n        <span>Balance: <span className=\"text-gray-200 font-mono\">{renderValue(balance)}</span></span>\n        <span>Margin: <span className=\"text-gray-200 font-mono\">{renderValue(margin)}</span></span>\n        <span>Margin level: <span className=\"text-gray-200 font-mono\">\n          {hideBalance ? '****' : `${marginLevel.toFixed(2)}%`}\n        </span></span>\n      </div>\n\n      {/* Right section - P/L, Close all, Connection */}\n      <div className=\"flex items-center gap-4\">\n        <span className=\"text-gray-400\">Total P/L, USD: <span className={`font-mono ${totalPL >= 0 ? 'text-[#2ebd85]' : 'text-[#f6465d]'}`}>\n          {hideBalance ? '****' : <>{totalPL >= 0 ? '+' : ''}{totalPL.toFixed(2)}</>}\n        </span></span>\n\n        <button\n          ref={buttonRef}\n          onClick={() => setShowDropdown(!showDropdown)}\n          disabled={openPositions.length === 0}\n          className={`px-3 mr-20 py-1 rounded text-sm flex items-center gap-2 transition-colors ${openPositions.length === 0\n            ? 'bg-background text-[#565c66] cursor-not-allowed'\n            : 'bg-background hover:bg-[#363c45] text-gray-200 cursor-pointer'\n            }`}\n        >\n          Close all\n          <svg className={`w-3 h-3 text-gray-400 transition-transform ${showDropdown ? 'rotate-180' : ''}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n          </svg>\n        </button>\n\n        <div className=\"flex items-end gap-1 ml-2\" title={`Network Latency: ${ping}ms`}>\n          <GiNetworkBars size={14} className={\n            ping < 100 ? \"text-emerald-500\" :\n              ping < 300 ? \"text-yellow-500\" :\n                \"text-red-500 animate-pulse\"\n          } />\n          <span className={`text-[10px] font-mono leading-none mb-0 ${ping === 0 ? \"text-gray-500\" :\n            ping < 100 ? \"text-gray-500\" :\n              ping < 300 ? \"text-yellow-500/80\" :\n                \"text-red-500/80\"\n            }`}>{ping > 0 ? ping : '--'} ms</span>\n        </div>\n      </div>\n\n      <CloseAllPositionsDropdown\n        isOpen={showDropdown}\n        onClose={() => setShowDropdown(false)}\n        onConfirm={onCloseAll}\n        positions={openPositions}\n        anchorRef={buttonRef}\n      />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10010, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/modals/ModifyPositionModal.tsx"],"sourcesContent":["\"use client\";\nimport React, { useState, useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport FlagIcon from '../ui/FlagIcon';\nimport Tooltip from '../ui/Tooltip';\n\nimport { useTrading } from '../../context/TradingContext';\n\nconst ModifyPositionModal = () => {\n  const { modifyModalState, setModifyModalState, requestModifyPosition } = useTrading();\n  const { isOpen, position } = modifyModalState;\n\n  const [activeTab, setActiveTab] = useState('modify');\n  const [tpValue, setTpValue] = useState('');\n  const [slValue, setSlValue] = useState('');\n  const [partialVolume, setPartialVolume] = useState('');\n  const [estimatedPL, setEstimatedPL] = useState<number | null>(null);\n\n  const onClose = () => {\n    setModifyModalState({ ...modifyModalState, isOpen: false });\n  };\n\n  // Reset state when position changes or modal opens\n  useEffect(() => {\n    if (isOpen && position) {\n      // Parse TP value, removing commas if present\n      // Only set value if it's already set, otherwise leave empty\n      let tpValueStr = '';\n      if (position?.tp && position?.tp !== 'Add' && position?.tp !== 'Not Set') {\n        // Remove commas from existing TP value\n        tpValueStr = String(position.tp).replace(/,/g, '');\n      }\n\n      // Parse SL value, removing commas if present\n      // Only set value if it's already set, otherwise leave empty\n      let slValueStr = '';\n      if (position?.sl && position?.sl !== 'Add' && position?.sl !== 'Not Set') {\n        // Remove commas from existing SL value\n        slValueStr = String(position.sl).replace(/,/g, '');\n      }\n\n      setTpValue(tpValueStr);\n      setSlValue(slValueStr);\n      setPartialVolume(position?.volume || '');\n    }\n  }, [isOpen, position]);\n\n  // Calculate estimated P/L when TP/SL changes (only for open positions, not pending orders)\n  useEffect(() => {\n    if (!position) return;\n\n    // Check if this is a pending order\n    const isPendingOrder = position.type === 'Buy Limit' || position.type === 'Sell Limit' ||\n      position.type === 'Buy Stop' || position.type === 'Sell Stop';\n\n    // Don't calculate P/L for pending orders\n    if (isPendingOrder) {\n      setEstimatedPL(null);\n      return;\n    }\n\n    // Parse prices, removing commas and formatting\n    const currentPriceStr = String(position.currentPrice || position.price || '0').replace(/,/g, '');\n    const openPriceStr = String(position.openPrice || position.avg_price || position.price || '0').replace(/,/g, '');\n    const currentPrice = parseFloat(currentPriceStr) || 0;\n    const openPrice = parseFloat(openPriceStr) || 0;\n    const volume = parseFloat(position.volume || position.qty || 0);\n    const isBuy = position.type === 'Buy' || position.side === 1;\n    const symbol = (position.symbol || '').toUpperCase();\n\n    // Get contract size based on symbol type\n    let contractSize: number;\n    if (symbol.includes('XAU') || symbol.includes('XAG')) {\n      contractSize = 100; // Metals: 1 lot = 100 oz\n    } else if (symbol.includes('BTC') || symbol.includes('ETH')) {\n      contractSize = 1; // Crypto: 1 lot = 1 unit\n    } else {\n      contractSize = 100000; // Forex: 1 lot = 100,000 units\n    }\n\n    // Calculate current P/L\n    let priceDiff = isBuy ? (currentPrice - openPrice) : (openPrice - currentPrice);\n    let currentPL = priceDiff * volume * contractSize;\n\n    // If TP is set and would be hit, calculate P/L at TP\n    // Remove commas from tpValue before parsing\n    const tpValueClean = String(tpValue || '').replace(/,/g, '');\n    const tp = parseFloat(tpValueClean);\n    if (tp && !isNaN(tp) && tp > 0) {\n      const tpDiff = isBuy ? (tp - openPrice) : (openPrice - tp);\n      const tpPL = tpDiff * volume * contractSize;\n      setEstimatedPL(tpPL);\n      return;\n    }\n\n    // If SL is set and would be hit, calculate P/L at SL\n    // Remove commas from slValue before parsing\n    const slValueClean = String(slValue || '').replace(/,/g, '');\n    const sl = parseFloat(slValueClean);\n    if (sl && !isNaN(sl) && sl > 0) {\n      const slDiff = isBuy ? (sl - openPrice) : (openPrice - sl);\n      const slPL = slDiff * volume * contractSize;\n      setEstimatedPL(slPL);\n      return;\n    }\n\n    // Otherwise show current P/L\n    setEstimatedPL(currentPL);\n  }, [tpValue, slValue, position]);\n\n  if (!isOpen || !position) return null;\n\n  const handleBackdropClick = (e) => {\n    if (e.target === e.currentTarget) {\n      onClose();\n    }\n  };\n\n  const adjustValue = (setter, currentValue, delta, decimals = 2) => {\n    // Get current price from position, removing commas\n    const currentPriceStr = String(position.currentPrice || position.price || '0').replace(/,/g, '');\n    const currentPrice = parseFloat(currentPriceStr) || 0;\n\n    // If currentValue is empty, \"Not set\", \"Add\", or 0, use current price as base\n    // Also remove commas from currentValue before parsing\n    const isEmpty = !currentValue || currentValue === '' || currentValue === 'Not set' || currentValue === 'Add' || currentValue === '0';\n    const currentValueClean = String(currentValue || '').replace(/,/g, '');\n    const baseVal = isEmpty ? currentPrice : (parseFloat(currentValueClean) || currentPrice);\n\n    // Calculate appropriate delta based on price magnitude\n    // For prices around 88,000, we need a delta of 100, not 0.1\n    let adjustedDelta: number;\n    if (baseVal >= 10000) {\n      adjustedDelta = 100; // For prices >= 10,000 (e.g., BTCUSD)\n    } else if (baseVal >= 1000) {\n      adjustedDelta = 10; // For prices >= 1,000\n    } else if (baseVal >= 100) {\n      adjustedDelta = 1; // For prices >= 100\n    } else if (baseVal >= 10) {\n      adjustedDelta = 0.1; // For prices >= 10\n    } else {\n      adjustedDelta = 0.01; // For prices < 10\n    }\n\n    // Apply the sign from the original delta\n    adjustedDelta = adjustedDelta * (delta > 0 ? 1 : -1);\n\n    // Apply delta and format\n    const newVal = (baseVal + adjustedDelta).toFixed(decimals);\n    setter(newVal);\n  };\n\n  const handleAction = async () => {\n    if (activeTab === 'modify') {\n      try {\n        // Use ticket for pending orders, id for open positions\n        const orderId = position.ticket || position.id;\n\n        console.log('[ModifyPositionModal] handleAction', { position, orderId, tpValue, slValue });\n\n        if (!orderId) {\n          console.error('[ModifyPositionModal] No orderId found');\n          return;\n        }\n\n        // Clean and parse TP/SL values, removing commas\n        let tp: number | undefined = undefined;\n        let sl: number | undefined = undefined;\n\n        if (tpValue && tpValue !== '' && tpValue !== 'Not set' && tpValue !== 'Add') {\n          const tpClean = String(tpValue).replace(/,/g, '').trim();\n          const tpParsed = parseFloat(tpClean);\n          if (!isNaN(tpParsed) && tpParsed > 0 && isFinite(tpParsed)) {\n            tp = tpParsed;\n          }\n        }\n\n        if (slValue && slValue !== '' && slValue !== 'Not set' && slValue !== 'Add') {\n          const slClean = String(slValue).replace(/,/g, '').trim();\n          const slParsed = parseFloat(slClean);\n          if (!isNaN(slParsed) && slParsed > 0 && isFinite(slParsed)) {\n            sl = slParsed;\n          }\n        }\n\n        // Only proceed if at least one value is being modified\n        if (tp === undefined && sl === undefined) {\n          console.log('[ModifyPositionModal] No changes detected');\n          onClose();\n          return;\n        }\n\n        console.log('[ModifyPositionModal] Requesting modify:', { id: orderId, tp, sl });\n        requestModifyPosition({\n          id: orderId,\n          tp: tp,\n          sl: sl\n        });\n      } catch (error) {\n      }\n    }\n    // Add logic for partial close / close by if needed\n    onClose();\n  };\n\n  return ReactDOM.createPortal(\n    <div\n      className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/10\"\n      onClick={handleBackdropClick}\n    >\n      <div className=\"bg-[#02040d] border border-gray-800 rounded-lg w-[400px] shadow-2xl overflow-hidden font-sans text-gray-200\">\n        {/* Header */}\n        <div className=\"px-4 pt-4 pb-2 flex justify-between items-start\">\n          {/* Left Column: Symbol info */}\n          <div>\n            <div className=\"flex items-center gap-3 mb-0.5\">\n              <div className=\"w-6 h-6 relative\">\n                <FlagIcon type={position.flag || 'xauusd'} />\n              </div>\n              <div className=\"flex items-baseline gap-2\">\n                <span className=\"text-[16px] font-bold text-gray-100 tracking-wide\">{position.symbol}</span>\n                <span className=\"text-[13px] text-[#8b9096] font-normal\">{position.volume} lots</span>\n              </div>\n            </div>\n            <div className=\"flex gap-1 pl-9 text-[13px]\">\n              <span className={`font-medium ${position.type === 'Buy' || position.side === 1 ? 'text-[#0099ff]' : 'text-[#f6465d]'}`}>\n                {position.type || (position.side === 1 ? 'Buy' : 'Sell')}\n              </span>\n              <span className=\"text-[#8b9096]\">at {position.openPrice || position.price}</span>\n            </div>\n          </div>\n\n          {/* Right Column: P/L, Price, Close */}\n          <div className=\"flex items-start gap-4\">\n            <div className=\"text-right\">\n              <div className={`flex items-baseline justify-end gap-1 ${parseFloat(position.pl) >= 0 ? 'text-[#00ffaa]' : 'text-[#ff444f]'}`}>\n                <span className=\"text-[15px] font-medium\">{position.pl || '0.00'}</span>\n                <span className=\"text-[11px] text-[#8b9096]\">USD</span>\n              </div>\n              <div className=\"text-[#e1e1e1] font-medium text-[13px]\">\n                {position.currentPrice || position.price}\n              </div>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"text-[#8b9096] hover:text-white transition-colors cursor-pointer mt-1\"\n            >\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"px-4 py-3\">\n          <div className=\"flex bg-[#02040d] p-[3px] rounded border border-[#2a3038]\">\n            {['Modify', 'Partial close'].map((tab) => {\n              const id = tab.toLowerCase().replace(' ', '');\n              const isActive = activeTab === id;\n              return (\n                <button\n                  key={id}\n                  onClick={() => setActiveTab(id)}\n                  className={`flex-1 py-1.5 text-[13px] font-medium rounded-[4px] transition-all ${isActive\n                    ? 'bg-[#8b5cf6] text-black shadow-sm'\n                    : 'text-[#8b9096] hover:text-white'\n                    }`}\n                >\n                  {tab}\n                </button>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"px-4 pb-4 space-y-4\">\n          {activeTab === 'modify' ? (\n            <>\n              {/* Take Profit */}\n              <div>\n                <div className=\"flex items-center justify-between mb-1.5\">\n                  <label className=\"text-[12px] text-[#8b9096] font-medium\">Take Profit</label>\n                  <Tooltip text=\"Set a Take Profit if you want your order to close automatically at the price level you have specified. Setting a Take Profit allows you to lock in profits.\" placement=\"top\">\n                    <div className=\"text-[#8b9096] cursor-help hover:text-white transition-colors\">\n                      <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                      </svg>\n                    </div>\n                  </Tooltip>\n                </div>\n                <div className=\"flex h-[38px] border border-[#2a3038] rounded hover:border-[#8b9096] transition-colors group focus-within:border-[#0099ff] bg-[#1e222d]\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Not set\"\n                    value={tpValue}\n                    onChange={(e) => setTpValue(e.target.value)}\n                    className=\"flex-1 bg-transparent px-3 text-[14px] text-white placeholder-[#585c63] outline-none\"\n                  />\n                  <div className=\"flex items-center border-l border-[#2a3038]\">\n                    <button className=\"px-3 h-full text-[12px] text-[#8b9096] hover:text-white flex items-center gap-1 transition-colors hover:bg-[#2a3038]\">\n                      Price\n                      <svg className=\"w-2.5 h-2.5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path d=\"M7 10l5 5 5-5z\" />\n                      </svg>\n                    </button>\n                    <div className=\"flex h-full border-l border-[#2a3038]\">\n                      <button\n                        onClick={() => adjustValue(setTpValue, tpValue, -0.1)}\n                        className=\"w-[32px] h-full flex items-center justify-center text-[#8b9096] hover:bg-[#2a3038] hover:text-white transition-colors\"\n                      >\n                        <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 12H4\" />\n                        </svg>\n                      </button>\n                      <div className=\"w-[1px] h-full bg-[#2a3038]\"></div>\n                      <button\n                        onClick={() => adjustValue(setTpValue, tpValue, 0.1)}\n                        className=\"w-[32px] h-full flex items-center justify-center text-[#8b9096] hover:bg-[#2a3038] hover:text-white transition-colors\"\n                      >\n                        <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                        </svg>\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Stop Loss */}\n              <div>\n                <div className=\"flex items-center justify-between mb-1.5\">\n                  <label className=\"text-[12px] text-[#8b9096] font-medium\">Stop Loss</label>\n                  <Tooltip text=\"Set a Stop Loss if you want your order to close automatically at the price level you have specified. Setting a Stop Loss enables you to limit losses.\" placement=\"top\">\n                    <div className=\"text-[#8b9096] cursor-help hover:text-white transition-colors\">\n                      <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                      </svg>\n                    </div>\n                  </Tooltip>\n                </div>\n                <div className=\"flex h-[38px] border border-[#2a3038] rounded hover:border-[#8b9096] transition-colors group focus-within:border-[#0099ff] bg-[#1e222d]\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Not set\"\n                    value={slValue}\n                    onChange={(e) => setSlValue(e.target.value)}\n                    className=\"flex-1 bg-transparent px-3 text-[14px] text-white placeholder-[#585c63] outline-none\"\n                  />\n                  <div className=\"flex items-center border-l border-[#2a3038]\">\n                    <button className=\"px-3 h-full text-[12px] text-[#8b9096] hover:text-white flex items-center gap-1 transition-colors hover:bg-[#2a3038]\">\n                      Price\n                      <svg className=\"w-2.5 h-2.5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path d=\"M7 10l5 5 5-5z\" />\n                      </svg>\n                    </button>\n                    <div className=\"flex h-full border-l border-[#2a3038]\">\n                      <button\n                        onClick={() => adjustValue(setSlValue, slValue, -0.1)}\n                        className=\"w-[32px] h-full flex items-center justify-center text-[#8b9096] hover:bg-[#2a3038] hover:text-white transition-colors\"\n                      >\n                        <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 12H4\" />\n                        </svg>\n                      </button>\n                      <div className=\"w-[1px] h-full bg-[#2a3038]\"></div>\n                      <button\n                        onClick={() => adjustValue(setSlValue, slValue, 0.1)}\n                        className=\"w-[32px] h-full flex items-center justify-center text-[#8b9096] hover:bg-[#2a3038] hover:text-white transition-colors\"\n                      >\n                        <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                        </svg>\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </>\n          ) : activeTab === 'partialclose' ? (\n            <>\n              {/* Volume to close */}\n              <div>\n                <div className=\"flex items-center justify-between mb-1.5\">\n                  <label className=\"text-[12px] text-[#e1e1e1] font-medium\">Volume to close</label>\n                </div>\n                <div className=\"flex h-[38px] border border-[#2a3038] rounded hover:border-[#8b9096] transition-colors group focus-within:border-[#0099ff] bg-[#1e222d]\">\n                  <div className=\"flex-1 flex items-center px-3\">\n                    <input\n                      type=\"text\"\n                      value={partialVolume}\n                      onChange={(e) => setPartialVolume(e.target.value)}\n                      className=\"w-full bg-transparent text-[14px] text-white placeholder-[#585c63] outline-none\"\n                    />\n                    <span className=\"text-[14px] text-[#8b9096] ml-2\">Lots</span>\n                  </div>\n                  <div className=\"flex h-full border-l border-[#2a3038]\">\n                    <button\n                      onClick={() => adjustValue(setPartialVolume, partialVolume, -0.01)}\n                      className=\"w-[32px] h-full flex items-center justify-center text-[#8b9096] hover:bg-[#2a3038] hover:text-white transition-colors\"\n                    >\n                      <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 12H4\" />\n                      </svg>\n                    </button>\n                    <div className=\"w-[1px] h-full bg-[#2a3038]\"></div>\n                    <button\n                      onClick={() => adjustValue(setPartialVolume, partialVolume, 0.01)}\n                      className=\"w-[32px] h-full flex items-center justify-center text-[#8b9096] hover:bg-[#2a3038] hover:text-white transition-colors\"\n                    >\n                      <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                      </svg>\n                    </button>\n                  </div>\n                </div>\n                <div className=\"mt-1 text-[12px] text-[#8b9096]\">\n                  0.01 - {position.volume}\n                </div>\n              </div>\n            </>\n          ) : null}\n\n          {/* Estimated P/L Display */}\n          {activeTab === 'modify' && estimatedPL !== null && (\n            <div className=\"text-center text-[13px] text-[#8b9096] mb-2\">\n              Estimated P/L: <span className={estimatedPL >= 0 ? 'text-[#00ffaa]' : 'text-[#ff444f]'}>\n                {estimatedPL >= 0 ? '+' : ''}{estimatedPL.toFixed(2)} USD\n              </span>\n            </div>\n          )}\n\n          {/* Action Button */}\n          <button\n            onClick={handleAction}\n            className=\"w-full h-[40px] bg-[#8b5cf6] hover:bg-[#8b5cf6] text-black text-[14px] font-medium rounded transition-colors mt-2\"\n          >\n            {activeTab === 'modify' ? 'Modify position' : 'Close position'}\n          </button>\n\n          {activeTab === 'partialclose' && (\n            <div className=\"text-center text-[13px] text-[#8b9096]\">\n              Estimated profit: <span className={position.plColor}>{position.pl} USD</span>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>,\n    document.body\n  );\n};\n\nexport default ModifyPositionModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11021, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/ui/OrderPlacedToast.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect } from 'react'\nimport ReactDOM from 'react-dom'\n\nexport default function OrderPlacedToast({ order, onClose }) {\n  useEffect(() => {\n    if (!order) return;\n    \n    const timer = setTimeout(() => {\n      onClose()\n    }, 5000)\n    return () => clearTimeout(timer)\n  }, [order]) // Remove onClose from dependencies to prevent timer reset\n\n  if (!order) return null\n\n  // Format the order type display\n  const getOrderTypeLabel = () => {\n    if (order.orderType === 'market') {\n      return order.side === 'buy' ? 'Buy' : 'Sell';\n    } else if (order.orderType === 'limit') {\n      return order.side === 'buy' ? 'Buy Limit' : 'Sell Limit';\n    } else if (order.orderType === 'stop') {\n      return order.side === 'buy' ? 'Buy Stop' : 'Sell Stop';\n    }\n    return order.side === 'buy' ? 'Buy' : 'Sell';\n  };\n\n  // Format price display\n  const priceDisplay = order.price && !isNaN(parseFloat(order.price))\n    ? parseFloat(order.price).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 6 })\n    : null;\n\n  // Format volume display\n  const volumeDisplay = parseFloat(order.volume).toFixed(2);\n\n  // If there's an error, show error toast\n  if (order.error) {\n    return ReactDOM.createPortal(\n      <div className=\"fixed bottom-4 left-4 z-[99999] bg-[#02040d] text-[#b2b5be] rounded-md shadow-lg border border-red-500/50 w-[320px] overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-300\">\n        <div className=\"p-4 relative\">\n          <button\n            onClick={onClose}\n            className=\"absolute top-2 right-2 text-[#6e757c] hover:text-white transition-colors\"\n          >\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n              <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" />\n              <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" />\n            </svg>\n          </button>\n\n          <div className=\"flex items-start gap-3\">\n            <div className=\"mt-0.5 text-[#f6465d]\">\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                <circle cx=\"12\" cy=\"12\" r=\"10\" />\n                <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\" />\n                <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\" />\n              </svg>\n            </div>\n\n            <div className=\"flex-1\">\n              <h3 className=\"text-white font-medium text-[14px] leading-tight mb-1\">Not enough money</h3>\n              <p className=\"text-[13px] text-[#b2b5be]\">\n                {order.error}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>,\n      document.body\n    );\n  }\n\n  return ReactDOM.createPortal(\n    <div className=\"fixed bottom-4 left-4 z-[99999] bg-[#02040d] text-[#b2b5be] rounded-md shadow-lg border border-gray-800 w-[320px] overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-300\">\n      <div className=\"p-4 relative\">\n        <button\n          onClick={onClose}\n          className=\"absolute top-2 right-2 text-[#6e757c] hover:text-white transition-colors\"\n        >\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" />\n            <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" />\n          </svg>\n        </button>\n\n        <div className=\"flex items-start gap-3\">\n          <div className=\"mt-0.5 text-[#2ebd85]\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n              <circle cx=\"12\" cy=\"12\" r=\"10\" />\n              <polyline points=\"9 11 12 14 22 4\" />\n            </svg>\n          </div>\n\n          <div className=\"flex-1\">\n            <h3 className=\"text-white font-medium text-[14px] leading-tight mb-1\">\n              {order.isModified ? 'Order Modified' : 'Order placed'}\n            </h3>\n            <p className=\"text-[13px] text-[#b2b5be] mb-3\">\n              {getOrderTypeLabel()} {volumeDisplay} lot {order.symbol} {priceDisplay ? `at ${priceDisplay}` : ''}\n            </p>\n\n            {order.profit !== undefined && order.profit !== null && (\n              <div className=\"flex items-center justify-between text-[13px]\">\n                <span className=\"text-[#b2b5be]\">Profit</span>\n                <span className={`font-medium font-mono ${order.profit >= 0 ? 'text-[#2ebd85]' : 'text-[#f6465d]'}`}>\n                  {order.profit >= 0 ? '+' : ''}{order.profit.toFixed(2)} USD\n                </span>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>,\n    document.body\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11385, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/components/trading/TradingTerminal.tsx"],"sourcesContent":["'use client';\n\nimport { useRef, useEffect, useState, useCallback } from 'react'\nimport { ChevronLeft } from 'lucide-react'\nimport LeftSidebar from '@/components/layout/LeftSidebar'\nimport ChartSection from '@/components/layout/ChartSection'\nimport OrderPanel from '@/components/trading/OrderPanel'\nimport { ResizablePanelGroup, ResizablePanel, ResizableHandle } from '@/components/ui/resizable'\nimport StatusBar from '@/components/layout/StatusBar'\n\nimport { useSidebar } from '@/context/SidebarContext'\nimport { useTrading } from '@/context/TradingContext'\nimport { useInstruments } from '@/context/InstrumentContext'\n\nimport { ImperativePanelHandle } from 'react-resizable-panels'\n\nimport ModifyPositionModal from '@/components/modals/ModifyPositionModal'\nimport OrderPlacedToast from '@/components/ui/OrderPlacedToast'\nimport ReactDOM from 'react-dom'\n\nexport default function TradingTerminal() {\n  const { isSidebarExpanded, setIsSidebarExpanded } = useSidebar();\n  const { symbol } = useTrading();\n  const { instruments } = useInstruments();\n  const [marketClosedToast, setMarketClosedToast] = useState<string | null>(null);\n  const leftPanelRef = useRef<ImperativePanelHandle>(null)\n  const [orderToast, setOrderToast] = useState<any>(null)\n  const [isRightSidebarOpen, setIsRightSidebarOpen] = useState(true)\n\n  // Read-only demo: Close-all is disabled, but we keep the prop for StatusBar API.\n  const handleCloseAll = useCallback((_option: string) => {\n    // no-op in demo mode\n  }, []);\n\n  // Memoize toast close handlers to prevent timer resets\n  const handleOrderToastClose = useCallback(() => {\n    setOrderToast(null);\n  }, []);\n\n  // Read-only demo: no positions or history\n  const openPositions: any[] = [];\n\n  // Order placement handlers\n  const handleBuyOrder = async (orderData: any) => {\n    setOrderToast({\n      side: 'buy',\n      symbol: symbol || 'BTCUSD',\n      volume: orderData.volume || 0,\n      price: null,\n      orderType: orderData.orderType || 'market',\n      profit: null,\n      error: 'Trading is disabled in Demo Mode.',\n    });\n  };\n\n  const handleSellOrder = async (orderData: any) => {\n    setOrderToast({\n      side: 'sell',\n      symbol: symbol || 'BTCUSD',\n      volume: orderData.volume || 0,\n      price: null,\n      orderType: orderData.orderType || 'market',\n      profit: null,\n      error: 'Trading is disabled in Demo Mode.',\n    });\n  };\n\n  // Demo mode: position modification is fully disabled; chart brackets are visual-only\n\n  // Resize the left panel when it expands or collapses\n  useEffect(() => {\n    if (leftPanelRef.current) {\n      if (isSidebarExpanded) {\n        leftPanelRef.current.resize(23) // 15% ‚âà 290px on 1920px screen\n      } else {\n        leftPanelRef.current.resize(0)\n      }\n    }\n  }, [isSidebarExpanded])\n\n  return (\n    <>\n      <ResizablePanelGroup direction=\"horizontal\" className=\"flex-1 overflow-hidden min-h-0\">\n        {/* Left sidebar with panels */}\n        <ResizablePanel\n          ref={leftPanelRef}\n          defaultSize={20}\n          minSize={8}\n          maxSize={40}\n          className={`min-h-0 h-full ${!isSidebarExpanded ? \"!min-w-[48px] !max-w-[48px] !flex-none\" : \"\"}`}\n          collapsedSize={0}\n          collapsible={true}\n          onCollapse={() => setIsSidebarExpanded(false)}\n          onExpand={() => setIsSidebarExpanded(true)}\n        >\n          <LeftSidebar\n            onPanelStateChange={setIsSidebarExpanded}\n            isExpanded={isSidebarExpanded}\n          />\n        </ResizablePanel>\n\n        {/* Horizontal resize handle */}\n        <ResizableHandle withHandle={false} disabled={!isSidebarExpanded} className={!isSidebarExpanded ? \"pointer-events-none w-0\" : \"\"} />\n\n        {/* Main content area with status bar */}\n        <ResizablePanel defaultSize={80} className=\"flex flex-col h-full gap-1\">\n          {/* Top content area */}\n          <div className=\"relative flex flex-1 overflow-hidden gap-1\">\n            <div className=\"flex flex-col flex-1 min-w-0 overflow-hidden\">\n              {/* Chart section - Demo Mode: Full Height */}\n              <div className=\"flex-1 min-h-0 overflow-hidden\">\n                <ChartSection />\n              </div>\n            </div>\n\n            {/* Order Panel */}\n            {isRightSidebarOpen && (\n              <div className=\"w-[280px] border-l border-[#2a2f36] bg-background flex-shrink-0\">\n                <OrderPanel\n                  onClose={() => setIsRightSidebarOpen(false)}\n                  onBuy={handleBuyOrder}\n                  onSell={handleSellOrder}\n                />\n              </div>\n            )}\n\n            {/* Floating Open Button */}\n            {!isRightSidebarOpen && (\n              <button\n                onClick={() => setIsRightSidebarOpen(true)}\n                className=\"absolute right-0 top-2 z-50 bg-background border border-[#2a2f36] border-r-0 text-gray-400 hover:text-white transition-colors p-1.5 rounded-l-md shadow-lg cursor-pointer\"\n                title=\"Open Order Panel\"\n              >\n                <ChevronLeft size={20} />\n              </button>\n            )}\n          </div>\n\n          {/* Status bar only for center and right areas */}\n          <StatusBar\n            openPositions={openPositions}\n            onCloseAll={handleCloseAll}\n          />\n        </ResizablePanel>\n      </ResizablePanelGroup>\n      <ModifyPositionModal />\n      <OrderPlacedToast\n        order={orderToast}\n        onClose={handleOrderToastClose}\n      />\n      {marketClosedToast && ReactDOM.createPortal(\n        <div className=\"fixed bottom-4 left-4 z-[99999] bg-[#0b0e14] text-[#d1d5db] rounded-md shadow-lg border border-amber-500/60 w-[320px] overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-300\">\n          <div className=\"p-4 relative\">\n            <button\n              onClick={() => setMarketClosedToast(null)}\n              className=\"absolute top-2 right-2 text-[#9ca3af] hover:text-white transition-colors\"\n            >\n              √ó\n            </button>\n            <div className=\"flex items-start gap-3\">\n              <div className=\"mt-0.5 text-amber-400\">‚ö†</div>\n              <div className=\"flex-1\">\n                <h3 className=\"text-white font-medium text-[14px] leading-tight mb-1\">Market closed</h3>\n                <p className=\"text-[13px] text-[#d1d5db]\">{marketClosedToast}</p>\n              </div>\n            </div>\n          </div>\n        </div>,\n        document.body\n      )}\n    </>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11681, "column": 0}, "map": {"version":3,"sources":["file:///Users/akhilesh/Desktop/PycharmProjects/Terminal/demo-terminal-iframe/src/app/page.tsx"],"sourcesContent":["'use client';\n\nimport TradingTerminal from '@/components/trading/TradingTerminal';\n\nexport default function Home() {\n  return <TradingTerminal />;\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIe,SAAS;IACtB,qBAAO,8OAAC,2JAAe;;;;;AACzB"}}]
}